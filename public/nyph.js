!function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(e),a=n(t),o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var s=function(e){return e&&e.Math==Math&&e},l=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof o&&o)||function(){return this}()||Function("return this")(),c={exports:{}},u=l,d=function(e,t){try{Object.defineProperty(u,e,{value:t,configurable:!0,writable:!0})}catch(n){u[e]=t}return t},h=d,f=l["__core-js_shared__"]||h("__core-js_shared__",{}),p=f;(c.exports=function(e,t){return p[e]||(p[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.18.3",mode:"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"});var v,m,y=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},g=y,b=function(e){return Object(g(e))},E=b,w={}.hasOwnProperty,_=Object.hasOwn||function(e,t){return w.call(E(e),t)},x=0,S=Math.random(),k=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++x+S).toString(36)},I=function(e){return"function"==typeof e},T=l,C=I,R=function(e){return C(e)?e:void 0},O=function(e,t){return arguments.length<2?R(T[e]):T[e]&&T[e][t]},N=O("navigator","userAgent")||"",A=l,L=N,P=A.process,H=A.Deno,M=P&&P.versions||H&&H.version,D=M&&M.v8;D?m=(v=D.split("."))[0]<4?1:v[0]+v[1]:L&&(!(v=L.match(/Edge\/(\d+)/))||v[1]>=74)&&(v=L.match(/Chrome\/(\d+)/))&&(m=v[1]);var j=m&&+m,F=function(e){try{return!!e()}catch(e){return!0}},B=j,V=F,q=!!Object.getOwnPropertySymbols&&!V((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&B&&B<41})),W=q&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,U=l,G=c.exports,Y=_,z=k,K=q,X=W,Q=G("wks"),J=U.Symbol,Z=X?J:J&&J.withoutSetter||z,ee=function(e){return Y(Q,e)&&(K||"string"==typeof Q[e])||(K&&Y(J,e)?Q[e]=J[e]:Q[e]=Z("Symbol."+e)),Q[e]},te={};te[ee("toStringTag")]="z";var ne="[object z]"===String(te),re={exports:{}},ae=!F((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),oe={},ie=I,se=function(e){return"object"==typeof e?null!==e:ie(e)},le=se,ce=l.document,ue=le(ce)&&le(ce.createElement),de=function(e){return ue?ce.createElement(e):{}},he=de,fe=!ae&&!F((function(){return 7!=Object.defineProperty(he("div"),"a",{get:function(){return 7}}).a})),pe=se,ve=function(e){if(pe(e))return e;throw TypeError(String(e)+" is not an object")},me=I,ye=O,ge=W?function(e){return"symbol"==typeof e}:function(e){var t=ye("Symbol");return me(t)&&Object(e)instanceof t},be=function(e){try{return String(e)}catch(e){return"Object"}},Ee=I,we=be,_e=function(e){if(Ee(e))return e;throw TypeError(we(e)+" is not a function")},xe=_e,Se=function(e,t){var n=e[t];return null==n?void 0:xe(n)},ke=I,Ie=se,Te=se,Ce=ge,Re=Se,Oe=function(e,t){var n,r;if("string"===t&&ke(n=e.toString)&&!Ie(r=n.call(e)))return r;if(ke(n=e.valueOf)&&!Ie(r=n.call(e)))return r;if("string"!==t&&ke(n=e.toString)&&!Ie(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},Ne=ee("toPrimitive"),Ae=function(e,t){if(!Te(e)||Ce(e))return e;var n,r=Re(e,Ne);if(r){if(void 0===t&&(t="default"),n=r.call(e,t),!Te(n)||Ce(n))return n;throw TypeError("Can't convert object to primitive value")}return void 0===t&&(t="number"),Oe(e,t)},Le=ge,Pe=function(e){var t=Ae(e,"string");return Le(t)?t:String(t)},He=ae,Me=fe,De=ve,je=Pe,Fe=Object.defineProperty;oe.f=He?Fe:function(e,t,n){if(De(e),t=je(t),De(n),Me)try{return Fe(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var Be=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Ve=oe,qe=Be,We=ae?function(e,t,n){return Ve.f(e,t,qe(1,n))}:function(e,t,n){return e[t]=n,e},Ue=I,Ge=f,$e=Function.toString;Ue(Ge.inspectSource)||(Ge.inspectSource=function(e){return $e.call(e)});var Ye,ze,Ke,Xe=Ge.inspectSource,Qe=I,Je=Xe,Ze=l.WeakMap,et=Qe(Ze)&&/native code/.test(Je(Ze)),tt=c.exports,nt=k,rt=tt("keys"),at=function(e){return rt[e]||(rt[e]=nt(e))},ot={},it=et,st=se,lt=We,ct=_,ut=f,dt=at,ht=ot,ft=l.WeakMap;if(it||ut.state){var pt=ut.state||(ut.state=new ft),vt=pt.get,mt=pt.has,yt=pt.set;Ye=function(e,t){if(mt.call(pt,e))throw new TypeError("Object already initialized");return t.facade=e,yt.call(pt,e,t),t},ze=function(e){return vt.call(pt,e)||{}},Ke=function(e){return mt.call(pt,e)}}else{var gt=dt("state");ht[gt]=!0,Ye=function(e,t){if(ct(e,gt))throw new TypeError("Object already initialized");return t.facade=e,lt(e,gt,t),t},ze=function(e){return ct(e,gt)?e[gt]:{}},Ke=function(e){return ct(e,gt)}}var bt={set:Ye,get:ze,has:Ke,enforce:function(e){return Ke(e)?ze(e):Ye(e,{})},getterFor:function(e){return function(t){var n;if(!st(t)||(n=ze(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},Et=ae,wt=_,_t=Function.prototype,xt=Et&&Object.getOwnPropertyDescriptor,St=wt(_t,"name"),kt={EXISTS:St,PROPER:St&&"something"===function(){}.name,CONFIGURABLE:St&&(!Et||Et&&xt(_t,"name").configurable)},It=l,Tt=I,Ct=_,Rt=We,Ot=d,Nt=Xe,At=kt.CONFIGURABLE,Lt=bt.get,Pt=bt.enforce,Ht=String(String).split("String");(re.exports=function(e,t,n,r){var a,o=!!r&&!!r.unsafe,i=!!r&&!!r.enumerable,s=!!r&&!!r.noTargetGet,l=r&&void 0!==r.name?r.name:t;Tt(n)&&("Symbol("===String(l).slice(0,7)&&(l="["+String(l).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!Ct(n,"name")||At&&n.name!==l)&&Rt(n,"name",l),(a=Pt(n)).source||(a.source=Ht.join("string"==typeof l?l:""))),e!==It?(o?!s&&e[t]&&(i=!0):delete e[t],i?e[t]=n:Rt(e,t,n)):i?e[t]=n:Ot(t,n)})(Function.prototype,"toString",(function(){return Tt(this)&&Lt(this).source||Nt(this)}));var Mt={}.toString,Dt=function(e){return Mt.call(e).slice(8,-1)},jt=ne,Ft=I,Bt=Dt,Vt=ee("toStringTag"),qt="Arguments"==Bt(function(){return arguments}()),Wt=jt?Bt:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Vt))?n:qt?Bt(t):"Object"==(r=Bt(t))&&Ft(t.callee)?"Arguments":r},Ut=Wt,Gt=ne?{}.toString:function(){return"[object "+Ut(this)+"]"},$t=ne,Yt=re.exports,zt=Gt;$t||Yt(Object.prototype,"toString",zt,{unsafe:!0});var Kt={},Xt={},Qt={}.propertyIsEnumerable,Jt=Object.getOwnPropertyDescriptor,Zt=Jt&&!Qt.call({1:2},1);Xt.f=Zt?function(e){var t=Jt(this,e);return!!t&&t.enumerable}:Qt;var en=Dt,tn="".split,nn=F((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==en(e)?tn.call(e,""):Object(e)}:Object,rn=nn,an=y,on=function(e){return rn(an(e))},sn=ae,ln=Xt,cn=Be,un=on,dn=Pe,hn=_,fn=fe,pn=Object.getOwnPropertyDescriptor;Kt.f=sn?pn:function(e,t){if(e=un(e),t=dn(t),fn)try{return pn(e,t)}catch(e){}if(hn(e,t))return cn(!ln.f.call(e,t),e[t])};var vn={},mn=Math.ceil,yn=Math.floor,gn=function(e){var t=+e;return t!=t||0===t?0:(t>0?yn:mn)(t)},bn=gn,En=Math.max,wn=Math.min,_n=function(e,t){var n=bn(e);return n<0?En(n+t,0):wn(n,t)},xn=gn,Sn=Math.min,kn=function(e){return e>0?Sn(xn(e),9007199254740991):0},In=kn,Tn=function(e){return In(e.length)},Cn=on,Rn=_n,On=Tn,Nn=function(e){return function(t,n,r){var a,o=Cn(t),i=On(o),s=Rn(r,i);if(e&&n!=n){for(;i>s;)if((a=o[s++])!=a)return!0}else for(;i>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},An={includes:Nn(!0),indexOf:Nn(!1)},Ln=_,Pn=on,Hn=An.indexOf,Mn=ot,Dn=function(e,t){var n,r=Pn(e),a=0,o=[];for(n in r)!Ln(Mn,n)&&Ln(r,n)&&o.push(n);for(;t.length>a;)Ln(r,n=t[a++])&&(~Hn(o,n)||o.push(n));return o},jn=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Fn=Dn,Bn=jn.concat("length","prototype");vn.f=Object.getOwnPropertyNames||function(e){return Fn(e,Bn)};var Vn={};Vn.f=Object.getOwnPropertySymbols;var qn=vn,Wn=Vn,Un=ve,Gn=O("Reflect","ownKeys")||function(e){var t=qn.f(Un(e)),n=Wn.f;return n?t.concat(n(e)):t},$n=_,Yn=Gn,zn=Kt,Kn=oe,Xn=F,Qn=I,Jn=/#|\.prototype\./,Zn=function(e,t){var n=tr[er(e)];return n==rr||n!=nr&&(Qn(t)?Xn(t):!!t)},er=Zn.normalize=function(e){return String(e).replace(Jn,".").toLowerCase()},tr=Zn.data={},nr=Zn.NATIVE="N",rr=Zn.POLYFILL="P",ar=Zn,or=l,ir=Kt.f,sr=We,lr=re.exports,cr=d,ur=function(e,t){for(var n=Yn(t),r=Kn.f,a=zn.f,o=0;o<n.length;o++){var i=n[o];$n(e,i)||r(e,i,a(t,i))}},dr=ar,hr=function(e,t){var n,r,a,o,i,s=e.target,l=e.global,c=e.stat;if(n=l?or:c?or[s]||cr(s,{}):(or[s]||{}).prototype)for(r in t){if(o=t[r],a=e.noTargetGet?(i=ir(n,r))&&i.value:n[r],!dr(l?r:s+(c?".":"#")+r,e.forced)&&void 0!==a){if(typeof o==typeof a)continue;ur(o,a)}(e.sham||a&&a.sham)&&sr(o,"sham",!0),lr(n,r,o,e)}},fr=l.Promise,pr=re.exports,vr=function(e,t,n){for(var r in t)pr(e,r,t[r],n);return e},mr=I,yr=ve,gr=function(e){if("object"==typeof e||mr(e))return e;throw TypeError("Can't set "+String(e)+" as a prototype")},br=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return yr(n),gr(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),Er=oe.f,wr=_,_r=ee("toStringTag"),xr=function(e,t,n){e&&!wr(e=n?e:e.prototype,_r)&&Er(e,_r,{configurable:!0,value:t})},Sr=O,kr=oe,Ir=ae,Tr=ee("species"),Cr=function(e){var t=Sr(e),n=kr.f;Ir&&t&&!t[Tr]&&n(t,Tr,{configurable:!0,get:function(){return this}})},Rr=function(e,t,n){if(e instanceof t)return e;throw TypeError("Incorrect "+(n?n+" ":"")+"invocation")},Or={},Nr=Or,Ar=ee("iterator"),Lr=Array.prototype,Pr=_e,Hr=function(e,t,n){if(Pr(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,a){return e.call(t,n,r,a)}}return function(){return e.apply(t,arguments)}},Mr=Wt,Dr=Se,jr=Or,Fr=ee("iterator"),Br=function(e){if(null!=e)return Dr(e,Fr)||Dr(e,"@@iterator")||jr[Mr(e)]},Vr=_e,qr=ve,Wr=Br,Ur=ve,Gr=Se,$r=ve,Yr=function(e){return void 0!==e&&(Nr.Array===e||Lr[Ar]===e)},zr=Tn,Kr=Hr,Xr=function(e,t){var n=arguments.length<2?Wr(e):t;if(Vr(n))return qr(n.call(e));throw TypeError(String(e)+" is not iterable")},Qr=Br,Jr=function(e,t,n){var r,a;Ur(e);try{if(!(r=Gr(e,"return"))){if("throw"===t)throw n;return n}r=r.call(e)}catch(e){a=!0,r=e}if("throw"===t)throw n;if(a)throw r;return Ur(r),n},Zr=function(e,t){this.stopped=e,this.result=t},ea=function(e,t,n){var r,a,o,i,s,l,c,u=n&&n.that,d=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_ITERATOR),f=!(!n||!n.INTERRUPTED),p=Kr(t,u,1+d+f),v=function(e){return r&&Jr(r,"normal",e),new Zr(!0,e)},m=function(e){return d?($r(e),f?p(e[0],e[1],v):p(e[0],e[1])):f?p(e,v):p(e)};if(h)r=e;else{if(!(a=Qr(e)))throw TypeError(String(e)+" is not iterable");if(Yr(a)){for(o=0,i=zr(e);i>o;o++)if((s=m(e[o]))&&s instanceof Zr)return s;return new Zr(!1)}r=Xr(e,a)}for(l=r.next;!(c=l.call(r)).done;){try{s=m(c.value)}catch(e){Jr(r,"throw",e)}if("object"==typeof s&&s&&s instanceof Zr)return s}return new Zr(!1)},ta=ee("iterator"),na=!1;try{var ra=0,aa={next:function(){return{done:!!ra++}},return:function(){na=!0}};aa[ta]=function(){return this},Array.from(aa,(function(){throw 2}))}catch(e){}var oa,ia,sa,la,ca=function(e,t){if(!t&&!na)return!1;var n=!1;try{var r={};r[ta]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},ua=F,da=I,ha=Wt,fa=Xe,pa=[],va=O("Reflect","construct"),ma=/^\s*(?:class|function)\b/,ya=ma.exec,ga=!ma.exec((function(){})),ba=function(e){if(!da(e))return!1;try{return va(Object,pa,e),!0}catch(e){return!1}},Ea=!va||ua((function(){var e;return ba(ba.call)||!ba(Object)||!ba((function(){e=!0}))||e}))?function(e){if(!da(e))return!1;switch(ha(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return ga||!!ya.call(ma,fa(e))}:ba,wa=Ea,_a=be,xa=ve,Sa=function(e){if(wa(e))return e;throw TypeError(_a(e)+" is not a constructor")},ka=ee("species"),Ia=function(e,t){var n,r=xa(e).constructor;return void 0===r||null==(n=xa(r)[ka])?t:Sa(n)},Ta=O("document","documentElement"),Ca=/(?:ipad|iphone|ipod).*applewebkit/i.test(N),Ra="process"==Dt(l.process),Oa=l,Na=I,Aa=F,La=Hr,Pa=Ta,Ha=de,Ma=Ca,Da=Ra,ja=Oa.setImmediate,Fa=Oa.clearImmediate,Ba=Oa.process,Va=Oa.MessageChannel,qa=Oa.Dispatch,Wa=0,Ua={};try{oa=Oa.location}catch(e){}var Ga=function(e){if(Ua.hasOwnProperty(e)){var t=Ua[e];delete Ua[e],t()}},$a=function(e){return function(){Ga(e)}},Ya=function(e){Ga(e.data)},za=function(e){Oa.postMessage(String(e),oa.protocol+"//"+oa.host)};ja&&Fa||(ja=function(e){for(var t=[],n=arguments.length,r=1;n>r;)t.push(arguments[r++]);return Ua[++Wa]=function(){(Na(e)?e:Function(e)).apply(void 0,t)},ia(Wa),Wa},Fa=function(e){delete Ua[e]},Da?ia=function(e){Ba.nextTick($a(e))}:qa&&qa.now?ia=function(e){qa.now($a(e))}:Va&&!Ma?(la=(sa=new Va).port2,sa.port1.onmessage=Ya,ia=La(la.postMessage,la,1)):Oa.addEventListener&&Na(Oa.postMessage)&&!Oa.importScripts&&oa&&"file:"!==oa.protocol&&!Aa(za)?(ia=za,Oa.addEventListener("message",Ya,!1)):ia="onreadystatechange"in Ha("script")?function(e){Pa.appendChild(Ha("script")).onreadystatechange=function(){Pa.removeChild(this),Ga(e)}}:function(e){setTimeout($a(e),0)});var Ka,Xa,Qa,Ja,Za,eo,to,no,ro={set:ja,clear:Fa},ao=l,oo=/ipad|iphone|ipod/i.test(N)&&void 0!==ao.Pebble,io=/web0s(?!.*chrome)/i.test(N),so=l,lo=Kt.f,co=ro.set,uo=Ca,ho=oo,fo=io,po=Ra,vo=so.MutationObserver||so.WebKitMutationObserver,mo=so.document,yo=so.process,go=so.Promise,bo=lo(so,"queueMicrotask"),Eo=bo&&bo.value;Eo||(Ka=function(){var e,t;for(po&&(e=yo.domain)&&e.exit();Xa;){t=Xa.fn,Xa=Xa.next;try{t()}catch(e){throw Xa?Ja():Qa=void 0,e}}Qa=void 0,e&&e.enter()},uo||po||fo||!vo||!mo?!ho&&go&&go.resolve?((to=go.resolve(void 0)).constructor=go,no=to.then,Ja=function(){no.call(to,Ka)}):Ja=po?function(){yo.nextTick(Ka)}:function(){co.call(so,Ka)}:(Za=!0,eo=mo.createTextNode(""),new vo(Ka).observe(eo,{characterData:!0}),Ja=function(){eo.data=Za=!Za}));var wo=Eo||function(e){var t={fn:e,next:void 0};Qa&&(Qa.next=t),Xa||(Xa=t,Ja()),Qa=t},_o={},xo=_e,So=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=xo(t),this.reject=xo(n)};_o.f=function(e){return new So(e)};var ko,Io,To,Co,Ro=ve,Oo=se,No=_o,Ao=function(e,t){if(Ro(e),Oo(t)&&t.constructor===e)return t;var n=No.f(e);return(0,n.resolve)(t),n.promise},Lo=l,Po="object"==typeof window,Ho=hr,Mo=l,Do=O,jo=fr,Fo=re.exports,Bo=vr,Vo=br,qo=xr,Wo=Cr,Uo=_e,Go=I,$o=se,Yo=Rr,zo=Xe,Ko=ea,Xo=ca,Qo=Ia,Jo=ro.set,Zo=wo,ei=Ao,ti=function(e,t){var n=Lo.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},ni=_o,ri=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},ai=bt,oi=ar,ii=Po,si=Ra,li=j,ci=ee("species"),ui="Promise",di=ai.get,hi=ai.set,fi=ai.getterFor(ui),pi=jo&&jo.prototype,vi=jo,mi=pi,yi=Mo.TypeError,gi=Mo.document,bi=Mo.process,Ei=ni.f,wi=Ei,_i=!!(gi&&gi.createEvent&&Mo.dispatchEvent),xi=Go(Mo.PromiseRejectionEvent),Si=!1,ki=oi(ui,(function(){var e=zo(vi),t=e!==String(vi);if(!t&&66===li)return!0;if(li>=51&&/native code/.test(e))return!1;var n=new vi((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[ci]=r,!(Si=n.then((function(){}))instanceof r)||!t&&ii&&!xi})),Ii=ki||!Xo((function(e){vi.all(e).catch((function(){}))})),Ti=function(e){var t;return!(!$o(e)||!Go(t=e.then))&&t},Ci=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;Zo((function(){for(var r=e.value,a=1==e.state,o=0;n.length>o;){var i,s,l,c=n[o++],u=a?c.ok:c.fail,d=c.resolve,h=c.reject,f=c.domain;try{u?(a||(2===e.rejection&&Ai(e),e.rejection=1),!0===u?i=r:(f&&f.enter(),i=u(r),f&&(f.exit(),l=!0)),i===c.promise?h(yi("Promise-chain cycle")):(s=Ti(i))?s.call(i,d,h):d(i)):h(r)}catch(e){f&&!l&&f.exit(),h(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&Oi(e)}))}},Ri=function(e,t,n){var r,a;_i?((r=gi.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Mo.dispatchEvent(r)):r={promise:t,reason:n},!xi&&(a=Mo["on"+e])?a(r):"unhandledrejection"===e&&ti("Unhandled promise rejection",n)},Oi=function(e){Jo.call(Mo,(function(){var t,n=e.facade,r=e.value;if(Ni(e)&&(t=ri((function(){si?bi.emit("unhandledRejection",r,n):Ri("unhandledrejection",n,r)})),e.rejection=si||Ni(e)?2:1,t.error))throw t.value}))},Ni=function(e){return 1!==e.rejection&&!e.parent},Ai=function(e){Jo.call(Mo,(function(){var t=e.facade;si?bi.emit("rejectionHandled",t):Ri("rejectionhandled",t,e.value)}))},Li=function(e,t,n){return function(r){e(t,r,n)}},Pi=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Ci(e,!0))},Hi=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw yi("Promise can't be resolved itself");var r=Ti(t);r?Zo((function(){var n={done:!1};try{r.call(t,Li(Hi,n,e),Li(Pi,n,e))}catch(t){Pi(n,t,e)}})):(e.value=t,e.state=1,Ci(e,!1))}catch(t){Pi({done:!1},t,e)}}};if(ki&&(mi=(vi=function(e){Yo(this,vi,ui),Uo(e),ko.call(this);var t=di(this);try{e(Li(Hi,t),Li(Pi,t))}catch(e){Pi(t,e)}}).prototype,(ko=function(e){hi(this,{type:ui,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=Bo(mi,{then:function(e,t){var n=fi(this),r=Ei(Qo(this,vi));return r.ok=!Go(e)||e,r.fail=Go(t)&&t,r.domain=si?bi.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Ci(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Io=function(){var e=new ko,t=di(e);this.promise=e,this.resolve=Li(Hi,t),this.reject=Li(Pi,t)},ni.f=Ei=function(e){return e===vi||e===To?new Io(e):wi(e)},Go(jo)&&pi!==Object.prototype)){Co=pi.then,Si||(Fo(pi,"then",(function(e,t){var n=this;return new vi((function(e,t){Co.call(n,e,t)})).then(e,t)}),{unsafe:!0}),Fo(pi,"catch",mi.catch,{unsafe:!0}));try{delete pi.constructor}catch(e){}Vo&&Vo(pi,mi)}Ho({global:!0,wrap:!0,forced:ki},{Promise:vi}),qo(vi,ui,!1),Wo(ui),To=Do(ui),Ho({target:ui,stat:!0,forced:ki},{reject:function(e){var t=Ei(this);return t.reject.call(void 0,e),t.promise}}),Ho({target:ui,stat:!0,forced:ki},{resolve:function(e){return ei(this,e)}}),Ho({target:ui,stat:!0,forced:Ii},{all:function(e){var t=this,n=Ei(t),r=n.resolve,a=n.reject,o=ri((function(){var n=Uo(t.resolve),o=[],i=0,s=1;Ko(e,(function(e){var l=i++,c=!1;o.push(void 0),s++,n.call(t,e).then((function(e){c||(c=!0,o[l]=e,--s||r(o))}),a)})),--s||r(o)}));return o.error&&a(o.value),n.promise},race:function(e){var t=this,n=Ei(t),r=n.reject,a=ri((function(){var a=Uo(t.resolve);Ko(e,(function(e){a.call(t,e).then(n.resolve,r)}))}));return a.error&&r(a.value),n.promise}});var Mi=hr,Di=fr,ji=F,Fi=O,Bi=I,Vi=Ia,qi=Ao,Wi=re.exports;if(Mi({target:"Promise",proto:!0,real:!0,forced:!!Di&&ji((function(){Di.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=Vi(this,Fi("Promise")),n=Bi(e);return this.then(n?function(n){return qi(t,e()).then((function(){return n}))}:e,n?function(n){return qi(t,e()).then((function(){throw n}))}:e)}}),Bi(Di)){var Ui=Fi("Promise").prototype.finally;Di.prototype.finally!==Ui&&Wi(Di.prototype,"finally",Ui,{unsafe:!0})}function Gi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Yi(e,t,n){return t&&$i(e.prototype,t),n&&$i(e,n),e}function zi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ki(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qi(e,t)}function Xi(e){return(Xi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qi(e,t){return(Qi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ji(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Zi(e,t,n){return(Zi=Ji()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&Qi(a,n.prototype),a}).apply(null,arguments)}function es(e){var t="function"==typeof Map?new Map:void 0;return(es=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return Zi(e,arguments,Xi(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Qi(r,e)})(e)}function ts(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ns(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ts(e)}function rs(e){var t=Ji();return function(){var n,r=Xi(e);if(t){var a=Xi(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return ns(this,n)}}function as(e,t,n){return(as="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Xi(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function os(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}(e,t)||ss(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function is(e){return function(e){if(Array.isArray(e))return ls(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ss(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ss(e,t){if(e){if("string"==typeof e)return ls(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ls(e,t):void 0}}function ls(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function cs(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=ss(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function us(e,t){return vs(e,hs(e,t,"get"))}function ds(e,t,n){return ms(e,hs(e,t,"set"),n),n}function hs(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function fs(e,t,n){return ys(e,t),gs(n,"get"),vs(e,n)}function ps(e,t,n,r){return ys(e,t),gs(n,"set"),ms(e,n,r),r}function vs(e,t){return t.get?t.get.call(e):t.value}function ms(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}function ys(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function gs(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function bs(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function Es(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ws(e,t,n){Es(e,t),t.set(e,n)}function _s(e,t){Es(e,t),t.add(e)}var xs=Dt,Ss=Array.isArray||function(e){return"Array"==xs(e)},ks=Pe,Is=oe,Ts=Be,Cs=function(e,t,n){var r=ks(t);r in e?Is.f(e,r,Ts(0,n)):e[r]=n},Rs=Ss,Os=Ea,Ns=se,As=ee("species"),Ls=function(e){var t;return Rs(e)&&(t=e.constructor,(Os(t)&&(t===Array||Rs(t.prototype))||Ns(t)&&null===(t=t[As]))&&(t=void 0)),void 0===t?Array:t},Ps=function(e,t){return new(Ls(e))(0===t?0:t)},Hs=F,Ms=j,Ds=ee("species"),js=function(e){return Ms>=51||!Hs((function(){var t=[];return(t.constructor={})[Ds]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Fs=hr,Bs=F,Vs=Ss,qs=se,Ws=b,Us=Tn,Gs=Cs,$s=Ps,Ys=js,zs=j,Ks=ee("isConcatSpreadable"),Xs=zs>=51||!Bs((function(){var e=[];return e[Ks]=!1,e.concat()[0]!==e})),Qs=Ys("concat"),Js=function(e){if(!qs(e))return!1;var t=e[Ks];return void 0!==t?!!t:Vs(e)};Fs({target:"Array",proto:!0,forced:!Xs||!Qs},{concat:function(e){var t,n,r,a,o,i=Ws(this),s=$s(i,0),l=0;for(t=-1,r=arguments.length;t<r;t++)if(Js(o=-1===t?i:arguments[t])){if(l+(a=Us(o))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<a;n++,l++)n in o&&Gs(s,l,o[n])}else{if(l>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Gs(s,l++,o)}return s.length=l,s}});var Zs,el=Dn,tl=jn,nl=Object.keys||function(e){return el(e,tl)},rl=oe,al=ve,ol=nl,il=ae?Object.defineProperties:function(e,t){al(e);for(var n,r=ol(t),a=r.length,o=0;a>o;)rl.f(e,n=r[o++],t[n]);return e},sl=ve,ll=il,cl=jn,ul=ot,dl=Ta,hl=de,fl=at("IE_PROTO"),pl=function(){},vl=function(e){return"<script>"+e+"<\/script>"},ml=function(e){e.write(vl("")),e.close();var t=e.parentWindow.Object;return e=null,t},yl=function(){try{Zs=new ActiveXObject("htmlfile")}catch(e){}var e,t;yl="undefined"!=typeof document?document.domain&&Zs?ml(Zs):((t=hl("iframe")).style.display="none",dl.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(vl("document.F=Object")),e.close(),e.F):ml(Zs);for(var n=cl.length;n--;)delete yl.prototype[cl[n]];return yl()};ul[fl]=!0;var gl=Object.create||function(e,t){var n;return null!==e?(pl.prototype=sl(e),n=new pl,pl.prototype=null,n[fl]=e):n=yl(),void 0===t?n:ll(n,t)},bl=gl,El=oe,wl=ee("unscopables"),_l=Array.prototype;null==_l[wl]&&El.f(_l,wl,{configurable:!0,value:bl(null)});var xl,Sl,kl,Il=function(e){_l[wl][e]=!0},Tl=!F((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Cl=_,Rl=I,Ol=b,Nl=Tl,Al=at("IE_PROTO"),Ll=Object.prototype,Pl=Nl?Object.getPrototypeOf:function(e){var t=Ol(e);if(Cl(t,Al))return t[Al];var n=t.constructor;return Rl(n)&&t instanceof n?n.prototype:t instanceof Object?Ll:null},Hl=F,Ml=I,Dl=Pl,jl=re.exports,Fl=ee("iterator"),Bl=!1;[].keys&&("next"in(kl=[].keys())?(Sl=Dl(Dl(kl)))!==Object.prototype&&(xl=Sl):Bl=!0),(null==xl||Hl((function(){var e={};return xl[Fl].call(e)!==e})))&&(xl={}),Ml(xl[Fl])||jl(xl,Fl,(function(){return this}));var Vl={IteratorPrototype:xl,BUGGY_SAFARI_ITERATORS:Bl},ql=Vl.IteratorPrototype,Wl=gl,Ul=Be,Gl=xr,$l=Or,Yl=function(){return this},zl=hr,Kl=kt,Xl=I,Ql=function(e,t,n){var r=t+" Iterator";return e.prototype=Wl(ql,{next:Ul(1,n)}),Gl(e,r,!1),$l[r]=Yl,e},Jl=Pl,Zl=br,ec=xr,tc=We,nc=re.exports,rc=Or,ac=Kl.PROPER,oc=Kl.CONFIGURABLE,ic=Vl.IteratorPrototype,sc=Vl.BUGGY_SAFARI_ITERATORS,lc=ee("iterator"),cc=function(){return this},uc=function(e,t,n,r,a,o,i){Ql(n,t,r);var s,l,c,u=function(e){if(e===a&&v)return v;if(!sc&&e in f)return f[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",h=!1,f=e.prototype,p=f[lc]||f["@@iterator"]||a&&f[a],v=!sc&&p||u(a),m="Array"==t&&f.entries||p;if(m&&(s=Jl(m.call(new e)))!==Object.prototype&&s.next&&(Jl(s)!==ic&&(Zl?Zl(s,ic):Xl(s[lc])||nc(s,lc,cc)),ec(s,d,!0)),ac&&"values"==a&&p&&"values"!==p.name&&(oc?tc(f,"name","values"):(h=!0,v=function(){return p.call(this)})),a)if(l={values:u("values"),keys:o?v:u("keys"),entries:u("entries")},i)for(c in l)(sc||h||!(c in f))&&nc(f,c,l[c]);else zl({target:t,proto:!0,forced:sc||h},l);return f[lc]!==v&&nc(f,lc,v,{name:a}),rc[t]=v,l},dc=on,hc=Il,fc=Or,pc=bt,vc=uc,mc=pc.set,yc=pc.getterFor("Array Iterator"),gc=vc(Array,"Array",(function(e,t){mc(this,{type:"Array Iterator",target:dc(e),index:0,kind:t})}),(function(){var e=yc(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");fc.Arguments=fc.Array,hc("keys"),hc("values"),hc("entries");var bc=Wt,Ec=function(e){if("Symbol"===bc(e))throw TypeError("Cannot convert a Symbol value to a string");return String(e)},wc=gn,_c=Ec,xc=y,Sc=function(e){return function(t,n){var r,a,o=_c(xc(t)),i=wc(n),s=o.length;return i<0||i>=s?e?"":void 0:(r=o.charCodeAt(i))<55296||r>56319||i+1===s||(a=o.charCodeAt(i+1))<56320||a>57343?e?o.charAt(i):r:e?o.slice(i,i+2):a-56320+(r-55296<<10)+65536}},kc={codeAt:Sc(!1),charAt:Sc(!0)},Ic=kc.charAt,Tc=Ec,Cc=bt,Rc=uc,Oc=Cc.set,Nc=Cc.getterFor("String Iterator");Rc(String,"String",(function(e){Oc(this,{type:"String Iterator",string:Tc(e),index:0})}),(function(){var e,t=Nc(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=Ic(n,r),t.index+=e.length,{value:e,done:!1})}));var Ac={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Lc=de("span").classList,Pc=Lc&&Lc.constructor&&Lc.constructor.prototype,Hc=Pc===Object.prototype?void 0:Pc,Mc=l,Dc=Ac,jc=Hc,Fc=gc,Bc=We,Vc=ee,qc=Vc("iterator"),Wc=Vc("toStringTag"),Uc=Fc.values,Gc=function(e,t){if(e){if(e[qc]!==Uc)try{Bc(e,qc,Uc)}catch(t){e[qc]=Uc}if(e[Wc]||Bc(e,Wc,t),Dc[t])for(var n in Fc)if(e[n]!==Fc[n])try{Bc(e,n,Fc[n])}catch(t){e[n]=Fc[n]}}};for(var $c in Dc)Gc(Mc[$c]&&Mc[$c].prototype,$c);Gc(jc,"DOMTokenList");var Yc=An.includes,zc=Il;hr({target:"Array",proto:!0},{includes:function(e){return Yc(this,e,arguments.length>1?arguments[1]:void 0)}}),zc("includes");var Kc=se,Xc=Dt,Qc=ee("match"),Jc=function(e){var t;return Kc(e)&&(void 0!==(t=e[Qc])?!!t:"RegExp"==Xc(e))},Zc=Jc,eu=ee("match"),tu=function(e){if(Zc(e))throw TypeError("The method doesn't accept regular expressions");return e},nu=y,ru=Ec;hr({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[eu]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~ru(nu(this)).indexOf(ru(tu(e)),arguments.length>1?arguments[1]:void 0)}});var au=ve,ou=function(){var e=au(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},iu={},su=F,lu=l.RegExp;iu.UNSUPPORTED_Y=su((function(){var e=lu("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),iu.BROKEN_CARET=su((function(){var e=lu("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));var cu=F,uu=l.RegExp,du=cu((function(){var e=uu(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),hu=F,fu=l.RegExp,pu=hu((function(){var e=fu("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),vu=Ec,mu=ou,yu=iu,gu=c.exports,bu=gl,Eu=bt.get,wu=du,_u=pu,xu=RegExp.prototype.exec,Su=gu("native-string-replace",String.prototype.replace),ku=xu,Iu=function(){var e=/a/,t=/b*/g;return xu.call(e,"a"),xu.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),Tu=yu.UNSUPPORTED_Y||yu.BROKEN_CARET,Cu=void 0!==/()??/.exec("")[1];(Iu||Cu||Tu||wu||_u)&&(ku=function(e){var t,n,r,a,o,i,s,l=this,c=Eu(l),u=vu(e),d=c.raw;if(d)return d.lastIndex=l.lastIndex,t=ku.call(d,u),l.lastIndex=d.lastIndex,t;var h=c.groups,f=Tu&&l.sticky,p=mu.call(l),v=l.source,m=0,y=u;if(f&&(-1===(p=p.replace("y","")).indexOf("g")&&(p+="g"),y=u.slice(l.lastIndex),l.lastIndex>0&&(!l.multiline||l.multiline&&"\n"!==u.charAt(l.lastIndex-1))&&(v="(?: "+v+")",y=" "+y,m++),n=new RegExp("^(?:"+v+")",p)),Cu&&(n=new RegExp("^"+v+"$(?!\\s)",p)),Iu&&(r=l.lastIndex),a=xu.call(f?n:l,y),f?a?(a.input=a.input.slice(m),a[0]=a[0].slice(m),a.index=l.lastIndex,l.lastIndex+=a[0].length):l.lastIndex=0:Iu&&a&&(l.lastIndex=l.global?a.index+a[0].length:r),Cu&&a&&a.length>1&&Su.call(a[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(a[o]=void 0)})),a&&h)for(a.groups=i=bu(null),o=0;o<h.length;o++)i[(s=h[o])[0]]=a[s[1]];return a});var Ru=ku;hr({target:"RegExp",proto:!0,forced:/./.exec!==Ru},{exec:Ru});var Ou=re.exports,Nu=Ru,Au=F,Lu=ee,Pu=We,Hu=Lu("species"),Mu=RegExp.prototype,Du=function(e,t,n,r){var a=Lu(e),o=!Au((function(){var t={};return t[a]=function(){return 7},7!=""[e](t)})),i=o&&!Au((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[Hu]=function(){return n},n.flags="",n[a]=/./[a]),n.exec=function(){return t=!0,null},n[a](""),!t}));if(!o||!i||n){var s=/./[a],l=t(a,""[e],(function(e,t,n,r,a){var i=t.exec;return i===Nu||i===Mu.exec?o&&!a?{done:!0,value:s.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}));Ou(String.prototype,e,l[0]),Ou(Mu,a,l[1])}r&&Pu(Mu[a],"sham",!0)},ju=kc.charAt,Fu=function(e,t,n){return t+(n?ju(e,t).length:1)},Bu=ve,Vu=I,qu=Dt,Wu=Ru,Uu=function(e,t){var n=e.exec;if(Vu(n)){var r=n.call(e,t);return null!==r&&Bu(r),r}if("RegExp"===qu(e))return Wu.call(e,t);throw TypeError("RegExp#exec called on incompatible receiver")},Gu=Du,$u=Jc,Yu=ve,zu=y,Ku=Ia,Xu=Fu,Qu=kn,Ju=Ec,Zu=Se,ed=Uu,td=Ru,nd=F,rd=iu.UNSUPPORTED_Y,ad=[].push,od=Math.min;Gu("split",(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=Ju(zu(this)),a=void 0===n?4294967295:n>>>0;if(0===a)return[];if(void 0===e)return[r];if(!$u(e))return t.call(r,e,a);for(var o,i,s,l=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),u=0,d=new RegExp(e.source,c+"g");(o=td.call(d,r))&&!((i=d.lastIndex)>u&&(l.push(r.slice(u,o.index)),o.length>1&&o.index<r.length&&ad.apply(l,o.slice(1)),s=o[0].length,u=i,l.length>=a));)d.lastIndex===o.index&&d.lastIndex++;return u===r.length?!s&&d.test("")||l.push(""):l.push(r.slice(u)),l.length>a?l.slice(0,a):l}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var a=zu(this),o=null==t?void 0:Zu(t,e);return o?o.call(t,a,n):r.call(Ju(a),t,n)},function(e,a){var o=Yu(this),i=Ju(e),s=n(r,o,i,a,r!==t);if(s.done)return s.value;var l=Ku(o,RegExp),c=o.unicode,u=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(rd?"g":"y"),d=new l(rd?"^(?:"+o.source+")":o,u),h=void 0===a?4294967295:a>>>0;if(0===h)return[];if(0===i.length)return null===ed(d,i)?[i]:[];for(var f=0,p=0,v=[];p<i.length;){d.lastIndex=rd?0:p;var m,y=ed(d,rd?i.slice(p):i);if(null===y||(m=od(Qu(d.lastIndex+(rd?p:0)),i.length))===f)p=Xu(i,p,c);else{if(v.push(i.slice(f,p)),v.length===h)return v;for(var g=1;g<=y.length-1;g++)if(v.push(y[g]),v.length===h)return v;p=f=m}}return v.push(i.slice(f)),v}]}),!!nd((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),rd);var id={exports:{}},sd={},ld=on,cd=vn.f,ud={}.toString,dd="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];sd.f=function(e){return dd&&"[object Window]"==ud.call(e)?function(e){try{return cd(e)}catch(e){return dd.slice()}}(e):cd(ld(e))};var hd=!F((function(){return Object.isExtensible(Object.preventExtensions({}))})),fd=hr,pd=ot,vd=se,md=_,yd=oe.f,gd=vn,bd=sd,Ed=hd,wd=!1,_d=k("meta"),xd=0,Sd=Object.isExtensible||function(){return!0},kd=function(e){yd(e,_d,{value:{objectID:"O"+xd++,weakData:{}}})},Id=id.exports={enable:function(){Id.enable=function(){},wd=!0;var e=gd.f,t=[].splice,n={};n[_d]=1,e(n).length&&(gd.f=function(n){for(var r=e(n),a=0,o=r.length;a<o;a++)if(r[a]===_d){t.call(r,a,1);break}return r},fd({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:bd.f}))},fastKey:function(e,t){if(!vd(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!md(e,_d)){if(!Sd(e))return"F";if(!t)return"E";kd(e)}return e[_d].objectID},getWeakData:function(e,t){if(!md(e,_d)){if(!Sd(e))return!0;if(!t)return!1;kd(e)}return e[_d].weakData},onFreeze:function(e){return Ed&&wd&&Sd(e)&&!md(e,_d)&&kd(e),e}};pd[_d]=!0;var Td=I,Cd=se,Rd=br,Od=function(e,t,n){var r,a;return Rd&&Td(r=t.constructor)&&r!==n&&Cd(a=r.prototype)&&a!==n.prototype&&Rd(e,a),e},Nd=hr,Ad=l,Ld=ar,Pd=re.exports,Hd=id.exports,Md=ea,Dd=Rr,jd=I,Fd=se,Bd=F,Vd=ca,qd=xr,Wd=Od,Ud=function(e,t,n){var r=-1!==e.indexOf("Map"),a=-1!==e.indexOf("Weak"),o=r?"set":"add",i=Ad[e],s=i&&i.prototype,l=i,c={},u=function(e){var t=s[e];Pd(s,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(a&&!Fd(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return a&&!Fd(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(a&&!Fd(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(Ld(e,!jd(i)||!(a||s.forEach&&!Bd((function(){(new i).entries().next()})))))l=n.getConstructor(t,e,r,o),Hd.enable();else if(Ld(e,!0)){var d=new l,h=d[o](a?{}:-0,1)!=d,f=Bd((function(){d.has(1)})),p=Vd((function(e){new i(e)})),v=!a&&Bd((function(){for(var e=new i,t=5;t--;)e[o](t,t);return!e.has(-0)}));p||((l=t((function(t,n){Dd(t,l,e);var a=Wd(new i,t,l);return null!=n&&Md(n,a[o],{that:a,AS_ENTRIES:r}),a}))).prototype=s,s.constructor=l),(f||v)&&(u("delete"),u("has"),r&&u("get")),(v||h)&&u(o),a&&s.clear&&delete s.clear}return c[e]=l,Nd({global:!0,forced:l!=i},c),qd(l,e),a||n.setStrong(l,e,r),l},Gd=oe.f,$d=gl,Yd=vr,zd=Hr,Kd=Rr,Xd=ea,Qd=uc,Jd=Cr,Zd=ae,eh=id.exports.fastKey,th=bt.set,nh=bt.getterFor;Ud("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(e,t,n,r){var a=e((function(e,o){Kd(e,a,t),th(e,{type:t,index:$d(null),first:void 0,last:void 0,size:0}),Zd||(e.size=0),null!=o&&Xd(o,e[r],{that:e,AS_ENTRIES:n})})),o=nh(t),i=function(e,t,n){var r,a,i=o(e),l=s(e,t);return l?l.value=n:(i.last=l={index:a=eh(t,!0),key:t,value:n,previous:r=i.last,next:void 0,removed:!1},i.first||(i.first=l),r&&(r.next=l),Zd?i.size++:e.size++,"F"!==a&&(i.index[a]=l)),e},s=function(e,t){var n,r=o(e),a=eh(t);if("F"!==a)return r.index[a];for(n=r.first;n;n=n.next)if(n.key==t)return n};return Yd(a.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,Zd?e.size=0:this.size=0},delete:function(e){var t=o(this),n=s(this,e);if(n){var r=n.next,a=n.previous;delete t.index[n.index],n.removed=!0,a&&(a.next=r),r&&(r.previous=a),t.first==n&&(t.first=r),t.last==n&&(t.last=a),Zd?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=o(this),r=zd(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!s(this,e)}}),Yd(a.prototype,n?{get:function(e){var t=s(this,e);return t&&t.value},set:function(e,t){return i(this,0===e?0:e,t)}}:{add:function(e){return i(this,e=0===e?0:e,e)}}),Zd&&Gd(a.prototype,"size",{get:function(){return o(this).size}}),a},setStrong:function(e,t,n){var r=t+" Iterator",a=nh(t),o=nh(r);Qd(e,t,(function(e,t){th(this,{type:r,target:e,state:a(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),Jd(t)}});var rh=Hr,ah=nn,oh=b,ih=Tn,sh=Ps,lh=[].push,ch=function(e){var t=1==e,n=2==e,r=3==e,a=4==e,o=6==e,i=7==e,s=5==e||o;return function(l,c,u,d){for(var h,f,p=oh(l),v=ah(p),m=rh(c,u,3),y=ih(v),g=0,b=d||sh,E=t?b(l,y):n||i?b(l,0):void 0;y>g;g++)if((s||g in v)&&(f=m(h=v[g],g,p),e))if(t)E[g]=f;else if(f)switch(e){case 3:return!0;case 5:return h;case 6:return g;case 2:lh.call(E,h)}else switch(e){case 4:return!1;case 7:lh.call(E,h)}return o?-1:r||a?a:E}},uh={forEach:ch(0),map:ch(1),filter:ch(2),some:ch(3),every:ch(4),find:ch(5),findIndex:ch(6),filterReject:ch(7)},dh=vr,hh=id.exports.getWeakData,fh=ve,ph=se,vh=Rr,mh=ea,yh=_,gh=bt.set,bh=bt.getterFor,Eh=uh.find,wh=uh.findIndex,_h=0,xh=function(e){return e.frozen||(e.frozen=new Sh)},Sh=function(){this.entries=[]},kh=function(e,t){return Eh(e.entries,(function(e){return e[0]===t}))};Sh.prototype={get:function(e){var t=kh(this,e);if(t)return t[1]},has:function(e){return!!kh(this,e)},set:function(e,t){var n=kh(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=wh(this.entries,(function(t){return t[0]===e}));return~t&&this.entries.splice(t,1),!!~t}};var Ih,Th={getConstructor:function(e,t,n,r){var a=e((function(e,o){vh(e,a,t),gh(e,{type:t,id:_h++,frozen:void 0}),null!=o&&mh(o,e[r],{that:e,AS_ENTRIES:n})})),o=bh(t),i=function(e,t,n){var r=o(e),a=hh(fh(t),!0);return!0===a?xh(r).set(t,n):a[r.id]=n,e};return dh(a.prototype,{delete:function(e){var t=o(this);if(!ph(e))return!1;var n=hh(e);return!0===n?xh(t).delete(e):n&&yh(n,t.id)&&delete n[t.id]},has:function(e){var t=o(this);if(!ph(e))return!1;var n=hh(e);return!0===n?xh(t).has(e):n&&yh(n,t.id)}}),dh(a.prototype,n?{get:function(e){var t=o(this);if(ph(e)){var n=hh(e);return!0===n?xh(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return i(this,e,t)}}:{add:function(e){return i(this,e,!0)}}),a}},Ch=l,Rh=vr,Oh=id.exports,Nh=Ud,Ah=Th,Lh=se,Ph=bt.enforce,Hh=et,Mh=!Ch.ActiveXObject&&"ActiveXObject"in Ch,Dh=Object.isExtensible,jh=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Fh=Nh("WeakMap",jh,Ah);if(Hh&&Mh){Ih=Ah.getConstructor(jh,"WeakMap",!0),Oh.enable();var Bh=Fh.prototype,Vh=Bh.delete,qh=Bh.has,Wh=Bh.get,Uh=Bh.set;Rh(Bh,{delete:function(e){if(Lh(e)&&!Dh(e)){var t=Ph(this);return t.frozen||(t.frozen=new Ih),Vh.call(this,e)||t.frozen.delete(e)}return Vh.call(this,e)},has:function(e){if(Lh(e)&&!Dh(e)){var t=Ph(this);return t.frozen||(t.frozen=new Ih),qh.call(this,e)||t.frozen.has(e)}return qh.call(this,e)},get:function(e){if(Lh(e)&&!Dh(e)){var t=Ph(this);return t.frozen||(t.frozen=new Ih),qh.call(this,e)?Wh.call(this,e):t.frozen.get(e)}return Wh.call(this,e)},set:function(e,t){if(Lh(e)&&!Dh(e)){var n=Ph(this);n.frozen||(n.frozen=new Ih),qh.call(this,e)?Uh.call(this,e,t):n.frozen.set(e,t)}else Uh.call(this,e,t);return this}})}var Gh=new WeakMap,$h=function(){function e(){Gi(this,e),ws(this,Gh,{writable:!0,value:[]})}return Yi(e,[{key:"addListener",value:function(e,t,n,r){ds(this,Gh,us(this,Gh)||[]);var a="string"==typeof n?function(e,a,o){return t[n](e,a,o,r)}:function(e,a,o){return n.call(t,e,a,o,r)};return us(this,Gh)[e]?us(this,Gh)[e].push(a)-1:(us(this,Gh)[e]=[a],0)}},{key:"removeListener",value:function(e,t){us(this,Gh)[e]&&us(this,Gh)[e][t]?delete us(this,Gh)[e][t]:console.log("trying to remove non-existent event handler, event = "+e+" handle = "+t)}},{key:"destructor",value:function(){ds(this,Gh,null)}},{key:"fireEvent",value:function(t,n){if(us(this,Gh))for(var r in us(this,Gh)[t])if(us(this,Gh)[t].hasOwnProperty(r)&&us(this,Gh)[t][r](this,t,arguments[1])===e.STOP_PROPAGATION)break}}]),e}();zi($h,"STOP_PROPAGATION","STOP_PROPAGATION");var Yh=function(e){Ki(n,e);var t=rs(n);function n(){var e;Gi(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return zi(ts(e=t.call.apply(t,[this].concat(a))),"controller",void 0),e}return Yi(n,[{key:"initialise",value:function(){}},{key:"display",value:function(){console.log("got to view display"),this.refreshHeader(),this.body()}},{key:"refreshHeader",value:function(){}},{key:"body",value:function(){}},{key:"card",value:function(e){var t=document.createElement("div");t.id=e.cardId,t.className="card";var n=t.appendChild(document.createElement("div"));n.className="card-header pointer",e.cardHeadingId&&(n.id=e.cardHeadingId),n.setAttribute("data-toggle","collapse"),n.setAttribute("data-target","#".concat(e.cardDescriptionId));var r=n.appendChild(document.createElement("h2"));r.className="mb-0";var a=r.appendChild(document.createElement("button"));if(a.className="btn btn-link".concat(e.collapsed?" collapsed":""),e.headingButtonId&&(a.id=e.headingButtonId),a.type="button",a.setAttribute("data-toggle","collapse"),e.cardDescriptionId&&(a.setAttribute("data-target","#".concat(e.cardDescriptionId)),a.setAttribute("aria-controls",e.cardDescriptionId)),a.setAttribute("aria-expanded",e.collapsed?"false":"true"),a.innerHTML=e.headingHTML,e.headingNonbuttonHTML){var o=r.appendChild(document.createElement("span"));o.style.display="inline-block",o.innerHTML=e.headingNonbuttonHTML}if(e.headingValidationWarningHTML){var i=n.appendChild(document.createElement("div"));i.className="card-invalid-feedback",i.innerHTML="<small>".concat(e.headingValidationWarningHTML,"</small>")}var s=t.appendChild(document.createElement("div"));if(e.cardDescriptionId&&(s.id=e.cardDescriptionId),s.className="collapse".concat(e.collapsed?"":" show"),e.cardHeadingId&&s.setAttribute("aria-labelledby",e.cardHeadingId),s.setAttribute("data-parent","#".concat(e.parentContainerId)),e.dataAttributes)for(var l in e.dataAttributes)e.dataAttributes.hasOwnProperty(l)&&s.setAttribute("data-".concat(l),e.dataAttributes[l]);var c=s.appendChild(document.createElement("div"));return c.className="card-body pl-2 pr-2 pl-md-3 pr-md-3",c.appendChild(e.bodyContentElement),t}}]),n}($h),zh=function(e){Ki(n,e);var t=rs(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Yi(n,[{key:"body",value:function(){document.getElementById("body").innerHTML='<h2>Page not found</h2><p><a href="/app/list">Return to the homepage.</a>'}}]),n}(Yh),Kh=new WeakMap,Xh=new WeakMap,Qh=function(e){Ki(n,e);var t=rs(n);function n(){var e;return Gi(this,n),ws(ts(e=t.call(this)),Kh,{writable:!0,value:void 0}),ws(ts(e),Xh,{writable:!0,value:void 0}),zi(ts(e),"controllers",[]),zi(ts(e),"currentControllerHandle",!1),zi(ts(e),"routeHistory",[]),zi(ts(e),"occurrences",void 0),zi(ts(e),"surveys",void 0),zi(ts(e),"currentSurvey",void 0),zi(ts(e),"layout",void 0),e.reset(),e}return Yi(n,[{key:"reset",value:function(){this.surveys=new Map,this.clearCurrentSurvey()}},{key:"clearCurrentSurvey",value:function(){this.occurrences=new Map,this.currentSurvey=null}},{key:"router",get:function(){return us(this,Kh)},set:function(e){ds(this,Kh,e)}},{key:"containerId",set:function(e){var t=document.getElementById(e);if(!t)throw new Error("App container '".concat(e,"' not found."));ds(this,Xh,t)}},{key:"container",get:function(){return us(this,Xh)}},{key:"registerController",value:function(e){e.handle=this.controllers.length,this.controllers[this.controllers.length]=e,e.app=this,e.registerRoute(us(this,Kh))}},{key:"initialise",value:function(){var e=this;this.layout.initialise(),us(this,Kh).notFound((function(e){console.log("no route found for '".concat(e,"'")),(new zh).display()})),us(this,Kh).on((function(){console.log("redirecting from '/' to '/list'"),us(e,Kh).pause(),e.clearCurrentSurvey&&e.currentSurvey.isPristine?us(e,Kh).navigate("/list/survey/welcome").resume():us(e,Kh).navigate("/list").resume(),us(e,Kh).resolve()}));var t,n=cs(this.controllers);try{for(n.s();!(t=n.n()).done;){t.value.initialise()}}catch(e){n.e(e)}finally{n.f()}}},{key:"display",value:function(){console.log("App display"),us(this,Kh).resolve()}},{key:"saveRoute",value:function(){var e=us(this,Kh).lastRouteResolved();this.routeHistory.length?this.routeHistory[this.routeHistory.length-1]!==e&&(this.routeHistory[this.routeHistory.length]=e):this.routeHistory[0]=e}},{key:"markAllNotPristine",value:function(){var e,t=cs(this.occurrences);try{for(t.s();!(e=t.n()).done;){e.value[1].isPristine=!1}}catch(e){t.e(e)}finally{t.f()}}},{key:"setLayout",value:function(e){this.layout=e,e.setApp(this)}}]),n}($h);zi(Qh,"EVENT_ADD_SURVEY_USER_REQUEST","useraddsurveyrequest"),zi(Qh,"EVENT_RESET_SURVEYS","userresetsurveys");var Jh=kt.PROPER,Zh=re.exports,ef=ve,tf=Ec,nf=F,rf=ou,af=RegExp.prototype,of=af.toString,sf=nf((function(){return"/a/b"!=of.call({source:"a",flags:"b"})})),lf=Jh&&"toString"!=of.name;(sf||lf)&&Zh(RegExp.prototype,"toString",(function(){var e=ef(this),t=tf(e.source),n=e.flags;return"/"+t+"/"+tf(void 0===n&&e instanceof RegExp&&!("flags"in af)?rf.call(e):n)}),{unsafe:!0});var cf=y,uf=Ec,df="[\t\n\v\f\r                　\u2028\u2029\ufeff]",hf=RegExp("^"+df+df+"*"),ff=RegExp(df+df+"*$"),pf=function(e){return function(t){var n=uf(cf(t));return 1&e&&(n=n.replace(hf,"")),2&e&&(n=n.replace(ff,"")),n}},vf={start:pf(1),end:pf(2),trim:pf(3)},mf=kt.PROPER,yf=F,gf="\t\n\v\f\r                　\u2028\u2029\ufeff",bf=function(e){return yf((function(){return!!gf[e]()||"​᠎"!=="​᠎"[e]()||mf&&gf[e].name!==e}))},Ef=vf.trim;hr({target:"String",proto:!0,forced:bf("trim")},{trim:function(){return Ef(this)}});var wf=b,_f=Math.floor,xf="".replace,Sf=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,kf=/\$([$&'`]|\d{1,2})/g,If=Du,Tf=F,Cf=ve,Rf=I,Of=gn,Nf=kn,Af=Ec,Lf=y,Pf=Fu,Hf=Se,Mf=function(e,t,n,r,a,o){var i=n+e.length,s=r.length,l=kf;return void 0!==a&&(a=wf(a),l=Sf),xf.call(o,l,(function(o,l){var c;switch(l.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(i);case"<":c=a[l.slice(1,-1)];break;default:var u=+l;if(0===u)return o;if(u>s){var d=_f(u/10);return 0===d?o:d<=s?void 0===r[d-1]?l.charAt(1):r[d-1]+l.charAt(1):o}c=r[u-1]}return void 0===c?"":c}))},Df=Uu,jf=ee("replace"),Ff=Math.max,Bf=Math.min,Vf="$0"==="a".replace(/./,"$0"),qf=!!/./[jf]&&""===/./[jf]("a","$0");If("replace",(function(e,t,n){var r=qf?"$":"$0";return[function(e,n){var r=Lf(this),a=null==e?void 0:Hf(e,jf);return a?a.call(e,r,n):t.call(Af(r),e,n)},function(e,a){var o=Cf(this),i=Af(e);if("string"==typeof a&&-1===a.indexOf(r)&&-1===a.indexOf("$<")){var s=n(t,o,i,a);if(s.done)return s.value}var l=Rf(a);l||(a=Af(a));var c=o.global;if(c){var u=o.unicode;o.lastIndex=0}for(var d=[];;){var h=Df(o,i);if(null===h)break;if(d.push(h),!c)break;""===Af(h[0])&&(o.lastIndex=Pf(i,Nf(o.lastIndex),u))}for(var f,p="",v=0,m=0;m<d.length;m++){h=d[m];for(var y=Af(h[0]),g=Ff(Bf(Of(h.index),i.length),0),b=[],E=1;E<h.length;E++)b.push(void 0===(f=h[E])?f:String(f));var w=h.groups;if(l){var _=[y].concat(b,g,i);void 0!==w&&_.push(w);var x=Af(a.apply(void 0,_))}else x=Mf(y,i,g,b,w,a);g>=v&&(p+=i.slice(v,g)+x,v=g+y.length)}return p+i.slice(v)}]}),!!Tf((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!Vf||qf);var Wf={exports:{}};
/*!
	    localForage -- Offline Storage, Improved
	    Version 1.10.0
	    https://localforage.github.io/localForage
	    (c) 2013-2017 Mozilla, Apache License 2.0
	*/Wf.exports=function e(t,n,r){function a(s,l){if(!n[s]){if(!t[s]){if(!l&&i)return i(s);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,(function(e){var n=t[s][1][e];return a(n||e)}),u,u.exports,e,t,n,r)}return n[s].exports}for(var o=i,s=0;s<r.length;s++)a(r[s]);return a}({1:[function(e,t,n){(function(e){var n,r,a=e.MutationObserver||e.WebKitMutationObserver;if(a){var o=0,i=new a(u),s=e.document.createTextNode("");i.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var l=new e.MessageChannel;l.port1.onmessage=u,n=function(){l.port2.postMessage(0)}}var c=[];function u(){var e,t;r=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}r=!1}t.exports=function(e){1!==c.push(e)||r||n()}}).call(this,void 0!==o?o:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var r=e(1);function a(){}var o={},i=["REJECTED"],s=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==a&&f(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return o.reject(e,t)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function a(t){n||(n=!0,o.resolve(e,t))}var i=p((function(){t(a,r)}));"error"===i.status&&r(i.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=c,c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===i)return this;var n=new this.constructor(a);return this.state!==l?d(n,this.state===s?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){o.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=p(h,t);if("error"===n.status)return o.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=s,e.outcome=t;for(var a=-1,i=e.queue.length;++a<i;)e.queue[a].callFulfilled(t)}return e},o.reject=function(e,t){e.state=i,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:o.resolve(new this(a),e)},c.reject=function(e){var t=new this(a);return o.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i=new Array(n),s=0,l=-1,c=new this(a);++l<n;)u(e[l],l);return c;function u(e,a){t.resolve(e).then((function(e){i[a]=e,++s!==n||r||(r=!0,o.resolve(c,i))}),(function(e){r||(r=!0,o.reject(c,e))}))}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i,s=-1,l=new this(a);++s<n;)i=e[s],t.resolve(i).then((function(e){r||(r=!0,o.resolve(l,e))}),(function(e){r||(r=!0,o.reject(l,e))}));return l}},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==o?o:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(a){if("TypeError"!==a.name)throw a;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var i=Promise;function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function l(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function c(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var d=void 0,h={},f=Object.prototype.toString;function p(e){return"boolean"==typeof d?i.resolve(d):function(e){return new i((function(t){var n=e.transaction("local-forage-detect-blob-support","readwrite"),r=o([""]);n.objectStore("local-forage-detect-blob-support").put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return d=e}))}function v(e){var t=h[e.name],n={};n.promise=new i((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function m(e){var t=h[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function y(e,t){var n=h[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function g(e,t){return new i((function(n,r){if(h[e.name]=h[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);v(e),e.db.close()}var o=[e.name];t&&o.push(e.version);var i=a.open.apply(a,o);t&&(i.onupgradeneeded=function(t){var n=i.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore("local-forage-detect-blob-support")}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),i.onerror=function(e){e.preventDefault(),r(i.error)},i.onsuccess=function(){var t=i.result;t.onversionchange=function(e){e.target.close()},n(t),m(e)}}))}function b(e){return g(e,!1)}function E(e){return g(e,!0)}function w(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,a=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),a||n){if(n){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function _(e){return o([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),a=0;a<t;a++)r[a]=e.charCodeAt(a);return n}(atob(e.data))],{type:e.type})}function x(e){return e&&e.__local_forage_encoded_blob}function S(e){var t=this,n=t._initReady().then((function(){var e=h[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return l(n,e,e),n}function k(e,t,n,r){void 0===r&&(r=1);try{var a=e.db.transaction(e.storeName,t);n(null,a)}catch(a){if(r>0&&(!e.db||"InvalidStateError"===a.name||"NotFoundError"===a.name))return i.resolve().then((function(){if(!e.db||"NotFoundError"===a.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),E(e)})).then((function(){return function(e){v(e);for(var t=h[e.name],n=t.forages,r=0;r<n.length;r++){var a=n[r];a._dbInfo.db&&(a._dbInfo.db.close(),a._dbInfo.db=null)}return e.db=null,b(e).then((function(t){return e.db=t,w(e)?E(e):t})).then((function(r){e.db=t.db=r;for(var a=0;a<n.length;a++)n[a]._dbInfo.db=r})).catch((function(t){throw y(e,t),t}))}(e).then((function(){k(e,t,n,r-1)}))})).catch(n);n(a)}}var I={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var a=h[n.name];a||(a={forages:[],db:null,dbReady:null,deferredOperations:[]},h[n.name]=a),a.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=S);var o=[];function s(){return i.resolve()}for(var l=0;l<a.forages.length;l++){var c=a.forages[l];c!==t&&o.push(c._initReady().catch(s))}var u=a.forages.slice(0);return i.all(o).then((function(){return n.db=a.db,b(n)})).then((function(e){return n.db=e,w(n,t._defaultConfig.version)?E(n):e})).then((function(e){n.db=a.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var o=u[r];o!==t&&(o._dbInfo.db=n.db,o._dbInfo.version=n.version)}}))},_support:function(){try{if(!a||!a.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){k(n._dbInfo,"readonly",(function(a,o){if(a)return r(a);try{var i=o.objectStore(n._dbInfo.storeName).openCursor(),s=1;i.onsuccess=function(){var n=i.result;if(n){var r=n.value;x(r)&&(r=_(r));var a=e(r,n.key,s++);void 0!==a?t(a):n.continue()}else t()},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=new i((function(t,r){n.ready().then((function(){k(n._dbInfo,"readonly",(function(a,o){if(a)return r(a);try{var i=o.objectStore(n._dbInfo.storeName).get(e);i.onsuccess=function(){var e=i.result;void 0===e&&(e=null),x(e)&&(e=_(e)),t(e)},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=c(e);var a=new i((function(n,a){var o;r.ready().then((function(){return o=r._dbInfo,"[object Blob]"===f.call(t)?p(o.db).then((function(e){return e?t:(n=t,new i((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){k(r._dbInfo,"readwrite",(function(o,i){if(o)return a(o);try{var s=i.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var l=s.put(t,e);i.oncomplete=function(){void 0===t&&(t=null),n(t)},i.onabort=i.onerror=function(){var e=l.error?l.error:l.transaction.error;a(e)}}catch(e){a(e)}}))})).catch(a)}));return s(a,n),a},removeItem:function(e,t){var n=this;e=c(e);var r=new i((function(t,r){n.ready().then((function(){k(n._dbInfo,"readwrite",(function(a,o){if(a)return r(a);try{var i=o.objectStore(n._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){r(i.error)},o.onabort=function(){var e=i.error?i.error:i.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){k(t._dbInfo,"readwrite",(function(r,a){if(r)return n(r);try{var o=a.objectStore(t._dbInfo.storeName).clear();a.oncomplete=function(){e()},a.onabort=a.onerror=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){k(t._dbInfo,"readonly",(function(r,a){if(r)return n(r);try{var o=a.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new i((function(t,r){e<0?t(null):n.ready().then((function(){k(n._dbInfo,"readonly",(function(a,o){if(a)return r(a);try{var i=o.objectStore(n._dbInfo.storeName),s=!1,l=i.openKeyCursor();l.onsuccess=function(){var n=l.result;n?0===e||s?t(n.key):(s=!0,n.advance(e)):t(null)},l.onerror=function(){r(l.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){k(t._dbInfo,"readonly",(function(r,a){if(r)return n(r);try{var o=a.objectStore(t._dbInfo.storeName).openKeyCursor(),i=[];o.onsuccess=function(){var t=o.result;t?(i.push(t.key),t.continue()):e(i)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,o=this;if(e.name){var l=e.name===n.name&&o._dbInfo.db,c=l?i.resolve(o._dbInfo.db):b(e).then((function(t){var n=h[e.name],r=n.forages;n.db=t;for(var a=0;a<r.length;a++)r[a]._dbInfo.db=t;return t}));r=e.storeName?c.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;v(e);var r=h[e.name],o=r.forages;t.close();for(var s=0;s<o.length;s++){var l=o[s];l._dbInfo.db=null,l._dbInfo.version=n}return new i((function(t,r){var o=a.open(e.name,n);o.onerror=function(e){o.result.close(),r(e)},o.onupgradeneeded=function(){o.result.deleteObjectStore(e.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<o.length;t++){var n=o[t];n._dbInfo.db=e,m(n._dbInfo)}})).catch((function(t){throw(y(e,t)||i.resolve()).catch((function(){})),t}))}})):c.then((function(t){v(e);var n=h[e.name],r=n.forages;t.close();for(var o=0;o<r.length;o++)r[o]._dbInfo.db=null;return new i((function(t,n){var r=a.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)m(r[t]._dbInfo)})).catch((function(t){throw(y(e,t)||i.resolve()).catch((function(){})),t}))}))}else r=i.reject("Invalid arguments");return s(r,t),r}},T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",C=/^~~local_forage_type~([^~]+)~/,R="__lfsc__:".length,O=R+"arbf".length,N=Object.prototype.toString;function A(e){var t,n,r,a,o,i=.75*e.length,s=e.length,l=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var c=new ArrayBuffer(i),u=new Uint8Array(c);for(t=0;t<s;t+=4)n=T.indexOf(e[t]),r=T.indexOf(e[t+1]),a=T.indexOf(e[t+2]),o=T.indexOf(e[t+3]),u[l++]=n<<2|r>>4,u[l++]=(15&r)<<4|a>>2,u[l++]=(3&a)<<6|63&o;return c}function L(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=T[n[t]>>2],r+=T[(3&n[t])<<4|n[t+1]>>4],r+=T[(15&n[t+1])<<2|n[t+2]>>6],r+=T[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var P={serialize:function(e,t){var n="";if(e&&(n=N.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===N.call(e.buffer))){var r,a="__lfsc__:";e instanceof ArrayBuffer?(r=e,a+="arbf"):(r=e.buffer,"[object Int8Array]"===n?a+="si08":"[object Uint8Array]"===n?a+="ui08":"[object Uint8ClampedArray]"===n?a+="uic8":"[object Int16Array]"===n?a+="si16":"[object Uint16Array]"===n?a+="ur16":"[object Int32Array]"===n?a+="si32":"[object Uint32Array]"===n?a+="ui32":"[object Float32Array]"===n?a+="fl32":"[object Float64Array]"===n?a+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(a+L(r))}else if("[object Blob]"===n){var o=new FileReader;o.onload=function(){var n="~~local_forage_type~"+e.type+"~"+L(this.result);t("__lfsc__:blob"+n)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if("__lfsc__:"!==e.substring(0,R))return JSON.parse(e);var t,n=e.substring(O),r=e.substring(R,O);if("blob"===r&&C.test(n)){var a=n.match(C);t=a[1],n=n.substring(a[0].length)}var i=A(n);switch(r){case"arbf":return i;case"blob":return o([i],{type:t});case"si08":return new Int8Array(i);case"ui08":return new Uint8Array(i);case"uic8":return new Uint8ClampedArray(i);case"si16":return new Int16Array(i);case"ur16":return new Uint16Array(i);case"si32":return new Int32Array(i);case"ui32":return new Uint32Array(i);case"fl32":return new Float32Array(i);case"fl64":return new Float64Array(i);default:throw new Error("Unkown type: "+r)}},stringToBuffer:A,bufferToString:L};function H(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function M(e,t,n,r,a,o){e.executeSql(n,r,a,(function(e,i){i.code===i.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?o(e,i):H(e,t,(function(){e.executeSql(n,r,a,o)}),o)}),o):o(e,i)}),o)}function D(e,t,n,r){var a=this;e=c(e);var o=new i((function(o,i){a.ready().then((function(){void 0===t&&(t=null);var s=t,l=a._dbInfo;l.serializer.serialize(t,(function(t,c){c?i(c):l.db.transaction((function(n){M(n,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){o(s)}),(function(e,t){i(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void o(D.apply(a,[e,s,n,r-1]));i(t)}}))}))})).catch(i)}));return s(o,n),o}function j(e){return new i((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var a=[],o=0;o<r.rows.length;o++)a.push(r.rows.item(o).name);t({db:e,storeNames:a})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}var F={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var a=new i((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(a){H(a,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=P,a},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){M(n,a,"SELECT * FROM "+a.storeName,[],(function(n,r){for(var o=r.rows,i=o.length,s=0;s<i;s++){var l=o.item(s),c=l.value;if(c&&(c=a.serializer.deserialize(c)),void 0!==(c=e(c,l.key,s+1)))return void t(c)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=new i((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){M(n,a,"SELECT * FROM "+a.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=a.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){return D.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=c(e);var r=new i((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){M(n,a,"DELETE FROM "+a.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){M(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){M(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){M(n,a,"SELECT key FROM "+a.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){M(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],a=0;a<n.rows.length;a++)r.push(n.rows.item(a).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,a=this;return s(r=e.name?new i((function(t){var r;r=e.name===n.name?a._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(j(r))})).then((function(e){return new i((function(t,n){e.db.transaction((function(r){function a(e){return new i((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var o=[],s=0,l=e.storeNames.length;s<l;s++)o.push(a(e.storeNames[s]));i.all(o).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):i.reject("Invalid arguments"),t),r}};function B(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function V(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0}var q={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=B(e,this._defaultConfig),V()?(this._dbInfo=t,t.serializer=P,i.resolve()):i.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,a=r.length,o=localStorage.length,i=1,s=0;s<o;s++){var l=localStorage.key(s);if(0===l.indexOf(r)){var c=localStorage.getItem(l);if(c&&(c=t.serializer.deserialize(c)),void 0!==(c=e(c,l.substring(a),i++)))return c}}}));return s(r,t),r},getItem:function(e,t){var n=this;e=c(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=c(e);var a=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new i((function(a,o){var i=r._dbInfo;i.serializer.serialize(t,(function(t,r){if(r)o(r);else try{localStorage.setItem(i.keyPrefix+e,t),a(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}}))}))}));return s(a,n),a},removeItem:function(e,t){var n=this;e=c(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return s(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return s(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return s(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],a=0;a<n;a++){var o=localStorage.key(a);0===o.indexOf(e.keyPrefix)&&r.push(o.substring(e.keyPrefix.length))}return r}));return s(n,e),n},dropInstance:function(e,t){if(t=u.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,a=this;return s(r=e.name?new i((function(t){e.storeName?t(B(e,a._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):i.reject("Invalid arguments"),t),r}},W=function(e,t){for(var n,r,a=e.length,o=0;o<a;){if((n=e[o])===(r=t)||"number"==typeof n&&"number"==typeof r&&isNaN(n)&&isNaN(r))return!0;o++}return!1},U=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},G={},$={},Y={INDEXEDDB:I,WEBSQL:F,LOCALSTORAGE:q},z=[Y.INDEXEDDB._driver,Y.WEBSQL._driver,Y.LOCALSTORAGE._driver],K=["dropInstance"],X=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(K),Q={description:"",driver:z.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function J(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function Z(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(U(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ee=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Y)if(Y.hasOwnProperty(n)){var r=Y[n],a=r._driver;this[n]=a,G[a]||this.defineDriver(r)}this._defaultConfig=Z({},Q),this._config=Z({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new i((function(t,n){try{var r=e._driver,a=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(a);for(var o=X.concat("_initStorage"),l=0,c=o.length;l<c;l++){var u=o[l];if((!W(K,u)||e[u])&&"function"!=typeof e[u])return void n(a)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=i.reject(t);return s(n,arguments[arguments.length-1]),n}},n=0,r=K.length;n<r;n++){var a=K[n];e[a]||(e[a]=t(a))}}();var d=function(n){G[r]&&console.info("Redefining LocalForage driver: "+r),G[r]=e,$[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(d,n):d(!!e._support):d(!0)}catch(e){n(e)}}));return l(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=G[e]?i.resolve(G[e]):i.reject(new Error("Driver not found."));return l(r,t,n),r},e.prototype.getSerializer=function(e){var t=i.resolve(P);return l(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return l(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;U(e)||(e=[e]);var a=this._getSupportedDrivers(e);function o(){r._config.driver=r.driver()}function s(e){return r._extend(e),o(),r._ready=r._initStorage(r._config),r._ready}var c=null!==this._driverSet?this._driverSet.catch((function(){return i.resolve()})):i.resolve();return this._driverSet=c.then((function(){var e=a[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,o(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var a=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(a).then(s).catch(n)}o();var l=new Error("No available storage method found.");return r._driverSet=i.reject(l),r._driverSet}()}}(a)}))})).catch((function(){o();var e=new Error("No available storage method found.");return r._driverSet=i.reject(e),r._driverSet})),l(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!$[e]},e.prototype._extend=function(e){Z(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var a=e[n];this.supports(a)&&t.push(a)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=X.length;e<t;e++)J(this,X[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=ee},{3:3}]},{},[4])(4);var Uf=Wf.exports;function Gf(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,Gf)}var $f=/^[a-fA-F0-9]{8}-(?:[a-fA-F0-9]{4}-){3}[a-fA-F0-9]{12}$/,Yf=function(e){Ki(n,e);var t=rs(n);function n(){var e;return Gi(this,n),zi(ts(e=t.call(this)),"_id",void 0),zi(ts(e),"_savedRemotely",!1),zi(ts(e),"_savedLocally",!1),zi(ts(e),"deleted",!1),zi(ts(e),"createdStamp",void 0),zi(ts(e),"modifiedStamp",void 0),zi(ts(e),"projectId",void 0),zi(ts(e),"isPristine",!1),e.createdStamp=Math.floor(Date.now()/1e3),e}return Yi(n,[{key:"unsaved",value:function(){return!(this._savedLocally&&this._savedRemotely)}},{key:"id",get:function(){return this._id||(this._id=Gf()),this._id},set:function(e){if(this._id&&e!==this._id)throw new Error("Occurrence id has already been set, when trying to set new id '".concat(e,"'."));this._id=e}},{key:"queuePost",value:function(e){var t=this;return new Promise((function(r,a){var o=function(){return console.log({"posting form data":e}),t.post(e).then(r,a)};n._tasks.push(o),n._tasks.length>1?console.log("Added post request to the queue."):(console.log("No pending tasks, starting post request immediately."),o().finally(n._next))}))}},{key:"post",value:function(e){var t=this;return fetch(this.SAVE_ENDPOINT,{method:"POST",body:e}).then((function(e){return e.ok?e.clone().json().then((function(n){switch(console.log({"returned to client after save":n}),n.saveState){case"SAVED_TO_SERVER":t._savedLocally=!0,t._savedRemotely=!0;break;case"SAVED_LOCALLY":t._savedLocally=!0,t._savedRemotely=!1;break;default:console.log("Unrecognised save state '".concat(n.saveState,"'"))}return t.createdStamp=n.created,t.modifiedStamp=n.modified,e.json()})):(console.log("Save failed, presumably service worker is missing and there is no network connection. Should write to IndexedDb here."),Promise.reject("IndexedDb storage not yet implemented"))}))}},{key:"_parseDescriptor",value:function(e){this._parseAttributes(e.attributes),this._parseSavedState(e.saveState),this.deleted=e.deleted,this.createdStamp=0+e.created,this.modifiedStamp=0+e.modified,this.projectId=0+e.projectId}},{key:"_parseAttributes",value:function(e){Array.isArray(e)?(console.log("Attributes were spuriously represented as an array rather than as an empty object"),this.attributes={}):this.attributes=e}},{key:"_parseSavedState",value:function(e){switch(e){case"SAVED_LOCALLY":this._savedRemotely=!1,this._savedLocally=!0;break;case"SAVED_TO_SERVER":this._savedRemotely=!0,this._savedLocally=!0;break;default:throw new Error("Unrecognised saved state '".concat(e))}}},{key:"touch",value:function(){this.modifiedStamp=Math.floor(Date.now()/1e3),this.isPristine&&(this.isPristine=!1,this.createdStamp=this.modifiedStamp),this._savedLocally=!1,this._savedRemotely=!1}},{key:"evaluateCompletionStatus",value:function(e){var t={},n=!0;for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];t[r]=a.validator?a.validator(r,a,this.attributes):a.field.isValid(r,a,this.attributes),null!==t[r]&&(n=n&&t[r])}return{requiredFieldsPresent:n,validity:t}}}],[{key:"_next",value:function(){if(n._tasks.shift(),n._tasks.length)return console.log("Running the next task."),n._tasks[0]().finally(n._next)}},{key:"retrieveFromLocal",value:function(e,t){return Uf.getItem("".concat(t.TYPE,".").concat(e)).then((function(n){return n?(t.id=e,t._parseDescriptor(n),t):Promise.reject("Failed to retrieve ".concat(t.TYPE,".").concat(e," locally"))}))}}]),n}($h);zi(Yf,"_tasks",[]);var zf=function(e){Ki(n,e);var t=rs(n);function n(e){var r;return Gi(this,n),zi(ts(r=t.call(this)),"_value",void 0),zi(ts(r),"_fieldEl",void 0),zi(ts(r),"label","field label"),zi(ts(r),"helpText",""),zi(ts(r),"validationMessage",""),zi(ts(r),"completion",n.COMPLETION_OPTIONAL),zi(ts(r),"parentForm",void 0),zi(ts(r),"attributeName",void 0),e&&(e.label&&(r.label=e.label),e.helpText&&(r.helpText=e.helpText),e.validationMessage&&(r.validationMessage=e.validationMessage),e.completion&&(r.completion=e.completion)),r}return Yi(n,[{key:"value",get:function(){return this._value},set:function(e){}},{key:"fieldElement",get:function(){return this._fieldEl||this.buildField(),this._fieldEl}},{key:"addField",value:function(){this.parentForm.formElement.appendChild(this.fieldElement)}},{key:"markValidity",value:function(e){}}],[{key:"nextId",get:function(){var e;return"field".concat((ps(n,n,Kf,1+(e=+fs(n,n,Kf))),e))}},{key:"cleanRawInput",value:function(e){return e.value.trim().replace(/\s\s+/g," ")}},{key:"cleanRawString",value:function(e){return e.trim().replace(/\s\s+/g," ")}},{key:"isEmpty",value:function(e){return""===e}},{key:"isValid",value:function(e,t,r){return!t.attributes.completion||t.attributes.completion!==n.COMPLETION_COMPULSORY&&t.attributes.completion!==n.COMPLETION_DESIRED?null:!(!r.hasOwnProperty(e)||t.field.isEmpty(r[e]))}},{key:"summarise",value:function(e,t,n){return!t.summary||t.summary.hasOwnProperty("summarise")&&!0!==t.summary.summarise?"":t.field.summariseImpl(e,t,n)}},{key:"summariseImpl",value:function(e,t,n){return""}}]),n}($h);zi(zf,"COMPLETION_COMPULSORY","compulsory"),zi(zf,"COMPLETION_DESIRED","desired"),zi(zf,"COMPLETION_OPTIONAL","optional");var Kf={writable:!0,value:1};zi(zf,"EVENT_CHANGE","fieldChange");var Xf=new WeakMap,Qf=function(e){Ki(n,e);var t=rs(n);function n(){var e;Gi(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return ws(ts(e=t.call.apply(t,[this].concat(a))),Xf,{writable:!0,value:void 0}),zi(ts(e),"_formId",void 0),zi(ts(e),"_formContentContainer",void 0),zi(ts(e),"fields",void 0),zi(ts(e),"liveValidation",!1),zi(ts(e),"isValid",null),e}return Yi(n,[{key:"formElement",get:function(){var e,t=this;us(this,Xf)||(ds(this,Xf,document.createElement("form")),us(this,Xf).id=this._formId="form".concat((ps(n,n,Jf,1+(e=+fs(n,n,Jf))),e)),us(this,Xf).noValidate=!0,this.liveValidation&&(us(this,Xf).className="needs-validation"),this.buildContentContainer(us(this,Xf)),us(this,Xf).addEventListener("change",(function(e){t.changeHandler(e)}),{capture:!1}));return us(this,Xf)}},{key:"buildContentContainer",value:function(e){return this._formContentContainer=e,this._formContentContainer}},{key:"changeHandler",value:function(e){console.log("form change event"),console.log(arguments)}},{key:"destructor",value:function(){as(Xi(n.prototype),"destructor",this).call(this),ds(this,Xf,null)}},{key:"buildFormFields",value:function(){for(var e in this.initialiseFormFields(),this.fields)if(this.fields.hasOwnProperty(e)){var t=this.fields[e];t.parentForm=this,t.attributeName=e,this._formContentContainer.appendChild(t.fieldElement),t.addListener(zf.EVENT_CHANGE,this,this.changeHandler)}this._formFieldsBuilt=!0}},{key:"conditionallyValidateForm",value:function(){this.liveValidation&&this.validateForm()}},{key:"validateForm",value:function(){this.liveValidation=!0,this.formElement.classList.add("needs-validation");var e=this.model.evaluateCompletionStatus(this.getFormSectionProperties());for(var t in this.fields){if(this.fields.hasOwnProperty(t))this.fields[t].markValidity(e.validity[t])}return this.isValid!==e.requiredFieldsPresent&&(this.isValid=e.requiredFieldsPresent,this.fireEvent(n.EVENT_VALIDATION_STATE_CHANGE,this.isValid)),e.requiredFieldsPresent}},{key:"populateFormContent",value:function(){if(this._formFieldsBuilt){var e=this.model;for(var t in this.fields){if(this.fields.hasOwnProperty(t))this.fields[t].value=e.attributes[t]}this.conditionallyValidateForm()}}}],[{key:"nextId",get:function(){var e;return"id".concat((ps(n,n,Zf,1+(e=+fs(n,n,Zf))),e))}}]),n}($h),Jf={writable:!0,value:0};zi(Qf,"EVENT_VALIDATION_STATE_CHANGE","validationstatechange");var Zf={writable:!0,value:0};zi(Qf,"COMPLETION_STATUS_UNSTARTED","unstarted"),zi(Qf,"COMPLETION_STATUS_COMPLETE","complete"),zi(Qf,"COMPLETION_STATUS_IN_PROGRESS","inProgress");var ep=new WeakMap,tp=function(e){Ki(n,e);var t=rs(n);function n(e){var r;return Gi(this,n),ws(ts(r=t.call(this)),ep,{writable:!0,value:void 0}),zi(ts(r),"_formFieldsBuilt",!1),zi(ts(r),"section",void 0),r.section=e,r}return Yi(n,[{key:"formElement",get:function(){var e=as(Xi(n.prototype),"formElement",this);return this._formFieldsBuilt||this.buildFormFields(),e}},{key:"updateModelFromContent",value:function(){for(var e in console.log("updating survey from NyphSurveyForm content"),this.fields)if(this.fields.hasOwnProperty(e)){var t=this.fields[e];us(this,ep).attributes[e]=t.value}console.log({survey:us(this,ep)})}},{key:"model",get:function(){return us(this,ep)},set:function(e){ds(this,ep,e),this.populateFormContent()}},{key:"changeHandler",value:function(e){console.log("survey form change event"),console.log({event:e}),this.fireEvent(n.CHANGE_EVENT,{form:this})}},{key:"destructor",value:function(){as(Xi(n.prototype),"destructor",this).call(this),ds(this,ep,null)}},{key:"initialiseFormFields",value:function(){var e=this.section.properties;for(var t in this.fields={},e)e.hasOwnProperty(t)&&(this.fields[t]=new e[t].field(e[t].attributes))}},{key:"getFormSectionProperties",value:function(){return this.section.properties}}],[{key:"registerSection",value:function(e){n.sections[e.sectionSortOrder]=e,n.sectionsByKey[e.sectionNavigationKey]=e}}]),n}(Qf);function np(e){try{var t=document.createElement("textarea");return t.innerHTML=e,t.innerHTML.replace(/"/g,"&quot;")}catch(t){var n=document.createElement("pre");return n.appendChild(document.createTextNode(e)),n.innerHTML.replace(/"/g,"&quot;")}}zi(tp,"sections",[]),zi(tp,"sectionsByKey",{}),tp.CHANGE_EVENT="change";var rp=function(e){Ki(n,e);var t=rs(n);function n(){var e;Gi(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return zi(ts(e=t.call.apply(t,[this].concat(a))),"SAVE_ENDPOINT","/savesurvey.php"),zi(ts(e),"TYPE","survey"),zi(ts(e),"attributes",{}),e}return Yi(n,[{key:"formChangedHandler",value:function(e,t,r){console.log("Survey change handler invoked."),r.form.updateModelFromContent(),r.form.conditionallyValidateForm(),this.touch(),this.fireEvent(n.EVENT_MODIFIED,{surveyId:this.id})}},{key:"registerForm",value:function(e){e.model=this,e.addListener(tp.CHANGE_EVENT,this,this.formChangedHandler)}},{key:"save",value:function(){if(this._savedRemotely)return Promise.reject("".concat(this.id," has already been saved."));var e=new FormData;return e.append("type",this.TYPE),e.append("surveyId",this.id),e.append("projectId",this.projectId.toString()),e.append("attributes",JSON.stringify(this.attributes)),e.append("deleted",this.deleted.toString()),e.append("created",this.createdStamp.toString()),console.log("queueing survey post"),this.queuePost(e)}},{key:"generateSurveyName",value:function(){var e,t=(this.attributes.place||this.attributes.georef||"(unlocalised)").trim(),n=new Date(1e3*this.createdStamp);try{e=n.toLocaleString("default",{year:"numeric",month:"long",day:"numeric"})}catch(t){e=n.toLocaleString("en-GB",{year:"numeric",month:"long",day:"numeric"})}return"".concat(np(t)," ").concat(e)}}]),n}(Yf);zi(rp,"EVENT_MODIFIED","modified");var ap=function(e){Ki(n,e);var t=rs(n);function n(){return Gi(this,n),t.apply(this,arguments)}return n}(es(Error)),op=function(){function e(){Gi(this,e),zi(this,"id",void 0),zi(this,"nameString",""),zi(this,"canonical",""),zi(this,"hybridCanonical",""),zi(this,"acceptedEntityId",""),zi(this,"qualifier",""),zi(this,"authority",""),zi(this,"vernacular",""),zi(this,"vernacularRoot",""),zi(this,"used",void 0),zi(this,"sortOrder",void 0),zi(this,"parentIds",[])}return Yi(e,[{key:"formattedHTML",value:function(t){var n;return this.id!==this.acceptedEntityId&&(n=e.fromId(this.acceptedEntityId)),e.showVernacular?t?n?"<q><b>".concat(np(this.vernacular),'</b></q> <span class="italictaxon">').concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(np(this.authority),"</span>")+' = <span class="italictaxon">'.concat(n.nameString).concat(n.qualifier?" <b>".concat(n.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(np(n.authority),"</span>"):"<q><b>".concat(np(this.vernacular),'</b></q> <span class="italictaxon">').concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(np(this.authority),"</span>"):n?'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(this.authority,"</span>").concat(this.vernacular?" <q><b>".concat(np(this.vernacular),"</b></q>"):"",' = <span class="italictaxon">').concat(n.nameString).concat(n.qualifier?" <b>".concat(n.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(np(n.authority),"</span>"):'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(np(this.authority),"</span>").concat(this.vernacular?" <q><b>".concat(np(this.vernacular),"</b></q>"):""):n?'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(this.authority,"</span>")+' = <span class="italictaxon">'.concat(n.nameString).concat(n.qualifier?" <b>".concat(n.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(np(n.authority),"</span>"):'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(np(this.authority),"</span>")}}],[{key:"fromId",value:function(t){if(!e.rawTaxa){if(!r.default.TaxonNames)throw new ap("Taxon.fromId() called before taxon list has loaded.");e.rawTaxa=r.default.TaxonNames}if(!e.rawTaxa.hasOwnProperty(t))throw new ap("Taxon id '".concat(t,"' not found."));var n=e.rawTaxa[t],a=new e;return a.id=t,a.nameString=n[0],a.canonical=n[1]||n[0],a.hybridCanonical=n[2]||a.canonical,a.acceptedEntityId=n[3]||t,a.qualifier=n[4],a.authority=n[5],a.vernacular=n[6],a.vernacularRoot=n[7],a.used=n[8],a.sortOrder=n[9],a.parentIds=n[10],a}}]),e}();zi(op,"rawTaxa",r.default.TaxonNames),zi(op,"showVernacular",!0);var ip=hr,sp=vf.start,lp=bf("trimStart"),cp=lp?function(){return sp(this)}:"".trimStart;ip({target:"String",proto:!0,name:"trimStart",forced:lp},{trimStart:cp,trimLeft:cp});var up=F,dp=function(e,t){var n=[][e];return!!n&&up((function(){n.call(null,t||function(){throw 1},1)}))},hp=hr,fp=on,pp=[].join,vp=nn!=Object,mp=dp("join",",");hp({target:"Array",proto:!0,forced:vp||!mp},{join:function(e){return pp.call(fp(this),void 0===e?",":e)}});var yp=hr,gp=uh.find,bp=Il,Ep=!0;"find"in[]&&Array(1).find((function(){Ep=!1})),yp({target:"Array",proto:!0,forced:Ep},{find:function(e){return gp(this,e,arguments.length>1?arguments[1]:void 0)}}),bp("find"),Ud("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Th);var wp=ve,_p=kn,xp=Ec,Sp=y,kp=Se,Ip=Fu,Tp=Uu;Du("match",(function(e,t,n){return[function(t){var n=Sp(this),r=null==t?void 0:kp(t,e);return r?r.call(t,n):new RegExp(t)[e](xp(n))},function(e){var r=wp(this),a=xp(e),o=n(t,r,a);if(o.done)return o.value;if(!r.global)return Tp(r,a);var i=r.unicode;r.lastIndex=0;for(var s,l=[],c=0;null!==(s=Tp(r,a));){var u=xp(s[0]);l[c]=u,""===u&&(r.lastIndex=Ip(a,_p(r.lastIndex),i)),c++}return 0===c?null:l}]}));var Cp=ae,Rp=l,Op=ar,Np=Od,Ap=We,Lp=oe.f,Pp=vn.f,Hp=Jc,Mp=Ec,Dp=ou,jp=iu,Fp=re.exports,Bp=F,Vp=_,qp=bt.enforce,Wp=Cr,Up=du,Gp=pu,$p=ee("match"),Yp=Rp.RegExp,zp=Yp.prototype,Kp=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,Xp=/a/g,Qp=/a/g,Jp=new Yp(Xp)!==Xp,Zp=jp.UNSUPPORTED_Y,ev=Cp&&(!Jp||Zp||Up||Gp||Bp((function(){return Qp[$p]=!1,Yp(Xp)!=Xp||Yp(Qp)==Qp||"/a/i"!=Yp(Xp,"i")})));if(Op("RegExp",ev)){for(var tv=function(e,t){var n,r,a,o,i,s,l=this instanceof tv,c=Hp(e),u=void 0===t,d=[],h=e;if(!l&&c&&u&&e.constructor===tv)return e;if((c||e instanceof tv)&&(e=e.source,u&&(t="flags"in h?h.flags:Dp.call(h))),e=void 0===e?"":Mp(e),t=void 0===t?"":Mp(t),h=e,Up&&"dotAll"in Xp&&(r=!!t&&t.indexOf("s")>-1)&&(t=t.replace(/s/g,"")),n=t,Zp&&"sticky"in Xp&&(a=!!t&&t.indexOf("y")>-1)&&(t=t.replace(/y/g,"")),Gp&&(e=(o=function(e){for(var t,n=e.length,r=0,a="",o=[],i={},s=!1,l=!1,c=0,u="";r<=n;r++){if("\\"===(t=e.charAt(r)))t+=e.charAt(++r);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:Kp.test(e.slice(r+1))&&(r+=2,l=!0),a+=t,c++;continue;case">"===t&&l:if(""===u||Vp(i,u))throw new SyntaxError("Invalid capture group name");i[u]=!0,o.push([u,c]),l=!1,u="";continue}l?u+=t:a+=t}return[a,o]}(e))[0],d=o[1]),i=Np(Yp(e,t),l?this:zp,tv),(r||a||d.length)&&(s=qp(i),r&&(s.dotAll=!0,s.raw=tv(function(e){for(var t,n=e.length,r=0,a="",o=!1;r<=n;r++)"\\"!==(t=e.charAt(r))?o||"."!==t?("["===t?o=!0:"]"===t&&(o=!1),a+=t):a+="[\\s\\S]":a+=t+e.charAt(++r);return a}(e),n)),a&&(s.sticky=!0),d.length&&(s.groups=d)),e!==h)try{Ap(i,"source",""===h?"(?:)":h)}catch(e){}return i},nv=function(e){e in tv||Lp(tv,e,{configurable:!0,get:function(){return Yp[e]},set:function(t){Yp[e]=t}})},rv=Pp(Yp),av=0;rv.length>av;)nv(rv[av++]);zp.constructor=tv,tv.prototype=zp,Fp(Rp,"RegExp",tv)}Wp("RegExp");var ov=Math.floor,iv=function(e,t){var n=e.length,r=ov(n/2);return n<8?sv(e,t):lv(iv(e.slice(0,r),t),iv(e.slice(r),t),t)},sv=function(e,t){for(var n,r,a=e.length,o=1;o<a;){for(r=o,n=e[o];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==o++&&(e[r]=n)}return e},lv=function(e,t,n){for(var r=e.length,a=t.length,o=0,i=0,s=[];o<r||i<a;)o<r&&i<a?s.push(n(e[o],t[i])<=0?e[o++]:t[i++]):s.push(o<r?e[o++]:t[i++]);return s},cv=iv,uv=N.match(/firefox\/(\d+)/i),dv=!!uv&&+uv[1],hv=/MSIE|Trident/.test(N),fv=N.match(/AppleWebKit\/(\d+)\./),pv=!!fv&&+fv[1],vv=hr,mv=_e,yv=b,gv=Tn,bv=Ec,Ev=F,wv=cv,_v=dp,xv=dv,Sv=hv,kv=j,Iv=pv,Tv=[],Cv=Tv.sort,Rv=Ev((function(){Tv.sort(void 0)})),Ov=Ev((function(){Tv.sort(null)})),Nv=_v("sort"),Av=!Ev((function(){if(kv)return kv<70;if(!(xv&&xv>3)){if(Sv)return!0;if(Iv)return Iv<603;var e,t,n,r,a="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)Tv.push({k:t+r,v:n})}for(Tv.sort((function(e,t){return t.v-e.v})),r=0;r<Tv.length;r++)t=Tv[r].k.charAt(0),a.charAt(a.length-1)!==t&&(a+=t);return"DGBEFHACIJK"!==a}}));vv({target:"Array",proto:!0,forced:Rv||!Ov||!Nv||!Av},{sort:function(e){void 0!==e&&mv(e);var t=yv(this);if(Av)return void 0===e?Cv.call(t):Cv.call(t,e);var n,r,a=[],o=gv(t);for(r=0;r<o;r++)r in t&&a.push(t[r]);for(n=(a=wv(a,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:bv(t)>bv(n)?1:-1}}(e))).length,r=0;r<n;)t[r]=a[r++];for(;r<o;)delete t[r++];return t}});var Lv=hr,Pv=Ss,Hv=Ea,Mv=se,Dv=_n,jv=Tn,Fv=on,Bv=Cs,Vv=ee,qv=js("slice"),Wv=Vv("species"),Uv=[].slice,Gv=Math.max;Lv({target:"Array",proto:!0,forced:!qv},{slice:function(e,t){var n,r,a,o=Fv(this),i=jv(o),s=Dv(e,i),l=Dv(void 0===t?i:t,i);if(Pv(o)&&(n=o.constructor,(Hv(n)&&(n===Array||Pv(n.prototype))||Mv(n)&&null===(n=n[Wv]))&&(n=void 0),n===Array||void 0===n))return Uv.call(o,s,l);for(r=new(void 0===n?Array:n)(Gv(l-s,0)),a=0;s<l;s++,a++)s in o&&Bv(r,a,o[s]);return r.length=a,r}});var $v=hr,Yv=_n,zv=gn,Kv=Tn,Xv=b,Qv=Ps,Jv=Cs,Zv=js("splice"),em=Math.max,tm=Math.min;$v({target:"Array",proto:!0,forced:!Zv},{splice:function(e,t){var n,r,a,o,i,s,l=Xv(this),c=Kv(l),u=Yv(e,c),d=arguments.length;if(0===d?n=r=0:1===d?(n=0,r=c-u):(n=d-2,r=tm(em(zv(t),0),c-u)),c+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(a=Qv(l,r),o=0;o<r;o++)(i=u+o)in l&&Jv(a,o,l[i]);if(a.length=r,n<r){for(o=u;o<c-r;o++)s=o+n,(i=o+r)in l?l[s]=l[i]:delete l[s];for(o=c;o>c-r+n;o--)delete l[o-1]}else if(n>r)for(o=c-r;o>u;o--)s=o+n-1,(i=o+r-1)in l?l[s]=l[i]:delete l[s];for(o=0;o<n;o++)l[o+u]=arguments[o+2];return l.length=c-r+n,a}});var nm=function(){function e(){if(Gi(this,e),zi(this,"minimumRankSort",null),zi(this,"requireExtantDDbRecords",!1),zi(this,"skipJunk",!0),!op.rawTaxa&&(op.rawTaxa=BsbiDb.TaxonNames,!op.rawTaxa))throw new Error("Taxon list has failed to load in TaxonSearch")}return Yi(e,[{key:"lookup",value:function(t){var n,r,a,o,i=e.normaliseTaxonName(decodeURIComponent(t).trim()),s={},l=/ x\b/.test(i);if(""!==(i=i.replace(/\s+x$/i,""))){var c=i.match(e.abbreviatedGenusRegex);if(c){var u,d;for(o in"X"===c[2]||"x"===c[2]?d=u=new RegExp("^(X\\s|X[a-z]+\\s+)(x )?\\b".concat(e.generate_hybrid_combinations_regex(c[3]),".*"),"i"):(u=new RegExp("^(X )?".concat(e.escapeRegExp(c[2]),"[a-z]+ (x )?.*\\b").concat(e.generate_hybrid_combinations_regex(c[3]),".*"),"i"),d=new RegExp("^(X )?".concat(e.escapeRegExp(c[2]),"[a-z]+ (x )?\\b").concat(e.generate_hybrid_combinations_regex(c[3]),".*"),"i")),op.rawTaxa)a=0===(r=op.rawTaxa[o])[e.canonicalColumn]?r[e.nameStringColumn]:r[e.canonicalColumn],(u.test(a)||""!==r[e.hybridCanonicalColumn]&&u.test(r[e.hybridCanonicalColumn]))&&(s[o]={exact:r[e.nameStringColumn]===i,near:d.test(r[e.nameStringColumn])});n=this.compile_results(s,l)}else{var h,f,p=e.escapeRegExp(i);-1!==i.indexOf(" ")?(h="".concat(e.escapeRegExp(i.substr(0,i.indexOf(" ")))," (x )?.*\\b").concat(e.generate_hybrid_combinations_regex(i.substr(i.indexOf(" ")+1)),".*"),f=new RegExp("^(?:Xs+)?".concat(e.escapeRegExp(i.substr(0,i.indexOf(" ")))," (x )?\\b").concat(e.generate_hybrid_combinations_regex(i.substr(i.indexOf(" ")+1)),".*"),"i")):(h="".concat(p,".*"),f=new RegExp("^".concat(p,".*")));var v="^".concat(p,".*"),m=new RegExp("^(?:Xs+)?".concat(h),"i");if(e.showVernacular){var y=new RegExp(v,"i");for(o in op.rawTaxa)a=0===(r=op.rawTaxa[o])[e.canonicalColumn]?r[e.nameStringColumn]:r[e.canonicalColumn],m.test(r[e.nameStringColumn])||a!==r[e.nameStringColumn]&&m.test(a)?s[o]={exact:r[e.nameStringColumn]==i,near:f.test(r[e.nameStringColumn])||f.test(a)}:(y.test(r[e.vernacularColumn])||y.test(r[e.vernacularRootColumn]))&&(s[o]={exact:r[e.nameStringColumn]==i,vernacular:!0});if((n=this.compile_results(s,l)).length<5){var g=new RegExp("\\b".concat(p,".*"),"i");for(o in op.rawTaxa)s.hasOwnProperty(o)||(r=op.rawTaxa[o],g.test(r[e.nameStringColumn])?s[o]={exact:r[e.nameStringColumn]===i}:(0!==r[e.canonicalColumn]&&g.test(r[e.canonicalColumn])||g.test(r[e.vernacularColumn]))&&(s[o]={exact:r[e.nameStringColumn]===i,vernacular:!0}));n=this.compile_results(s,l)}}else{for(o in op.rawTaxa)a=0===(r=op.rawTaxa[o])[e.canonicalColumn]?r[e.nameStringColumn]:r[e.canonicalColumn],(m.test(r[e.nameStringColumn])||a!==r[e.nameStringColumn]&&m.test(a))&&(s[o]={exact:r[e.nameStringColumn]==i});n=this.compile_results(s,l)}}}else n=[];return n}},{key:"compile_results",value:function(t,n){var r=[];for(var a in t)if(t.hasOwnProperty(a)){var o=op.rawTaxa[a];if((!this.requireExtantDDbRecords||this.requireExtantDDbRecords&&1===o[e.usedColumn])&&(!this.minimumRankSort||this.minimumRankSort>0&&o[e.minRankColumn]>=this.minimumRankSort)){var i=o[e.nameStringColumn]+(o[e.qualifierColumn]?" ".concat(o[e.qualifierColumn]):""),s={entityId:a,vernacular:o[e.vernacularColumn],qname:i,name:i,qualifier:o[e.qualifierColumn],authority:o[e.authorityColumn],uname:o[e.nameStringColumn],vernacularMatched:t[a].hasOwnProperty("vernacular"),exact:t[a].hasOwnProperty("exact")&&t[a].exact,near:t[a].hasOwnProperty("near")&&t[a].near};if(s.formatted=e.formatter(s),o[e.acceptedEntityIdColumn]){var l=op.rawTaxa[o[e.acceptedEntityIdColumn]];if(!l)throw op.rawTaxa?new Error("Failed to find taxon for accepted entity id ".concat(o[e.acceptedEntityIdColumn])):new Error("Taxon.rawTaxa set is undefined, when trying to find taxon for accepted entity id ".concat(o[e.acceptedEntityIdColumn]));s.acceptedEntityId=o[e.acceptedEntityIdColumn],s.acceptedNameString=l[e.nameStringColumn],s.acceptedQualifier=l[e.qualifierColumn],s.acceptedAuthority=l[e.authorityColumn]}r.push(s)}}return r.length&&(r.sort((function(e,t){if(e.exact)return t.exact?e.acceptedEntityId?1:0:-1;if(t.exact)return 1;if(e.near){if(!t.near)return-1}else if(t.near)return 1;var r=null!==e.uname.match(/\bx\b/i),a=null!==t.uname.match(/\bx\b/i);if(r)return a?e.uname===t.uname?e.acceptedEntityId?1:0:e.qname<t.qname?-1:1:n?-1:1;if(a)return n?1:-1;if(e.uname===t.uname){if(!e.acceptedEntityId&&!t.acceptedEntityId||e.acceptedEntityId&&t.acceptedEntityId){var o=["s.s.","",null,"s.l.","agg."].indexOf(e.qualifier),i=["s.s.","",null,"s.l.","agg."].indexOf(t.qualifier);return o===i?0:o<i?1:-1}return e.acceptedEntityId?1:-1}return e.uname<t.uname?-1:1})),r.length>e.MAXIMUM_RESULTS&&(r.length=e.MAXIMUM_RESULTS)),r}}],[{key:"formatter",value:function(t){return e.showVernacular?t.vernacularMatched?t.acceptedEntityId?"<q><b>".concat(t.vernacular,'</b></q> <span class="italictaxon">').concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>")+' = <span class="italictaxon">'.concat(t.acceptedNameString).concat(t.acceptedQualifier?" <b>".concat(t.acceptedQualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.acceptedAuthority,"</span>"):"<q><b>".concat(t.vernacular,'</b></q> <span class="italictaxon">').concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>"):t.acceptedEntityId?'<span class="italictaxon">'.concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>").concat(t.vernacular?" <q><b>".concat(t.vernacular,"</b></q>"):"",' = <span class="italictaxon">').concat(t.acceptedNameString).concat(t.acceptedQualifier?" <b>".concat(t.acceptedQualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.acceptedAuthority,"</span>"):'<span class="italictaxon">'.concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>").concat(t.vernacular?" <q><b>".concat(t.vernacular,"</b></q>"):""):t.acceptedEntityId?'<span class="italictaxon">'.concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>")+' = <span class="italictaxon">'.concat(t.acceptedNameString).concat(t.acceptedQualifier?" <b>".concat(t.acceptedQualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.acceptedAuthority,"</span>"):'<span class="italictaxon">'.concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>")}},{key:"normaliseTaxonName",value:function(t){for(var n=0,r=e.taxonRankNameSearchRegex.length;n<r;n++)t=t.replace(e.taxonRankNameSearchRegex[n],e.taxonRankNameReplacement[n]);for(var a=0,o=e.taxonQualifierSearchRegex.length;a<o;a++)t=t.replace(e.taxonQualifierSearchRegex[a],e.taxonQualifierReplacement[a]);return t}},{key:"escapeRegExp",value:function(t){return t.replace(e.cleanRegex,"\\$&")}},{key:"generate_hybrid_combinations_regex",value:function(t){var n=e.escapeRegExp(t).split(/\s+x\s+/i);if(n.length<2)return n[0];var r=[];return function e(t,n){if(0===t.length)r[r.length]=n.join("[a-zA-Z]* x ");else for(var a=t.length-1;a>=0;--a){var o=t.slice(0),i=n.slice(0);i.unshift(o.splice(a,1)[0]),e(o,i)}}(n,[]),"(?:".concat(r.join("|"),")")}}]),e}();zi(nm,"showVernacular",!0),zi(nm,"MIN_SEARCH_LENGTH",2),zi(nm,"MAXIMUM_RESULTS",25),zi(nm,"abbreviatedGenusRegex",/^(X\s+)?([a-z])[.\s]+(.*?)$/i),zi(nm,"nameStringColumn",0),zi(nm,"canonicalColumn",1),zi(nm,"hybridCanonicalColumn",2),zi(nm,"acceptedEntityIdColumn",3),zi(nm,"qualifierColumn",4),zi(nm,"authorityColumn",5),zi(nm,"vernacularColumn",6),zi(nm,"vernacularRootColumn",7),zi(nm,"usedColumn",8),zi(nm,"minRankColumn",9),zi(nm,"taxonRankNameSearchRegex",[/\s+sub-?g(?:en(?:us)?)?[.\s]+/i,/\s+sect(?:ion)?[.\s]+/i,/\s+subsect(?:ion)?[.\s]+/i,/\s+ser(?:ies)?[.\s]+/i,/\s+gp[.\s]+/i,/\s+s(?:ub)?-?sp(?:ecies)?[.\s]+/i,/\s+morphotype\s+/i,/\s+var[.\s]+/i,/\s+cv[.\s]+/i,/\s+n(?:otho)?v(?:ar)?[.\s]+/i,/\s+f[.\s]+|\s+forma?\s+/i,/\s+n(?:otho)?ssp[.\s]+/i]),zi(nm,"taxonRankNameReplacement",[" subg. "," sect. "," subsect. "," ser. "," group "," subsp. "," morph. "," var. "," cv. "," nothovar. "," f. "," nothosubsp. "]),zi(nm,"cleanRankNamesRegex",/\s(subfam\.|subg\.|sect\.|subsect\.|ser\.|subser\.|subsp\.|nothosubsp\.|microsp\.|praesp\.|agsp\.|race|convar\.|nm\.|microgene|f\.|subvar\.|var\.|nothovar\.|cv\.|sublusus|taxon|morph\.|group|sp\.)\s/),zi(nm,"taxonQualifierSearchRegex",[/\s*\(?\bf\s*x\s*m or m\s*x\s*f\)?\s*$/i,/\s*\(?\bm\s*x\s*f or f\s*x\s*m\)?\s*$/i,/\s*\(?\bf\s*x\s*m\)?\s*$/i,/\s*\(?\bm\s*x\s*f\)?\s*$/i,/\s*\(?\bfemale\s*x\s*male\)?\s*$/i,/\s*\(?\bmale\s*x\s*female\)?\s*$/i,/\s*'male'\s*$/i,/\s*'female'\s*$/i,/\b\s*sens\.?\s*lat[.\s]+/i,/\b\s*s\.\s*lat\.?\s*\b/i,/\b\s*s\.?\s*l\.?\s+\b/i,/\b\s*sensu\s*lato\s+\b|\(\s*sensu\s*lato\s*\)/i,/\b\s*sensu\s*stricto\s+\b|\(\s*sensu\s*stricto\s*\)/i,/\b\s*sens\.?\s*strict[.\s]+/i,/\b\s*sens\.?\s*str\.?\s*(?=\))|\b\s*sens\.?\s*str[.\s]+/i,/\b\s*s\.\s*str[.\s]+/i,/\b\s*s\.?\s*s\.?\s+\b/i,/\b\s*sens\.?\s*lat\.?\s*$/i,/\b\s*s\.\s*lat\.?\s*$/i,/\b\s*s\.?\s*l\.?\s*$/i,/\b\s*sensu\s*lato\s*$/i,/\b\s*sensu\s*stricto\s*$/i,/\b\s*sens\.?\s*strict\.?\s*$/i,/\b\s*sens\.?\s*str\.?\s*$/i,/\b\s*s\.\s*str\.?\s*$/i,/\b\s*s\.?\s*s\.?\s*$/i,/\b\s*agg\.?\s*$/i,/\b\s*aggregate\s*$/i,/\b\s*sp\.?\s*cultivar\s*$/i,/\b\s*sp\.?\s*cv\.?\s*$/i,/\b\s*cultivars?\s*$/i,/\b\s*cv\s+$/i,/\b\s*cv$/i,/\b\s*cf\s*$/i,/\b\s*aff\s*$/i,/\b\s*s\.?n\.?\s*$/i,/\b\s*sp\.?\s*nov\.?\s*$/i,/\b\s*auct[.\s]*$/i,/\b\s*ined[.\s]*$/i,/\b\s*nom\.?\snud[.\s]*$/i,/\b\s*p\.p[.\s?]*$/i,/\b\s*spp?\.?[\s?]*$/i,/\b\s*species\s*$/i,/\b\s*spp?\.?\s*\(/i,/\b\s*species\s*\(/i]),zi(nm,"taxonQualifierReplacement",[" "," "," (f x m)"," (m x f)"," (f x m)"," (m x f)"," male"," female"," s.l. "," s.l. "," s.l. "," s.l. "," s.s. "," s.s. "," s.s. "," s.s. "," s.s. "," s.l."," s.l."," s.l."," s.l."," s.s."," s.s."," s.s."," s.s."," s.s."," agg."," agg."," cv. "," cv. "," cv. "," cv. "," cv. "," cf."," aff."," sp.nov."," sp.nov."," auct."," ined."," nom. nud."," pro parte","",""," ("," ("]),zi(nm,"cleanRegex",/[.*+?^${}()|[\]\\]/g);var rm=new WeakMap,am=new WeakMap,om=new WeakMap,im=new WeakMap,sm=new WeakMap,lm=new WeakMap,cm=new WeakMap,um=new WeakMap,dm=new WeakSet,hm=function(e){Ki(n,e);var t=rs(n);function n(e){var r;return Gi(this,n),_s(ts(r=t.call(this,e)),dm),zi(ts(r),"taxonSearch",void 0),ws(ts(r),rm,{writable:!0,value:void 0}),ws(ts(r),am,{writable:!0,value:void 0}),ws(ts(r),om,{writable:!0,value:void 0}),ws(ts(r),im,{writable:!0,value:void 0}),ws(ts(r),sm,{writable:!0,value:null}),ws(ts(r),lm,{writable:!0,value:null}),ws(ts(r),cm,{writable:!0,value:null}),zi(ts(r),"_lastInputValue",""),ws(ts(r),um,{writable:!0,value:[]}),zi(ts(r),"_value",{taxonId:"",taxonName:"",vernacularMatch:!1}),r.taxonSearch=new nm,r}return Yi(n,[{key:"value",get:function(){return this._value},set:function(e){var t;e&&e.taxonId?(t=op.fromId(e.taxonId),this._value={taxonId:t.id,taxonName:e.vernacularMatch?t.vernacular:t.nameString,vernacularMatch:e.vernacularMatch}):this._value={taxonId:"",taxonName:e&&e.taxonName?e.taxonName:"",vernacularMatch:null},this.updateView()}},{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(us(this,rm)).value=this._value.taxonName,this._lastInputValue=this._value.taxonName)}},{key:"markValidity",value:function(e){var t=document.getElementById(us(this,rm));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",ds(this,im,e.id=zf.nextId),ds(this,rm,zf.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=us(this,rm),t.textContent=this.label;var n=e.appendChild(document.createElement("div"));n.className="dropdown-wrapper";var r=n.appendChild(document.createElement("input"));if(r.className="form-control dropdown-input",r.id=us(this,rm),r.autocomplete="off",r.spellcheck=!1,this.validationMessage){var a=n.appendChild(document.createElement("div"));a.className="invalid-feedback",a.innerHTML=this.validationMessage}var o=n.appendChild(document.createElement("div"));(o.className="dropdown-list",ds(this,am,o.id=zf.nextId),ds(this,om,zf.nextId),this.helpText)&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);r.addEventListener("keydown",this.keydownHandler.bind(this)),r.addEventListener("input",this.inputHandler.bind(this)),r.addEventListener("change",this.inputChangeHandler.bind(this)),e.addEventListener("focusin",this.focusHandler.bind(this)),e.addEventListener("focusout",this.blurHandler.bind(this)),o.addEventListener("click",this.dropboxClickHandler.bind(this)),this._fieldEl=e}},{key:"keydownHandler",value:function(e){switch(this._lastInputValue=e.target.value.trimLeft(),e.key){case"Enter":case"ArrowUp":case"ArrowDown":e.preventDefault()}}},{key:"inputHandler",value:function(e){e.target.value.trimLeft()!==this._lastInputValue&&bs(this,dm,fm).call(this,e.target)}},{key:"keyupHandler",value:function(e){!e.key||1!==e.key.length&&"Backspace"!==e.key&&"Delete"!==e.key||bs(this,dm,fm).call(this,e.target)}},{key:"focusHandler",value:function(e){console.log("focused");var t=document.getElementById(us(this,am));if(!t.classList.contains("dropdown-focused")){var n=document.getElementById(us(this,rm));bs(this,dm,fm).call(this,n),t.classList.add("dropdown-focused")}}},{key:"blurHandler",value:function(e){var t=this;us(this,sm)&&(clearTimeout(us(this,sm)),ds(this,sm,null)),setTimeout((function(){document.getElementById(us(t,am)).classList.remove("dropdown-focused")}),500)}},{key:"refreshSearchResultsList",value:function(){var e=document.getElementById(us(this,am));if(us(this,um).length){var t,n=[],r=0,a=cs(us(this,um));try{for(a.s();!(t=a.n()).done;){var o=t.value;n[n.length]='<a class="list-group-item list-group-item-action" href="#" data-occurrenceId="'.concat(o.entityId,'" data-resultnumber="').concat(r,'">').concat(nm.formatter(o),"</a>"),++r}}catch(e){a.e(e)}finally{a.f()}e.innerHTML='<div class="list-group" id="'.concat(us(this,om),'">').concat(n.join(""),"</div>")}else e.innerHTML="";ds(this,cm,null)}},{key:"dropboxClickHandler",value:function(e){console.log("click handler"),console.log(e);var t=e.target.closest("a");if(console.log(t),us(this,lm)&&(clearTimeout(us(this,lm)),ds(this,lm,null),console.log("cleared a pending change event")),t&&t.dataset.occurrenceid){e.preventDefault(),console.log("got target ".concat(t.dataset.occurrenceid));var n=us(this,um)[t.dataset.resultnumber];this.value={taxonId:n.entityId,taxonName:n.vernacularMatched?n.vernacular:n.qname,vernacularMatch:n.vernacularMatched},this.fireEvent(zf.EVENT_CHANGE)}}},{key:"inputChangeHandler",value:function(e){var t=this;e.stopPropagation(),console.log("got taxon field input change event"),us(this,lm)&&clearTimeout(us(this,lm)),ds(this,lm,setTimeout((function(){console.log("processing taxon field input change event");var e=us(t,um).find((function(e){return e.exact}));e?(console.log("exact match"),t.value={taxonId:e.entityId,taxonName:e.vernacularMatched?e.vernacular:e.qname,vernacularMatch:e.vernacularMatched}):(console.log("no match"),t.value={taxonId:"",taxonName:document.getElementById(us(t,rm)).value.trim(),vernacularMatch:null}),console.log(t._value),t.fireEvent(zf.EVENT_CHANGE)}),500))}}],[{key:"isEmpty",value:function(e){return!e||e&&!e.taxonName}},{key:"cleanRawInput",value:function(e){return e.value.trim().replace(/\s\s+/g," ")}}]),n}(zf);function fm(e){var t=this,n=zf.cleanRawInput(e);us(this,sm)&&clearTimeout(us(this,sm)),n.length>=nm.MIN_SEARCH_LENGTH?ds(this,sm,setTimeout((function(){ds(t,um,t.taxonSearch.lookup(zf.cleanRawInput(document.getElementById(us(t,rm))))),console.log(us(t,um)),t.refreshSearchResultsList(),ds(t,sm,null)}),hm.timeoutDelay)):(ds(this,um,[]),this.refreshSearchResultsList())}zi(hm,"timeoutDelay",50);var pm=ae,vm=kt.EXISTS,mm=oe.f,ym=Function.prototype,gm=ym.toString,bm=/^\s*function ([^ (]*)/;pm&&!vm&&mm(ym,"name",{configurable:!0,get:function(){try{return gm.call(this).match(bm)[1]}catch(e){return""}}});var Em=new WeakMap,wm=new WeakMap,_m=function(e){Ki(n,e);var t=rs(n);function n(e){var r;return Gi(this,n),ws(ts(r=t.call(this,e)),Em,{writable:!0,value:void 0}),ws(ts(r),wm,{writable:!0,value:void 0}),zi(ts(r),"_value",""),zi(ts(r),"_autocomplete",""),e&&(e.options&&(r.options=e.options),e.placeholder&&(r.placeholder=e.placeholder),e.autocomplete&&(r._autocomplete=e.autocomplete)),r}return Yi(n,[{key:"value",get:function(){return this._value},set:function(e){this._value=void 0===e||null==e?"":e.trim(),this.updateView()}},{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(us(this,Em)).value=zf.cleanRawString(this._value))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",ds(this,wm,e.id=zf.nextId),ds(this,Em,zf.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=us(this,Em),t.textContent=this.label;var n=e.appendChild(document.createElement("textarea"));(n.className="form-control",n.id=us(this,Em),this.helpText)&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);if(this._autocomplete&&(n.autocomplete=this._autocomplete,"off"===this._autocomplete&&(n.name=Gf())),this.validationMessage){var r=e.appendChild(document.createElement("div"));r.className="invalid-feedback",r.innerHTML=this.validationMessage}n.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"inputChangeHandler",value:function(e){e.stopPropagation(),console.log("got text area field input change event"),this.value=zf.cleanRawString(document.getElementById(us(this,Em)).value),this.fireEvent(zf.EVENT_CHANGE)}}],[{key:"summariseImpl",value:function(e,t,n){return""!==n[e]&&null!==n[e]&&void 0!==n[e]?np(n[e].trim()):""}}]),n}(zf);function xm(e,t,n){if(n.length>2){var r=n.pop();return"".concat(n.join(e+" ")," ").concat(t," ").concat(r)}return n.join(" ".concat(t," "))}var Sm=new WeakMap,km=new WeakMap,Im=new WeakSet,Tm=function(e){Ki(n,e);var t=rs(n);function n(e){var r;return Gi(this,n),_s(ts(r=t.call(this,e)),Im),ws(ts(r),Sm,{writable:!0,value:void 0}),ws(ts(r),km,{writable:!0,value:void 0}),zi(ts(r),"options",{}),zi(ts(r),"includeOtherFreeText",!0),zi(ts(r),"_value",{selection:[],other:null}),e&&(e.options&&(r.options=e.options),e.hasOwnProperty("includeOtherFreeText")&&(r.includeOtherFreeText=e.includeOtherFreeText)),r}return Yi(n,[{key:"value",get:function(){return this._value},set:function(e){this._value=e||{selection:[],other:null},this.updateView()}},{key:"updateView",value:function(){if(this._fieldEl){var e,t=cs(document.querySelectorAll("".concat(fs(n,n,Rm),"#").concat(us(this,Sm),' input[type="checkbox"]')));try{for(t.s();!(e=t.n()).done;){var r=e.value,a=r.checked=this._value.selection.includes(r.name);if(r.name===n.KEY_OTHER&&us(this,km)){var o=document.getElementById(us(this,km));o.style.display=a?"block":"none",o.value=null===this._value.other?"":this._value.other.trim()}}}catch(e){t.e(e)}finally{t.f()}}}},{key:"buildField",value:function(){if(!this.options)throw new Error("Options have not been set before call to buildField()");var e=document.createElement(fs(n,n,Rm));e.className="form-group",ds(this,Sm,e.id=zf.nextId);var t=e.appendChild(document.createElement("label"));(t.style.display="block",t.textContent=this.label,this.helpText)&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);for(var r in this.options)this.options.hasOwnProperty(r)&&bs(this,Im,Cm).call(this,e,r,this.options[r]);if(this.validationMessage){var a=e.appendChild(document.createElement("div"));a.className="invalid-feedback",a.innerHTML=this.validationMessage}e.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"inputChangeHandler",value:function(e){e.stopPropagation();var t,r={selection:[],other:null};us(this,km)&&(t=document.getElementById(us(this,km)));var a,o=cs(document.querySelectorAll("".concat(fs(n,n,Rm),"#").concat(us(this,Sm),' input[type="checkbox"]:checked')));try{for(o.s();!(a=o.n()).done;){var i=a.value;r.selection[r.selection.length]=i.name,i.name===n.KEY_OTHER&&us(this,km)&&(r.other=zf.cleanRawInput(t),!0)}}catch(e){o.e(e)}finally{o.f()}this.value=r,this.fireEvent(zf.EVENT_CHANGE)}}],[{key:"summariseImpl",value:function(e,t,n){var r=t.summary,a=[];if(n[e].selection.length){var o,i=cs(n[e].selection);try{for(i.s();!(o=i.n()).done;){var s=o.value;"other"===s&&n[e].other?a[a.length]="".concat(t.attributes.options[s].summary||t.attributes.options[s].label," (").concat(n[e].other,")"):a[a.length]=t.attributes.options[s].summary||t.attributes.options[s].label}}catch(e){i.e(e)}finally{i.f()}return np("".concat(r.summaryPrefix," ").concat(xm(",","or",a)))}return""}}]),n}(zf);function Cm(e,t,n){var r=e.appendChild(document.createElement("div"));r.className="form-check";var a=r.appendChild(document.createElement("input"));a.type="checkbox",a.className="form-check-input",a.id=zf.nextId,a.name=t;var o=r.appendChild(document.createElement("label"));if(o.htmlFor=a.id,o.className="form-check-label",o.textContent=n.label,Tm.KEY_OTHER===t&&this.includeOtherFreeText){var i=r.appendChild(document.createElement("input"));i.id=ds(this,km,zf.nextId),i.className="form-control",i.style.display="none"}}zi(Tm,"KEY_OTHER","other");var Rm={writable:!0,value:"fieldset"},Om=new WeakMap,Nm=new WeakMap,Am=new WeakMap,Lm=new WeakSet,Pm=function(e){Ki(n,e);var t=rs(n);function n(e){var r;return Gi(this,n),_s(ts(r=t.call(this,e)),Lm),ws(ts(r),Om,{writable:!0,value:void 0}),ws(ts(r),Nm,{writable:!0,value:void 0}),ws(ts(r),Am,{writable:!0,value:void 0}),zi(ts(r),"options",{}),zi(ts(r),"placeholder",""),zi(ts(r),"includeOtherFreeText",!0),zi(ts(r),"_value",{selection:[],other:null}),e&&(e.options&&(r.options=e.options),e.hasOwnProperty("includeOtherFreeText")&&(r.includeOtherFreeText=e.includeOtherFreeText),e.placeholder&&(r.placeholder=e.placeholder)),r}return Yi(n,[{key:"value",get:function(){return this._value},set:function(e){this._value=e||{selection:[],other:null},this.updateView()}},{key:"markValidity",value:function(e){var t=document.getElementById(us(this,Nm));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"updateView",value:function(){if(this._fieldEl){var e,t=cs(document.querySelectorAll("select#".concat(us(this,Nm)," option")));try{for(t.s();!(e=t.n()).done;){var n=e.value;if(""!==n.value){var r=n.selected=this._value.selection.includes(n.value);if(n.value===Tm.KEY_OTHER&&us(this,Am)){var a=document.getElementById(us(this,Am));a.style.display=r?"block":"none",a.value=null===this._value.other?"":this._value.other.trim()}}else n.selected=0===this._value.selection.length}}catch(e){t.e(e)}finally{t.f()}}}},{key:"buildField",value:function(){if(!this.options)throw new Error("Options have not been set before call to buildField()");var e=document.createElement(fs(n,n,Mm));e.className="form-group",ds(this,Om,e.id=zf.nextId),ds(this,Nm,zf.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=us(this,Nm),t.style.display="block",t.innerHTML=this.label;var r=document.createElement("select");(r.id=us(this,Nm),r.className="custom-select",this.helpText)&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);for(var a in this.placeholder&&bs(this,Lm,Hm).call(this,e,r,"",{label:this.placeholder}),this.options)this.options.hasOwnProperty(a)&&bs(this,Lm,Hm).call(this,e,r,a,this.options[a]);if(e.appendChild(r),this.validationMessage){var o=e.appendChild(document.createElement("div"));o.className="invalid-feedback",o.innerHTML=this.validationMessage}e.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"inputChangeHandler",value:function(e){e.stopPropagation();var t,n={selection:[],other:null};us(this,Am)&&(t=document.getElementById(us(this,Am)));var r,a=cs(document.querySelectorAll("select#".concat(us(this,Nm)," option:checked")));try{for(a.s();!(r=a.n()).done;){var o=r.value;""!==o.value&&(n.selection[n.selection.length]=o.value,o.name===Tm.KEY_OTHER&&us(this,Am)&&(n.other=zf.cleanRawInput(t),!0))}}catch(e){a.e(e)}finally{a.f()}this.value=n,this.fireEvent(zf.EVENT_CHANGE)}}],[{key:"isEmpty",value:function(e){return 0===e.selection.length||""===e.selection[0]}},{key:"summariseImpl",value:function(e,t,n){var r=t.summary,a=[];if(n[e].selection.length){var o,i=cs(n[e].selection);try{for(i.s();!(o=i.n()).done;){var s=o.value;"other"===s&&n[e].other?a[a.length]="".concat(t.attributes.options[s].summary||t.attributes.options[s].label," (").concat(n[e].other,")"):a[a.length]=t.attributes.options[s].summary||t.attributes.options[s].label}}catch(e){i.e(e)}finally{i.f()}return np("".concat(r.summaryPrefix," ").concat(xm(",","or",a)))}return""}}]),n}(zf);function Hm(e,t,n,r){var a=t.appendChild(document.createElement("option"));if(a.value=n,a.innerText=r.label,Tm.KEY_OTHER===n&&this.includeOtherFreeText){var o=e.appendChild(document.createElement("input"));o.id=ds(this,Am,zf.nextId),o.className="form-control"}}var Mm={writable:!0,value:"fieldset"},Dm=function(e){Ki(n,e);var t=rs(n);function n(){var e;Gi(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return zi(ts(e=t.call.apply(t,[this].concat(a))),"file",void 0),zi(ts(e),"TYPE","image"),zi(ts(e),"SAVE_ENDPOINT","/saveimage.php"),e}return Yi(n,[{key:"getUrl",value:function(){}},{key:"save",value:function(e,t,n){if(this._savedRemotely)return Promise.reject("".concat(this.id," has already been saved."));var r=new FormData;return r.append("type",this.TYPE),r.append("surveyId",e),r.append("occurrenceId",t),r.append("projectId",n.toString()),r.append("imageId",this.id),r.append("image",this.file),r.append("deleted",this.deleted.toString()),console.log("queueing image post, image id ".concat(this.id)),this.queuePost(r)}},{key:"_parseDescriptor",value:function(e){as(Xi(n.prototype),"_parseDescriptor",this).call(this,e),this.surveyId=e.surveyId,this.occurrenceId=e.occurrenceId,this.file=e.image}}],[{key:"fromFile",value:function(e){var t=new n;return t.file=e,t}},{key:"placeholder",value:function(e){var t=new n;return t._id=e,n.imageCache.set(e,t),t}},{key:"imageLink",value:function(e,t,n,r){t=t||0,n=n||0;var a="";r.className&&(a+=' class="'.concat(r.className,'"'));var o=t>n?'width="'.concat(t,'"'):'height="'.concat(n,'"');return'<picture><source srcset="/image.php?imageid='.concat(e,'&amp;height=128&amp;format=webp" type="image/webp"><img').concat(a,' src="/image.php?imageid=').concat(e,"&amp;width=").concat(t,"&amp;height=").concat(n,'&amp;format=jpeg" ').concat(o,' alt="photo"></picture>')}}]),n}(Yf);zi(Dm,"imageCache",new Map),zi(Dm,"EVENT_MODIFIED","modified");var jm=new WeakMap,Fm=new WeakMap,Bm=new WeakMap,Vm=new WeakSet,qm=new WeakSet,Wm=function(e){Ki(n,e);var t=rs(n);function n(e){var r;return Gi(this,n),_s(ts(r=t.call(this,e)),qm),_s(ts(r),Vm),ws(ts(r),jm,{writable:!0,value:void 0}),ws(ts(r),Fm,{writable:!0,value:void 0}),ws(ts(r),Bm,{writable:!0,value:void 0}),zi(ts(r),"parentForm",void 0),zi(ts(r),"_value",{images:[]}),zi(ts(r),"includeCamera",!0),zi(ts(r),"placeholder",""),e&&(e.hasOwnProperty("includeCamera")&&(r.includeCamera=e.includeCamera),e.placeholder&&(r.placeholder=e.placeholder)),r}return Yi(n,[{key:"value",get:function(){var e=[];if(this._value&&this._value.images){var t,n=cs(this._value.images);try{for(n.s();!(t=n.n()).done;){var r=t.value;e[e.length]=r.id}}catch(e){n.e(e)}finally{n.f()}}return e},set:function(e){if(this._value={images:[]},e){var t,n=cs(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;Dm.imageCache.has(r)?this._value.images.push(Dm.imageCache.get(r)):(console.log("Creating placeholder image object '".concat(r,"'")),this._value.images.push(Dm.placeholder(r)))}}catch(e){n.e(e)}finally{n.f()}}this.updateView()}},{key:"updateView",value:function(){if(this._fieldEl){var e,t=[],n=cs(this._value.images);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push('<picture style="cursor: pointer;" data-imageid="'.concat(r.id,'"><source srcset="/image.php?imageid=').concat(r.id,'&amp;height=128&amp;format=webp" type="image/webp"><img data-imageid="').concat(r.id,'" src="/image.php?imageid=').concat(r.id,'&amp;height=128&amp;format=jpeg" height="128" alt="photo"></picture>'))}}catch(e){n.e(e)}finally{n.f()}document.getElementById(us(this,Bm)).innerHTML=t.join("\n")}}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",ds(this,Fm,e.id=zf.nextId),ds(this,jm,zf.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=us(this,jm),t.textContent=this.label;var n=e.appendChild(document.createElement("div"));n.className="input-group";var r=document.createElement("div");r.className="custom-file",n.appendChild(r);var a=r.appendChild(document.createElement("input"));if(a.type="file",a.className="custom-file-input",a.id=us(this,jm),a.accept="image/png, image/jpeg",a.multiple=!0,this.placeholder){var o=r.appendChild(document.createElement("label"));o.className="custom-file-label",o.htmlFor=us(this,jm),o.textContent=this.placeholder}if(this.includeCamera){var i=document.createElement("div");i.className="input-group-append";var s=i.appendChild(document.createElement("span"));s.className="input-group-text";var l=s.appendChild(document.createElement("label"));l.className="pl-0 pr-0 ml-0 mr-0 mt-0 mb-0 pt-0 pb-0 material-icons";var c=l.appendChild(document.createElement("i"));c.className="material-icons pl-0 pr-0 ml-0 mr-0 mt-0 mb-0 pt-0 pb-0",c.textContent="add_a_photo";var u=l.appendChild(document.createElement("input"));u.type="file",u.capture="environment",u.accept="image/*",u.style.display="none",u.id=zf.nextId,n.appendChild(i),u.addEventListener("change",this.inputChangeHandler.bind(this,u.id))}this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);var d=e.appendChild(document.createElement("p"));if(ds(this,Bm,d.id=zf.nextId),d.addEventListener("click",this.imageClickHandler.bind(this)),this.validationMessage){var h=e.appendChild(document.createElement("div"));h.className="invalid-feedback",h.innerHTML=this.validationMessage}a.addEventListener("change",this.inputChangeHandler.bind(this,a.id)),this._fieldEl=e,this.parentForm.addListener("deleteimage",this,"deleteImageHandler")}},{key:"deleteImageHandler",value:function(e,t,n){var r;for(var a in console.log("delete image ".concat(n)),this._value.images)if(this._value.images.hasOwnProperty(a)&&this._value.images[a].id===n){r=this._value.images.splice(a,1)[0];break}r?(this.updateView(),this.fireEvent(zf.EVENT_CHANGE)):console.log("Failed to find image id ".concat(n))}},{key:"imageClickHandler",value:function(e){var t=e.target.closest("picture");t||(t=e.target.closest("img")),console.log({"clicked image":t});var n=t.getAttribute("data-imageid");n&&(document.getElementById("imagemodal").getElementsByTagName("picture")[0].innerHTML='<source srcset="/image.php?imageid='.concat(n,"&amp;width=").concat(window.innerWidth,'&amp;format=webp" type="image/webp">\n                <img src="/image.php?imageid=').concat(n,"&amp;width=").concat(window.innerWidth,'&amp;format=jpeg" width="auto" style="max-height: 48vh; max-width: 100%;" alt="photo">'),document.getElementById("imagemodaldelete").setAttribute("data-imageid",n),$("#".concat("imagemodal")).modal({}))}},{key:"inputChangeHandler",value:function(e,t){var n=this;t.stopPropagation(),console.log("got image field input change event");var r=document.getElementById(e);r.files.length?bs(this,Vm,Um).call(this,r.files).then((function(){n.fireEvent(zf.EVENT_CHANGE)})):this.fireEvent(zf.EVENT_CHANGE)}}],[{key:"isEmpty",value:function(e){return!e||0===e.length}},{key:"licenseModal",value:function(){var e=document.createElement("div");return e.innerHTML='<div class="modal fade" id="'.concat(n.LICENSE_MODAL,'" tabindex="-1" role="dialog" aria-labelledby="').concat(n.LICENSE_MODAL,'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title" id="').concat(n.LICENSE_MODAL,'Title">Image licensing</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <p>By choosing to submit images with your plant hunt records you agree to license the image under the terms of the Creative Common Attribution 4.0 International license (CC BY 4.0).</p>\n        <p>The following is a summary of (and not a substitute for) the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">license</a>.</p>\n        <p>Licensees are free to:</p>\n        <ul class="license-properties">\n<li>\n<strong>Share</strong> — copy and redistribute the material in any medium or format\n</li>\n<li>\n<strong>Adapt</strong> — remix, transform, and build upon the material for any purpose, even commercially.\n</li>\n</ul>\n<p>Licensees are most follow these term:</p>\n<ul>\n<li>\n<p>\n<strong>Attribution</strong> — licensees must give appropriate credit, provide a link to the license, and indicate if changes were made.\n</p>\n</li>\n</ul>\n<p>Full details of the license are here: <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0 license</a></p>\n\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n      </div>\n    </div>\n  </div>\n</div>'),e.firstChild}}]),n}(zf);function Um(e){this.parentForm.pingOccurrence();var t,n=[],r=cs(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(Dm.fromFile(a))}}catch(e){r.e(e)}finally{r.f()}return bs(this,qm,Gm).call(this,n)}function Gm(e){var t=this;if(e.length){var n=e.shift();return n.save(this.parentForm.surveyId,this.parentForm.occurrenceId,this.parentForm.projectId).then((function(e){console.log("Added image '".concat(n.id,"'")),console.log({jsonDescription:e}),t._value.images.push(n),t.updateView()}),(function(e){console.log("Failed to add image ".concat(n.id)),console.log({"Failure reason":e})})).finally((function(){return bs(t,qm,Gm).call(t,e)}))}return Promise.resolve()}zi(Wm,"LICENSE_MODAL","imagelicensemodal");var $m=new WeakMap,Ym=function(e){Ki(n,e);var t=rs(n);function n(e){var r;return Gi(this,n),ws(ts(r=t.call(this)),$m,{writable:!0,value:void 0}),zi(ts(r),"_formFieldsBuilt",!1),zi(ts(r),"surveyId",""),e&&(r.model=e),r}return Yi(n,[{key:"formElement",get:function(){var e=arguments,t=as(Xi(n.prototype),"formElement",this);return this._formFieldsBuilt||(this.buildFormFields(),t.addEventListener("change",(function(){console.log("occurrence form change event"),console.log(e)}),{capture:!1})),t}},{key:"buildContentContainer",value:function(e){var t=e.appendChild(document.createElement("div"));t.className="card mt-3 ml-0 mr-0 mb-3";var r=t.appendChild(document.createElement("div"));return r.className="card-header",r.textContent=n.sectionTitle,this._formContentContainer=t.appendChild(document.createElement("div")),this._formContentContainer.className="card-body",this._formContentContainer}},{key:"occurrenceId",get:function(){return us(this,$m)?us(this,$m).id:null}},{key:"projectId",get:function(){return us(this,$m)?us(this,$m).projectId:null}},{key:"initialiseFormFields",value:function(){var e=n.properties;for(var t in this.fields={},e)e.hasOwnProperty(t)&&(this.fields[t]=new e[t].field(e[t].attributes))}},{key:"updateModelFromContent",value:function(){for(var e in console.log("updating occurrence from NyphOccurrenceForm content"),this.fields)if(this.fields.hasOwnProperty(e)){var t=this.fields[e];us(this,$m).attributes[e]=t.value}console.log({occurrence:us(this,$m)})}},{key:"model",get:function(){return us(this,$m)},set:function(e){ds(this,$m,e),this.populateFormContent()}},{key:"changeHandler",value:function(e){console.log("occurrence form change event"),console.log({event:e}),this.fireEvent(n.CHANGE_EVENT,{form:this})}},{key:"pingOccurrence",value:function(){us(this,$m).unsaved()&&this.fireEvent(n.CHANGE_EVENT,{form:this})}},{key:"destructor",value:function(){ds(this,$m,null),as(Xi(n.prototype),"destructor",this).call(this)}},{key:"getFormSectionProperties",value:function(){return n.properties}}]),n}(Qf);zi(Ym,"sectionTitle","Details of invasive garden plant"),zi(Ym,"help",'\x3c!-- begin: templates/formHelp/recordsHelp.html --\x3e\r\n<p>In this section, please list the ornamental plants that are spreading in your\r\ngarden and are difficult to control.</p>\r\n<p> Many plants in your garden will spread and this is a sign that they are growing well. We only want to know about those that are spreading to an extent that\r\n    you have to control them to prevent them overgrowing other plants or parts of your garden where you do not want them.</p>\r\n<p>Please note in this project we are dealing with ornamental plants only (no vegetables, no weeds -\r\n    unless they are ornamentals that you now regard as weeds).</p>\r\n<div class="card mt-3">\r\n    <div class="card-body">\r\n        <h5 class="card-title">Using the forms</h5>\r\n        <p class="card-text">You can enter as many plant records as you need. To add another record click the \'Add a plant\' button.</p>\r\n        <p class="card-text">If you are currently online then the entries will be saved as you go, automatically. Otherwise the records\r\n            will be remembered on your device, but you will need to click \'<a href="/app/survey/save" data-navigo="survey/save">save all</a>\' (on the Surveys menu) when you have a network connection again.\r\n        </p>\r\n        <p class="card-text">To delete a plant record, find it in the list and click the red \'bin\' icon.\r\n        </p>\r\n    </div>\r\n</div>\r\n<div class="card mt-3">\r\n    <div class="card-body">\r\n        <h5 class="card-title">Identifying your plants</h5>\r\n        </p>\r\n        <h6 class="card-subtitle mb-2 text-muted">Plant names</h6>\r\n        <p class="card-text">If possible, please enter the scientific or common name of the plant, but don\'t worry if you dont know the full details.\r\n            The list of suggested names includes a very wide range of both native and horticultural plants, but if the name you need\r\n            isn\'t on the list then you can still type it in.\r\n        </p>\r\n        <h6 class="card-subtitle mb-2 text-muted">Photos</h6>\r\n        <p class="card-text">Photos of the plant will help us confirm your record. Please provide a picture showing the whole plant, but it will\r\n            also help us if you can provide close-up views of the flowers and leaves.\r\n        </p>\r\n    </div>\r\n</div>\r\n\x3c!-- begin: templates/formHelp/recordsHelp.html --\x3e\r\n'),zi(Ym,"properties",{taxon:{field:hm,attributes:{label:"plant name",validationMessage:"Please specify a taxon name or provide some photos if you cannot identify the plant.",helpText:"Type the common or scientific name of the invasive plant and, if possible, pick a suggestion from the list. If you do not know the name of the plant then please leave this blank and include some photos."},validator:function(e,t,n){return!(!n.hasOwnProperty(e)||t.field.isEmpty(n[e]))||n.hasOwnProperty("images")&&!Wm.isEmpty(n.images)}},idConfidence:{field:Pm,attributes:{label:"How confident are you about your identification of this plant?",helpText:"",placeholder:"please choose an option",options:{1:{label:"very sure"},2:{label:"not really sure"},3:{label:"could be wrong"}},includeOtherFreeText:!1,completion:zf.COMPLETION_DESIRED}},images:{field:Wm,attributes:{label:"Please provide some photos of the plant",placeholder:"photos",helpText:'If the plant is unusual or if you are unsure of its identity then photos will help us check your record.<br><strong>Submitted images remain your property, but you agree to allow us to use the photos under the terms of a <a href="#" title="Creative Commons Attribution" data-toggle="modal" data-target="#'.concat(Wm.LICENSE_MODAL,'">CC BY</a> license.</strong>')}},spread:{field:Tm,attributes:{label:"How does the plant spread in your garden?",helpText:"<i>(tick all that apply)</i>",options:{seeds:{label:"seeds"},roots:{label:"roots"},runners:{label:"runners"},bulbs:{label:"bulbs"},unknown:{label:"don't know"},other:{label:"other"}},includeOtherFreeText:!0,completion:zf.COMPLETION_DESIRED},summary:{summaryPrefix:"Spread by"}},control:{field:Tm,attributes:{label:"How do you control this plant?",helpText:"<i>(tick all that apply)</i>",options:{digging:{label:"digging"},pulling:{label:"pulling"},chemical:{label:"chemical"},cutting:{label:"cutting"},mulching:{label:"mulching"},other:{label:"other"}},includeOtherFreeText:!0,completion:zf.COMPLETION_DESIRED},summary:{summaryPrefix:"Controlled by"}},disposal:{field:Tm,attributes:{label:"Please tell us how you dispose of this plant?",helpText:"<i>(tick all that apply)</i>",options:{homecompost:{label:"home composting"},greenwaste:{label:"green waste"},"other waste":{label:"other waste collection"},other:{label:"other"}},includeOtherFreeText:!0,completion:zf.COMPLETION_DESIRED},summary:{summaryPrefix:"Disposal by"}},problemSeverity:{field:Pm,attributes:{label:"Which of the following best describes your effort to control the plant?",placeholder:"please select a response",options:{1:{label:"I don't try to control it"},2:{label:"I try to keep it confined to certain areas."},3:{label:"I am trying everything to get rid of it."},4:{label:"I have given up trying to control it."},5:{label:"I have successfully eradicated the plant."}},includeOtherFreeText:!1,completion:zf.COMPLETION_DESIRED},summary:{summaryPrefix:"Severity:"}},source:{field:Tm,attributes:{label:"Please tell us how this plant came into your garden?",helpText:"<i>(tick all that apply)</i>",options:{alreadypresent:{label:"Was already in the garden"},bought:{label:"Bought the plant"},seed:{label:"Grown from seed"},someoneelse:{label:"From someone else's garden"},saleswap:{label:"Non-commercial sale/swap"},spread:{label:"Spread into my garden"},other:{label:"other"}},includeOtherFreeText:!0,completion:zf.COMPLETION_DESIRED},summary:{summaryPrefix:"Source"}},local:{field:Pm,attributes:{label:"Is the plant growing locally outside your garden?",placeholder:"please select a response",options:{yes:{label:"yes"},no:{label:"no"},notknown:{label:"I don't know"}},includeOtherFreeText:!1}},warning:{field:Pm,attributes:{label:"In your opinion, should the plant be sold with a label warning buyers of potential control difficulties in their garden?",placeholder:"please select a response",options:{yes:{label:"Yes",summary:"Plants should carry a warning"},no:{label:"No",summary:"Plants need not carry a warning"},unsure:{label:"Don't know",summary:"Don't know if plants should carry a warning"}},includeOtherFreeText:!1,completion:zf.COMPLETION_DESIRED},summary:{summarise:!0,summaryPrefix:""}},comments:{field:_m,attributes:{label:"Any other comments about this plant?",helpText:"",autocomplete:"off"},summary:{summarise:!0}}}),Ym.CHANGE_EVENT="change";var zm=function(e){Ki(n,e);var t=rs(n);function n(){var e;Gi(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return zi(ts(e=t.call.apply(t,[this].concat(a))),"attributes",{}),zi(ts(e),"_savedRemotely",!1),zi(ts(e),"_savedLocally",!1),zi(ts(e),"SAVE_ENDPOINT","/saveoccurrence.php"),zi(ts(e),"TYPE","occurrence"),zi(ts(e),"isNew",!1),e}return Yi(n,[{key:"taxon",get:function(){return this.attributes.taxon&&this.attributes.taxon.taxonId?op.fromId(this.attributes.taxon.taxonId):null}},{key:"getForm",value:function(){var e=new Ym(this);return this.isNew||(e.liveValidation=!0),e.addListener(Ym.CHANGE_EVENT,this,this.formChangedHandler),e}},{key:"formChangedHandler",value:function(e,t,r){console.log("Occurrence change handler invoked."),r.form.updateModelFromContent(),r.form.conditionallyValidateForm(),this.touch(),this.fireEvent(n.EVENT_MODIFIED,{occurrenceId:this.id})}},{key:"delete",value:function(){this.deleted||(this.touch(),this.deleted=!0,this.fireEvent(n.EVENT_MODIFIED,{occurrenceId:this.id}))}},{key:"save",value:function(e){if(this._savedRemotely)return Promise.reject("".concat(this.id," has already been saved."));var t=new FormData;return t.append("type",this.TYPE),t.append("surveyId",e),t.append("occurrenceId",this.id),t.append("projectId",this.projectId.toString()),t.append("attributes",JSON.stringify(this.attributes)),t.append("deleted",this.deleted.toString()),t.append("created",this.createdStamp.toString()),console.log("queueing occurrence post"),this.queuePost(t)}},{key:"_parseDescriptor",value:function(e){as(Xi(n.prototype),"_parseDescriptor",this).call(this,e),this.surveyId=e.surveyId}}]),n}(Yf);zi(zm,"EVENT_MODIFIED","modified");var Km=function(e){Ki(n,e);var t=rs(n);function n(){return Gi(this,n),t.apply(this,arguments)}return n}(es(Error)),Xm=function(e){Ki(n,e);var t=rs(n);function n(){var e;Gi(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return zi(ts(e=t.call.apply(t,[this].concat(a))),"projectId",2),e}return Yi(n,[{key:"addSurvey",value:function(e){var t=this;if(e.projectId!==this.projectId)throw new Error("Survey project id '".concat(e.projectId," does not match with current project ('").concat(this.projectId,"')"));this.surveys.has(e.id)||(console.log("setting survey's modified/save handler"),e.addListener(rp.EVENT_MODIFIED,this,(function(e){return t.fireEvent(Qh.EVENT_SURVEYS_CHANGED),e.save()}))),this.surveys.set(e.id,e),this.fireEvent(Qh.EVENT_SURVEYS_CHANGED)}},{key:"haveExtantOccurrences",value:function(){var e,t=cs(this.occurrences);try{for(t.s();!(e=t.n()).done;){if(!e.value.deleted)return!0}}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"addOccurrence",value:function(e){var t=this;if(!e.surveyId)throw new Km("Survey id must set prior to registering occurrence.");0===this.occurrences.size&&(this.surveys.get(e.surveyId).createdStamp=e.createdStamp);this.occurrences.set(e.id,e),e.addListener(zm.EVENT_MODIFIED,this,(function(e){var n=t.surveys.get(e.surveyId);if(!n)throw new Error("Failed to look up survey id ".concat(e.surveyId));n.unsaved()&&n.save(),e.save(n.id)}))}},{key:"refreshFromServer",value:function(e){var t,r=this,a=new FormData,o=0,i=cs(e);try{for(i.s();!(t=i.n()).done;){var s=t.value;a.append("surveyId[".concat(o++,"]"),s)}}catch(e){i.e(e)}finally{i.f()}return fetch(n.LOAD_SURVEYS_ENDPOINT,{method:"POST",body:a}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response from server when refreshing survey ids")})).then((function(e){console.log({"refresh from server json response":e});var t=[];for(var n in e)if(e.hasOwnProperty(n)){var a,o=cs(e[n]);try{for(o.s();!(a=o.n()).done;){var i=a.value;t.push(r._conditionallyReplaceObject(i))}}catch(e){o.e(e)}finally{o.f()}}return Promise.all(t)}))}},{key:"_conditionallyReplaceObject",value:function(e){var t=e.type,n=e.id,r="".concat(t,".").concat(n);return Uf.getItem(r).then((function(t){return t&&!e.deleted&&t.modified>=e.modified?(console.log("Local copy of ".concat(r," is the same or newer than the server copy. (").concat(t.modified," >= ").concat(e.modified,") ")),Promise.resolve()):(console.log("Adding or replacing local copy of ".concat(r)),Uf.setItem(r,e))}))}},{key:"seekKeys",value:function(e){return Uf.keys().then((function(t){var n,r=cs(t);try{for(r.s();!(n=r.n()).done;){var a,o,i=n.value,s=os(i.split(".",2),2);a=s[0],o=s[1],e.hasOwnProperty(a)?e[a].includes(o)||e[a].push(o):console.log("Unrecognised stored key type '".concat(a,"."))}}catch(e){r.e(e)}finally{r.f()}return e}))}},{key:"syncAll",value:function(){var e=this;return this.seekKeys({survey:[],occurrence:[],image:[]}).then((function(t){return e._syncLocalUnsaved(t)}),(function(e){console.log("Failed to sync all: ".concat(e))}))}},{key:"_syncLocalUnsaved",value:function(e){var t,n=[],r=cs(e.survey);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(rp.retrieveFromLocal(a,new rp).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){r.e(e)}finally{r.f()}var o,i=cs(e.occurrence);try{for(i.s();!(o=i.n()).done;){var s=o.value;n.push(zm.retrieveFromLocal(s,new zm).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){i.e(e)}finally{i.f()}var l,c=cs(e.image);try{for(c.s();!(l=c.n()).done;){var u=l.value;n.push(Dm.retrieveFromLocal(u,new Dm).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){c.e(e)}finally{c.f()}return Promise.all(n).catch((function(e){console.log("Save failure: ".concat(e))}))}},{key:"restoreOccurrences",value:function(e){var t=this;if(this.surveys.has(e)){var n=this.surveys.get(e);if(n.isPristine)return this.currentSurvey=n,this.fireEvent(Qh.EVENT_SURVEYS_CHANGED),Promise.resolve()}var r={survey:[],occurrence:[],image:[]};return e&&(r.survey[0]=e),this.seekKeys(r).then((function(e){return e.survey.length?t.refreshFromServer(e.survey).finally((function(){return t.seekKeys(e)})):null})).finally((function(){return r.survey.length?t._restoreSurveyFromLocal(r.survey[0],r).finally((function(){return t.currentSurvey=t.surveys.get(r.survey[0]),t.currentSurvey?(t.currentSurvey.deleted?t.setNewSurvey():t.fireEvent(Qh.EVENT_SURVEYS_CHANGED),Promise.resolve()):(console.log("Failed to retrieve survey id '".concat(e,"'")),Promise.reject(new Error("Failed to retrieve survey id '".concat(e,"'"))))})):(t.setNewSurvey(),Promise.resolve())}))}},{key:"setNewSurvey",value:function(){this.currentSurvey=new rp,this.currentSurvey.projectId=this.projectId,this.currentSurvey.isPristine=!0,this.addSurvey(this.currentSurvey)}},{key:"addNewOccurrence",value:function(){var e=new zm;return e.surveyId=this.currentSurvey.id,e.projectId=this.projectId,e.isNew=!0,e.isPristine=!0,this.addOccurrence(e),this.fireEvent(n.EVENT_OCCURRENCE_ADDED,{occurrenceId:e.id,surveyId:e.surveyId}),e}},{key:"_restoreSurveyFromLocal",value:function(e,t){var n=this;return rp.retrieveFromLocal(e,new rp).then((function(r){n.clearCurrentSurvey(),n.addSurvey(r);var a,o=[],i=cs(t.occurrence);try{for(i.s();!(a=i.n()).done;){var s=a.value;o.push(zm.retrieveFromLocal(s,new zm).then((function(t){t.surveyId===e&&n.addOccurrence(t)})))}}catch(e){i.e(e)}finally{i.f()}return Promise.all(o)})).finally((function(){var n,r=[],a=cs(t.image);try{var o=function(){var t=n.value;r.push(Dm.retrieveFromLocal(t,new Dm).then((function(n){n.surveyId===e&&Dm.imageCache.set(t,n)}),(function(e){console.log("Failed to retrieve an image: ".concat(e))})))};for(a.s();!(n=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}return Promise.all(r)}))}},{key:"clearLocalForage",value:function(){return Uf.clear()}}]),n}(Qh);zi(Xm,"LOAD_SURVEYS_ENDPOINT","/loadsurveys.php"),zi(Xm,"EVENT_OCCURRENCE_ADDED","occurrenceadded"),zi(Xm,"EVENT_SURVEYS_CHANGED","surveyschanged"),zi(Xm,"devMode",!1);var Qm=function(){function e(){Gi(this,e),zi(this,"route",null),zi(this,"view",void 0),zi(this,"title","untitled"),zi(this,"handle",void 0),zi(this,"app",void 0)}return Yi(e,[{key:"initialise",value:function(){this.view.initialise()}},{key:"registerRoute",value:function(e){if(null===this.route)throw new Error("No route set for '".concat(this.title,"' controller."));console.log({route:this.route}),e.on(this.route,this.routeHandler.bind(this),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null})}},{key:"routeHandler",value:function(e,t){}}],[{key:"nextHandle",get:function(){var t;return ps(e,e,Jm,1+(t=+fs(e,e,Jm))),t}}]),e}(),Jm={writable:!0,value:0},Zm=function(e){Ki(n,e);var t=rs(n);function n(e){return Gi(this,n),t.call(this,e)}return n}(es(Error)),ey=new WeakMap,ty=function(e){Ki(n,e);var t=rs(n);function n(e){var r;return Gi(this,n),zi(ts(r=t.call(this)),"route","/list/:action/:id"),zi(ts(r),"title","BSBI New Year Plant Hunt homepage"),zi(ts(r),"app",void 0),zi(ts(r),"view",void 0),ws(ts(r),ey,{writable:!0,value:""}),zi(ts(r),"needsFullRefresh",!0),zi(ts(r),"needRightPanelRefresh",!0),zi(ts(r),"viewSubcontext",""),zi(ts(r),"surveySection",void 0),zi(ts(r),"leftPanelBaseRoute",""),zi(ts(r),"viewContexts",{record:function(e){this.surveySection=null,e?us(this,ey)!==e.id?(this.needRightPanelRefresh=!0,this.currentOccurrenceId=e.id?e.id:""):this.needRightPanelRefresh=!1:(this.currentOccurrenceId="",this.needRightPanelRefresh=!0),this.leftPanelBaseRoute="/list/record"},survey:function(e){console.log("in survey section ".concat(e.section)),this.currentOccurrenceId="",this.needRightPanelRefresh=!0,this.surveySection=e.section,this.leftPanelBaseRoute="/list/survey/".concat(e.section)}}),r.view=e,e.controller=ts(r),r.handle=Qm.nextHandle,e.addListener(n.EVENT_SELECT_OCCURRENCE,ts(r),r.occurrenceSelectionHandler),e.addListener(n.EVENT_SELECT_SURVEY_SECTION,ts(r),r.surveyPartSelectionHandler),e.addListener(n.EVENT_NEW_RECORD,ts(r),r.newRecordHandler),e.addListener(n.EVENT_DELETE_OCCURRENCE,ts(r),r.deleteOccurrenceHandler),e.addListener(n.EVENT_BACK,ts(r),r.backHandler),e.addListener(n.EVENT_NEXT_TO_RECORDS,ts(r),r.nextTransitionToRecordsHandler),r}return Yi(n,[{key:"occurrences",get:function(){return this.app.occurrences}},{key:"currentOccurrence",get:function(){if(us(this,ey)){if(this.app.occurrences.has(us(this,ey)))return this.app.occurrences.get(us(this,ey));throw new Zm("Record id '".concat(us(this,ey),"' was not found."))}return null}},{key:"currentOccurrenceId",get:function(){return us(this,ey)},set:function(e){ds(this,ey,e)}},{key:"survey",get:function(){return this.app.currentSurvey}},{key:"nextTransitionToRecordsHandler",value:function(){console.log("in nextTransitionToRecordsHandler()"),this.app.haveExtantOccurrences()?this.app.router.navigate("/list/record/"):this.newRecordHandler()}},{key:"deleteOccurrenceHandler",value:function(e,t,n){console.log({deleting:n});var r=this.app.occurrences.get(n);if(!r)throw new Km("Occurrence id '".concat(n,"' not found when trying to delete."));r.delete(),this.currentOccurrenceId===n&&this.app.router.navigate("/list/record/")}},{key:"surveyPartSelectionHandler",value:function(e,t,n){console.log("In surveyPartSelectionHandler"),console.log({context:e,eventName:t,params:n}),"record"===n.sectionKey?this.app.router.navigate("/list/record/"):n.sectionKey?this.app.router.navigate("/list/survey/".concat(n.sectionKey)):this.app.router.navigate("/list/")}},{key:"newRecordHandler",value:function(){var e=this.app.addNewOccurrence();this.app.router.navigate("/list/record/".concat(e.id))}},{key:"occurrenceSelectionHandler",value:function(e,t,n){console.log({"In occurrenceSelectionHandler":{context:e,eventName:t,params:n}}),this.currentOccurrenceId&&n.occurrenceId&&this.currentOccurrenceId===n.occurrenceId?console.log("ignoring spurious navigation event for '".concat(n.occurrenceId,"'")):this.app.router.navigate("/list/record/".concat(n.occurrenceId))}},{key:"registerRoute",value:function(e){e.on("/list",this.mainRouteHandler.bind(this,"list","",""),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/help",this.mainRouteHandler.bind(this,"list","","help")),e.on("/list/record/",this.mainRouteHandler.bind(this,"list","record",""),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/record/help",this.mainRouteHandler.bind(this,"list","record","help")),e.on("/list/record/:id",this.mainRouteHandler.bind(this,"list","record","form"),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/survey/:section",this.mainRouteHandler.bind(this,"list","survey",""),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/survey/:section/help",this.mainRouteHandler.bind(this,"list","survey","help"))}},{key:"mainRouteHandler",value:function(e,t,n,r){console.log("reached special route handler for MainController.js"),console.log({context:e,params:t,query:r}),this.app.saveRoute();try{this.viewSubcontext=t,t&&this.viewContexts[t].call(this,r),this.app.currentControllerHandle!==this.handle&&(this.needsFullRefresh=!0,this.needRightPanelRefresh=!0,this.app.currentControllerHandle=this.handle),this.view.panelKey=n,this.view.display(),this.needsFullRefresh=!1}catch(e){this.error=e,console.log({error:e});try{this.needsFullRefresh=!0,this.view.display()}catch(e){console.log({rethrownError:e}),document.body.innerHTML="<h2>Internal error</h2><p>Please report this problem:</p><p>".concat(e.message,"</p>")}}}},{key:"backHandler",value:function(){this.app.routeHistory.length>=2&&this.app.routeHistory[this.app.routeHistory.length-2].url===this.leftPanelBaseRoute?(this.app.routeHistory.length-=1,console.log("using standard back navigation"),window.history.back()):(console.log("navigating back using base address '".concat(this.leftPanelBaseRoute,"'")),this.app.router.navigate(this.leftPanelBaseRoute))}}]),n}(Qm);zi(ty,"EVENT_SELECT_OCCURRENCE","selectoccurrence"),zi(ty,"EVENT_SELECT_SURVEY_SECTION","selectsurveysection"),zi(ty,"EVENT_NEW_RECORD","newrecord"),zi(ty,"EVENT_DELETE_OCCURRENCE","deleteoccurrence"),zi(ty,"EVENT_BACK","back"),zi(ty,"EVENT_NEXT_TO_RECORDS","nexttorecords");var ny="\x3c!-- begin: templates/formHelp/surveyAboutHelp.html --\x3e\r\n<h3>Background to the project</h3>\r\n<p>The majority of our ornamental plants are non-native. They contribute greatly to our enjoyment\r\nof gardens and represent a long history of plant discovery and garden design. However, some\r\nhave escaped the controlled environment of gardens, and a small minority of these are\r\nthreatening native biodiversity or are causing severe problems for infrastructure, agriculture or\r\n    forestry. Well known examples include Japanese Knotweed (<i>Reynoutria japonica</i>), <i>Rhododendron\r\n        ponticum</i> and Himalayan Balsam (<i>Impatiens glandulifera</i>).</p>\r\n<p>The period between introduction of a species and it first being noticed as a problem can be a\r\nlong one, making future control problematic. In Britain on average, this time span has been more\r\nthan one hundred years. Early detection of potentially problematic plants for further risk\r\n    assessment could greatly improve our ability to prevent plant species becoming invasive.</p>\r\n<p>This survey is based upon the assumption that it is gardeners who are most likely to notice first\r\nif a particular ornamental plant may have the potential to spread outside the garden. (Most\r\ngardeners will know which plants tend to overgrow others or tend to spread all over the\r\ngarden.) This knowledge could be invaluable in identifying potential invaders, triggering timely risk\r\n    assessment.</p>\r\n\x3c!-- end: templates/formHelp/surveyAboutHelp.html --\x3e\r\n",ry=new WeakMap,ay=new WeakMap,oy=function(e){Ki(n,e);var t=rs(n);function n(e){var r;return Gi(this,n),ws(ts(r=t.call(this,e)),ry,{writable:!0,value:void 0}),ws(ts(r),ay,{writable:!0,value:void 0}),zi(ts(r),"_value",""),zi(ts(r),"_inputType","text"),zi(ts(r),"_autocomplete",""),e&&(e.type&&(r._inputType=e.type),e.placeholder&&(r.placeholder=e.placeholder),e.autocomplete&&(r._autocomplete=e.autocomplete)),r}return Yi(n,[{key:"value",get:function(){return this._value},set:function(e){this._value=void 0===e||null==e?"":e.trim(),this.updateView()}},{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(us(this,ry)).value=zf.cleanRawString(this._value))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",ds(this,ay,e.id=zf.nextId),ds(this,ry,zf.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=us(this,ry),t.textContent=this.label;var n=e.appendChild(document.createElement("input"));if(n.className="form-control",n.id=us(this,ry),n.type=this._inputType,this.placeholder&&(n.placeholder=this.placeholder),this._autocomplete&&(n.autocomplete=this._autocomplete,"off"===this._autocomplete&&(n.name=Gf())),this.completion===zf.COMPLETION_COMPULSORY&&(n.required=!0),this.validationMessage){var r=e.appendChild(document.createElement("div"));r.className="invalid-feedback",r.innerHTML=this.validationMessage}this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);n.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"markValidity",value:function(e){var t=document.getElementById(us(this,ry));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"inputChangeHandler",value:function(e){e.stopPropagation(),console.log("got input field change event"),this.value=zf.cleanRawString(document.getElementById(us(this,ry)).value),this.fireEvent(zf.EVENT_CHANGE)}}],[{key:"summariseImpl",value:function(e,t,n){return""!==n[e]&&null!==n[e]&&void 0!==n[e]?np(n[e].trim()):""}}]),n}(zf),iy=function e(){Gi(this,e)};zi(iy,"sectionTitle",void 0),zi(iy,"sectionSortOrder",void 0),zi(iy,"sectionNavigationKey",void 0),zi(iy,"help",""),zi(iy,"properties",void 0);var sy=function(e){Ki(n,e);var t=rs(n);function n(){return Gi(this,n),t.apply(this,arguments)}return n}(iy);zi(sy,"sectionNavigationKey","garden"),zi(sy,"sectionTitle","About your garden"),zi(sy,"sectionSortOrder",1),zi(sy,"help","\x3c!-- begin: templates/formHelp/surveyGardenHelp.html --\x3e\r\n<h2>About your garden</h2>\r\n<p>The questions in this section provide background information about the area where you live.</p>\r\n<p>Please try to answer everything, but don't worry if some details are impossible to assess.</p>\r\n<p>When you have completed this section, move on to the final part of the survey, where you can list the invasive plants in your garden.</p>\r\n\x3c!-- end: templates/formHelp/surveyGardenHelp.html --\x3e\r\n"),zi(sy,"properties",{durationAtAddress:{field:oy,attributes:{label:"Roughly how long have you lived at this address?",placeholder:"approximate years",type:"number"}},numberOfPlants:{field:Pm,attributes:{label:"Could you please try to estimate how many different ornamental plants are growing in your garden?",placeholder:"please estimate",options:{"<20":{label:"fewer than 20"},"20-50":{label:"between 20 and 50"},"50-100":{label:"between 50 and 100"},">100":{label:"more than 100"},unknown:{label:"impossible to estimate"}},includeOtherFreeText:!1,completion:zf.COMPLETION_DESIRED}},introductions:{field:oy,attributes:{label:"In the last year, how many new ornamental plant species did you plant/introduce into your garden?",helpText:"please estimate",placeholder:"number of plants",autocomplete:"off",type:"number"}},acquisitions:{field:Tm,attributes:{label:"In the last year, where did you get these new plants or seeds?",helpText:"<i>(tick all that apply)</i>",options:{nursery:{label:"bought from nursery"},gardencentre:{label:"bought at garden centre"},supermarket:{label:"bought at supermarket"},mailorder:{label:"mail-order"},internetorder:{label:"internet order"},friendsneighbours:{label:"from friends or neighbours"},swap:{label:"plant / seed swap"},other:{label:"other"}},includeOtherFreeText:!0}},gifts:{field:Pm,attributes:{label:"In the last two years, did you give plants/seeds to friends/neighbours?",placeholder:"please select a response",options:{yes:{label:"yes"},no:{label:"no"}},includeOtherFreeText:!1}}});var ly=function(e){Ki(n,e);var t=rs(n);function n(){return Gi(this,n),t.apply(this,arguments)}return n}(iy);zi(ly,"sectionNavigationKey","about"),zi(ly,"sectionTitle","About you and your survey"),zi(ly,"sectionSortOrder",0),zi(ly,"help",'\x3c!-- begin: templates/formHelp/surveyAboutHelp.html --\x3e\r\n<div class="card mt-3">\r\n    <div class="card-body">\r\n        <h5 class="card-title">Localising your records</h5>\r\n        <p class="card-text">To make sense of the national coverage of the records we receive, we need to know the approximate location\r\n        of your garden. Usually a postcode works well for this, but you can provide a grid-reference if you prefer (in Ireland please use a grid-reference as we don\'t yet have a way to convert postcodes).\r\n            We also need a place name, as a way to double check that the postcode or grid-reference makes sense.\r\n        </p>\r\n        <p><strong>Please don\'t provide your full address, as we would need to remove that from our data.</strong></p>\r\n    </div>\r\n</div>\r\n<div class="card mt-3">\r\n    <div class="card-body">\r\n        <h5 class="card-title">Your name and email</h5>\r\n        <p class="card-text">Both of these are optional, but providing an email address is important if you want to return\r\n            to your survey later or to revise your records. It is also really useful for our experts to be able to contact you\r\n            if we have questions about the records that you\'ve sent.\r\n        </p>\r\n        <p>We\'d like to be able to include your name with the records in our archive, but your email address won\'t be stored long-term\r\n            after your plant records have been checked.</p>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/formHelp/surveyAboutHelp.html --\x3e\r\n'),zi(ly,"properties",{place:{field:oy,attributes:{label:"Where did you survey?",helpText:"e.g. town or village. Please don't give an address.",placeholder:"Nearest named place",autocomplete:"address-level2",completion:zf.COMPLETION_COMPULSORY}},georef:{field:oy,attributes:{label:"Postcode or grid-reference",helpText:"We need to be able to put your survey on our map. Detailed locations won't be made public.",placeholder:"Grid-reference or postcode",autocomplete:"postal-code",completion:zf.COMPLETION_COMPULSORY}},recorder:{field:oy,attributes:{label:"Your name",helpText:"(optional) This helps us follow-up if we have any queries about your records and allows us to properly acknowledge the origin of your observations.",placeholder:"full name",autocomplete:"name"}},namearchive:{field:Pm,attributes:{label:"Can we include your name in our archive of plant records?",helpText:"",placeholder:"please choose an option",options:{yes:{label:"yes"},no:{label:"no, I'd prefer my records to be anonymous"}},includeOtherFreeText:!1,completion:zf.COMPLETION_DESIRED}},email:{field:oy,attributes:{label:"Your email address",helpText:"(optional) We'll never share your email with anyone else.",autocomplete:"email",type:"email"}}});tp.registerSection(ly),tp.registerSection(sy);var cy=new WeakMap,uy=new WeakMap,dy=new WeakMap,hy=new WeakSet,fy=new WeakSet,py=new WeakSet,vy=new WeakSet,my=new WeakSet,yy=new WeakSet,gy=new WeakSet,by=new WeakSet,Ey=new WeakSet,wy=new WeakSet,_y=new WeakSet,xy=new WeakSet,Sy=function(e){Ki(n,e);var t=rs(n);function n(){var e;Gi(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return _s(ts(e=t.call.apply(t,[this].concat(a))),xy),_s(ts(e),_y),_s(ts(e),wy),_s(ts(e),Ey),_s(ts(e),by),_s(ts(e),gy),_s(ts(e),yy),_s(ts(e),my),_s(ts(e),vy),_s(ts(e),py),_s(ts(e),fy),_s(ts(e),hy),zi(ts(e),"controller",void 0),ws(ts(e),cy,{writable:!0,value:{}}),ws(ts(e),uy,{writable:!0,value:void 0}),ws(ts(e),dy,{writable:!0,value:{}}),zi(ts(e),"panelKey",""),zi(ts(e),"OCCURRENCES_ARE_LAST_SECTION",!0),e}return Yi(n,[{key:"initialise",value:function(){this.controller.app.addListener(Xm.EVENT_OCCURRENCE_ADDED,this,"occurrenceAddedHandler")}},{key:"setLayout",value:function(){var e=this;document.getElementById("body").innerHTML='\r\n<div class="container-fluid">\r\n    <div class="row" style="height: 90vh;">\r\n        <div class="col d-md-block pr-md-0 pt-3" id="col1panel" style="overflow-y: auto; max-height: calc(100vh - 5rem);">\r\n        </div>\r\n        <div class="col d-md-none pl-0 pr-0" id="ctrlpanel" style="background-color: aliceblue; width: 28px; max-width: 28px; overflow-y: hidden; ">\r\n            <button class="navbar-light navbar-toggler pl-0 pr-0" type="button" aria-label="Back" id="right-panel-back">\r\n                <i class="material-icons-round" style="color: gray;">view_list</i>\r\n            </button>\r\n        </div>\r\n        <div class="col d-md-block pr-md-0" id="col2panel" style="overflow-y: auto; height: 100%;">\r\n        </div>\r\n    </div>\r\n</div>\r\n',document.getElementById("right-panel-back").addEventListener("click",(function(t){t.stopPropagation(),t.preventDefault(),e.fireEvent(ty.EVENT_BACK)}))}},{key:"refreshLeftPanelAccordionState",value:function(){var e,t=document.querySelectorAll("div#".concat(this.leftPanelAccordionId,' div[data-parent="#').concat(this.leftPanelAccordionId,'"].collapse'));e=this.controller.viewSubcontext?"record"===this.controller.viewSubcontext?"record":this.controller.surveySection:"";var n,r=cs(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.getAttribute("data-sectionkey")===e?a.classList.add("show"):a.classList.remove("show")}}catch(e){r.e(e)}finally{r.f()}this._refreshOccurrenceAccordionState()}},{key:"_refreshOccurrenceAccordionState",value:function(){var e,t=document.querySelectorAll("div#".concat("occurrencelistcontainer",' div[data-parent="#').concat("occurrencelistcontainer",'"].collapse')),n=this.controller.currentOccurrenceId,r=cs(t);try{for(r.s();!(e=r.n()).done;){var a=e.value;a.getAttribute("data-occurrenceid")===n?a.classList.add("show"):a.classList.remove("show")}}catch(e){r.e(e)}finally{r.f()}}},{key:"display",value:function(){if(this.controller.needsFullRefresh?(console.log("Full refresh triggered."),this.setLayout(),bs(this,my,Ry).call(this)):this.refreshLeftPanelAccordionState(),this.controller.needRightPanelRefresh)switch(this.controller.viewSubcontext){case"record":bs(this,fy,Iy).call(this);break;case"survey":bs(this,hy,ky).call(this);break;default:bs(this,py,Ty).call(this)}this.setResponsivePanel(""===this.panelKey?"left":"right")}},{key:"refreshOccurrenceFooterControls",value:function(e){var t=this,n=e.appendChild(document.createElement("div")),r=n.appendChild(document.createElement("button"));if(r.className="btn btn-secondary btn-md-lg mt-2 mb-3 mr-2",r.type="button",r.textContent="back to list",r.setAttribute("data-buttonaction","back"),this.occurrenceIsMostRecent(this.controller.currentOccurrence)){var o=n.appendChild(document.createElement("button"));o.className="btn btn-primary btn-md-lg mt-2 mb-3 mr-2",o.type="button",o.textContent="add another",o.setAttribute("data-buttonaction","new")}if(this.OCCURRENCES_ARE_LAST_SECTION){var i=n.appendChild(document.createElement("button"));i.className="btn btn-primary btn-md-lg mt-2 mb-3",i.type="button",i.textContent="finish",i.setAttribute("data-buttonaction","finish")}else{var s=tp.sections[1],l=n.appendChild(document.createElement("button"));l.className="btn btn-primary btn-md-lg mt-2 mb-3",l.type="button",l.textContent="next »",l.setAttribute("data-buttonaction","next"),l.title=s.sectionTitle}n.addEventListener("click",(function(e){var n=e.target.closest("button");if(n&&n.hasAttribute("data-buttonaction"))switch(n.getAttribute("data-buttonaction")){case"new":t.fireEvent(ty.EVENT_NEW_RECORD);break;case"back":t.controller.app.router.navigate("/list/record/");break;case"finish":t.controller.app.router.navigate("/list/record/"),a.default("#".concat("finishmodal")).modal();break;case"next":t.controller.app.router.navigate("/list/survey/".concat(nextSection.sectionNavigationKey));break;default:throw new Error("Unrecognised button action ".concat(n.getAttribute("data-buttonaction")))}}))}},{key:"occurrenceIsMostRecent",value:function(e){var t,n=cs(this.controller.occurrences.entries());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r[1].createdStamp>e.createdStamp&&!r[1].deleted)return!1}}catch(e){n.e(e)}finally{n.f()}return!0}},{key:"newButtonClickHandler",value:function(e){e.preventDefault(),e.stopPropagation(),this.fireEvent(ty.EVENT_NEW_RECORD)}},{key:"occurrenceAddedHandler",value:function(e,t,n){var r=document.getElementById("occurrencelistcontainer");if(r){var a=this.controller.occurrences.get(n.occurrenceId),o=document.createElement("div");o.className="card",o.id="card_".concat(a.id),o.innerHTML=bs(this,xy,My).call(this,a),us(this,dy)[a.id]=a.addListener(zm.EVENT_MODIFIED,this,this.occurrenceChangeHandler,{occurrenceId:a.id}),r.insertBefore(o,r.firstChild)}}},{key:"refreshOccurrenceValiditySummary",value:function(e){var t=document.getElementById("card_".concat(e.id));t&&(e.evaluateCompletionStatus(Ym.properties).requiredFieldsPresent?t.classList.remove("is-invalid"):t.classList.add("is-invalid"))}},{key:"occurrenceChangeHandler",value:function(e,t,n){var r=this.controller.occurrences.get(n.occurrenceId),a=document.getElementById("card_".concat(n.occurrenceId));a&&(r.deleted?(a.parentElement.removeChild(a),us(this,dy)[n.occurrenceId]&&(r.removeListener(zm.EVENT_MODIFIED,us(this,dy)[n.occurrenceId]),us(this,dy)[n.occurrenceId]=null)):(a.innerHTML=bs(this,xy,My).call(this,r),this.refreshOccurrenceValiditySummary(r)))}},{key:"occurrenceSummaryBodyHTML",value:function(e){var t="";for(var n in e.attributes)if(e.attributes.hasOwnProperty(n)&&Ym.properties.hasOwnProperty(n)&&!Ym.properties[n].field.isEmpty(e.attributes[n])){var r=Ym.properties[n].field.summarise(n,Ym.properties[n],e.attributes);r&&(t+='<p class="ellipsed-line mb-0">'.concat(r,"</p>"))}return Xm.devMode&&(t+='<p class="mb-0">(<i>id '.concat(e.id,"</i>)</p>")),t}},{key:"occurrenceSummaryHeadingHTML",value:function(e){var t="";if(e.attributes.hasOwnProperty("images")&&e.attributes.images.length){var n=e.attributes.images[0];t+=Dm.imageLink(n,48,48,{className:"mr-1"})}return e.attributes.taxon&&e.attributes.taxon.taxonId?t+=e.taxon.formattedHTML(e.attributes.taxon.vernacularMatch):e.attributes.taxon&&e.attributes.taxon.taxonName?t+=np(e.attributes.taxon.taxonName):t+="<span>(unnamed plant)</span>",t}},{key:"setResponsivePanel",value:function(e){var t=document.getElementById("col2panel"),n=document.getElementById("col1panel"),r=document.getElementById("ctrlpanel");switch(e){case"left":n.classList.remove("d-none"),n.classList.add("d-block"),t.classList.remove("d-block"),t.classList.add("d-none"),r.classList.remove("d-md-none"),r.classList.add("d-none");break;case"right":n.classList.remove("d-block"),n.classList.add("d-none"),t.classList.remove("d-none"),t.classList.add("d-block"),r.classList.remove("d-none"),r.classList.add("d-md-none");break;default:throw new Error("Unrecognised panel value '".concat(e))}}}]),n}(Yh);function ky(){var e=document.getElementById("col2panel"),t=this.controller.surveySection,n=tp.sectionsByKey[t]?tp.sectionsByKey[t].help:"";e.innerHTML=n||("welcome"===t?ny:"<p>placeholder survey help content for '".concat(t,"'</p>"))}function Iy(){try{var e=this.controller.currentOccurrence,t=document.getElementById("col2panel");if(e){us(this,uy)&&us(this,uy).occurrenceId===e.id||(us(this,uy)&&us(this,uy).destructor(),ds(this,uy,e.getForm()),us(this,uy).surveyId=this.controller.app.currentSurvey.id,t.scrollTop=0),t.innerHTML="";var n=us(this,uy).formElement;t.appendChild(n),us(this,uy).populateFormContent(),this.refreshOccurrenceFooterControls(t),a.default("#description_".concat(e.id)).collapse("show")}else bs(this,py,Ty).call(this,Ym.help)}catch(e){console.log({error:e});var r=document.getElementById("col2panel");r?r.innerHTML="<p>".concat(e.message,"</p>"):document.body.innerHTML="<h2>Internal error</h2><p>Please report this problem:</p><p>".concat(e.message,"</p>")}}function Ty(e){document.getElementById("col2panel").innerHTML=e||ny}function Cy(){for(var e in us(this,dy)){var t=this.controller.occurrences.get[e];t&&t.removeListener(zm.EVENT_MODIFIED,us(this,dy)[e])}ds(this,dy,{})}function Ry(){var e=this,t=document.getElementById("col1panel").appendChild(document.createElement("div"));t.className="accordion",this.leftPanelAccordionId=t.id=Qf.nextId,bs(this,by,Ay).call(this),bs(this,Ey,Ly).call(this,0,t,Sy.NEXT_RECORDS),bs(this,wy,Py).call(this),bs(this,_y,Hy).call(this),t.addEventListener("click",(function(t){var n=t.target.closest("a");n&&n.hasAttribute("data-help-link")&&(t.preventDefault(),t.stopPropagation(),e.controller.app.router.navigate(n.getAttribute("data-help-link")))})),bs(this,gy,Ny).call(this),bs(this,yy,Oy).call(this)}function Oy(){var e=this,t=document.body,n='<div class="modal fade" id="'.concat("deleteoccurrencemodal",'" tabindex="-1" role="dialog" aria-labelledby="').concat("deleteoccurrencemodal",'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title" id="').concat("deleteoccurrencemodal",'Title">Delete record?</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        Please confirm that you wish to delete the record.\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Back</button>\n        <button type="button" class="btn btn-danger" data-dismiss="modal" id="').concat("deleteoccurrencemodal",'confirmed">Delete record</button>\n      </div>\n    </div>\n  </div>\n</div>'),r=document.createElement("div");r.innerHTML=n,t.appendChild(r.firstChild),a.default("#".concat("deleteoccurrencemodal")).on("show.bs.modal",(function(e){var t=a.default(e.relatedTarget);if(t&&t.data("occurrenceid")){var n=t.data("occurrenceid");document.getElementById("".concat("deleteoccurrencemodal","confirmed")).setAttribute("data-occurrenceid",n)}})),document.getElementById("".concat("deleteoccurrencemodal","confirmed")).addEventListener("click",(function(t){var n=t.target.closest("button");if(n&&n.hasAttribute("data-occurrenceid")){var r=n.getAttribute("data-occurrenceid");console.log("Deleting occurrence ".concat(r,".")),e.fireEvent(ty.EVENT_DELETE_OCCURRENCE,r)}}));var o=document.createElement("div");o.innerHTML='<div class="modal fade" id="'.concat("finishmodal",'" tabindex="-1" role="dialog" aria-labelledby="').concat("finishmodal",'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title" id="').concat("finishmodal",'Title">Thank you</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <p>Thank you! Your form responses have been sent. If you wish, you can continue to make changes and edit or add further records.</p>\n        <p>If you provided an email address, then we will send you a message with a link to this form, so that you can return to it later if needed.</p>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n      </div>\n    </div>\n  </div>\n</div>'),t.appendChild(o.firstChild),t.appendChild(Wm.licenseModal());var i=document.createElement("div");i.innerHTML='<div class="modal fade" id="'.concat("imagemodal",'" tabindex="-1" role="dialog" aria-labelledby="').concat("imagemodal",'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header d-none d-md-flex">\n        <h5 class="modal-title" id="').concat("imagemodal",'Title">Photo</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body" style="position: relative;">\n        <picture>\n        </picture>\n      </div>\n      <div class="modal-footer">\n        <button type="button" id="').concat("imagemodaldelete",'" class="btn btn-outline-danger delete-occurrence-button mr-3" data-toggle="modal" data-target="#').concat("deleteimagemodal",'" data-imageid=""><i class="material-icons">delete</i></button>\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n      </div>\n    </div>\n  </div>\n</div>'),t.appendChild(i.firstChild),document.getElementById("imagemodaldelete").addEventListener("click",(function(t){var n=t.target.closest("button");if(n&&n.hasAttribute("data-imageid")){var r=n.getAttribute("data-imageid");us(e,uy).fireEvent("deleteimage",r),a.default("#".concat("imagemodal")).modal("hide")}}))}function Ny(){var e=this;a.default("#".concat("col1panel")).on("show.bs.collapse",(function(t){t.target.dataset.occurrenceid?(console.log({"left panel accordion show event (with occ id)":t}),e.fireEvent(ty.EVENT_SELECT_OCCURRENCE,{occurrenceId:t.target.dataset.occurrenceid})):t.target.dataset.sectionkey?(console.log({"left panel accordion show event (with section key)":t}),e.fireEvent(ty.EVENT_SELECT_SURVEY_SECTION,{sectionKey:t.target.dataset.sectionkey})):console.log({"left panel accordion show event (other)":t})})).on("hidden.bs.collapse",(function(t){if(console.log({"left panel accordion hide event":t}),t.target.dataset.occurrenceid){var n=e.controller.occurrences.get(t.target.dataset.occurrenceid);n.isNew&&!n.isPristine&&(n.isNew=!1,e.refreshOccurrenceValiditySummary(n)),e.controller.currentOccurrenceId===t.target.dataset.occurrenceid&&e.fireEvent(ty.EVENT_SELECT_OCCURRENCE,{occurrenceId:""})}else if(t.target.dataset.sectionkey)if("record"===t.target.dataset.sectionkey)"record"===e.controller.viewSubcontext&&e.fireEvent(ty.EVENT_SELECT_SURVEY_SECTION,{sectionKey:""});else if(us(e,cy)[t.target.dataset.sectionkey]){var r=us(e,cy)[t.target.dataset.sectionkey].validateForm();console.log({"survey section validity":r}),e.controller.surveySection===t.target.dataset.sectionkey&&e.fireEvent(ty.EVENT_SELECT_SURVEY_SECTION,{sectionKey:""})}}))}function Ay(){var e=document.getElementById(this.leftPanelAccordionId),t=document.createElement("button");t.className="btn btn-primary",t.type="button",t.textContent="get started »",t.setAttribute("data-toggle","collapse"),t.setAttribute("data-target","#survey-0-about");var n=Qf.nextId,r=document.createElement("div");r.innerHTML='\x3c!-- begin: templates/welcome.html --\x3e\r\n<p>Using your experience as gardener, please help us identify\r\npotentially invasive plant species in gardens before they become a problem for\r\nbiodiversity and conservation in wild situations in Britain or Ireland.</p>\r\n<p>The survey is divided into three sections and usually takes between 15 and 20 minutes to complete. You can pause and come back\r\n    later at any point.</p>\r\n<p>The information that you provide will be used by the <a href="https://www.coventry.ac.uk/research/areas-of-research/agroecology-water-resilience/" target="_blank" title="CAWR">Centre for Agroecology, Water and Resilience</a> at Coventry University and by\r\n    <a href="https://bsbi.org/" target="_blank" title="Botanical Society of Britain and Ireland">BSBI</a> for a\r\n    study of invasive plants. We\'ll include your plant records in a permanent archive held by BSBI, to help us track\r\n    long term changes in plant distribution.</p>\r\n<p>To follow up any queries about the survey we request that you please provide your name and email address. You can choose whether or not\r\n    to include your name in our archive of plant records. Your email address (if provided) will be\r\nconfidential and won\'t be archived.</p>\r\n<p>A summary of records will appear on the project website, but the full survey details including the exact location of your garden will only be accessible to the research team.</p>\r\n\x3c!-- end: templates/welcome.html --\x3e\r\n',r.appendChild(t);var a=document.createElement("span");a.className="d-md-none pl-2",a.innerHTML='(<a href="/app/list/survey/welcome/help" data-navigo="list/survey/welcome/help">more info</a>)',r.appendChild(a),e.appendChild(this.card({cardId:n,cardHeadingId:Qf.nextId,collapsed:"welcome"!==this.controller.surveySection,headingButtonId:Qf.nextId,headingHTML:"Welcome",headingNonbuttonHTML:"",headingValidationWarningHTML:"",cardDescriptionId:"survey-welcome",parentContainerId:e.id,bodyContentElement:r,dataAttributes:{sectionkey:"welcome"}}))}function Ly(e,t,n){var r=this,o=tp.sections[e],i=new tp(o);us(this,cy)[o.sectionNavigationKey]=i;var s=i.formElement,l=document.createElement("button");switch(l.className="btn btn-primary",l.type="button",l.textContent="next »",n){case Sy.NEXT_RECORDS:l.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),r.fireEvent(ty.EVENT_NEXT_TO_RECORDS)}));break;case Sy.NEXT_SURVEY_SECTION:var c=tp.sections[e+1];l.setAttribute("data-toggle","collapse"),l.setAttribute("data-target","#survey-".concat(e+1,"-").concat(c.sectionNavigationKey)),l.title=c.sectionTitle;break;case Sy.NEXT_IS_FINAL:l.textContent="finish",l.className="btn btn-primary btn-md-lg mt-2 mb-3",l.type="button",l.addEventListener("click",(function(){r.controller.app.router.navigate("/list/"),a.default("#".concat("finishmodal")).modal()}));break;default:throw new Error("Unrecognized next section keyword '".concat(n,"'"))}s.appendChild(l);var u=Qf.nextId;t.appendChild(this.card({cardId:u,cardHeadingId:Qf.nextId,collapsed:this.controller.surveySection!==o.sectionNavigationKey,headingButtonId:Qf.nextId,headingHTML:o.sectionTitle,headingNonbuttonHTML:'<small class="btn d-md-none" style="margin: 0; padding: 0;">(<a href="/app/list/survey/'.concat(o.sectionNavigationKey,'/help" data-help-link="/list/survey/').concat(o.sectionNavigationKey,'/help">help</a>)</small>'),headingValidationWarningHTML:"Please check the form for some missing responses.",cardDescriptionId:"survey-".concat(e,"-").concat(o.sectionNavigationKey),parentContainerId:t.id,bodyContentElement:s,dataAttributes:{sectionkey:o.sectionNavigationKey}})),this.controller.survey.registerForm(i),i.addListener(tp.EVENT_VALIDATION_STATE_CHANGE,this,(function(e,t,n){var r=document.getElementById(u);n?r.classList.remove("is-invalid"):r.classList.add("is-invalid")}))}function Py(){var e=document.getElementById(this.leftPanelAccordionId),t=document.createDocumentFragment();t.appendChild(document.createElement("p")).innerHTML='Records of invasive plants in your garden.<small class="d-block d-md-none"><a href="/app/list/record/help">(help)</a></small>';var n=t.appendChild(document.createElement("button"));n.type="button",n.className="btn btn-primary btn-lg mb-2",n.innerText="Add a plant record.",n.addEventListener("click",this.newButtonClickHandler.bind(this)),t.appendChild(document.createElement("div")).id="occurrencelistcontainer",e.appendChild(this.card({cardId:Qf.nextId,cardHeadingId:Qf.nextId,collapsed:"record"!==this.controller.viewSubcontext,headingButtonId:Qf.nextId,headingHTML:"Your plant records",cardDescriptionId:Qf.nextId,parentContainerId:e.id,bodyContentElement:t,dataAttributes:{sectionkey:"record"}}))}function Hy(){var e=document.getElementById("occurrencelistcontainer");if(!e)throw new Km("Failed to find list container.");bs(this,vy,Cy).call(this);var t,n=[],r=cs(is(this.controller.occurrences.entries()).sort((function(e,t){return t[1].createdStamp-e[1].createdStamp})));try{for(r.s();!(t=r.n()).done;){var o=t.value[1];if(!o.deleted){var i=o.isNew||o.evaluateCompletionStatus(Ym.properties).requiredFieldsPresent;n.push('<div class="card'.concat(i?"":" is-invalid",'" id="card_').concat(o.id,'">\n    ').concat(bs(this,xy,My).call(this,o),"\n</div>")),us(this,dy)[o.id]=o.addListener(zm.EVENT_MODIFIED,this,this.occurrenceChangeHandler,{occurrenceId:o.id})}}}catch(e){r.e(e)}finally{r.f()}e.className="accordion",e.innerHTML=n.join(""),e.addEventListener("click",(function(e){var t=e.target.closest("button");t&&t.hasAttribute("data-toggle")&&"modal"===t.getAttribute("data-toggle")&&(document.getElementById("".concat("deleteoccurrencemodal","confirmed")).setAttribute("data-occurrenceid",t.getAttribute("data-occurrenceid")),a.default(t.getAttribute("data-target")).modal(),e.preventDefault(),e.stopPropagation())}))}function My(e){return'<div class="card-header pointer pl-2 pr-2 pt-2 pb-2" id="heading_'.concat(e.id,'" data-toggle="collapse" data-target="#description_').concat(e.id,'">\n    <div class="float-right">\n        <button type="button" class="btn btn-outline-danger delete-occurrence-button" data-toggle="modal" data-target="#').concat("deleteoccurrencemodal",'" data-occurrenceid="').concat(e.id,'"><i class="material-icons">delete</i></button>\n    </div>\n    <h2 class="mb-0 pb-0 mt-0 pt-0 pl-0 ml-0">\n        <button class="btn btn-link').concat(this.controller.currentOccurrenceId===e.id?"":" collapsed",' pt-0 pb-0 pl-0" id="headingbutton_').concat(e.id,'" type="button" data-toggle="collapse" data-target="#description_').concat(e.id,'" aria-expanded="').concat(this.controller.currentOccurrenceId===e.id?"true":"false",'" aria-controls="description_').concat(e.id,'">\n          ').concat(this.occurrenceSummaryHeadingHTML(e),'\n        </button>\n    </h2>\n    <div class="card-invalid-feedback">\n        <small>Please check for errors or missing details.</small>\n    </div>\n</div>\n<div id="description_').concat(e.id,'" class="collapse').concat(this.controller.currentOccurrenceId===e.id?" show":"",'" aria-labelledby="heading_').concat(e.id,'" data-parent="#').concat("occurrencelistcontainer",'" data-occurrenceid="').concat(e.id,'">\n  <div class="card-body">\n    ').concat(this.occurrenceSummaryBodyHTML(e),"\n  </div>\n</div>")}zi(Sy,"NEXT_RECORDS","records"),zi(Sy,"NEXT_SURVEY_SECTION","survey"),zi(Sy,"NEXT_IS_FINAL","last");var Dy=function(e){Ki(n,e);var t=rs(n);function n(e,r){var a;return Gi(this,n),zi(ts(a=t.call(this)),"route",void 0),a.view=e,a.route=r,a.handle=Qm.nextHandle,a}return Yi(n,[{key:"routeHandler",value:function(e,t){console.log("reached route handler for StaticContentController.js"),this.app.currentControllerHandle=this.handle,this.view.display()}}]),n}(Qm),jy=function(e){Ki(n,e);var t=rs(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Yi(n,[{key:"body",value:function(){document.getElementById("body").innerHTML='\x3c!-- begin: templates/helpPage.html --\x3e\r\n<div class="accordion" id="helpaccordion">\r\n    <div class="card">\r\n        <div class="card-header" id="helphelpheadingOne">\r\n            <h5 class="mb-0">\r\n                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">\r\n                    About the invasive plants survey\r\n                </button>\r\n            </h5>\r\n        </div>\r\n\r\n        <div id="collapseOne" class="collapse show" aria-labelledby="helpheadingOne" data-parent="#helpaccordion">\r\n            <div class="card-body">\r\n                <div style="float: right; padding-left: 12px; margin: 0;" class="d-none d-md-block"><a href="/Plant_Alert_Flyer.pdf" target="_blank" title="Plant Alert introductory leaflet (pdf)"><img src="/img/leaflet_thumb-or8.png" alt="" width="196"><p>download Plant Alert leaflet (pdf)</p></a></div>\r\n                <p>Invasive non-native plants are causing major problems\r\n                for native biodiversity, ecosystems, infrastructure, the\r\n                built environment and human health. Most of our\r\n                invasive plants were introduced as ornamental garden\r\n                    plants but then escaped into the wider environment.</p>\r\n                <p>While maintaining the benefits and contributions of nonnative plants to our gardens we need to know\r\n                    early which plants might endanger natural habitats in the future. Gardeners can play a crucial role\r\n                    as they may be the first to notice any ornamental plants that show signs of invasiveness.</p>\r\n                <p class="d-block d-md-none"><a href="/Plant_Alert_Flyer.pdf" target="_blank" title="Plant Alert introductory leaflet (pdf)">Download the Plant Alert Leaflet</a></p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="card">\r\n        <div class="card-header" id="helpheadingTwo">\r\n            <h5 class="mb-0">\r\n                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">\r\n                    What happens to my records?\r\n                </button>\r\n            </h5>\r\n        </div>\r\n        <div id="collapseTwo" class="collapse" aria-labelledby="helpheadingTwo" data-parent="#helpaccordion">\r\n            <div class="card-body">\r\n                <p>A list of reported plants can be accessed on the website. At least once a year we will publish a summary of all records received on the webpage and in the <a href="https://bsbi.org/">BSBI\'s newsletter</a>.\r\n                Data collected will be used in risk assessments of species as well as to provide gardeners and nurseries with advice on which plants could also\r\n                    become difficult to manage in gardens.</p>\r\n                <p>The data will also be included in BSBI\'s permanent archive of plant occurrence records.</p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="card">\r\n        <div class="card-header" id="helpheadingwhatreport">\r\n            <h5 class="mb-0">\r\n                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseWhatReport" aria-expanded="false" aria-controls="collapseThree">\r\n                    Which plants should be reported?\r\n                </button>\r\n            </h5>\r\n        </div>\r\n        <div id="collapseWhatReport" class="collapse" aria-labelledby="helpheadingwhatreport" data-parent="#helpaccordion">\r\n            <div class="card-body">\r\n                <p>Many ornamental plants in your garden will spread\r\n                    and this is a sign that they are growing well. We only\r\n                    want to know about those that are spreading to an\r\n                    extent that you have to control them to prevent them\r\n                    overgrowing other plants or parts of your garden\r\n                    where you do not want them.</p>\r\n                    <p>If you do not know a plant you want to report or are\r\n                    not sure, you can submit photographs we will use to\r\n                    help with identification</p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="card">\r\n        <div class="card-header" id="helpheadingThree">\r\n            <h5 class="mb-0">\r\n                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">\r\n                    Help and support\r\n                </button>\r\n            </h5>\r\n        </div>\r\n        <div id="collapseThree" class="collapse" aria-labelledby="helpheadingThree" data-parent="#helpaccordion">\r\n            <div class="card-body">\r\n                <p>If you encounter problems, would like to provide feedback about the survey or for more information about Nyph, please contact\r\n                <a href="mailto:support@nyph.bsbi.org">support@nyph.bsbi.org</a>.</p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="card">\r\n        <div class="card-header" id="helpheadingFour">\r\n            <h5 class="mb-0">\r\n                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseThree">\r\n                    Links to further information\r\n                </button>\r\n            </h5>\r\n        </div>\r\n        <div id="collapseFour" class="collapse" aria-labelledby="helpheadingFour" data-parent="#helpaccordion">\r\n            <div class="card-body">\r\n                <p>Introductory article published in BSBI news.<br>\r\n                    Judith Conroy &amp; Katharina Dehnen-Schmutz. 2018. <a href="/GardenOrnamentals_BSBI_News_2018.pdf" target="_blank">Can gardeners help identify ornamental plants at risk\r\n                    of becoming invasive?</a> BSBI News. <strong>139</strong>: 51.</p>\r\n                <p>The findings of a pilot study for Nyph have been published:<br>\r\n                    Dehnen-Schmutz, K. &amp; Conroy, J. Biol Invasions (2018) <strong>20</strong>: 3069. <a href="https://doi.org/10.1007/s10530-018-1759-3" target="_blank">https://doi.org/10.1007/s10530-018-1759-3</a></p>\r\n                <p>Background information about invasive species can be found on the <a href="http://www.nonnativespecies.org/" target="_blank">GB Non-native Species Secretariat</a> website.</p>\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="card">\r\n        <div class="card-header" id="helpheadingFive">\r\n            <h5 class="mb-0">\r\n                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseFive" aria-expanded="false" aria-controls="collapseThree">\r\n                    About us\r\n                </button>\r\n            </h5>\r\n        </div>\r\n        <div id="collapseFive" class="collapse" aria-labelledby="helpheadingFive" data-parent="#helpaccordion">\r\n            <div class="card-body">\r\n                Nyph is a collaboration between and the <a href="https://www.coventry.ac.uk/research/areas-of-research/agroecology-water-resilience/" title="CAWR" target="_blank">Centre for Agroecology, Water and Resilience</a> at Coventry University and the <a href="https://bsbi.org/" target="_blank" title="BSBI">Botanical Society of Britain and Ireland</a>.\r\n                <p>For more information, please contact <a href="mailto:support@nyph.bsbi.org">support@nyph.bsbi.org</a>.</p>\r\n                <p>Follow us on twitter <a href="https://twitter.com/Plant_Alert" target="_blank">@Plant_Alert</a></p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/helpPage.html --\x3e\r\n<p>Version 1.0.1.1634126336</p>'}}]),n}(Yh),Fy=uh.forEach,By=l,Vy=Ac,qy=Hc,Wy=dp("forEach")?[].forEach:function(e){return Fy(this,e,arguments.length>1?arguments[1]:void 0)},Uy=We,Gy=function(e){if(e&&e.forEach!==Wy)try{Uy(e,"forEach",Wy)}catch(t){e.forEach=Wy}};for(var $y in Vy)Vy[$y]&&Gy(By[$y]&&By[$y].prototype);Gy(qy);var Yy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function zy(){return!("undefined"==typeof window||!window.history||!window.history.pushState)}function Ky(e,t,n){this.root=null,this._routes=[],this._useHash=t,this._hash=void 0===n?"#":n,this._paused=!1,this._destroyed=!1,this._lastRouteResolved=null,this._notFoundHandler=null,this._defaultHandler=null,this._usePushState=!t&&zy(),this._onLocationChange=this._onLocationChange.bind(this),this._genericHooks=null,this._historyAPIUpdateMethod="pushState",e?this.root=t?e.replace(/\/$/,"/"+this._hash):e.replace(/\/$/,""):t&&(this.root=this._cLoc().split(this._hash)[0].replace(/\/$/,"/"+this._hash)),this._listen(),this.updatePageLinks()}function Xy(e){return e instanceof RegExp?e:e.replace(/\/+$/,"").replace(/^\/+/,"^/")}function Qy(e,t){return 0===t.length?null:e?e.slice(1,e.length).reduce((function(e,n,r){return null===e&&(e={}),e[t[r]]=decodeURIComponent(n),e}),null):null}function Jy(e){var t=[];return{regexp:e instanceof RegExp?e:new RegExp(e.replace(Ky.PARAMETER_REGEXP,(function(e,n,r){return t.push(r),Ky.REPLACE_VARIABLE_REGEXP})).replace(Ky.WILDCARD_REGEXP,Ky.REPLACE_WILDCARD)+Ky.FOLLOWED_BY_SLASH_REGEXP,Ky.MATCH_REGEXP_FLAGS),paramNames:t}}function Zy(e){return e.replace(/\/$/,"").split("/").length}function eg(e,t){return Zy(t)-Zy(e)}function tg(e,t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.map((function(t){var n=Jy(Xy(t.route)),r=n.regexp,a=n.paramNames,o=e.replace(/^\/+/,"/").match(r),i=Qy(o,a);return!!o&&{match:o,route:t,params:i}})).filter((function(e){return e}))}(e,t)[0]||!1}function ng(e,t){var n=t.map((function(t){return""===t.route||"*"===t.route?e:e.split(new RegExp(t.route+"($|/)"))[0]})),r=Xy(e);return n.length>1?n.reduce((function(e,t){return e.length>t.length&&(e=t),e}),n[0]):1===n.length?n[0]:r}function rg(e,t,n){var r,a=function(e){return e.split(/\?(.*)?$/)[0]};return void 0===n&&(n="#"),zy()&&!t?a(e).split(n)[0]:(r=e.split(n)).length>1?a(r[1]):a(r[0])}function ag(e,t,n){if(t&&"object"===(void 0===t?"undefined":Yy(t))){if(t.before)return void t.before((function(){var r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];r&&(e(),t.after&&t.after(n))}),n);if(t.after)return e(),void(t.after&&t.after(n))}e()}Ky.prototype={helpers:{match:tg,root:ng,clean:Xy,getOnlyURL:rg},navigate:function(e,t){var n;return e=e||"",this._usePushState?(n=(n=(t?"":this._getRoot()+"/")+e.replace(/^\/+/,"/")).replace(/([^:])(\/{2,})/g,"$1/"),history[this._historyAPIUpdateMethod]({},"",n),this.resolve()):"undefined"!=typeof window&&(e=e.replace(new RegExp("^"+this._hash),""),window.location.href=window.location.href.replace(/#$/,"").replace(new RegExp(this._hash+".*$"),"")+this._hash+e),this},on:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];if("function"==typeof n[0])this._defaultHandler={handler:n[0],hooks:n[1]};else if(n.length>=2)if("/"===n[0]){var a=n[1];"object"===Yy(n[1])&&(a=n[1].uses),this._defaultHandler={handler:a,hooks:n[2]}}else this._add(n[0],n[1],n[2]);else if("object"===Yy(n[0])){var o=Object.keys(n[0]).sort(eg);o.forEach((function(t){e.on(t,n[0][t])}))}return this},off:function(e){return null!==this._defaultHandler&&e===this._defaultHandler.handler?this._defaultHandler=null:null!==this._notFoundHandler&&e===this._notFoundHandler.handler&&(this._notFoundHandler=null),this._routes=this._routes.reduce((function(t,n){return n.handler!==e&&t.push(n),t}),[]),this},notFound:function(e,t){return this._notFoundHandler={handler:e,hooks:t},this},resolve:function(e){var t,n,r=this,a=(e||this._cLoc()).replace(this._getRoot(),"");this._useHash&&(a=a.replace(new RegExp("^/"+this._hash),"/"));var o=function(e){return e.split(/\?(.*)?$/).slice(1).join("")}(e||this._cLoc()),i=rg(a,this._useHash,this._hash);return!this._paused&&(this._lastRouteResolved&&i===this._lastRouteResolved.url&&o===this._lastRouteResolved.query?(this._lastRouteResolved.hooks&&this._lastRouteResolved.hooks.already&&this._lastRouteResolved.hooks.already(this._lastRouteResolved.params),!1):(n=tg(i,this._routes))?(this._callLeave(),this._lastRouteResolved={url:i,query:o,hooks:n.route.hooks,params:n.params,name:n.route.name},t=n.route.handler,ag((function(){ag((function(){n.route.route instanceof RegExp?t.apply(void 0,n.match.slice(1,n.match.length)):t(n.params,o)}),n.route.hooks,n.params,r._genericHooks)}),this._genericHooks,n.params),n):this._defaultHandler&&(""===i||"/"===i||i===this._hash||function(e,t,n){if(zy()&&!t)return!1;if(!e.match(n))return!1;var r=e.split(n);return r.length<2||""===r[1]}(i,this._useHash,this._hash))?(ag((function(){ag((function(){r._callLeave(),r._lastRouteResolved={url:i,query:o,hooks:r._defaultHandler.hooks},r._defaultHandler.handler(o)}),r._defaultHandler.hooks)}),this._genericHooks),!0):(this._notFoundHandler&&ag((function(){ag((function(){r._callLeave(),r._lastRouteResolved={url:i,query:o,hooks:r._notFoundHandler.hooks},r._notFoundHandler.handler(o)}),r._notFoundHandler.hooks)}),this._genericHooks),!1))},destroy:function(){this._routes=[],this._destroyed=!0,this._lastRouteResolved=null,this._genericHooks=null,clearTimeout(this._listeningInterval),"undefined"!=typeof window&&(window.removeEventListener("popstate",this._onLocationChange),window.removeEventListener("hashchange",this._onLocationChange))},updatePageLinks:function(){var e=this;"undefined"!=typeof document&&this._findLinks().forEach((function(t){t.hasListenerAttached||(t.addEventListener("click",(function(n){if((n.ctrlKey||n.metaKey)&&"a"==n.target.tagName.toLowerCase())return!1;var r=e.getLinkPath(t);e._destroyed||(n.preventDefault(),e.navigate(r.replace(/\/+$/,"").replace(/^\/+/,"/")))})),t.hasListenerAttached=!0)}))},generate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._routes.reduce((function(n,r){var a;if(r.name===e)for(a in n=r.route,t)n=n.toString().replace(":"+a,t[a]);return n}),"");return this._useHash?this._hash+n:n},link:function(e){return this._getRoot()+e},pause:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._paused=e,this._historyAPIUpdateMethod=e?"replaceState":"pushState"},resume:function(){this.pause(!1)},historyAPIUpdateMethod:function(e){return void 0===e?this._historyAPIUpdateMethod:(this._historyAPIUpdateMethod=e,e)},disableIfAPINotAvailable:function(){zy()||this.destroy()},lastRouteResolved:function(){return this._lastRouteResolved},getLinkPath:function(e){return e.getAttribute("href")},hooks:function(e){this._genericHooks=e},_add:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"string"==typeof e&&(e=encodeURI(e)),this._routes.push("object"===(void 0===t?"undefined":Yy(t))?{route:e,handler:t.uses,name:t.as,hooks:n||t.hooks}:{route:e,handler:t,hooks:n}),this._add},_getRoot:function(){return null!==this.root||(this.root=ng(this._cLoc().split("?")[0],this._routes)),this.root},_listen:function(){var e=this;if(this._usePushState)window.addEventListener("popstate",this._onLocationChange);else if("undefined"!=typeof window&&"onhashchange"in window)window.addEventListener("hashchange",this._onLocationChange);else{var t=this._cLoc(),n=void 0,r=void 0;(r=function(){n=e._cLoc(),t!==n&&(t=n,e.resolve()),e._listeningInterval=setTimeout(r,200)})()}},_cLoc:function(){return"undefined"!=typeof window?void 0!==window.__NAVIGO_WINDOW_LOCATION_MOCK__?window.__NAVIGO_WINDOW_LOCATION_MOCK__:Xy(window.location.href):""},_findLinks:function(){return[].slice.call(document.querySelectorAll("[data-navigo]"))},_onLocationChange:function(){this.resolve()},_callLeave:function(){var e=this._lastRouteResolved;e&&e.hooks&&e.hooks.leave&&e.hooks.leave(e.params)}},Ky.PARAMETER_REGEXP=/([:*])(\w+)/g,Ky.WILDCARD_REGEXP=/\*/g,Ky.REPLACE_VARIABLE_REGEXP="([^/]+)",Ky.REPLACE_WILDCARD="(?:.*)",Ky.FOLLOWED_BY_SLASH_REGEXP="(?:/$|$)",Ky.MATCH_REGEXP_FLAGS="";var og=function(e){Ki(n,e);var t=rs(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Yi(n,[{key:"updatePageLinks",value:function(){var e=this;if("undefined"!=typeof document){var t=document.createElement("a");t.href=this.root;var n=t.pathname;this._findLinks().forEach((function(t){t.hasListenerAttached||(t.addEventListener("click",(function(r){if((r.ctrlKey||r.metaKey)&&"a"==r.target.tagName.toLowerCase())return!1;if(!e._destroyed){var a=t.pathname.replace(n,"");r.preventDefault(),e.navigate(a)}})),t.hasListenerAttached=!0)}))}}}]),n}(Ky),ig=function(e){Ki(n,e);var t=rs(n);function n(){var e;Gi(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return zi(ts(e=t.call.apply(t,[this].concat(a))),"app",void 0),zi(ts(e),"surveysMenuId",void 0),e}return Yi(n,[{key:"setApp",value:function(e){this.app=e,e.addListener(Qh.EVENT_SURVEYS_CHANGED,this,this.surveysChangedHandler)}},{key:"initialise",value:function(){var e=this;this.refreshSurveysMenu();var t=document.createElement("div");t.innerHTML='\x3c!-- begin: templates/newSurveyModal.html --\x3e\r\n<div class="modal fade" id="newsurveymodal" tabindex="-1" role="dialog" aria-labelledby="newsurveymodalTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="newsurveymodalTitle">Start a new survey?</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Please confirm that you wish to start a new survey. You only need to do this is you wish to send a set of records from a different locality, otherwise please add more records to your current report.\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Back</button>\r\n                <button type="button" class="btn btn-danger" data-dismiss="modal" id="newsurveymodalconfirmed">New survey</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/newSurveyModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),(t=document.createElement("div")).innerHTML='\x3c!-- begin: templates/resetModal.html --\x3e\r\n<div class="modal fade" id="resetmodal" tabindex="-1" role="dialog" aria-labelledby="resetmodalTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="resetmodalTitle">Reset?</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Please confirm that you wish to clear out your survey data.\r\n                <p>Warning: any unsaved changes will be lost.</p>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Back</button>\r\n                <button type="button" class="btn btn-danger" data-dismiss="modal" id="resetmodalconfirmed">Reset</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/resetModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),(t=document.createElement("div")).innerHTML='\x3c!-- begin: templates/syncSuccessModal.html --\x3e\r\n<div class="modal fade" id="saveallsuccess" tabindex="-1" role="dialog" aria-labelledby="saveallsuccessTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="saveallsuccessTitle">All records sent</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Your data has been synchronised with the server.\r\n                <p>Thank you.</p>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/syncSuccessModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),(t=document.createElement("div")).innerHTML='\x3c!-- begin: templates/syncFailureModal.html --\x3e\r\n<div class="modal fade" id="saveallfailure" tabindex="-1" role="dialog" aria-labelledby="saveallfailureTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="saveallfailureTitle">One or more records could not be saved</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Please check your connection to the network and try again.\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/syncFailureModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),setTimeout((function(){document.getElementById("".concat(n.NEW_SURVEY_MODAL_ID,"confirmed")).addEventListener("click",(function(t){e.app.fireEvent(Qh.EVENT_ADD_SURVEY_USER_REQUEST)})),document.getElementById("".concat(n.RESET_MODAL_ID,"confirmed")).addEventListener("click",(function(t){e.app.fireEvent(Qh.EVENT_RESET_SURVEYS)}))}),100)}},{key:"surveysChangedHandler",value:function(){this.refreshSurveysMenu()}},{key:"refreshSurveysMenu",value:function(){var e,t=document.getElementById(this.surveysMenuId),n=[],r=this.app.currentSurvey?this.app.currentSurvey.id:null,a=cs(this.app.surveys);try{for(a.s();!(e=a.n()).done;){var o=e.value,i=o[1].generateSurveyName()+(o[0]===r?' <span style="color: green">●</span>':"");n[n.length]='<a class="dropdown-item" href="/app/survey/add/'.concat(o[0],'" data-navigo="survey/add/').concat(o[0],'">').concat(i,"</a>")}}catch(e){a.e(e)}finally{a.f()}t.innerHTML='<a class="dropdown-item" href="/app/survey/save" data-navigo="survey/save">save all</a>\n    <div class="dropdown-divider"></div>\n    '.concat(n.join(""),'\n    <div class="dropdown-divider"></div>\n    <a class="dropdown-item" href="/app/survey/new" data-navigo="survey/new">new survey</a>\n    <a class="dropdown-item" href="/app/survey/reset" data-navigo="survey/reset">reset</a>'),this.app.router.updatePageLinks()}}]),n}($h);zi(ig,"NEW_SURVEY_MODAL_ID","newsurveymodal"),zi(ig,"RESET_MODAL_ID","resetmodal"),zi(ig,"SAVE_ALL_SUCCESS_MODAL_ID","saveallsuccess"),zi(ig,"SAVE_ALL_FAILURE_MODAL_ID","saveallfailure");var sg=function(e){Ki(n,e);var t=rs(n);function n(e){var r;return Gi(this,n),zi(ts(r=t.call(this)),"route","/survey/:action/:id"),zi(ts(r),"title","NYPH survey picker"),zi(ts(r),"app",void 0),zi(ts(r),"view",void 0),r.view=e,e.controller=ts(r),r.handle=Qm.nextHandle,r}return Yi(n,[{key:"survey",get:function(){return this.app.currentSurvey}},{key:"registerRoute",value:function(e){e.on("/survey",this.mainRouteHandler.bind(this,"survey","",""),{}),e.on("/survey/new",this.newSurveyHandler.bind(this,"survey","new",""),{before:this.beforeNewHandler.bind(this)}),e.on("/survey/reset",this.mainRouteHandler.bind(this,"survey","reset",""),{before:this.beforeResetHandler.bind(this)}),e.on("/survey/save",this.mainRouteHandler.bind(this,"survey","save",""),{before:this.beforeSaveAllHandler.bind(this)}),e.on("/survey/add/:surveyId",this.addSurveyHandler.bind(this,"survey","add","")),this.app.addListener(Qh.EVENT_ADD_SURVEY_USER_REQUEST,this,this.addNewSurveyHandler),this.app.addListener(Qh.EVENT_RESET_SURVEYS,this,this.resetSurveysHandler)}},{key:"beforeNewHandler",value:function(e){$("#".concat(ig.NEW_SURVEY_MODAL_ID)).modal(),this.app.router.pause(),window.history.back(),this.app.router.resume(),e(!1)}},{key:"beforeResetHandler",value:function(e){$("#".concat(ig.RESET_MODAL_ID)).modal(),this.app.router.pause(),window.history.back(),this.app.router.resume(),e(!1)}},{key:"beforeSaveAllHandler",value:function(e){this.app.syncAll().then((function(e){console.log("In save all handler, success result: ".concat(e)),$("#".concat(ig.SAVE_ALL_SUCCESS_MODAL_ID)).modal()}),(function(e){console.log("In save all handler, failure result: ".concat(e)),$("#".concat(ig.SAVE_ALL_FAILURE_MODAL_ID)).modal()})).finally((function(){})),this.app.router.pause(),window.history.back(),this.app.router.resume(),e(!1)}},{key:"newSurveyHandler",value:function(e,t,n,r){}},{key:"addNewSurveyHandler",value:function(){console.log("reached addNewSurveyHandler"),this.app.currentControllerHandle=this.handle,this.app.clearCurrentSurvey(),this.app.setNewSurvey(),this.app.router.pause(),this.app.router.navigate("/list/survey/welcome").resume(),this.app.router.resolve()}},{key:"resetSurveysHandler",value:function(){var e=this;this.app.clearLocalForage().then((function(){e.app.reset(),e.addNewSurveyHandler()}))}},{key:"addSurveyHandler",value:function(e,t,n,r){var a=this;console.log("reached addSurveyHandler"),console.log({context:e,params:t,query:r}),this.app.currentControllerHandle=this.handle;var o=r.surveyId;if(!o||!o.match($f))throw new Zm("Failed to match survey id '".concat(o,"', the id format appears to be incorrect"));o=o.toLowerCase(),this.app.restoreOccurrences(o).then((function(){a.app.markAllNotPristine(),a.app.router.pause(),a.app.router.navigate("/list").resume(),a.app.router.resolve()}),(function(e){console.log({"failed survey restoration":e})}))}},{key:"mainRouteHandler",value:function(e,t,n,r){console.log("reached special route handler for SurveyPickerController.js"),console.log({context:e,params:t,query:r})}}]),n}(Qm);zi(sg,"EVENT_BACK","back");var lg=function(e){Ki(n,e);var t=rs(n);function n(){return Gi(this,n),t.apply(this,arguments)}return Yi(n,[{key:"body",value:function(){document.getElementById("body").innerHTML="<p>Placeholder survey picker content.</p>"}}]),n}(Yh),cg=function(e){Ki(n,e);var t=rs(n);function n(){var e;Gi(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return zi(ts(e=t.call.apply(t,[this].concat(a))),"surveysMenuId","surveysmenu"),e}return n}(ig),ug=function(){function e(){Gi(this,e)}return Yi(e,null,[{key:"taxaLoadedEntryPoint",value:function(){for(op.rawTaxa=BsbiDb.TaxonNames;e.callbackStack.length;){var t=e.callbackStack.shift();try{t()}catch(e){console.log({"Exception after taxon load":e})}}}},{key:"onceTaxaLoaded",value:function(){return BsbiDb.hasOwnProperty("TaxonNames")?Promise.resolve():(BsbiDb.taxonNamesLoadedEntryPoint||(BsbiDb.taxonNamesLoadedEntryPoint=e.taxaLoadedEntryPoint),new Promise((function(t){e.callbackStack.push(t)})))}}]),e}();zi(ug,"callbackStack",[]),Uf.config({name:"Nyph App"}),Promise.prototype.finally||(Promise.prototype.finally=function(e){return this.then(e).catch(e)}),console.log("if you have sourcemaps enabled in your devtools, click on main.js:5 --\x3e"),navigator.serviceWorker.register("/app/serviceworker.js",{}),navigator.serviceWorker.addEventListener("controllerchange",(function(){window.location.reload(!0)}));var dg=new Xm;dg.router=new og("https://nyph.bsbi.org/app/"),dg.containerId="appcontainer",dg.setLayout(new cg),dg.registerController(new Dy(new jy,"/help")),dg.registerController(new ty(new Sy)),dg.registerController(new sg(new lg)),dg.restoreOccurrences().then((function(e){console.log({"result from restoreOccurrences":e})}),(function(e){console.log({"failed result from restoreOccurrences":e})})).finally((function(){ug.onceTaxaLoaded().then((function(){dg.initialise(),dg.display()}))}))}(BsbiDb,$);
//# sourceMappingURL=nyph.js.map
