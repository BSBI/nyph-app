!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function i(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}var a=function(){function t(){e(this,t),r(this,"route",null),r(this,"view",void 0),r(this,"title","untitled"),r(this,"handle",void 0),r(this,"app",void 0)}return n(t,[{key:"initialise",value:function(){this.view.initialise()}},{key:"registerRoute",value:function(e){if(null===this.route)throw new Error("No route set for '".concat(this.title,"' controller."));console.log({route:this.route}),e.on(this.route,this.routeHandler.bind(this),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null})}},{key:"routeHandler",value:function(e,t){}}],[{key:"nextHandle",get:function(){var e,n,r;return function(e,t,n,r){i(e,t),o(n,"set"),function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,n,r)}(t,t,c,(r=c,i(n=t,t),o(r,"get"),1+(e=+function(e,t){return t.get?t.get.call(e):t.value}(n,r)))),e}}]),t}(),c={writable:!0,value:0},s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function u(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var l=function(e){return e&&e.Math==Math&&e},d=l("object"==typeof globalThis&&globalThis)||l("object"==typeof window&&window)||l("object"==typeof self&&self)||l("object"==typeof s&&s)||function(){return this}()||Function("return this")(),f={},h=function(e){try{return!!e()}catch(e){return!0}},p=!h((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),v={},y={}.propertyIsEnumerable,S=Object.getOwnPropertyDescriptor,m=S&&!y.call({1:2},1);v.f=m?function(e){var t=S(this,e);return!!t&&t.enumerable}:y;var g,N,b=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},T={}.toString,E=function(e){return T.call(e).slice(8,-1)},w=E,_="".split,O=h((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==w(e)?_.call(e,""):Object(e)}:Object,I=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},R=O,C=I,x=function(e){return R(C(e))},L=function(e){return"function"==typeof e},M=L,k=function(e){return"object"==typeof e?null!==e:M(e)},A=d,H=L,P=function(e){return H(e)?e:void 0},D=function(e,t){return arguments.length<2?P(A[e]):A[e]&&A[e][t]},j=D("navigator","userAgent")||"",F=d,U=j,B=F.process,J=F.Deno,Y=B&&B.versions||J&&J.version,G=Y&&Y.v8;G?N=(g=G.split("."))[0]<4?1:g[0]+g[1]:U&&(!(g=U.match(/Edge\/(\d+)/))||g[1]>=74)&&(g=U.match(/Chrome\/(\d+)/))&&(N=g[1]);var K=N&&+N,V=K,q=h,X=!!Object.getOwnPropertySymbols&&!q((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&V&&V<41})),W=X&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Q=L,Z=D,z=W?function(e){return"symbol"==typeof e}:function(e){var t=Z("Symbol");return Q(t)&&Object(e)instanceof t},ee=function(e){try{return String(e)}catch(e){return"Object"}},te=L,ne=ee,re=function(e){if(te(e))return e;throw TypeError(ne(e)+" is not a function")},oe=re,ie=function(e,t){var n=e[t];return null==n?void 0:oe(n)},ae=L,ce=k,se={exports:{}},ue=d,le=function(e,t){try{Object.defineProperty(ue,e,{value:t,configurable:!0,writable:!0})}catch(n){ue[e]=t}return t},de=le,fe=d["__core-js_shared__"]||de("__core-js_shared__",{}),he=fe;(se.exports=function(e,t){return he[e]||(he[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.18.2",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var pe=I,ve=function(e){return Object(pe(e))},ye=ve,Se={}.hasOwnProperty,me=Object.hasOwn||function(e,t){return Se.call(ye(e),t)},ge=0,Ne=Math.random(),be=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++ge+Ne).toString(36)},Te=d,Ee=se.exports,we=me,_e=be,Oe=X,Ie=W,Re=Ee("wks"),Ce=Te.Symbol,xe=Ie?Ce:Ce&&Ce.withoutSetter||_e,Le=function(e){return we(Re,e)&&(Oe||"string"==typeof Re[e])||(Oe&&we(Ce,e)?Re[e]=Ce[e]:Re[e]=xe("Symbol."+e)),Re[e]},Me=k,ke=z,Ae=ie,He=Le("toPrimitive"),Pe=function(e,t){if(!Me(e)||ke(e))return e;var n,r=Ae(e,He);if(r){if(void 0===t&&(t="default"),n=r.call(e,t),!Me(n)||ke(n))return n;throw TypeError("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var n,r;if("string"===t&&ae(n=e.toString)&&!ce(r=n.call(e)))return r;if(ae(n=e.valueOf)&&!ce(r=n.call(e)))return r;if("string"!==t&&ae(n=e.toString)&&!ce(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}(e,t)},De=z,je=function(e){var t=Pe(e,"string");return De(t)?t:String(t)},Fe=k,Ue=d.document,Be=Fe(Ue)&&Fe(Ue.createElement),Je=function(e){return Be?Ue.createElement(e):{}},Ye=Je,Ge=!p&&!h((function(){return 7!=Object.defineProperty(Ye("div"),"a",{get:function(){return 7}}).a})),Ke=p,Ve=v,qe=b,Xe=x,We=je,Qe=me,Ze=Ge,ze=Object.getOwnPropertyDescriptor;f.f=Ke?ze:function(e,t){if(e=Xe(e),t=We(t),Ze)try{return ze(e,t)}catch(e){}if(Qe(e,t))return qe(!Ve.f.call(e,t),e[t])};var $e={},et=k,tt=function(e){if(et(e))return e;throw TypeError(String(e)+" is not an object")},nt=p,rt=Ge,ot=tt,it=je,at=Object.defineProperty;$e.f=nt?at:function(e,t,n){if(ot(e),t=it(t),ot(n),rt)try{return at(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var ct=$e,st=b,ut=p?function(e,t,n){return ct.f(e,t,st(1,n))}:function(e,t,n){return e[t]=n,e},lt={exports:{}},dt=L,ft=fe,ht=Function.toString;dt(ft.inspectSource)||(ft.inspectSource=function(e){return ht.call(e)});var pt,vt,yt,St=ft.inspectSource,mt=L,gt=St,Nt=d.WeakMap,bt=mt(Nt)&&/native code/.test(gt(Nt)),Tt=se.exports,Et=be,wt=Tt("keys"),_t=function(e){return wt[e]||(wt[e]=Et(e))},Ot={},It=bt,Rt=k,Ct=ut,xt=me,Lt=fe,Mt=_t,kt=Ot,At=d.WeakMap;if(It||Lt.state){var Ht=Lt.state||(Lt.state=new At),Pt=Ht.get,Dt=Ht.has,jt=Ht.set;pt=function(e,t){if(Dt.call(Ht,e))throw new TypeError("Object already initialized");return t.facade=e,jt.call(Ht,e,t),t},vt=function(e){return Pt.call(Ht,e)||{}},yt=function(e){return Dt.call(Ht,e)}}else{var Ft=Mt("state");kt[Ft]=!0,pt=function(e,t){if(xt(e,Ft))throw new TypeError("Object already initialized");return t.facade=e,Ct(e,Ft,t),t},vt=function(e){return xt(e,Ft)?e[Ft]:{}},yt=function(e){return xt(e,Ft)}}var Ut={set:pt,get:vt,has:yt,enforce:function(e){return yt(e)?vt(e):pt(e,{})},getterFor:function(e){return function(t){var n;if(!Rt(t)||(n=vt(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},Bt=p,Jt=me,Yt=Function.prototype,Gt=Bt&&Object.getOwnPropertyDescriptor,Kt=Jt(Yt,"name"),Vt={EXISTS:Kt,PROPER:Kt&&"something"===function(){}.name,CONFIGURABLE:Kt&&(!Bt||Bt&&Gt(Yt,"name").configurable)},qt=d,Xt=L,Wt=me,Qt=ut,Zt=le,zt=St,$t=Vt.CONFIGURABLE,en=Ut.get,tn=Ut.enforce,nn=String(String).split("String");(lt.exports=function(e,t,n,r){var o,i=!!r&&!!r.unsafe,a=!!r&&!!r.enumerable,c=!!r&&!!r.noTargetGet,s=r&&void 0!==r.name?r.name:t;Xt(n)&&("Symbol("===String(s).slice(0,7)&&(s="["+String(s).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!Wt(n,"name")||$t&&n.name!==s)&&Qt(n,"name",s),(o=tn(n)).source||(o.source=nn.join("string"==typeof s?s:""))),e!==qt?(i?!c&&e[t]&&(a=!0):delete e[t],a?e[t]=n:Qt(e,t,n)):a?e[t]=n:Zt(t,n)})(Function.prototype,"toString",(function(){return Xt(this)&&en(this).source||zt(this)}));var rn={},on=Math.ceil,an=Math.floor,cn=function(e){var t=+e;return t!=t||0===t?0:(t>0?an:on)(t)},sn=cn,un=Math.max,ln=Math.min,dn=function(e,t){var n=sn(e);return n<0?un(n+t,0):ln(n,t)},fn=cn,hn=Math.min,pn=function(e){return e>0?hn(fn(e),9007199254740991):0},vn=pn,yn=function(e){return vn(e.length)},Sn=x,mn=dn,gn=yn,Nn=function(e){return function(t,n,r){var o,i=Sn(t),a=gn(i),c=mn(r,a);if(e&&n!=n){for(;a>c;)if((o=i[c++])!=o)return!0}else for(;a>c;c++)if((e||c in i)&&i[c]===n)return e||c||0;return!e&&-1}},bn={includes:Nn(!0),indexOf:Nn(!1)},Tn=me,En=x,wn=bn.indexOf,_n=Ot,On=function(e,t){var n,r=En(e),o=0,i=[];for(n in r)!Tn(_n,n)&&Tn(r,n)&&i.push(n);for(;t.length>o;)Tn(r,n=t[o++])&&(~wn(i,n)||i.push(n));return i},In=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Rn=On,Cn=In.concat("length","prototype");rn.f=Object.getOwnPropertyNames||function(e){return Rn(e,Cn)};var xn={};xn.f=Object.getOwnPropertySymbols;var Ln=rn,Mn=xn,kn=tt,An=D("Reflect","ownKeys")||function(e){var t=Ln.f(kn(e)),n=Mn.f;return n?t.concat(n(e)):t},Hn=me,Pn=An,Dn=f,jn=$e,Fn=function(e,t){for(var n=Pn(t),r=jn.f,o=Dn.f,i=0;i<n.length;i++){var a=n[i];Hn(e,a)||r(e,a,o(t,a))}},Un=h,Bn=L,Jn=/#|\.prototype\./,Yn=function(e,t){var n=Kn[Gn(e)];return n==qn||n!=Vn&&(Bn(t)?Un(t):!!t)},Gn=Yn.normalize=function(e){return String(e).replace(Jn,".").toLowerCase()},Kn=Yn.data={},Vn=Yn.NATIVE="N",qn=Yn.POLYFILL="P",Xn=Yn,Wn=d,Qn=f.f,Zn=ut,zn=lt.exports,$n=le,er=Fn,tr=Xn,nr=function(e,t){var n,r,o,i,a,c=e.target,s=e.global,u=e.stat;if(n=s?Wn:u?Wn[c]||$n(c,{}):(Wn[c]||{}).prototype)for(r in t){if(i=t[r],o=e.noTargetGet?(a=Qn(n,r))&&a.value:n[r],!tr(s?r:c+(u?".":"#")+r,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;er(i,o)}(e.sham||o&&o.sham)&&Zn(i,"sham",!0),zn(n,r,i,e)}},rr={};rr[Le("toStringTag")]="z";var or,ir="[object z]"===String(rr),ar=ir,cr=L,sr=E,ur=Le("toStringTag"),lr="Arguments"==sr(function(){return arguments}()),dr=ar?sr:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),ur))?n:lr?sr(t):"Object"==(r=sr(t))&&cr(t.callee)?"Arguments":r},fr=h,hr=L,pr=dr,vr=St,yr=[],Sr=D("Reflect","construct"),mr=/^\s*(?:class|function)\b/,gr=mr.exec,Nr=!mr.exec((function(){})),br=function(e){if(!hr(e))return!1;try{return Sr(Object,yr,e),!0}catch(e){return!1}},Tr=!Sr||fr((function(){var e;return br(br.call)||!br(Object)||!br((function(){e=!0}))||e}))?function(e){if(!hr(e))return!1;switch(pr(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return Nr||!!gr.call(mr,vr(e))}:br,Er=Tr,wr=ee,_r=function(e){if(Er(e))return e;throw TypeError(wr(e)+" is not a constructor")},Or=On,Ir=In,Rr=Object.keys||function(e){return Or(e,Ir)},Cr=$e,xr=tt,Lr=Rr,Mr=p?Object.defineProperties:function(e,t){xr(e);for(var n,r=Lr(t),o=r.length,i=0;o>i;)Cr.f(e,n=r[i++],t[n]);return e},kr=D("document","documentElement"),Ar=tt,Hr=Mr,Pr=In,Dr=Ot,jr=kr,Fr=Je,Ur=_t("IE_PROTO"),Br=function(){},Jr=function(e){return"<script>"+e+"<\/script>"},Yr=function(e){e.write(Jr("")),e.close();var t=e.parentWindow.Object;return e=null,t},Gr=function(){try{or=new ActiveXObject("htmlfile")}catch(e){}var e,t;Gr="undefined"!=typeof document?document.domain&&or?Yr(or):((t=Fr("iframe")).style.display="none",jr.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Jr("document.F=Object")),e.close(),e.F):Yr(or);for(var n=Pr.length;n--;)delete Gr.prototype[Pr[n]];return Gr()};Dr[Ur]=!0;var Kr=Object.create||function(e,t){var n;return null!==e?(Br.prototype=Ar(e),n=new Br,Br.prototype=null,n[Ur]=e):n=Gr(),void 0===t?n:Hr(n,t)},Vr=re,qr=k,Xr=[].slice,Wr={},Qr=function(e,t,n){if(!(t in Wr)){for(var r=[],o=0;o<t;o++)r[o]="a["+o+"]";Wr[t]=Function("C,a","return new C("+r.join(",")+")")}return Wr[t](e,n)},Zr=Function.bind||function(e){var t=Vr(this),n=Xr.call(arguments,1),r=function(){var o=n.concat(Xr.call(arguments));return this instanceof r?Qr(t,o.length,o):t.apply(e,o)};return qr(t.prototype)&&(r.prototype=t.prototype),r},zr=nr,$r=_r,eo=tt,to=k,no=Kr,ro=Zr,oo=h,io=D("Reflect","construct"),ao=oo((function(){function e(){}return!(io((function(){}),[],e)instanceof e)})),co=!oo((function(){io((function(){}))})),so=ao||co;function uo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lo(e,t){return(lo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fo(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lo(e,t)}function ho(e){return(ho="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function po(e,t){if(t&&("object"===ho(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return uo(e)}function vo(e){return(vo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function yo(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function So(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,yo(e,t,"set"),n),n}function mo(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,yo(e,t,"get"))}zr({target:"Reflect",stat:!0,forced:so,sham:so},{construct:function(e,t){$r(e),eo(t);var n=arguments.length<3?e:$r(arguments[2]);if(co&&!ao)return io(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(ro.apply(e,r))}var o=n.prototype,i=no(to(o)?o:Object.prototype),a=Function.apply.call(e,i,t);return to(a)?a:i}});var go=Kr,No=$e,bo=Le("unscopables"),To=Array.prototype;null==To[bo]&&No.f(To,bo,{configurable:!0,value:go(null)});var Eo,wo,_o,Oo=function(e){To[bo][e]=!0},Io={},Ro=!h((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Co=me,xo=L,Lo=ve,Mo=Ro,ko=_t("IE_PROTO"),Ao=Object.prototype,Ho=Mo?Object.getPrototypeOf:function(e){var t=Lo(e);if(Co(t,ko))return t[ko];var n=t.constructor;return xo(n)&&t instanceof n?n.prototype:t instanceof Object?Ao:null},Po=h,Do=L,jo=Ho,Fo=lt.exports,Uo=Le("iterator"),Bo=!1;[].keys&&("next"in(_o=[].keys())?(wo=jo(jo(_o)))!==Object.prototype&&(Eo=wo):Bo=!0),(null==Eo||Po((function(){var e={};return Eo[Uo].call(e)!==e})))&&(Eo={}),Do(Eo[Uo])||Fo(Eo,Uo,(function(){return this}));var Jo={IteratorPrototype:Eo,BUGGY_SAFARI_ITERATORS:Bo},Yo=$e.f,Go=me,Ko=Le("toStringTag"),Vo=function(e,t,n){e&&!Go(e=n?e:e.prototype,Ko)&&Yo(e,Ko,{configurable:!0,value:t})},qo=Jo.IteratorPrototype,Xo=Kr,Wo=b,Qo=Vo,Zo=Io,zo=function(){return this},$o=function(e,t,n){var r=t+" Iterator";return e.prototype=Xo(qo,{next:Wo(1,n)}),Qo(e,r,!1),Zo[r]=zo,e},ei=L,ti=tt,ni=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return ti(n),function(e){if("object"==typeof e||ei(e))return e;throw TypeError("Can't set "+String(e)+" as a prototype")}(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),ri=nr,oi=Vt,ii=L,ai=$o,ci=Ho,si=ni,ui=Vo,li=ut,di=lt.exports,fi=Io,hi=oi.PROPER,pi=oi.CONFIGURABLE,vi=Jo.IteratorPrototype,yi=Jo.BUGGY_SAFARI_ITERATORS,Si=Le("iterator"),mi=function(){return this},gi=function(e,t,n,r,o,i,a){ai(n,t,r);var c,s,u,l=function(e){if(e===o&&v)return v;if(!yi&&e in h)return h[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",f=!1,h=e.prototype,p=h[Si]||h["@@iterator"]||o&&h[o],v=!yi&&p||l(o),y="Array"==t&&h.entries||p;if(y&&(c=ci(y.call(new e)))!==Object.prototype&&c.next&&(ci(c)!==vi&&(si?si(c,vi):ii(c[Si])||di(c,Si,mi)),ui(c,d,!0)),hi&&"values"==o&&p&&"values"!==p.name&&(pi?li(h,"name","values"):(f=!0,v=function(){return p.call(this)})),o)if(s={values:l("values"),keys:i?v:l("keys"),entries:l("entries")},a)for(u in s)(yi||f||!(u in h))&&di(h,u,s[u]);else ri({target:t,proto:!0,forced:yi||f},s);return h[Si]!==v&&di(h,Si,v,{name:o}),fi[t]=v,s},Ni=x,bi=Oo,Ti=Io,Ei=Ut,wi=gi,_i=Ei.set,Oi=Ei.getterFor("Array Iterator"),Ii=wi(Array,"Array",(function(e,t){_i(this,{type:"Array Iterator",target:Ni(e),index:0,kind:t})}),(function(){var e=Oi(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");Ti.Arguments=Ti.Array,bi("keys"),bi("values"),bi("entries");var Ri=dr,Ci=ir?{}.toString:function(){return"[object "+Ri(this)+"]"},xi=ir,Li=lt.exports,Mi=Ci;xi||Li(Object.prototype,"toString",Mi,{unsafe:!0});var ki=dr,Ai=function(e){if("Symbol"===ki(e))throw TypeError("Cannot convert a Symbol value to a string");return String(e)},Hi=cn,Pi=Ai,Di=I,ji=function(e){return function(t,n){var r,o,i=Pi(Di(t)),a=Hi(n),c=i.length;return a<0||a>=c?e?"":void 0:(r=i.charCodeAt(a))<55296||r>56319||a+1===c||(o=i.charCodeAt(a+1))<56320||o>57343?e?i.charAt(a):r:e?i.slice(a,a+2):o-56320+(r-55296<<10)+65536}},Fi={codeAt:ji(!1),charAt:ji(!0)},Ui=Fi.charAt,Bi=Ai,Ji=Ut,Yi=gi,Gi=Ji.set,Ki=Ji.getterFor("String Iterator");Yi(String,"String",(function(e){Gi(this,{type:"String Iterator",string:Bi(e),index:0})}),(function(){var e,t=Ki(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=Ui(n,r),t.index+=e.length,{value:e,done:!1})}));var Vi=lt.exports,qi=function(e,t,n){for(var r in t)Vi(e,r,t[r],n);return e},Xi={exports:{}},Wi={},Qi=x,Zi=rn.f,zi={}.toString,$i="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Wi.f=function(e){return $i&&"[object Window]"==zi.call(e)?function(e){try{return Zi(e)}catch(e){return $i.slice()}}(e):Zi(Qi(e))};var ea=!h((function(){return Object.isExtensible(Object.preventExtensions({}))})),ta=nr,na=Ot,ra=k,oa=me,ia=$e.f,aa=rn,ca=Wi,sa=ea,ua=!1,la=be("meta"),da=0,fa=Object.isExtensible||function(){return!0},ha=function(e){ia(e,la,{value:{objectID:"O"+da++,weakData:{}}})},pa=Xi.exports={enable:function(){pa.enable=function(){},ua=!0;var e=aa.f,t=[].splice,n={};n[la]=1,e(n).length&&(aa.f=function(n){for(var r=e(n),o=0,i=r.length;o<i;o++)if(r[o]===la){t.call(r,o,1);break}return r},ta({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:ca.f}))},fastKey:function(e,t){if(!ra(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!oa(e,la)){if(!fa(e))return"F";if(!t)return"E";ha(e)}return e[la].objectID},getWeakData:function(e,t){if(!oa(e,la)){if(!fa(e))return!0;if(!t)return!1;ha(e)}return e[la].weakData},onFreeze:function(e){return sa&&ua&&fa(e)&&!oa(e,la)&&ha(e),e}};na[la]=!0;var va=Io,ya=Le("iterator"),Sa=Array.prototype,ma=function(e){return void 0!==e&&(va.Array===e||Sa[ya]===e)},ga=re,Na=function(e,t,n){if(ga(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}},ba=dr,Ta=ie,Ea=Io,wa=Le("iterator"),_a=function(e){if(null!=e)return Ta(e,wa)||Ta(e,"@@iterator")||Ea[ba(e)]},Oa=re,Ia=tt,Ra=_a,Ca=function(e,t){var n=arguments.length<2?Ra(e):t;if(Oa(n))return Ia(n.call(e));throw TypeError(String(e)+" is not iterable")},xa=tt,La=ie,Ma=function(e,t,n){var r,o;xa(e);try{if(!(r=La(e,"return"))){if("throw"===t)throw n;return n}r=r.call(e)}catch(e){o=!0,r=e}if("throw"===t)throw n;if(o)throw r;return xa(r),n},ka=tt,Aa=ma,Ha=yn,Pa=Na,Da=Ca,ja=_a,Fa=Ma,Ua=function(e,t){this.stopped=e,this.result=t},Ba=function(e,t,n){var r,o,i,a,c,s,u,l=n&&n.that,d=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_ITERATOR),h=!(!n||!n.INTERRUPTED),p=Pa(t,l,1+d+h),v=function(e){return r&&Fa(r,"normal",e),new Ua(!0,e)},y=function(e){return d?(ka(e),h?p(e[0],e[1],v):p(e[0],e[1])):h?p(e,v):p(e)};if(f)r=e;else{if(!(o=ja(e)))throw TypeError(String(e)+" is not iterable");if(Aa(o)){for(i=0,a=Ha(e);a>i;i++)if((c=y(e[i]))&&c instanceof Ua)return c;return new Ua(!1)}r=Da(e,o)}for(s=r.next;!(u=s.call(r)).done;){try{c=y(u.value)}catch(e){Fa(r,"throw",e)}if("object"==typeof c&&c&&c instanceof Ua)return c}return new Ua(!1)},Ja=function(e,t,n){if(e instanceof t)return e;throw TypeError("Incorrect "+(n?n+" ":"")+"invocation")},Ya=Le("iterator"),Ga=!1;try{var Ka=0,Va={next:function(){return{done:!!Ka++}},return:function(){Ga=!0}};Va[Ya]=function(){return this},Array.from(Va,(function(){throw 2}))}catch(e){}var qa=function(e,t){if(!t&&!Ga)return!1;var n=!1;try{var r={};r[Ya]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Xa=L,Wa=k,Qa=ni,Za=function(e,t,n){var r,o;return Qa&&Xa(r=t.constructor)&&r!==n&&Wa(o=r.prototype)&&o!==n.prototype&&Qa(e,o),e},za=nr,$a=d,ec=Xn,tc=lt.exports,nc=Xi.exports,rc=Ba,oc=Ja,ic=L,ac=k,cc=h,sc=qa,uc=Vo,lc=Za,dc=function(e,t,n){var r=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),i=r?"set":"add",a=$a[e],c=a&&a.prototype,s=a,u={},l=function(e){var t=c[e];tc(c,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(o&&!ac(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return o&&!ac(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(o&&!ac(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(ec(e,!ic(a)||!(o||c.forEach&&!cc((function(){(new a).entries().next()})))))s=n.getConstructor(t,e,r,i),nc.enable();else if(ec(e,!0)){var d=new s,f=d[i](o?{}:-0,1)!=d,h=cc((function(){d.has(1)})),p=sc((function(e){new a(e)})),v=!o&&cc((function(){for(var e=new a,t=5;t--;)e[i](t,t);return!e.has(-0)}));p||((s=t((function(t,n){oc(t,s,e);var o=lc(new a,t,s);return null!=n&&rc(n,o[i],{that:o,AS_ENTRIES:r}),o}))).prototype=c,c.constructor=s),(h||v)&&(l("delete"),l("has"),r&&l("get")),(v||f)&&l(i),o&&c.clear&&delete c.clear}return u[e]=s,za({global:!0,forced:s!=a},u),uc(s,e),o||n.setStrong(s,e,r),s},fc=E,hc=Array.isArray||function(e){return"Array"==fc(e)},pc=hc,vc=Tr,yc=k,Sc=Le("species"),mc=function(e,t){return new(function(e){var t;return pc(e)&&(t=e.constructor,(vc(t)&&(t===Array||pc(t.prototype))||yc(t)&&null===(t=t[Sc]))&&(t=void 0)),void 0===t?Array:t}(e))(0===t?0:t)},gc=Na,Nc=O,bc=ve,Tc=yn,Ec=mc,wc=[].push,_c=function(e){var t=1==e,n=2==e,r=3==e,o=4==e,i=6==e,a=7==e,c=5==e||i;return function(s,u,l,d){for(var f,h,p=bc(s),v=Nc(p),y=gc(u,l,3),S=Tc(v),m=0,g=d||Ec,N=t?g(s,S):n||a?g(s,0):void 0;S>m;m++)if((c||m in v)&&(h=y(f=v[m],m,p),e))if(t)N[m]=h;else if(h)switch(e){case 3:return!0;case 5:return f;case 6:return m;case 2:wc.call(N,f)}else switch(e){case 4:return!1;case 7:wc.call(N,f)}return i?-1:r||o?o:N}},Oc={forEach:_c(0),map:_c(1),filter:_c(2),some:_c(3),every:_c(4),find:_c(5),findIndex:_c(6),filterReject:_c(7)},Ic=qi,Rc=Xi.exports.getWeakData,Cc=tt,xc=k,Lc=Ja,Mc=Ba,kc=me,Ac=Ut.set,Hc=Ut.getterFor,Pc=Oc.find,Dc=Oc.findIndex,jc=0,Fc=function(e){return e.frozen||(e.frozen=new Uc)},Uc=function(){this.entries=[]},Bc=function(e,t){return Pc(e.entries,(function(e){return e[0]===t}))};Uc.prototype={get:function(e){var t=Bc(this,e);if(t)return t[1]},has:function(e){return!!Bc(this,e)},set:function(e,t){var n=Bc(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=Dc(this.entries,(function(t){return t[0]===e}));return~t&&this.entries.splice(t,1),!!~t}};var Jc,Yc={getConstructor:function(e,t,n,r){var o=e((function(e,i){Lc(e,o,t),Ac(e,{type:t,id:jc++,frozen:void 0}),null!=i&&Mc(i,e[r],{that:e,AS_ENTRIES:n})})),i=Hc(t),a=function(e,t,n){var r=i(e),o=Rc(Cc(t),!0);return!0===o?Fc(r).set(t,n):o[r.id]=n,e};return Ic(o.prototype,{delete:function(e){var t=i(this);if(!xc(e))return!1;var n=Rc(e);return!0===n?Fc(t).delete(e):n&&kc(n,t.id)&&delete n[t.id]},has:function(e){var t=i(this);if(!xc(e))return!1;var n=Rc(e);return!0===n?Fc(t).has(e):n&&kc(n,t.id)}}),Ic(o.prototype,n?{get:function(e){var t=i(this);if(xc(e)){var n=Rc(e);return!0===n?Fc(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return a(this,e,t)}}:{add:function(e){return a(this,e,!0)}}),o}},Gc=d,Kc=qi,Vc=Xi.exports,qc=dc,Xc=Yc,Wc=k,Qc=Ut.enforce,Zc=bt,zc=!Gc.ActiveXObject&&"ActiveXObject"in Gc,$c=Object.isExtensible,es=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},ts=qc("WeakMap",es,Xc);if(Zc&&zc){Jc=Xc.getConstructor(es,"WeakMap",!0),Vc.enable();var ns=ts.prototype,rs=ns.delete,os=ns.has,is=ns.get,as=ns.set;Kc(ns,{delete:function(e){if(Wc(e)&&!$c(e)){var t=Qc(this);return t.frozen||(t.frozen=new Jc),rs.call(this,e)||t.frozen.delete(e)}return rs.call(this,e)},has:function(e){if(Wc(e)&&!$c(e)){var t=Qc(this);return t.frozen||(t.frozen=new Jc),os.call(this,e)||t.frozen.has(e)}return os.call(this,e)},get:function(e){if(Wc(e)&&!$c(e)){var t=Qc(this);return t.frozen||(t.frozen=new Jc),os.call(this,e)?is.call(this,e):t.frozen.get(e)}return is.call(this,e)},set:function(e,t){if(Wc(e)&&!$c(e)){var n=Qc(this);n.frozen||(n.frozen=new Jc),os.call(this,e)?as.call(this,e,t):n.frozen.set(e,t)}else as.call(this,e,t);return this}})}var cs={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},ss=Je("span").classList,us=ss&&ss.constructor&&ss.constructor.prototype,ls=us===Object.prototype?void 0:us,ds=d,fs=cs,hs=ls,ps=Ii,vs=ut,ys=Le,Ss=ys("iterator"),ms=ys("toStringTag"),gs=ps.values,Ns=function(e,t){if(e){if(e[Ss]!==gs)try{vs(e,Ss,gs)}catch(t){e[Ss]=gs}if(e[ms]||vs(e,ms,t),fs[t])for(var n in ps)if(e[n]!==ps[n])try{vs(e,n,ps[n])}catch(t){e[n]=ps[n]}}};for(var bs in fs)Ns(ds[bs]&&ds[bs].prototype,bs);function Ts(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Es(e,t,n){return(Es=Ts()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&lo(o,n.prototype),o}).apply(null,arguments)}function ws(e){var t="function"==typeof Map?new Map:void 0;return(ws=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return Es(e,arguments,vo(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),lo(r,e)})(e)}Ns(hs,"DOMTokenList");var _s=function(t){fo(r,ws(Error));var n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(r);function r(t){return e(this,r),n.call(this,t)}return r}();function Os(e,t,n){return(Os="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=vo(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}var Is=je,Rs=$e,Cs=b,xs=function(e,t,n){var r=Is(t);r in e?Rs.f(e,r,Cs(0,n)):e[r]=n},Ls=h,Ms=K,ks=Le("species"),As=function(e){return Ms>=51||!Ls((function(){var t=[];return(t.constructor={})[ks]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Hs=nr,Ps=h,Ds=hc,js=k,Fs=ve,Us=yn,Bs=xs,Js=mc,Ys=As,Gs=K,Ks=Le("isConcatSpreadable"),Vs=Gs>=51||!Ps((function(){var e=[];return e[Ks]=!1,e.concat()[0]!==e})),qs=Ys("concat"),Xs=function(e){if(!js(e))return!1;var t=e[Ks];return void 0!==t?!!t:Ds(e)};Hs({target:"Array",proto:!0,forced:!Vs||!qs},{concat:function(e){var t,n,r,o,i,a=Fs(this),c=Js(a,0),s=0;for(t=-1,r=arguments.length;t<r;t++)if(Xs(i=-1===t?a:arguments[t])){if(s+(o=Us(i))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<o;n++,s++)n in i&&Bs(c,s,i[n])}else{if(s>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Bs(c,s++,i)}return c.length=s,c}});var Ws=tt,Qs=function(){var e=Ws(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},Zs=Vt.PROPER,zs=lt.exports,$s=tt,eu=Ai,tu=h,nu=Qs,ru=RegExp.prototype,ou=ru.toString,iu=tu((function(){return"/a/b"!=ou.call({source:"a",flags:"b"})})),au=Zs&&"toString"!=ou.name;(iu||au)&&zs(RegExp.prototype,"toString",(function(){var e=$s(this),t=eu(e.source),n=e.flags;return"/"+t+"/"+eu(void 0===n&&e instanceof RegExp&&!("flags"in ru)?nu.call(e):n)}),{unsafe:!0});var cu,su,uu,lu,du=d.Promise,fu=D,hu=$e,pu=p,vu=Le("species"),yu=function(e){var t=fu(e),n=hu.f;pu&&t&&!t[vu]&&n(t,vu,{configurable:!0,get:function(){return this}})},Su=tt,mu=_r,gu=Le("species"),Nu=function(e,t){var n,r=Su(e).constructor;return void 0===r||null==(n=Su(r)[gu])?t:mu(n)},bu=/(?:ipad|iphone|ipod).*applewebkit/i.test(j),Tu="process"==E(d.process),Eu=d,wu=L,_u=h,Ou=Na,Iu=kr,Ru=Je,Cu=bu,xu=Tu,Lu=Eu.setImmediate,Mu=Eu.clearImmediate,ku=Eu.process,Au=Eu.MessageChannel,Hu=Eu.Dispatch,Pu=0,Du={};try{cu=Eu.location}catch(e){}var ju=function(e){if(Du.hasOwnProperty(e)){var t=Du[e];delete Du[e],t()}},Fu=function(e){return function(){ju(e)}},Uu=function(e){ju(e.data)},Bu=function(e){Eu.postMessage(String(e),cu.protocol+"//"+cu.host)};Lu&&Mu||(Lu=function(e){for(var t=[],n=arguments.length,r=1;n>r;)t.push(arguments[r++]);return Du[++Pu]=function(){(wu(e)?e:Function(e)).apply(void 0,t)},su(Pu),Pu},Mu=function(e){delete Du[e]},xu?su=function(e){ku.nextTick(Fu(e))}:Hu&&Hu.now?su=function(e){Hu.now(Fu(e))}:Au&&!Cu?(lu=(uu=new Au).port2,uu.port1.onmessage=Uu,su=Ou(lu.postMessage,lu,1)):Eu.addEventListener&&wu(Eu.postMessage)&&!Eu.importScripts&&cu&&"file:"!==cu.protocol&&!_u(Bu)?(su=Bu,Eu.addEventListener("message",Uu,!1)):su="onreadystatechange"in Ru("script")?function(e){Iu.appendChild(Ru("script")).onreadystatechange=function(){Iu.removeChild(this),ju(e)}}:function(e){setTimeout(Fu(e),0)});var Ju,Yu,Gu,Ku,Vu,qu,Xu,Wu,Qu={set:Lu,clear:Mu},Zu=d,zu=/ipad|iphone|ipod/i.test(j)&&void 0!==Zu.Pebble,$u=/web0s(?!.*chrome)/i.test(j),el=d,tl=f.f,nl=Qu.set,rl=bu,ol=zu,il=$u,al=Tu,cl=el.MutationObserver||el.WebKitMutationObserver,sl=el.document,ul=el.process,ll=el.Promise,dl=tl(el,"queueMicrotask"),fl=dl&&dl.value;fl||(Ju=function(){var e,t;for(al&&(e=ul.domain)&&e.exit();Yu;){t=Yu.fn,Yu=Yu.next;try{t()}catch(e){throw Yu?Ku():Gu=void 0,e}}Gu=void 0,e&&e.enter()},rl||al||il||!cl||!sl?!ol&&ll&&ll.resolve?((Xu=ll.resolve(void 0)).constructor=ll,Wu=Xu.then,Ku=function(){Wu.call(Xu,Ju)}):Ku=al?function(){ul.nextTick(Ju)}:function(){nl.call(el,Ju)}:(Vu=!0,qu=sl.createTextNode(""),new cl(Ju).observe(qu,{characterData:!0}),Ku=function(){qu.data=Vu=!Vu}));var hl=fl||function(e){var t={fn:e,next:void 0};Gu&&(Gu.next=t),Yu||(Yu=t,Ku()),Gu=t},pl={},vl=re,yl=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=vl(t),this.reject=vl(n)};pl.f=function(e){return new yl(e)};var Sl,ml,gl,Nl,bl=tt,Tl=k,El=pl,wl=function(e,t){if(bl(e),Tl(t)&&t.constructor===e)return t;var n=El.f(e);return(0,n.resolve)(t),n.promise},_l=d,Ol="object"==typeof window,Il=nr,Rl=d,Cl=D,xl=du,Ll=lt.exports,Ml=qi,kl=ni,Al=Vo,Hl=yu,Pl=re,Dl=L,jl=k,Fl=Ja,Ul=St,Bl=Ba,Jl=qa,Yl=Nu,Gl=Qu.set,Kl=hl,Vl=wl,ql=pl,Xl=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Wl=Ut,Ql=Xn,Zl=Ol,zl=Tu,$l=K,ed=Le("species"),td="Promise",nd=Wl.get,rd=Wl.set,od=Wl.getterFor(td),id=xl&&xl.prototype,ad=xl,cd=id,sd=Rl.TypeError,ud=Rl.document,ld=Rl.process,dd=ql.f,fd=dd,hd=!!(ud&&ud.createEvent&&Rl.dispatchEvent),pd=Dl(Rl.PromiseRejectionEvent),vd=!1,yd=Ql(td,(function(){var e=Ul(ad),t=e!==String(ad);if(!t&&66===$l)return!0;if($l>=51&&/native code/.test(e))return!1;var n=new ad((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[ed]=r,!(vd=n.then((function(){}))instanceof r)||!t&&Zl&&!pd})),Sd=yd||!Jl((function(e){ad.all(e).catch((function(){}))})),md=function(e){var t;return!(!jl(e)||!Dl(t=e.then))&&t},gd=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;Kl((function(){for(var r=e.value,o=1==e.state,i=0;n.length>i;){var a,c,s,u=n[i++],l=o?u.ok:u.fail,d=u.resolve,f=u.reject,h=u.domain;try{l?(o||(2===e.rejection&&Ed(e),e.rejection=1),!0===l?a=r:(h&&h.enter(),a=l(r),h&&(h.exit(),s=!0)),a===u.promise?f(sd("Promise-chain cycle")):(c=md(a))?c.call(a,d,f):d(a)):f(r)}catch(e){h&&!s&&h.exit(),f(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&bd(e)}))}},Nd=function(e,t,n){var r,o;hd?((r=ud.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Rl.dispatchEvent(r)):r={promise:t,reason:n},!pd&&(o=Rl["on"+e])?o(r):"unhandledrejection"===e&&function(e,t){var n=_l.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)},bd=function(e){Gl.call(Rl,(function(){var t,n=e.facade,r=e.value;if(Td(e)&&(t=Xl((function(){zl?ld.emit("unhandledRejection",r,n):Nd("unhandledrejection",n,r)})),e.rejection=zl||Td(e)?2:1,t.error))throw t.value}))},Td=function(e){return 1!==e.rejection&&!e.parent},Ed=function(e){Gl.call(Rl,(function(){var t=e.facade;zl?ld.emit("rejectionHandled",t):Nd("rejectionhandled",t,e.value)}))},wd=function(e,t,n){return function(r){e(t,r,n)}},_d=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,gd(e,!0))},Od=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw sd("Promise can't be resolved itself");var r=md(t);r?Kl((function(){var n={done:!1};try{r.call(t,wd(Od,n,e),wd(_d,n,e))}catch(t){_d(n,t,e)}})):(e.value=t,e.state=1,gd(e,!1))}catch(t){_d({done:!1},t,e)}}};if(yd&&(cd=(ad=function(e){Fl(this,ad,td),Pl(e),Sl.call(this);var t=nd(this);try{e(wd(Od,t),wd(_d,t))}catch(e){_d(t,e)}}).prototype,(Sl=function(e){rd(this,{type:td,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=Ml(cd,{then:function(e,t){var n=od(this),r=dd(Yl(this,ad));return r.ok=!Dl(e)||e,r.fail=Dl(t)&&t,r.domain=zl?ld.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&gd(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),ml=function(){var e=new Sl,t=nd(e);this.promise=e,this.resolve=wd(Od,t),this.reject=wd(_d,t)},ql.f=dd=function(e){return e===ad||e===gl?new ml(e):fd(e)},Dl(xl)&&id!==Object.prototype)){Nl=id.then,vd||(Ll(id,"then",(function(e,t){var n=this;return new ad((function(e,t){Nl.call(n,e,t)})).then(e,t)}),{unsafe:!0}),Ll(id,"catch",cd.catch,{unsafe:!0}));try{delete id.constructor}catch(e){}kl&&kl(id,cd)}Il({global:!0,wrap:!0,forced:yd},{Promise:ad}),Al(ad,td,!1),Hl(td),gl=Cl(td),Il({target:td,stat:!0,forced:yd},{reject:function(e){var t=dd(this);return t.reject.call(void 0,e),t.promise}}),Il({target:td,stat:!0,forced:yd},{resolve:function(e){return Vl(this,e)}}),Il({target:td,stat:!0,forced:Sd},{all:function(e){var t=this,n=dd(t),r=n.resolve,o=n.reject,i=Xl((function(){var n=Pl(t.resolve),i=[],a=0,c=1;Bl(e,(function(e){var s=a++,u=!1;i.push(void 0),c++,n.call(t,e).then((function(e){u||(u=!0,i[s]=e,--c||r(i))}),o)})),--c||r(i)}));return i.error&&o(i.value),n.promise},race:function(e){var t=this,n=dd(t),r=n.reject,o=Xl((function(){var o=Pl(t.resolve);Bl(e,(function(e){o.call(t,e).then(n.resolve,r)}))}));return o.error&&r(o.value),n.promise}});var Id={},Rd=h,Cd=d.RegExp;Id.UNSUPPORTED_Y=Rd((function(){var e=Cd("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),Id.BROKEN_CARET=Rd((function(){var e=Cd("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));var xd=h,Ld=d.RegExp,Md=xd((function(){var e=Ld(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),kd=h,Ad=d.RegExp,Hd=kd((function(){var e=Ad("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),Pd=Ai,Dd=Qs,jd=Id,Fd=se.exports,Ud=Kr,Bd=Ut.get,Jd=Md,Yd=Hd,Gd=RegExp.prototype.exec,Kd=Fd("native-string-replace",String.prototype.replace),Vd=Gd,qd=function(){var e=/a/,t=/b*/g;return Gd.call(e,"a"),Gd.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),Xd=jd.UNSUPPORTED_Y||jd.BROKEN_CARET,Wd=void 0!==/()??/.exec("")[1];(qd||Wd||Xd||Jd||Yd)&&(Vd=function(e){var t,n,r,o,i,a,c,s=this,u=Bd(s),l=Pd(e),d=u.raw;if(d)return d.lastIndex=s.lastIndex,t=Vd.call(d,l),s.lastIndex=d.lastIndex,t;var f=u.groups,h=Xd&&s.sticky,p=Dd.call(s),v=s.source,y=0,S=l;if(h&&(-1===(p=p.replace("y","")).indexOf("g")&&(p+="g"),S=l.slice(s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\n"!==l.charAt(s.lastIndex-1))&&(v="(?: "+v+")",S=" "+S,y++),n=new RegExp("^(?:"+v+")",p)),Wd&&(n=new RegExp("^"+v+"$(?!\\s)",p)),qd&&(r=s.lastIndex),o=Gd.call(h?n:s,S),h?o?(o.input=o.input.slice(y),o[0]=o[0].slice(y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:qd&&o&&(s.lastIndex=s.global?o.index+o[0].length:r),Wd&&o&&o.length>1&&Kd.call(o[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&f)for(o.groups=a=Ud(null),i=0;i<f.length;i++)a[(c=f[i])[0]]=o[c[1]];return o});var Qd=Vd;nr({target:"RegExp",proto:!0,forced:/./.exec!==Qd},{exec:Qd});var Zd=lt.exports,zd=Qd,$d=h,ef=Le,tf=ut,nf=ef("species"),rf=RegExp.prototype,of=function(e,t,n,r){var o=ef(e),i=!$d((function(){var t={};return t[o]=function(){return 7},7!=""[e](t)})),a=i&&!$d((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[nf]=function(){return n},n.flags="",n[o]=/./[o]),n.exec=function(){return t=!0,null},n[o](""),!t}));if(!i||!a||n){var c=/./[o],s=t(o,""[e],(function(e,t,n,r,o){var a=t.exec;return a===zd||a===rf.exec?i&&!o?{done:!0,value:c.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}));Zd(String.prototype,e,s[0]),Zd(rf,o,s[1])}r&&tf(rf[o],"sham",!0)},af=Fi.charAt,cf=function(e,t,n){return t+(n?af(e,t).length:1)},sf=ve,uf=Math.floor,lf="".replace,df=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,ff=/\$([$&'`]|\d{1,2})/g,hf=tt,pf=L,vf=E,yf=Qd,Sf=function(e,t){var n=e.exec;if(pf(n)){var r=n.call(e,t);return null!==r&&hf(r),r}if("RegExp"===vf(e))return yf.call(e,t);throw TypeError("RegExp#exec called on incompatible receiver")},mf=of,gf=h,Nf=tt,bf=L,Tf=cn,Ef=pn,wf=Ai,_f=I,Of=cf,If=ie,Rf=function(e,t,n,r,o,i){var a=n+e.length,c=r.length,s=ff;return void 0!==o&&(o=sf(o),s=df),lf.call(i,s,(function(i,s){var u;switch(s.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(a);case"<":u=o[s.slice(1,-1)];break;default:var l=+s;if(0===l)return i;if(l>c){var d=uf(l/10);return 0===d?i:d<=c?void 0===r[d-1]?s.charAt(1):r[d-1]+s.charAt(1):i}u=r[l-1]}return void 0===u?"":u}))},Cf=Sf,xf=Le("replace"),Lf=Math.max,Mf=Math.min,kf="$0"==="a".replace(/./,"$0"),Af=!!/./[xf]&&""===/./[xf]("a","$0");mf("replace",(function(e,t,n){var r=Af?"$":"$0";return[function(e,n){var r=_f(this),o=null==e?void 0:If(e,xf);return o?o.call(e,r,n):t.call(wf(r),e,n)},function(e,o){var i=Nf(this),a=wf(e);if("string"==typeof o&&-1===o.indexOf(r)&&-1===o.indexOf("$<")){var c=n(t,i,a,o);if(c.done)return c.value}var s=bf(o);s||(o=wf(o));var u=i.global;if(u){var l=i.unicode;i.lastIndex=0}for(var d=[];;){var f=Cf(i,a);if(null===f)break;if(d.push(f),!u)break;""===wf(f[0])&&(i.lastIndex=Of(a,Ef(i.lastIndex),l))}for(var h,p="",v=0,y=0;y<d.length;y++){f=d[y];for(var S=wf(f[0]),m=Lf(Mf(Tf(f.index),a.length),0),g=[],N=1;N<f.length;N++)g.push(void 0===(h=f[N])?h:String(h));var b=f.groups;if(s){var T=[S].concat(g,m,a);void 0!==b&&T.push(b);var E=wf(o.apply(void 0,T))}else E=Rf(S,a,m,g,b,o);m>=v&&(p+=a.slice(v,m)+E,v=m+S.length)}return p+a.slice(v)}]}),!!gf((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!kf||Af);var Hf=nr,Pf=du,Df=h,jf=D,Ff=L,Uf=Nu,Bf=wl,Jf=lt.exports;if(Hf({target:"Promise",proto:!0,real:!0,forced:!!Pf&&Df((function(){Pf.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=Uf(this,jf("Promise")),n=Ff(e);return this.then(n?function(n){return Bf(t,e()).then((function(){return n}))}:e,n?function(n){return Bf(t,e()).then((function(){throw n}))}:e)}}),Ff(Pf)){var Yf=jf("Promise").prototype.finally;Pf.prototype.finally!==Yf&&Jf(Pf.prototype,"finally",Yf,{unsafe:!0})}var Gf=ve,Kf=Rr;nr({target:"Object",stat:!0,forced:h((function(){Kf(1)}))},{keys:function(e){return Kf(Gf(e))}});var Vf={},qf=Le;Vf.f=qf;var Xf=d,Wf=me,Qf=Vf,Zf=$e.f,zf=function(e){var t=Xf.Symbol||(Xf.Symbol={});Wf(t,e)||Zf(t,e,{value:Qf.f(e)})},$f=nr,eh=d,th=D,nh=p,rh=X,oh=h,ih=me,ah=hc,ch=L,sh=k,uh=z,lh=tt,dh=ve,fh=x,hh=je,ph=Ai,vh=b,yh=Kr,Sh=Rr,mh=rn,gh=Wi,Nh=xn,bh=f,Th=$e,Eh=v,wh=lt.exports,_h=se.exports,Oh=Ot,Ih=be,Rh=Le,Ch=Vf,xh=zf,Lh=Vo,Mh=Ut,kh=Oc.forEach,Ah=_t("hidden"),Hh=Rh("toPrimitive"),Ph=Mh.set,Dh=Mh.getterFor("Symbol"),jh=Object.prototype,Fh=eh.Symbol,Uh=th("JSON","stringify"),Bh=bh.f,Jh=Th.f,Yh=gh.f,Gh=Eh.f,Kh=_h("symbols"),Vh=_h("op-symbols"),qh=_h("string-to-symbol-registry"),Xh=_h("symbol-to-string-registry"),Wh=_h("wks"),Qh=eh.QObject,Zh=!Qh||!Qh.prototype||!Qh.prototype.findChild,zh=nh&&oh((function(){return 7!=yh(Jh({},"a",{get:function(){return Jh(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=Bh(jh,t);r&&delete jh[t],Jh(e,t,n),r&&e!==jh&&Jh(jh,t,r)}:Jh,$h=function(e,t){var n=Kh[e]=yh(Fh.prototype);return Ph(n,{type:"Symbol",tag:e,description:t}),nh||(n.description=t),n},ep=function(e,t,n){e===jh&&ep(Vh,t,n),lh(e);var r=hh(t);return lh(n),ih(Kh,r)?(n.enumerable?(ih(e,Ah)&&e[Ah][r]&&(e[Ah][r]=!1),n=yh(n,{enumerable:vh(0,!1)})):(ih(e,Ah)||Jh(e,Ah,vh(1,{})),e[Ah][r]=!0),zh(e,r,n)):Jh(e,r,n)},tp=function(e,t){lh(e);var n=fh(t),r=Sh(n).concat(ip(n));return kh(r,(function(t){nh&&!np.call(n,t)||ep(e,t,n[t])})),e},np=function(e){var t=hh(e),n=Gh.call(this,t);return!(this===jh&&ih(Kh,t)&&!ih(Vh,t))&&(!(n||!ih(this,t)||!ih(Kh,t)||ih(this,Ah)&&this[Ah][t])||n)},rp=function(e,t){var n=fh(e),r=hh(t);if(n!==jh||!ih(Kh,r)||ih(Vh,r)){var o=Bh(n,r);return!o||!ih(Kh,r)||ih(n,Ah)&&n[Ah][r]||(o.enumerable=!0),o}},op=function(e){var t=Yh(fh(e)),n=[];return kh(t,(function(e){ih(Kh,e)||ih(Oh,e)||n.push(e)})),n},ip=function(e){var t=e===jh,n=Yh(t?Vh:fh(e)),r=[];return kh(n,(function(e){!ih(Kh,e)||t&&!ih(jh,e)||r.push(Kh[e])})),r};if(rh||(wh((Fh=function(){if(this instanceof Fh)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?ph(arguments[0]):void 0,t=Ih(e),n=function(e){this===jh&&n.call(Vh,e),ih(this,Ah)&&ih(this[Ah],t)&&(this[Ah][t]=!1),zh(this,t,vh(1,e))};return nh&&Zh&&zh(jh,t,{configurable:!0,set:n}),$h(t,e)}).prototype,"toString",(function(){return Dh(this).tag})),wh(Fh,"withoutSetter",(function(e){return $h(Ih(e),e)})),Eh.f=np,Th.f=ep,bh.f=rp,mh.f=gh.f=op,Nh.f=ip,Ch.f=function(e){return $h(Rh(e),e)},nh&&(Jh(Fh.prototype,"description",{configurable:!0,get:function(){return Dh(this).description}}),wh(jh,"propertyIsEnumerable",np,{unsafe:!0}))),$f({global:!0,wrap:!0,forced:!rh,sham:!rh},{Symbol:Fh}),kh(Sh(Wh),(function(e){xh(e)})),$f({target:"Symbol",stat:!0,forced:!rh},{for:function(e){var t=ph(e);if(ih(qh,t))return qh[t];var n=Fh(t);return qh[t]=n,Xh[n]=t,n},keyFor:function(e){if(!uh(e))throw TypeError(e+" is not a symbol");if(ih(Xh,e))return Xh[e]},useSetter:function(){Zh=!0},useSimple:function(){Zh=!1}}),$f({target:"Object",stat:!0,forced:!rh,sham:!nh},{create:function(e,t){return void 0===t?yh(e):tp(yh(e),t)},defineProperty:ep,defineProperties:tp,getOwnPropertyDescriptor:rp}),$f({target:"Object",stat:!0,forced:!rh},{getOwnPropertyNames:op,getOwnPropertySymbols:ip}),$f({target:"Object",stat:!0,forced:oh((function(){Nh.f(1)}))},{getOwnPropertySymbols:function(e){return Nh.f(dh(e))}}),Uh&&$f({target:"JSON",stat:!0,forced:!rh||oh((function(){var e=Fh();return"[null]"!=Uh([e])||"{}"!=Uh({a:e})||"{}"!=Uh(Object(e))}))},{stringify:function(e,t,n){for(var r,o=[e],i=1;arguments.length>i;)o.push(arguments[i++]);if(r=t,(sh(t)||void 0!==e)&&!uh(e))return ah(t)||(t=function(e,t){if(ch(r)&&(t=r.call(this,e,t)),!uh(t))return t}),o[1]=t,Uh.apply(null,o)}}),!Fh.prototype[Hh]){var ap=Fh.prototype.valueOf;wh(Fh.prototype,Hh,(function(){return ap.apply(this,arguments)}))}Lh(Fh,"Symbol"),Oh[Ah]=!0;var cp=Oc.filter;nr({target:"Array",proto:!0,forced:!As("filter")},{filter:function(e){return cp(this,e,arguments.length>1?arguments[1]:void 0)}});var sp=nr,up=h,lp=x,dp=f.f,fp=p,hp=up((function(){dp(1)}));sp({target:"Object",stat:!0,forced:!fp||hp,sham:!fp},{getOwnPropertyDescriptor:function(e,t){return dp(lp(e),t)}});var pp=h,vp=function(e,t){var n=[][e];return!!n&&pp((function(){n.call(null,t||function(){throw 1},1)}))},yp=Oc.forEach,Sp=d,mp=cs,gp=ls,Np=vp("forEach")?[].forEach:function(e){return yp(this,e,arguments.length>1?arguments[1]:void 0)},bp=ut,Tp=function(e){if(e&&e.forEach!==Np)try{bp(e,"forEach",Np)}catch(t){e.forEach=Np}};for(var Ep in mp)mp[Ep]&&Tp(Sp[Ep]&&Sp[Ep].prototype);Tp(gp);var wp=An,_p=x,Op=f,Ip=xs;function Rp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Cp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rp(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rp(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}nr({target:"Object",stat:!0,sham:!p},{getOwnPropertyDescriptors:function(e){for(var t,n,r=_p(e),o=Op.f,i=wp(r),a={},c=0;i.length>c;)void 0!==(n=o(r,t=i[c++]))&&Ip(a,t,n);return a}});var xp=new WeakMap,Lp=function(){function t(){e(this,t),function(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}(this,xp,{writable:!0,value:[]})}return n(t,[{key:"bindListener",value:function(e,t,n,r){So(this,xp,mo(this,xp)||[]);var o=function(e,o,i){return n.call(t,e,o,i,r)};return mo(this,xp)[e]?mo(this,xp)[e].push(o)-1:(mo(this,xp)[e]=[o],0)}},{key:"addListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};So(this,xp,mo(this,xp)||[]);var r=function(e,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t(Cp(Cp({context:e,eventName:r},o),n))};return mo(this,xp)[e]?mo(this,xp)[e].push(r)-1:(mo(this,xp)[e]=[r],0)}},{key:"removeListener",value:function(e,t){mo(this,xp)[e]&&mo(this,xp)[e][t]?delete mo(this,xp)[e][t]:console.log("trying to remove non-existent event handler, event = "+e+" handle = "+t)}},{key:"destructor",value:function(){So(this,xp,null)}},{key:"fireEvent",value:function(e,n){if(mo(this,xp))for(var r in mo(this,xp)[e])if(mo(this,xp)[e].hasOwnProperty(r)&&mo(this,xp)[e][r](this,e,arguments[1])===t.STOP_PROPAGATION)break}}]),t}();r(Lp,"STOP_PROPAGATION","STOP_PROPAGATION");var Mp=function e(t,n,r){function o(a,c){if(!n[a]){if(!t[a]){if(!c&&u)return u(a);if(i)return i(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var l=n[a]={exports:{}};t[a][0].call(l.exports,(function(e){return o(t[a][1][e]||e)}),l,l.exports,e,t,n,r)}return n[a].exports}for(var i=u,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){(function(e){var n,r,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var i=0,a=new o(l),c=e.document.createTextNode("");a.observe(c,{characterData:!0}),n=function(){c.data=i=++i%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)};else{var s=new e.MessageChannel;s.port1.onmessage=l,n=function(){s.port2.postMessage(0)}}var u=[];function l(){var e,t;r=!0;for(var n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}r=!1}t.exports=function(e){1!==u.push(e)||r||n()}}).call(this,void 0!==s?s:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var r=e(1);function o(){}var i={},a=["REJECTED"],c=["FULFILLED"],s=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,e!==o&&h(this,e)}function l(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return i.reject(e,t)}r===e?i.reject(e,new TypeError("Cannot resolve promise with itself")):i.resolve(e,r)}))}function f(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function h(e,t){var n=!1;function r(t){n||(n=!0,i.reject(e,t))}function o(t){n||(n=!0,i.resolve(e,t))}var a=p((function(){t(o,r)}));"error"===a.status&&r(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=u,u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===c||"function"!=typeof t&&this.state===a)return this;var n=new this.constructor(o);return this.state!==s?d(n,this.state===c?e:t,this.outcome):this.queue.push(new l(n,e,t)),n},l.prototype.callFulfilled=function(e){i.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){i.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},i.resolve=function(e,t){var n=p(f,t);if("error"===n.status)return i.reject(e,n.value);var r=n.value;if(r)h(e,r);else{e.state=c,e.outcome=t;for(var o=-1,a=e.queue.length;++o<a;)e.queue[o].callFulfilled(t)}return e},i.reject=function(e,t){e.state=a,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},u.resolve=function(e){return e instanceof this?e:i.resolve(new this(o),e)},u.reject=function(e){var t=new this(o);return i.reject(t,e)},u.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a=new Array(n),c=0,s=-1,u=new this(o);++s<n;)l(e[s],s);return u;function l(e,o){t.resolve(e).then((function(e){a[o]=e,++c!==n||r||(r=!0,i.resolve(u,a))}),(function(e){r||(r=!0,i.reject(u,e))}))}},u.race=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var t=e.length,n=!1;if(!t)return this.resolve([]);for(var r,a=-1,c=new this(o);++a<t;)r=e[a],this.resolve(r).then((function(e){n||(n=!0,i.resolve(c,e))}),(function(e){n||(n=!0,i.reject(c,e))}));return c}},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==s?s:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function i(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var a=Promise;function c(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function s(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function u(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function l(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var d=void 0,f={},h=Object.prototype.toString;function p(e){return"boolean"==typeof d?a.resolve(d):function(e){return new a((function(t){var n=e.transaction("local-forage-detect-blob-support","readwrite"),r=i([""]);n.objectStore("local-forage-detect-blob-support").put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return d=e}))}function v(e){var t=f[e.name],n={};n.promise=new a((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function y(e){var t=f[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function S(e,t){var n=f[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function m(e,t){return new a((function(n,r){if(f[e.name]=f[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);v(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var a=o.open.apply(o,i);t&&(a.onupgradeneeded=function(t){var n=a.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore("local-forage-detect-blob-support")}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),r(a.error)},a.onsuccess=function(){var t=a.result;t.onversionchange=function(e){e.target.close()},n(t),y(e)}}))}function g(e){return m(e,!1)}function N(e){return m(e,!0)}function b(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,o=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||n){if(n){var i=e.db.version+1;i>e.version&&(e.version=i)}return!0}return!1}function T(e){return i([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),o=0;o<t;o++)r[o]=e.charCodeAt(o);return n}(atob(e.data))],{type:e.type})}function E(e){return e&&e.__local_forage_encoded_blob}function w(e){var t=this,n=t._initReady().then((function(){var e=f[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return s(n,e,e),n}function _(e,t,n,r){void 0===r&&(r=1);try{var o=e.db.transaction(e.storeName,t);n(null,o)}catch(o){if(r>0&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return a.resolve().then((function(){if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),N(e)})).then((function(){return function(e){v(e);for(var t=f[e.name],n=t.forages,r=0;r<n.length;r++){var o=n[r];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,g(e).then((function(t){return e.db=t,b(e)?N(e):t})).then((function(r){e.db=t.db=r;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=r})).catch((function(t){throw S(e,t),t}))}(e).then((function(){_(e,t,n,r-1)}))})).catch(n);n(o)}}var O={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var o=f[n.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},f[n.name]=o),o.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=w);var i=[];function c(){return a.resolve()}for(var s=0;s<o.forages.length;s++){var u=o.forages[s];u!==t&&i.push(u._initReady().catch(c))}var l=o.forages.slice(0);return a.all(i).then((function(){return n.db=o.db,g(n)})).then((function(e){return n.db=e,b(n,t._defaultConfig.version)?N(n):e})).then((function(e){n.db=o.db=e,t._dbInfo=n;for(var r=0;r<l.length;r++){var i=l[r];i!==t&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}}))},_support:function(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){_(n._dbInfo,"readonly",(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).openCursor(),c=1;a.onsuccess=function(){var n=a.result;if(n){var r=n.value;E(r)&&(r=T(r));var o=e(r,n.key,c++);void 0!==o?t(o):n.continue()}else t()},a.onerror=function(){r(a.error)}}catch(e){r(e)}}))})).catch(r)}));return c(r,t),r},getItem:function(e,t){var n=this;e=u(e);var r=new a((function(t,r){n.ready().then((function(){_(n._dbInfo,"readonly",(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),E(e)&&(e=T(e)),t(e)},a.onerror=function(){r(a.error)}}catch(e){r(e)}}))})).catch(r)}));return c(r,t),r},setItem:function(e,t,n){var r=this;e=u(e);var o=new a((function(n,o){var i;r.ready().then((function(){return i=r._dbInfo,"[object Blob]"===h.call(t)?p(i.db).then((function(e){return e?t:(n=t,new a((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){_(r._dbInfo,"readwrite",(function(i,a){if(i)return o(i);try{var c=a.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var s=c.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),n(t)},a.onabort=a.onerror=function(){var e=s.error?s.error:s.transaction.error;o(e)}}catch(e){o(e)}}))})).catch(o)}));return c(o,n),o},removeItem:function(e,t){var n=this;e=u(e);var r=new a((function(t,r){n.ready().then((function(){_(n._dbInfo,"readwrite",(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).delete(e);i.oncomplete=function(){t()},i.onerror=function(){r(a.error)},i.onabort=function(){var e=a.error?a.error:a.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return c(r,t),r},clear:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){_(t._dbInfo,"readwrite",(function(r,o){if(r)return n(r);try{var i=o.objectStore(t._dbInfo.storeName).clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){var e=i.error?i.error:i.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return c(n,e),n},length:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){_(t._dbInfo,"readonly",(function(r,o){if(r)return n(r);try{var i=o.objectStore(t._dbInfo.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){n(i.error)}}catch(e){n(e)}}))})).catch(n)}));return c(n,e),n},key:function(e,t){var n=this,r=new a((function(t,r){e<0?t(null):n.ready().then((function(){_(n._dbInfo,"readonly",(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName),c=!1,s=a.openKeyCursor();s.onsuccess=function(){var n=s.result;n?0===e||c?t(n.key):(c=!0,n.advance(e)):t(null)},s.onerror=function(){r(s.error)}}catch(e){r(e)}}))})).catch(r)}));return c(r,t),r},keys:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){_(t._dbInfo,"readonly",(function(r,o){if(r)return n(r);try{var i=o.objectStore(t._dbInfo.storeName).openKeyCursor(),a=[];i.onsuccess=function(){var t=i.result;t?(a.push(t.key),t.continue()):e(a)},i.onerror=function(){n(i.error)}}catch(e){n(e)}}))})).catch(n)}));return c(n,e),n},dropInstance:function(e,t){t=l.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;if(e.name){var s=e.name===n.name&&i._dbInfo.db,u=s?a.resolve(i._dbInfo.db):g(e).then((function(t){var n=f[e.name],r=n.forages;n.db=t;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=t;return t}));r=e.storeName?u.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;v(e);var r=f[e.name],i=r.forages;t.close();for(var c=0;c<i.length;c++){var s=i[c];s._dbInfo.db=null,s._dbInfo.version=n}return new a((function(t,r){var i=o.open(e.name,n);i.onerror=function(e){i.result.close(),r(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,y(n._dbInfo)}})).catch((function(t){throw(S(e,t)||a.resolve()).catch((function(){})),t}))}})):u.then((function(t){v(e);var n=f[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;return new a((function(t,n){var r=o.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)y(r[t]._dbInfo)})).catch((function(t){throw(S(e,t)||a.resolve()).catch((function(){})),t}))}))}else r=a.reject("Invalid arguments");return c(r,t),r}},I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",R=/^~~local_forage_type~([^~]+)~/,C="__lfsc__:".length,x=C+"arbf".length,L=Object.prototype.toString;function M(e){var t,n,r,o,i,a=.75*e.length,c=e.length,s=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),l=new Uint8Array(u);for(t=0;t<c;t+=4)n=I.indexOf(e[t]),r=I.indexOf(e[t+1]),o=I.indexOf(e[t+2]),i=I.indexOf(e[t+3]),l[s++]=n<<2|r>>4,l[s++]=(15&r)<<4|o>>2,l[s++]=(3&o)<<6|63&i;return u}function k(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=I[n[t]>>2],r+=I[(3&n[t])<<4|n[t+1]>>4],r+=I[(15&n[t+1])<<2|n[t+2]>>6],r+=I[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var A={serialize:function(e,t){var n="";if(e&&(n=L.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===L.call(e.buffer))){var r,o="__lfsc__:";e instanceof ArrayBuffer?(r=e,o+="arbf"):(r=e.buffer,"[object Int8Array]"===n?o+="si08":"[object Uint8Array]"===n?o+="ui08":"[object Uint8ClampedArray]"===n?o+="uic8":"[object Int16Array]"===n?o+="si16":"[object Uint16Array]"===n?o+="ur16":"[object Int32Array]"===n?o+="si32":"[object Uint32Array]"===n?o+="ui32":"[object Float32Array]"===n?o+="fl32":"[object Float64Array]"===n?o+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(o+k(r))}else if("[object Blob]"===n){var i=new FileReader;i.onload=function(){var n="~~local_forage_type~"+e.type+"~"+k(this.result);t("__lfsc__:blob"+n)},i.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if("__lfsc__:"!==e.substring(0,C))return JSON.parse(e);var t,n=e.substring(x),r=e.substring(C,x);if("blob"===r&&R.test(n)){var o=n.match(R);t=o[1],n=n.substring(o[0].length)}var a=M(n);switch(r){case"arbf":return a;case"blob":return i([a],{type:t});case"si08":return new Int8Array(a);case"ui08":return new Uint8Array(a);case"uic8":return new Uint8ClampedArray(a);case"si16":return new Int16Array(a);case"ur16":return new Uint16Array(a);case"si32":return new Int32Array(a);case"ui32":return new Uint32Array(a);case"fl32":return new Float32Array(a);case"fl64":return new Float64Array(a);default:throw new Error("Unkown type: "+r)}},stringToBuffer:M,bufferToString:k};function H(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function P(e,t,n,r,o,i){e.executeSql(n,r,o,(function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,c){c.rows.length?i(e,a):H(e,t,(function(){e.executeSql(n,r,o,i)}),i)}),i):i(e,a)}),i)}function D(e,t,n,r){var o=this;e=u(e);var i=new a((function(i,a){o.ready().then((function(){void 0===t&&(t=null);var c=t,s=o._dbInfo;s.serializer.serialize(t,(function(t,u){u?a(u):s.db.transaction((function(n){P(n,s,"INSERT OR REPLACE INTO "+s.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){i(c)}),(function(e,t){a(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void i(D.apply(o,[e,c,n,r-1]));a(t)}}))}))})).catch(a)}));return c(i,n),i}function j(e){return new a((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var o=[],i=0;i<r.rows.length;i++)o.push(r.rows.item(i).name);t({db:e,storeNames:o})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}var F={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var o=new a((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(o){H(o,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=A,o},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){P(n,o,"SELECT * FROM "+o.storeName,[],(function(n,r){for(var i=r.rows,a=i.length,c=0;c<a;c++){var s=i.item(c),u=s.value;if(u&&(u=o.serializer.deserialize(u)),void 0!==(u=e(u,s.key,c+1)))return void t(u)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return c(r,t),r},getItem:function(e,t){var n=this;e=u(e);var r=new a((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){P(n,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=o.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return c(r,t),r},setItem:function(e,t,n){return D.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=u(e);var r=new a((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){P(n,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return c(r,t),r},clear:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){P(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return c(n,e),n},length:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){P(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return c(n,e),n},key:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){P(n,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return c(r,t),r},keys:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){P(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return c(n,e),n},dropInstance:function(e,t){t=l.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,o=this;return c(r=e.name?new a((function(t){var r;r=e.name===n.name?o._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(j(r))})).then((function(e){return new a((function(t,n){e.db.transaction((function(r){function o(e){return new a((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var i=[],c=0,s=e.storeNames.length;c<s;c++)i.push(o(e.storeNames[c]));a.all(i).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):a.reject("Invalid arguments"),t),r}};function U(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}var B={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=U(e,this._defaultConfig),!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0?(this._dbInfo=t,t.serializer=A,a.resolve()):a.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,o=r.length,i=localStorage.length,a=1,c=0;c<i;c++){var s=localStorage.key(c);if(0===s.indexOf(r)){var u=localStorage.getItem(s);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,s.substring(o),a++)))return u}}}));return c(r,t),r},getItem:function(e,t){var n=this;e=u(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return c(r,t),r},setItem:function(e,t,n){var r=this;e=u(e);var o=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new a((function(o,i){var a=r._dbInfo;a.serializer.serialize(t,(function(t,r){if(r)i(r);else try{localStorage.setItem(a.keyPrefix+e,t),o(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||i(e),i(e)}}))}))}));return c(o,n),o},removeItem:function(e,t){var n=this;e=u(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return c(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return c(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return c(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return c(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],o=0;o<n;o++){var i=localStorage.key(o);0===i.indexOf(e.keyPrefix)&&r.push(i.substring(e.keyPrefix.length))}return r}));return c(n,e),n},dropInstance:function(e,t){if(t=l.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,o=this;return c(r=e.name?new a((function(t){e.storeName?t(U(e,o._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):a.reject("Invalid arguments"),t),r}},J=function(e,t){for(var n,r,o=e.length,i=0;i<o;){if((n=e[i])===(r=t)||"number"==typeof n&&"number"==typeof r&&isNaN(n)&&isNaN(r))return!0;i++}return!1},Y=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},G={},K={},V={INDEXEDDB:O,WEBSQL:F,LOCALSTORAGE:B},q=[V.INDEXEDDB._driver,V.WEBSQL._driver,V.LOCALSTORAGE._driver],X=["dropInstance"],W=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(X),Q={description:"",driver:q.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Z(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function z(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Y(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var $=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),V)if(V.hasOwnProperty(n)){var r=V[n],o=r._driver;this[n]=o,G[o]||this.defineDriver(r)}this._defaultConfig=z({},Q),this._config=z({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new a((function(t,n){try{var r=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(o);for(var i=W.concat("_initStorage"),s=0,u=i.length;s<u;s++){var l=i[s];if((!J(X,l)||e[l])&&"function"!=typeof e[l])return void n(o)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=a.reject(t);return c(n,arguments[arguments.length-1]),n}},n=0,r=X.length;n<r;n++){var o=X[n];e[o]||(e[o]=t(o))}}();var d=function(n){G[r]&&console.info("Redefining LocalForage driver: "+r),G[r]=e,K[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(d,n):d(!!e._support):d(!0)}catch(e){n(e)}}));return s(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=G[e]?a.resolve(G[e]):a.reject(new Error("Driver not found."));return s(r,t,n),r},e.prototype.getSerializer=function(e){var t=a.resolve(A);return s(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return s(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;Y(e)||(e=[e]);var o=this._getSupportedDrivers(e);function i(){r._config.driver=r.driver()}function c(e){return r._extend(e),i(),r._ready=r._initStorage(r._config),r._ready}var u=null!==this._driverSet?this._driverSet.catch((function(){return a.resolve()})):a.resolve();return this._driverSet=u.then((function(){var e=o[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,i(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var o=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(o).then(c).catch(n)}i();var s=new Error("No available storage method found.");return r._driverSet=a.reject(s),r._driverSet}()}}(o)}))})).catch((function(){i();var e=new Error("No available storage method found.");return r._driverSet=a.reject(e),r._driverSet})),s(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!K[e]},e.prototype._extend=function(e){z(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n];this.supports(o)&&t.push(o)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=W.length;e<t;e++)Z(this,W[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=$},{3:3}]},{},[4])(4);
/*!
        localForage -- Offline Storage, Improved
        Version 1.10.0
        https://localforage.github.io/localForage
        (c) 2013-2017 Mozilla, Apache License 2.0
    */function kp(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,kp)}var Ap=/^[a-fA-F0-9]{8}-(?:[a-fA-F0-9]{4}-){3}[a-fA-F0-9]{12}$/,Hp=function(t){fo(i,Lp);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(){var t;return e(this,i),r(uo(t=o.call(this)),"_id",void 0),r(uo(t),"_savedRemotely",!1),r(uo(t),"_savedLocally",!1),r(uo(t),"deleted",!1),r(uo(t),"createdStamp",void 0),r(uo(t),"modifiedStamp",void 0),r(uo(t),"projectId",void 0),r(uo(t),"isPristine",!1),t.createdStamp=Math.floor(Date.now()/1e3),t}return n(i,[{key:"unsaved",value:function(){return!(this._savedLocally&&this._savedRemotely)}},{key:"id",get:function(){return this._id||(this._id=kp()),this._id},set:function(e){if(this._id&&e!==this._id)throw new Error("Occurrence id has already been set, when trying to set new id '".concat(e,"'."));this._id=e}},{key:"queuePost",value:function(e){var t=this;return new Promise((function(n,r){var o=function(){return console.log({"posting form data":e}),t.post(e).then(n,r)};i._tasks.push(o),i._tasks.length>1?console.log("Added post request to the queue."):(console.log("No pending tasks, starting post request immediately."),o().finally(i._next))}))}},{key:"post",value:function(e){var t=this;return fetch(this.SAVE_ENDPOINT,{method:"POST",body:e}).then((function(e){return e.ok?e.clone().json().then((function(n){switch(console.log({"returned to client after save":n}),n.saveState){case"SAVED_TO_SERVER":t._savedLocally=!0,t._savedRemotely=!0;break;case"SAVED_LOCALLY":t._savedLocally=!0,t._savedRemotely=!1;break;default:console.log("Unrecognised save state '".concat(n.saveState,"'"))}return t.createdStamp=parseInt(n.created,10),t.modifiedStamp=parseInt(n.modified,10),e.json()})):(console.log("Save failed, presumably service worker is missing and there is no network connection. Should write to IndexedDb here."),Promise.reject("IndexedDb storage not yet implemented"))}))}},{key:"_parseDescriptor",value:function(e){this._parseAttributes(e.attributes),this._parseSavedState(e.saveState),this.deleted=!0===e.deleted||"true"===e.deleted,this.createdStamp=parseInt(e.created,10),this.modifiedStamp=e.modified?parseInt(e.modified,10):0,this.projectId=parseInt(e.projectId,10)}},{key:"_parseAttributes",value:function(e){"string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)?(console.log("Attributes were spuriously represented as an array rather than as an empty object"),this.attributes={}):this.attributes=e}},{key:"_parseSavedState",value:function(e){switch(e){case"SAVED_LOCALLY":this._savedRemotely=!1,this._savedLocally=!0;break;case"SAVED_TO_SERVER":this._savedRemotely=!0,this._savedLocally=!0;break;default:throw new Error("Unrecognised saved state '".concat(e))}}},{key:"touch",value:function(){this.modifiedStamp=Math.floor(Date.now()/1e3),this.isPristine&&(this.isPristine=!1,this.createdStamp=this.modifiedStamp),this._savedLocally=!1,this._savedRemotely=!1}},{key:"evaluateCompletionStatus",value:function(e){var t={},n=!0;for(var r in e)if(e.hasOwnProperty(r)){var o=e[r];t[r]=o.validator?o.validator(r,o,this.attributes):o.field.isValid(r,o,this.attributes),null!==t[r]&&(n=n&&t[r])}return{requiredFieldsPresent:n,validity:t}}}],[{key:"_next",value:function(){if(i._tasks.shift(),i._tasks.length)return console.log("Running the next task."),i._tasks[0]().finally(i._next)}},{key:"retrieveFromLocal",value:function(e,t){return Mp.getItem("".concat(t.TYPE,".").concat(e)).then((function(n){return n?(t.id=e,t._parseDescriptor(n),t):Promise.reject("Failed to retrieve ".concat(t.TYPE,".").concat(e," locally"))}))}}]),i}();r(Hp,"_tasks",[]);var Pp=function(t){fo(r,ws(Error));var n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(r);function r(){return e(this,r),n.apply(this,arguments)}return r}();function Dp(e){try{var t=document.createElement("textarea");return t.innerHTML=e,t.innerHTML.replace(/"/g,"&quot;")}catch(t){var n=document.createElement("pre");return n.appendChild(document.createTextNode(e)),n.innerHTML.replace(/"/g,"&quot;")}}var jp=function(){function t(){e(this,t),r(this,"id",void 0),r(this,"nameString",""),r(this,"canonical",""),r(this,"hybridCanonical",""),r(this,"acceptedEntityId",""),r(this,"qualifier",""),r(this,"authority",""),r(this,"vernacular",""),r(this,"vernacularRoot",""),r(this,"used",void 0),r(this,"sortOrder",void 0),r(this,"parentIds",[])}return n(t,[{key:"formattedHTML",value:function(e){var n;return this.id!==this.acceptedEntityId&&(n=t.fromId(this.acceptedEntityId)),t.showVernacular?e?n?"<q><b>".concat(Dp(this.vernacular),'</b></q> <span class="italictaxon">').concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(Dp(this.authority),"</span>")+' = <span class="italictaxon">'.concat(n.nameString).concat(n.qualifier?" <b>".concat(n.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(Dp(n.authority),"</span>"):"<q><b>".concat(Dp(this.vernacular),'</b></q> <span class="italictaxon">').concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(Dp(this.authority),"</span>"):n?'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(this.authority,"</span>").concat(this.vernacular?" <q><b>".concat(Dp(this.vernacular),"</b></q>"):"",' = <span class="italictaxon">').concat(n.nameString).concat(n.qualifier?" <b>".concat(n.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(Dp(n.authority),"</span>"):'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(Dp(this.authority),"</span>").concat(this.vernacular?" <q><b>".concat(Dp(this.vernacular),"</b></q>"):""):n?'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(this.authority,"</span>")+' = <span class="italictaxon">'.concat(n.nameString).concat(n.qualifier?" <b>".concat(n.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(Dp(n.authority),"</span>"):'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(Dp(this.authority),"</span>")}}],[{key:"fromId",value:function(e){if(!t.rawTaxa){if(!BsbiDb.TaxonNames)throw new Pp("Taxon.fromId() called before taxon list has loaded.");t.rawTaxa=BsbiDb.TaxonNames}if(!t.rawTaxa.hasOwnProperty(e))throw new Pp("Taxon id '".concat(e,"' not found."));var n=t.rawTaxa[e],r=new t;return r.id=e,r.nameString=n[0],r.canonical=n[1]||n[0],r.hybridCanonical=n[2]||r.canonical,r.acceptedEntityId=n[3]||e,r.qualifier=n[4],r.authority=n[5],r.vernacular=n[6],r.vernacularRoot=n[7],r.used=n[8],r.sortOrder=n[9],r.parentIds=n[10],r}}]),t}();r(jp,"rawTaxa",BsbiDb.TaxonNames),r(jp,"showVernacular",!0);var Fp=I,Up=Ai,Bp="[\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff]",Jp=RegExp("^"+Bp+Bp+"*"),Yp=RegExp(Bp+Bp+"*$"),Gp=function(e){return function(t){var n=Up(Fp(t));return 1&e&&(n=n.replace(Jp,"")),2&e&&(n=n.replace(Yp,"")),n}},Kp={start:Gp(1),end:Gp(2),trim:Gp(3)},Vp=Vt.PROPER,qp=h,Xp="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",Wp=function(e){return qp((function(){return!!Xp[e]()||"âÂá "!=="âÂá "[e]()||Vp&&Xp[e].name!==e}))},Qp=Kp.trim;function Zp(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function zp(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}nr({target:"String",proto:!0,forced:Wp("trim")},{trim:function(){return Qp(this)}});var $p=function(t){fo(i,Lp);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(t){var n;return e(this,i),r(uo(n=o.call(this)),"_value",void 0),r(uo(n),"_fieldEl",void 0),r(uo(n),"label","field label"),r(uo(n),"helpText",""),r(uo(n),"validationMessage",""),r(uo(n),"completion",i.COMPLETION_OPTIONAL),r(uo(n),"parentForm",void 0),r(uo(n),"attributeName",void 0),t&&(t.label&&(n.label=t.label),t.helpText&&(n.helpText=t.helpText),t.validationMessage&&(n.validationMessage=t.validationMessage),t.completion&&(n.completion=t.completion)),n}return n(i,[{key:"value",get:function(){return this._value},set:function(e){}},{key:"fieldElement",get:function(){return this._fieldEl||this.buildField(),this._fieldEl}},{key:"addField",value:function(){this.parentForm.formElement.appendChild(this.fieldElement)}},{key:"markValidity",value:function(e){}}],[{key:"nextId",get:function(){var e,t,n;return"field".concat((function(e,t,n,r){zp(e,t),Zp(n,"set"),function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,n,r)}(i,i,ev,(n=ev,zp(t=i,i),Zp(n,"get"),1+(e=+function(e,t){return t.get?t.get.call(e):t.value}(t,n)))),e))}},{key:"cleanRawInput",value:function(e){return e.value.trim().replace(/\s\s+/g," ")}},{key:"cleanRawString",value:function(e){return e.trim().replace(/\s\s+/g," ")}},{key:"isEmpty",value:function(e){return""===e}},{key:"isValid",value:function(e,t,n){return!t.attributes.completion||t.attributes.completion!==i.COMPLETION_COMPULSORY&&t.attributes.completion!==i.COMPLETION_DESIRED?null:!(!n.hasOwnProperty(e)||t.field.isEmpty(n[e]))}},{key:"summarise",value:function(e,t,n){return!t.summary||t.summary.hasOwnProperty("summarise")&&!0!==t.summary.summarise?"":t.field.summariseImpl(e,t,n)}},{key:"summariseImpl",value:function(e,t,n){return""}}]),i}();r($p,"COMPLETION_COMPULSORY","compulsory"),r($p,"COMPLETION_DESIRED","desired"),r($p,"COMPLETION_OPTIONAL","optional");var ev={writable:!0,value:1};function tv(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function nv(e,t,n,r){return iv(e,t),ov(n,"set"),function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,n,r),r}function rv(e,t,n){return iv(e,t),ov(n,"get"),function(e,t){return t.get?t.get.call(e):t.value}(e,n)}function ov(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function iv(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}r($p,"EVENT_CHANGE","fieldChange");var av=new WeakMap,cv=function(t){fo(i,Lp);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(){var t;e(this,i);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return tv(uo(t=o.call.apply(o,[this].concat(a))),av,{writable:!0,value:void 0}),r(uo(t),"_formId",void 0),r(uo(t),"_formContentContainer",void 0),r(uo(t),"fields",void 0),r(uo(t),"liveValidation",!1),r(uo(t),"isValid",null),r(uo(t),"_formFieldsBuilt",!1),t}return n(i,[{key:"formElement",get:function(){var e,t=this;return mo(this,av)||(So(this,av,document.createElement("form")),mo(this,av).id=this._formId="form".concat((nv(i,i,sv,1+(e=+rv(i,i,sv))),e)),mo(this,av).noValidate=!0,this.liveValidation&&(mo(this,av).className="needs-validation"),this.buildContentContainer(mo(this,av)),mo(this,av).addEventListener("change",(function(e){t.changeHandler(e)}),{capture:!1})),mo(this,av)}},{key:"buildContentContainer",value:function(e){return this._formContentContainer=e,this._formContentContainer}},{key:"changeHandler",value:function(e){console.log({"form change event":e})}},{key:"destructor",value:function(){Os(vo(i.prototype),"destructor",this).call(this),So(this,av,null)}},{key:"buildFormFields",value:function(){for(var e in this.initialiseFormFields(),this.fields)if(this.fields.hasOwnProperty(e)){var t=this.fields[e];t.parentForm=this,t.attributeName=e,this._formContentContainer.appendChild(t.fieldElement),t.addListener($p.EVENT_CHANGE,this.changeHandler.bind(this))}this._formFieldsBuilt=!0}},{key:"conditionallyValidateForm",value:function(){this.liveValidation&&this.validateForm()}},{key:"validateForm",value:function(){this.liveValidation=!0,this.formElement.classList.add("needs-validation");var e=this.model.evaluateCompletionStatus(this.getFormSectionProperties());for(var t in this.fields)this.fields.hasOwnProperty(t)&&this.fields[t].markValidity(e.validity[t]);return this.isValid!==e.requiredFieldsPresent&&(this.isValid=e.requiredFieldsPresent,this.fireEvent(i.EVENT_VALIDATION_STATE_CHANGE,{isValid:this.isValid})),e.requiredFieldsPresent}},{key:"populateFormContent",value:function(){if(this._formFieldsBuilt){var e=this.model;for(var t in this.fields)this.fields.hasOwnProperty(t)&&(this.fields[t].value=e.attributes[t]);this.conditionallyValidateForm()}}}],[{key:"nextId",get:function(){var e;return"id".concat((nv(i,i,uv,1+(e=+rv(i,i,uv))),e))}}]),i}();r(cv,"CHANGE_EVENT","change");var sv={writable:!0,value:0};r(cv,"EVENT_VALIDATION_STATE_CHANGE","validationstatechange");var uv={writable:!0,value:0};r(cv,"COMPLETION_STATUS_UNSTARTED","unstarted"),r(cv,"COMPLETION_STATUS_COMPLETE","complete"),r(cv,"COMPLETION_STATUS_IN_PROGRESS","inProgress");var lv=function(t){fo(i,Hp);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(){var t;e(this,i);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return r(uo(t=o.call.apply(o,[this].concat(a))),"attributes",{}),r(uo(t),"_savedRemotely",!1),r(uo(t),"_savedLocally",!1),r(uo(t),"SAVE_ENDPOINT","/saveoccurrence.php"),r(uo(t),"TYPE","occurrence"),r(uo(t),"isNew",!1),t}return n(i,[{key:"taxon",get:function(){return this.attributes.taxon&&this.attributes.taxon.taxonId?jp.fromId(this.attributes.taxon.taxonId):null}},{key:"setForm",value:function(e){return this.isNew||(e.liveValidation=!0),e.addListener(cv.CHANGE_EVENT,this.formChangedHandler.bind(this)),e}},{key:"formChangedHandler",value:function(e){console.log("Occurrence change handler invoked."),e.form.updateModelFromContent(),e.form.conditionallyValidateForm(),this.touch(),this.fireEvent(i.EVENT_MODIFIED,{occurrenceId:this.id})}},{key:"delete",value:function(){this.deleted||(this.touch(),this.deleted=!0,this.fireEvent(i.EVENT_MODIFIED,{occurrenceId:this.id}))}},{key:"save",value:function(e){if(this._savedRemotely)return Promise.reject("".concat(this.id," has already been saved."));var t=new FormData;return!e&&this.surveyId&&(e=this.surveyId),t.append("type",this.TYPE),t.append("surveyId",e),t.append("occurrenceId",this.id),t.append("id",this.id),t.append("projectId",this.projectId.toString()),t.append("attributes",JSON.stringify(this.attributes)),t.append("deleted",this.deleted.toString()),t.append("created",this.createdStamp.toString()),console.log("queueing occurrence post"),this.queuePost(t)}},{key:"_parseDescriptor",value:function(e){Os(vo(i.prototype),"_parseDescriptor",this).call(this,e),this.surveyId=e.surveyId}}]),i}();r(lv,"EVENT_MODIFIED","modified");var dv=function(t){fo(r,ws(Error));var n=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(r);function r(){return e(this,r),n.apply(this,arguments)}return r}();var fv=new WeakMap,hv=function(t){fo(i,a);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(t){var n;return e(this,i),r(uo(n=o.call(this)),"route","/list/:action/:id"),r(uo(n),"title","App homepage"),r(uo(n),"app",void 0),r(uo(n),"view",void 0),function(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}(uo(n),fv,{writable:!0,value:""}),r(uo(n),"needsFullRefresh",!0),r(uo(n),"needRightPanelRefresh",!0),r(uo(n),"viewSubcontext",""),r(uo(n),"surveySection",void 0),r(uo(n),"leftPanelBaseRoute",""),r(uo(n),"viewContexts",{record:function(e){this.surveySection=null,e?mo(this,fv)!==e.id?(this.needRightPanelRefresh=!0,this.currentOccurrenceId=e.id?e.id:""):this.needRightPanelRefresh=!1:(this.currentOccurrenceId="",this.needRightPanelRefresh=!0),this.leftPanelBaseRoute="/list/record"},survey:function(e){console.log("in survey section ".concat(e.section)),this.currentOccurrenceId="",this.needRightPanelRefresh=!0,this.surveySection=e.section,this.leftPanelBaseRoute="/list/survey/".concat(e.section)}}),n.view=t,t.controller=uo(n),n.handle=a.nextHandle,t.addListener(i.EVENT_SELECT_OCCURRENCE,n.occurrenceSelectionHandler.bind(uo(n))),t.addListener(i.EVENT_SELECT_SURVEY_SECTION,n.surveyPartSelectionHandler.bind(uo(n))),t.addListener(i.EVENT_NEW_RECORD,n.newRecordHandler.bind(uo(n))),t.addListener(i.EVENT_DELETE_OCCURRENCE,n.deleteOccurrenceHandler.bind(uo(n))),t.addListener(i.EVENT_BACK,n.backHandler.bind(uo(n))),t.addListener(i.EVENT_NEXT_TO_RECORDS,n.nextTransitionToRecordsHandler.bind(uo(n))),n}return n(i,[{key:"occurrences",get:function(){return this.app.occurrences}},{key:"currentOccurrence",get:function(){if(mo(this,fv)){if(this.app.occurrences.has(mo(this,fv)))return this.app.occurrences.get(mo(this,fv));throw new _s("Record id '".concat(mo(this,fv),"' was not found."))}return null}},{key:"currentOccurrenceId",get:function(){return mo(this,fv)},set:function(e){So(this,fv,e)}},{key:"survey",get:function(){return this.app.currentSurvey}},{key:"nextTransitionToRecordsHandler",value:function(){console.log("in nextTransitionToRecordsHandler()"),this.app.haveExtantOccurrences()?this.app.router.navigate("/list/record/"):this.newRecordHandler()}},{key:"deleteOccurrenceHandler",value:function(e){console.log({deleting:e.occurrenceId});var t=this.app.occurrences.get(e.occurrenceId);if(!t)throw new dv("Occurrence id '".concat(e.occurrenceId,"' not found when trying to delete."));t.delete(),this.currentOccurrenceId===e.occurrenceId&&this.app.router.navigate("/list/record/")}},{key:"surveyPartSelectionHandler",value:function(e){console.log({"In surveyPartSelectionHandler":e}),"record"===e.sectionKey?this.app.router.navigate("/list/record/"):e.sectionKey?this.app.router.navigate("/list/survey/".concat(e.sectionKey)):this.app.router.navigate("/list/")}},{key:"newRecordHandler",value:function(){var e=this.app.addNewOccurrence();this.app.router.navigate("/list/record/".concat(e.id))}},{key:"occurrenceSelectionHandler",value:function(e){console.log({"In occurrenceSelectionHandler":e}),this.currentOccurrenceId&&e.occurrenceId&&this.currentOccurrenceId===e.occurrenceId?console.log("ignoring spurious navigation event for '".concat(e.occurrenceId,"'")):this.app.router.navigate("/list/record/".concat(e.occurrenceId))}},{key:"registerRoute",value:function(e){e.on("/list",this.mainRouteHandler.bind(this,"list","",""),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/help",this.mainRouteHandler.bind(this,"list","","help")),e.on("/list/record/",this.mainRouteHandler.bind(this,"list","record",""),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/record/help",this.mainRouteHandler.bind(this,"list","record","help")),e.on("/list/record/:id",this.mainRouteHandler.bind(this,"list","record","form"),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/survey/:section",this.mainRouteHandler.bind(this,"list","survey",""),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/survey/:section/help",this.mainRouteHandler.bind(this,"list","survey","help"))}},{key:"mainRouteHandler",value:function(e,t,n,r){console.log("reached special route handler for MainController.js"),console.log({context:e,params:t,query:r}),this.app.saveRoute();try{this.viewSubcontext=t,t&&this.viewContexts[t].call(this,r),this.app.currentControllerHandle!==this.handle&&(this.needsFullRefresh=!0,this.needRightPanelRefresh=!0,this.app.currentControllerHandle=this.handle),this.view.panelKey=n,this.view.display(),this.needsFullRefresh=!1}catch(e){this.error=e,console.log({error:e});try{this.needsFullRefresh=!0,this.view.display()}catch(e){console.log({rethrownError:e}),document.body.innerHTML="<h2>Internal error</h2><p>Please report this problem:</p><p>".concat(e.message,"</p>")}}}},{key:"backHandler",value:function(){this.app.routeHistory.length>=2&&this.app.routeHistory[this.app.routeHistory.length-2].url===this.leftPanelBaseRoute?(this.app.routeHistory.length-=1,console.log("using standard back navigation"),window.history.back()):(console.log("navigating back using base address '".concat(this.leftPanelBaseRoute,"'")),this.app.router.navigate(this.leftPanelBaseRoute))}}]),i}();r(hv,"EVENT_SELECT_OCCURRENCE","selectoccurrence"),r(hv,"EVENT_SELECT_SURVEY_SECTION","selectsurveysection"),r(hv,"EVENT_NEW_RECORD","newrecord"),r(hv,"EVENT_DELETE_OCCURRENCE","deleteoccurrence"),r(hv,"EVENT_BACK","back"),r(hv,"EVENT_NEXT_TO_RECORDS","nexttorecords"),function(t){fo(i,a);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(t,n){var c;return e(this,i),r(uo(c=o.call(this)),"route",void 0),c.view=t,c.route=n,c.handle=a.nextHandle,c}n(i,[{key:"routeHandler",value:function(e,t){this.app.currentControllerHandle=this.handle,this.view.display()}}])}();var pv=tt,vv=pn,yv=Ai,Sv=I,mv=ie,gv=cf,Nv=Sf;of("match",(function(e,t,n){return[function(t){var n=Sv(this),r=null==t?void 0:mv(t,e);return r?r.call(t,n):new RegExp(t)[e](yv(n))},function(e){var r=pv(this),o=yv(e),i=n(t,r,o);if(i.done)return i.value;if(!r.global)return Nv(r,o);var a=r.unicode;r.lastIndex=0;for(var c,s=[],u=0;null!==(c=Nv(r,o));){var l=yv(c[0]);s[u]=l,""===l&&(r.lastIndex=gv(o,vv(r.lastIndex),a)),u++}return 0===u?null:s}]}));var bv=nr,Tv=hc,Ev=Tr,wv=k,_v=dn,Ov=yn,Iv=x,Rv=xs,Cv=Le,xv=As("slice"),Lv=Cv("species"),Mv=[].slice,kv=Math.max;bv({target:"Array",proto:!0,forced:!xv},{slice:function(e,t){var n,r,o,i=Iv(this),a=Ov(i),c=_v(e,a),s=_v(void 0===t?a:t,a);if(Tv(i)&&(n=i.constructor,(Ev(n)&&(n===Array||Tv(n.prototype))||wv(n)&&null===(n=n[Lv]))&&(n=void 0),n===Array||void 0===n))return Mv.call(i,c,s);for(r=new(void 0===n?Array:n)(kv(s-c,0)),o=0;c<s;c++,o++)c in i&&Rv(r,o,i[c]);return r.length=o,r}});var Av=p,Hv=Vt.EXISTS,Pv=$e.f,Dv=Function.prototype,jv=Dv.toString,Fv=/^\s*function ([^ (]*)/;Av&&!Hv&&Pv(Dv,"name",{configurable:!0,get:function(){try{return jv.call(this).match(Fv)[1]}catch(e){return""}}});var Uv=tt,Bv=Ma,Jv=Na,Yv=ve,Gv=function(e,t,n,r){try{return r?t(Uv(n)[0],n[1]):t(n)}catch(t){Bv(e,"throw",t)}},Kv=ma,Vv=Tr,qv=yn,Xv=xs,Wv=Ca,Qv=_a;nr({target:"Array",stat:!0,forced:!qa((function(e){Array.from(e)}))},{from:function(e){var t=Yv(e),n=Vv(this),r=arguments.length,o=r>1?arguments[1]:void 0,i=void 0!==o;i&&(o=Jv(o,r>2?arguments[2]:void 0,2));var a,c,s,u,l,d,f=Qv(t),h=0;if(!f||this==Array&&Kv(f))for(a=qv(t),c=n?new this(a):Array(a);a>h;h++)d=i?o(t[h],h):t[h],Xv(c,h,d);else for(l=(u=Wv(t,f)).next,c=n?new this:[];!(s=l.call(u)).done;h++)d=i?Gv(u,o,[s.value,h],!0):s.value,Xv(c,h,d);return c.length=h,c}});var Zv=nr,zv=p,$v=d,ey=me,ty=L,ny=k,ry=$e.f,oy=Fn,iy=$v.Symbol;if(zv&&ty(iy)&&(!("description"in iy.prototype)||void 0!==iy().description)){var ay={},cy=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof cy?new iy(e):void 0===e?iy():iy(e);return""===e&&(ay[t]=!0),t};oy(cy,iy);var sy=cy.prototype=iy.prototype;sy.constructor=cy;var uy=sy.toString,ly="Symbol(test)"==String(iy("test")),dy=/^Symbol\((.*)\)[^)]+$/;ry(sy,"description",{configurable:!0,get:function(){var e=ny(this)?this.valueOf():this,t=uy.call(e);if(ey(ay,e))return"";var n=ly?t.slice(7,-1):t.replace(dy,"$1");return""===n?void 0:n}}),Zv({global:!0,forced:!0},{Symbol:cy})}zf("iterator");var fy=nr,hy=x,py=[].join,vy=O!=Object,yy=vp("join",",");function Sy(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function my(e,t){if(e){if("string"==typeof e)return Sy(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Sy(e,t):void 0}}function gy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(e,t)||my(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}fy({target:"Array",proto:!0,forced:vy||!yy},{join:function(e){return py.call(hy(this),void 0===e?",":e)}});var Ny=$e.f,by=Kr,Ty=qi,Ey=Na,wy=Ja,_y=Ba,Oy=gi,Iy=yu,Ry=p,Cy=Xi.exports.fastKey,xy=Ut.set,Ly=Ut.getterFor;dc("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(e,t,n,r){var o=e((function(e,i){wy(e,o,t),xy(e,{type:t,index:by(null),first:void 0,last:void 0,size:0}),Ry||(e.size=0),null!=i&&_y(i,e[r],{that:e,AS_ENTRIES:n})})),i=Ly(t),a=function(e,t,n){var r,o,a=i(e),s=c(e,t);return s?s.value=n:(a.last=s={index:o=Cy(t,!0),key:t,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=s),r&&(r.next=s),Ry?a.size++:e.size++,"F"!==o&&(a.index[o]=s)),e},c=function(e,t){var n,r=i(e),o=Cy(t);if("F"!==o)return r.index[o];for(n=r.first;n;n=n.next)if(n.key==t)return n};return Ty(o.prototype,{clear:function(){for(var e=i(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,Ry?e.size=0:this.size=0},delete:function(e){var t=i(this),n=c(this,e);if(n){var r=n.next,o=n.previous;delete t.index[n.index],n.removed=!0,o&&(o.next=r),r&&(r.previous=o),t.first==n&&(t.first=r),t.last==n&&(t.last=o),Ry?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=i(this),r=Ey(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),Ty(o.prototype,n?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return a(this,0===e?0:e,t)}}:{add:function(e){return a(this,e=0===e?0:e,e)}}),Ry&&Ny(o.prototype,"size",{get:function(){return i(this).size}}),o},setStrong:function(e,t,n){var r=t+" Iterator",o=Ly(t),i=Ly(r);Oy(e,t,(function(e,t){xy(this,{type:r,target:e,state:o(e),kind:t,last:void 0})}),(function(){for(var e=i(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),Iy(t)}});var My=bn.includes,ky=Oo;nr({target:"Array",proto:!0},{includes:function(e){return My(this,e,arguments.length>1?arguments[1]:void 0)}}),ky("includes");var Ay=k,Hy=E,Py=Le("match"),Dy=function(e){var t;return Ay(e)&&(void 0!==(t=e[Py])?!!t:"RegExp"==Hy(e))},jy=Dy,Fy=Le("match"),Uy=function(e){if(jy(e))throw TypeError("The method doesn't accept regular expressions");return e},By=I,Jy=Ai;nr({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[Fy]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~Jy(By(this)).indexOf(Jy(Uy(e)),arguments.length>1?arguments[1]:void 0)}});var Yy=of,Gy=Dy,Ky=tt,Vy=I,qy=Nu,Xy=cf,Wy=pn,Qy=Ai,Zy=ie,zy=Sf,$y=Qd,eS=h,tS=Id.UNSUPPORTED_Y,nS=[].push,rS=Math.min;Yy("split",(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=Qy(Vy(this)),o=void 0===n?4294967295:n>>>0;if(0===o)return[];if(void 0===e)return[r];if(!Gy(e))return t.call(r,e,o);for(var i,a,c,s=[],u=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,d=new RegExp(e.source,u+"g");(i=$y.call(d,r))&&!((a=d.lastIndex)>l&&(s.push(r.slice(l,i.index)),i.length>1&&i.index<r.length&&nS.apply(s,i.slice(1)),c=i[0].length,l=a,s.length>=o));)d.lastIndex===i.index&&d.lastIndex++;return l===r.length?!c&&d.test("")||s.push(""):s.push(r.slice(l)),s.length>o?s.slice(0,o):s}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var o=Vy(this),i=null==t?void 0:Zy(t,e);return i?i.call(t,o,n):r.call(Qy(o),t,n)},function(e,o){var i=Ky(this),a=Qy(e),c=n(r,i,a,o,r!==t);if(c.done)return c.value;var s=qy(i,RegExp),u=i.unicode,l=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(tS?"g":"y"),d=new s(tS?"^(?:"+i.source+")":i,l),f=void 0===o?4294967295:o>>>0;if(0===f)return[];if(0===a.length)return null===zy(d,a)?[a]:[];for(var h=0,p=0,v=[];p<a.length;){d.lastIndex=tS?0:p;var y,S=zy(d,tS?a.slice(p):a);if(null===S||(y=rS(Wy(d.lastIndex+(tS?p:0)),a.length))===h)p=Xy(a,p,u);else{if(v.push(a.slice(h,p)),v.length===f)return v;for(var m=1;m<=S.length-1;m++)if(v.push(S[m]),v.length===f)return v;p=h=y}}return v.push(a.slice(h)),v}]}),!!eS((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),tS);var oS=function(t){fo(i,Lp);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(){var t;e(this,i);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return r(uo(t=o.call.apply(o,[this].concat(a))),"controller",void 0),t}return n(i,[{key:"initialise",value:function(){}},{key:"display",value:function(){console.log("got to view display"),this.refreshHeader(),this.body()}},{key:"refreshHeader",value:function(){}},{key:"body",value:function(){}},{key:"card",value:function(e){var t=document.createElement("div");t.id=e.cardId,t.className="card";var n=t.appendChild(document.createElement("div"));n.className="card-header pointer",e.cardHeadingId&&(n.id=e.cardHeadingId),n.setAttribute("data-toggle","collapse"),n.setAttribute("data-target","#".concat(e.cardDescriptionId));var r=n.appendChild(document.createElement("h2"));r.className="mb-0";var o=r.appendChild(document.createElement("button"));if(o.className="btn btn-link".concat(e.collapsed?" collapsed":""),e.headingButtonId&&(o.id=e.headingButtonId),o.type="button",o.setAttribute("data-toggle","collapse"),e.buttonStyleString&&(o.style.cssText=e.buttonStyleString),e.cardDescriptionId&&(o.setAttribute("data-target","#".concat(e.cardDescriptionId)),o.setAttribute("aria-controls",e.cardDescriptionId)),o.setAttribute("aria-expanded",e.collapsed?"false":"true"),o.innerHTML=e.headingHTML,e.headingNonbuttonHTML){var i=r.appendChild(document.createElement("span"));i.style.display="inline-block",i.innerHTML=e.headingNonbuttonHTML}if(e.headingValidationWarningHTML){var a=n.appendChild(document.createElement("div"));a.className="card-invalid-feedback",a.innerHTML="<small>".concat(e.headingValidationWarningHTML,"</small>")}var c=t.appendChild(document.createElement("div"));if(e.cardDescriptionId&&(c.id=e.cardDescriptionId),c.className="collapse".concat(e.collapsed?"":" show"),e.cardHeadingId&&c.setAttribute("aria-labelledby",e.cardHeadingId),c.setAttribute("data-parent","#".concat(e.parentContainerId)),e.dataAttributes)for(var s in e.dataAttributes)e.dataAttributes.hasOwnProperty(s)&&c.setAttribute("data-".concat(s),e.dataAttributes[s]);var u=c.appendChild(document.createElement("div"));return u.className="card-body pl-2 pr-2 pl-md-3 pr-md-3",u.appendChild(e.bodyContentElement),t}}]),i}();var iS=function(t){fo(o,oS);var r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(o);function o(){return e(this,o),r.apply(this,arguments)}return n(o,[{key:"body",value:function(){document.getElementById("body").innerHTML='<h2>Page not found</h2><p><a href="/app/list">Return to the homepage.</a>'}}]),o}();var aS=function(t){fo(i,cv);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(t){var n;return e(this,i),r(uo(n=o.call(this)),"_survey",void 0),r(uo(n),"section",void 0),n.section=t,n}return n(i,[{key:"formElement",get:function(){var e=Os(vo(i.prototype),"formElement",this);return this._formFieldsBuilt||this.buildFormFields(),e}},{key:"updateModelFromContent",value:function(){for(var e in console.log("updating survey from SurveyForm content"),this.fields)if(this.fields.hasOwnProperty(e)){var t=this.fields[e];this._survey.attributes[e]=t.value}console.log({survey:this._survey})}},{key:"model",get:function(){return this._survey},set:function(e){this._survey=e,this.populateFormContent()}},{key:"changeHandler",value:function(e){console.log("survey form change event"),console.log({event:e}),this.fireEvent(cv.CHANGE_EVENT,{form:this})}},{key:"destructor",value:function(){Os(vo(i.prototype),"destructor",this).call(this),this._survey=null}},{key:"initialiseFormFields",value:function(){var e=this.section.properties;for(var t in this.fields={},e)e.hasOwnProperty(t)&&(this.fields[t]=new e[t].field(e[t].attributes))}},{key:"getFormSectionProperties",value:function(){return this.section.properties}}],[{key:"registerSection",value:function(e){i.sections[e.sectionSortOrder]=e,i.sectionsByKey[e.sectionNavigationKey]=e}}]),i}();r(aS,"sections",[]),r(aS,"sectionsByKey",{});var cS=function(t){fo(i,Hp);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(){var t;e(this,i);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return r(uo(t=o.call.apply(o,[this].concat(a))),"SAVE_ENDPOINT","/savesurvey.php"),r(uo(t),"TYPE","survey"),r(uo(t),"attributes",{}),t}return n(i,[{key:"formChangedHandler",value:function(e){console.log("Survey change handler invoked."),e.form.updateModelFromContent(),e.form.conditionallyValidateForm(),this.touch(),this.fireEvent(i.EVENT_MODIFIED,{surveyId:this.id})}},{key:"registerForm",value:function(e){e.model=this,e.addListener(cv.CHANGE_EVENT,this.formChangedHandler.bind(this))}},{key:"save",value:function(){if(this._savedRemotely)return Promise.reject("".concat(this.id," has already been saved."));var e=new FormData;return e.append("type",this.TYPE),e.append("surveyId",this.id),e.append("id",this.id),e.append("projectId",this.projectId.toString()),e.append("attributes",JSON.stringify(this.attributes)),e.append("deleted",this.deleted.toString()),e.append("created",this.createdStamp.toString()),console.log("queueing survey post"),this.queuePost(e)}},{key:"generateSurveyName",value:function(){var e,t=(this.attributes.place||this.attributes.georef||"(unlocalised)").trim(),n=new Date(1e3*this.createdStamp);try{e=n.toLocaleString("default",{year:"numeric",month:"long",day:"numeric"})}catch(t){e=n.toLocaleString("en-GB",{year:"numeric",month:"long",day:"numeric"})}return"".concat(Dp(t)," ").concat(e)}}]),i}();r(cS,"EVENT_MODIFIED","modified");var sS=function(t){fo(i,Hp);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(){var t;e(this,i);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return r(uo(t=o.call.apply(o,[this].concat(a))),"file",void 0),r(uo(t),"TYPE","image"),r(uo(t),"SAVE_ENDPOINT","/saveimage.php"),t}return n(i,[{key:"getUrl",value:function(){}},{key:"save",value:function(e,t,n){if(this._savedRemotely)return Promise.reject("".concat(this.id," has already been saved."));var r=new FormData;return r.append("type",this.TYPE),r.append("surveyId",e||""),r.append("occurrenceId",t||this.occurrenceId),r.append("projectId",n?n.toString():""),r.append("imageId",this.id),r.append("id",this.id),r.append("image",this.file),r.append("deleted",this.deleted.toString()),console.log("queueing image post, image id ".concat(this.id)),this.queuePost(r)}},{key:"_parseDescriptor",value:function(e){Os(vo(i.prototype),"_parseDescriptor",this).call(this,e),this.surveyId=e.surveyId,this.occurrenceId=e.occurrenceId,this.file=e.image}}],[{key:"fromFile",value:function(e){var t=new i;return t.file=e,t}},{key:"placeholder",value:function(e){var t=new i;return t._id=e,i.imageCache.set(e,t),t}},{key:"imageLink",value:function(e,t,n,r){t=t||0,n=n||0;var o="";r.className&&(o+=' class="'.concat(r.className,'"'));var i=t>n?'width="'.concat(t,'"'):'height="'.concat(n,'"');return'<picture><source srcset="/image.php?imageid='.concat(e,'&amp;height=128&amp;format=webp" type="image/webp"><img').concat(o,' src="/image.php?imageid=').concat(e,"&amp;width=").concat(t,"&amp;height=").concat(n,'&amp;format=jpeg" ').concat(i,' alt="photo"></picture>')}}]),i}();function uS(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return lS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lS(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function lS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function dS(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}r(sS,"imageCache",new Map),r(sS,"EVENT_MODIFIED","modified");var fS=new WeakMap,hS=new WeakMap,pS=function(t){fo(i,Lp);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(){var t;return e(this,i),dS(uo(t=o.call(this)),fS,{writable:!0,value:void 0}),dS(uo(t),hS,{writable:!0,value:void 0}),r(uo(t),"controllers",[]),r(uo(t),"currentControllerHandle",!1),r(uo(t),"routeHistory",[]),r(uo(t),"occurrences",void 0),r(uo(t),"surveys",void 0),r(uo(t),"currentSurvey",void 0),r(uo(t),"layout",void 0),t.reset(),t}return n(i,[{key:"reset",value:function(){this.surveys=new Map,this.clearCurrentSurvey()}},{key:"clearCurrentSurvey",value:function(){this.occurrences=new Map,this.currentSurvey=null}},{key:"router",get:function(){return mo(this,fS)},set:function(e){So(this,fS,e)}},{key:"containerId",set:function(e){var t=document.getElementById(e);if(!t)throw new Error("App container '".concat(e,"' not found."));So(this,hS,t)}},{key:"container",get:function(){return mo(this,hS)}},{key:"registerController",value:function(e){e.handle=this.controllers.length,this.controllers[this.controllers.length]=e,e.app=this,e.registerRoute(mo(this,fS))}},{key:"initialise",value:function(){var e=this;this.layout.initialise(),mo(this,fS).notFound((function(e){console.log("no route found for '".concat(e,"'")),(new iS).display()})),mo(this,fS).on((function(){console.log("redirecting from '/' to '/list'"),mo(e,fS).pause(),e.currentSurvey&&e.currentSurvey.isPristine?mo(e,fS).navigate("/list/survey/welcome").resume():mo(e,fS).navigate("/list").resume(),mo(e,fS).resolve()}));var t,n=uS(this.controllers);try{for(n.s();!(t=n.n()).done;)t.value.initialise()}catch(e){n.e(e)}finally{n.f()}}},{key:"display",value:function(){console.log("App display"),mo(this,fS).resolve()}},{key:"saveRoute",value:function(){var e=mo(this,fS).lastRouteResolved();this.routeHistory.length?this.routeHistory[this.routeHistory.length-1]!==e&&(this.routeHistory[this.routeHistory.length]=e):this.routeHistory[0]=e}},{key:"markAllNotPristine",value:function(){var e,t=uS(this.occurrences);try{for(t.s();!(e=t.n()).done;)e.value[1].isPristine=!1}catch(e){t.e(e)}finally{t.f()}}},{key:"setLayout",value:function(e){this.layout=e,e.setApp(this)}},{key:"addSurvey",value:function(e){var t=this;if(e.projectId!==this.projectId)throw new Error("Survey project id '".concat(e.projectId," does not match with current project ('").concat(this.projectId,"')"));this.surveys.has(e.id)||(console.log("setting survey's modified/save handler"),e.addListener(cS.EVENT_MODIFIED,(function(){return t.fireEvent(i.EVENT_SURVEYS_CHANGED),e.save()}))),this.surveys.set(e.id,e),this.fireEvent(i.EVENT_SURVEYS_CHANGED)}},{key:"haveExtantOccurrences",value:function(){var e,t=uS(this.occurrences);try{for(t.s();!(e=t.n()).done;)if(!e.value.deleted)return!0}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"addOccurrence",value:function(e){var t=this;if(!e.surveyId)throw new dv("Survey id must set prior to registering occurrence.");0===this.occurrences.size&&(this.surveys.get(e.surveyId).createdStamp=e.createdStamp),console.log("in addOccurrence setting id '".concat(e.id,"'")),this.occurrences.set(e.id,e),e.addListener(lv.EVENT_MODIFIED,(function(){var n=t.surveys.get(e.surveyId);if(!n)throw new Error("Failed to look up survey id ".concat(e.surveyId));n.isPristine=!1,n.unsaved()&&n.save(),e.save(n.id)}))}},{key:"refreshFromServer",value:function(e){var t,n=this,r=new FormData,o=0,i=uS(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;r.append("surveyId[".concat(o++,"]"),a)}}catch(e){i.e(e)}finally{i.f()}return fetch(ExampleApp.LOAD_SURVEYS_ENDPOINT,{method:"POST",body:r}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response from server when refreshing survey ids")})).then((function(e){console.log({"refresh from server json response":e});var t=[];for(var r in e)if(e.hasOwnProperty(r)){var o,i=uS(e[r]);try{for(i.s();!(o=i.n()).done;){var a=o.value;t.push(n._conditionallyReplaceObject(a))}}catch(e){i.e(e)}finally{i.f()}}return Promise.all(t)}))}},{key:"_conditionallyReplaceObject",value:function(e){var t=e.type,n=e.id,r="".concat(t,".").concat(n);return Mp.getItem(r).then((function(t){return t&&!e.deleted&&t.modified>=e.modified?(console.log("Local copy of ".concat(r," is the same or newer than the server copy. (").concat(t.modified," >= ").concat(e.modified,") ")),Promise.resolve()):(console.log("Adding or replacing local copy of ".concat(r)),Mp.setItem(r,e))}))}},{key:"seekKeys",value:function(e){return Mp.keys().then((function(t){var n,r=uS(t);try{for(r.s();!(n=r.n()).done;){var o,i,a=gy(n.value.split(".",2),2);o=a[0],i=a[1],e.hasOwnProperty(o)?e[o].includes(i)||e[o].push(i):console.log("Unrecognised stored key type '".concat(o,"."))}}catch(e){r.e(e)}finally{r.f()}return e}))}},{key:"syncAll",value:function(){var e=this;return this.seekKeys({survey:[],occurrence:[],image:[]}).then((function(t){return e._syncLocalUnsaved(t)}),(function(e){return console.log("Failed to sync all: ".concat(e)),!1}))}},{key:"_syncLocalUnsaved",value:function(e){var t,n=[],r=uS(e.survey);try{for(r.s();!(t=r.n()).done;){var o=t.value;n.push(cS.retrieveFromLocal(o,new cS).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){r.e(e)}finally{r.f()}var i,a=uS(e.occurrence);try{for(a.s();!(i=a.n()).done;){var c=i.value;n.push(lv.retrieveFromLocal(c,new lv).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){a.e(e)}finally{a.f()}var s,u=uS(e.image);try{for(u.s();!(s=u.n()).done;){var l=s.value;n.push(sS.retrieveFromLocal(l,new sS).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){u.e(e)}finally{u.f()}return Promise.all(n).catch((function(e){console.log("Save failure: ".concat(e))}))}},{key:"restoreOccurrences",value:function(e){var t=this;if(this.surveys.has(e)){var n=this.surveys.get(e);if(n.isPristine)return this.clearCurrentSurvey(),this.currentSurvey=n,this.fireEvent(i.EVENT_SURVEYS_CHANGED),Promise.resolve()}var r={survey:[],occurrence:[],image:[]};return e&&(r.survey[0]=e),console.log("pre-seek keys"),console.log(r),this.seekKeys(r).then((function(e){return e.survey.length?t.refreshFromServer(e.survey).finally((function(){return t.seekKeys(e)})):null})).finally((function(){return r.survey.length?t._restoreSurveyFromLocal(r.survey[0],r).finally((function(){return t.currentSurvey=t.surveys.get(r.survey[0]),t.currentSurvey?(t.currentSurvey.deleted?t.setNewSurvey():t.fireEvent(i.EVENT_SURVEYS_CHANGED),Promise.resolve()):(console.log("Failed to retrieve survey id '".concat(e,"'")),Promise.reject(new Error("Failed to retrieve survey id '".concat(e,"'"))))})):(t.setNewSurvey(),Promise.resolve())}))}},{key:"setNewSurvey",value:function(){this.currentSurvey=new cS,this.currentSurvey.projectId=this.projectId,this.currentSurvey.isPristine=!0,this.addSurvey(this.currentSurvey)}},{key:"addNewOccurrence",value:function(){var e=new lv;return e.surveyId=this.currentSurvey.id,e.projectId=this.projectId,e.isNew=!0,e.isPristine=!0,this.addOccurrence(e),this.fireEvent(ExampleApp.EVENT_OCCURRENCE_ADDED,{occurrenceId:e.id,surveyId:e.surveyId}),e}},{key:"_restoreSurveyFromLocal",value:function(e,t){var n=this;return cS.retrieveFromLocal(e,new cS).then((function(r){n.clearCurrentSurvey(),n.addSurvey(r);var o,i=[],a=uS(t.occurrence);try{var c=function(){var t=o.value;i.push(lv.retrieveFromLocal(t,new lv).then((function(r){r.surveyId===e&&(console.log("adding occurrence ".concat(t)),n.addOccurrence(r))})))};for(a.s();!(o=a.n()).done;)c()}catch(e){a.e(e)}finally{a.f()}return Promise.all(i)})).finally((function(){var n,r=[],o=uS(t.image);try{var i=function(){var t=n.value;r.push(sS.retrieveFromLocal(t,new sS).then((function(n){console.log("restoring image id '".concat(t,"'")),n.surveyId===e&&sS.imageCache.set(t,n)}),(function(e){console.log("Failed to retrieve an image: ".concat(e))})))};for(o.s();!(n=o.n()).done;)i()}catch(e){o.e(e)}finally{o.f()}return Promise.all(r)}))}},{key:"clearLocalForage",value:function(){return Mp.clear()}}]),i}();function vS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}r(pS,"EVENT_ADD_SURVEY_USER_REQUEST","useraddsurveyrequest"),r(pS,"EVENT_RESET_SURVEYS","userresetsurveys"),r(pS,"LOAD_SURVEYS_ENDPOINT","/loadsurveys.php"),r(pS,"EVENT_OCCURRENCE_ADDED","occurrenceadded"),r(pS,"EVENT_SURVEYS_CHANGED","surveyschanged"),r(pS,"devMode",!1);var yS=function(t){fo(i,Lp);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(){var t;e(this,i);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return r(uo(t=o.call.apply(o,[this].concat(a))),"app",void 0),r(uo(t),"surveysMenuId",void 0),t}return n(i,[{key:"setApp",value:function(e){var t=this;this.app=e,e.addListener(pS.EVENT_SURVEYS_CHANGED,(function(){t.refreshSurveysMenu()}))}},{key:"initialise",value:function(){var e=this;this.refreshSurveysMenu();var t=document.createElement("div");t.innerHTML='\x3c!-- begin: templates/newSurveyModal.html --\x3e\r\n<div class="modal fade" id="newsurveymodal" tabindex="-1" role="dialog" aria-labelledby="newsurveymodalTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="newsurveymodalTitle">Start a new survey?</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Please confirm that you wish to start a new survey. You only need to do this if you wish to send a set of records from a different locality, otherwise please add more records to your current report.\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Back</button>\r\n                <button type="button" class="btn btn-danger" data-dismiss="modal" id="newsurveymodalconfirmed">New survey</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/newSurveyModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),(t=document.createElement("div")).innerHTML='\x3c!-- begin: templates/resetModal.html --\x3e\r\n<div class="modal fade" id="resetmodal" tabindex="-1" role="dialog" aria-labelledby="resetmodalTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="resetmodalTitle">Reset?</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Please confirm that you wish to clear out your survey data.\r\n                <p>Warning: any unsaved changes will be lost.</p>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Back</button>\r\n                <button type="button" class="btn btn-danger" data-dismiss="modal" id="resetmodalconfirmed">Reset</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/resetModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),(t=document.createElement("div")).innerHTML='\x3c!-- begin: templates/syncSuccessModal.html --\x3e\r\n<div class="modal fade" id="saveallsuccess" tabindex="-1" role="dialog" aria-labelledby="saveallsuccessTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="saveallsuccessTitle">All records sent</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Your data has been synchronised with the server.\r\n                <p>Thank you.</p>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/syncSuccessModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),(t=document.createElement("div")).innerHTML='\x3c!-- begin: templates/syncFailureModal.html --\x3e\r\n<div class="modal fade" id="saveallfailure" tabindex="-1" role="dialog" aria-labelledby="saveallfailureTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="saveallfailureTitle">One or more records could not be saved</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Please check your connection to the network and try again.\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/syncFailureModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),setTimeout((function(){document.getElementById("".concat(i.NEW_SURVEY_MODAL_ID,"confirmed")).addEventListener("click",(function(t){e.app.fireEvent(pS.EVENT_ADD_SURVEY_USER_REQUEST)})),document.getElementById("".concat(i.RESET_MODAL_ID,"confirmed")).addEventListener("click",(function(t){e.app.fireEvent(pS.EVENT_RESET_SURVEYS)}))}),100)}},{key:"refreshSurveysMenu",value:function(){var e,t=document.getElementById(this.surveysMenuId),n=[],r=this.app.currentSurvey?this.app.currentSurvey.id:null,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return vS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vS(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}(this.app.surveys);try{for(o.s();!(e=o.n()).done;){var i=e.value,a=i[1].generateSurveyName()+(i[0]===r?' <span style="color: green">â</span>':"");n[n.length]='<a class="dropdown-item" href="/app/survey/add/'.concat(i[0],'" data-navigo="survey/add/').concat(i[0],'">').concat(a,"</a>")}}catch(e){o.e(e)}finally{o.f()}t.innerHTML='<a class="dropdown-item" href="/app/survey/save" data-navigo="survey/save">save all</a>\n    <div class="dropdown-divider"></div>\n    '.concat(n.join(""),'\n    <div class="dropdown-divider"></div>\n    <a class="dropdown-item" href="/app/survey/new" data-navigo="survey/new">new survey</a>\n    <a class="dropdown-item" href="/app/survey/reset" data-navigo="survey/reset">reset</a>'),this.app.router.updatePageLinks()}}]),i}();r(yS,"NEW_SURVEY_MODAL_ID","newsurveymodal"),r(yS,"RESET_MODAL_ID","resetmodal"),r(yS,"SAVE_ALL_SUCCESS_MODAL_ID","saveallsuccess"),r(yS,"SAVE_ALL_FAILURE_MODAL_ID","saveallfailure");var SS=function(t){fo(i,a);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(t){var n;return e(this,i),r(uo(n=o.call(this)),"route","/survey/:action/:id"),r(uo(n),"title","Survey picker"),r(uo(n),"app",void 0),r(uo(n),"view",void 0),n.view=t,t.controller=uo(n),n.handle=a.nextHandle,n}return n(i,[{key:"survey",get:function(){return this.app.currentSurvey}},{key:"registerRoute",value:function(e){e.on("/survey",this.mainRouteHandler.bind(this,"survey","",""),{}),e.on("/survey/new",this.newSurveyHandler.bind(this,"survey","new",""),{before:this.beforeNewHandler.bind(this)}),e.on("/survey/reset",this.mainRouteHandler.bind(this,"survey","reset",""),{before:this.beforeResetHandler.bind(this)}),e.on("/survey/save",this.mainRouteHandler.bind(this,"survey","save",""),{before:this.beforeSaveAllHandler.bind(this)}),e.on("/survey/add/:surveyId",this.addSurveyHandler.bind(this,"survey","add","")),this.app.addListener(pS.EVENT_ADD_SURVEY_USER_REQUEST,this.addNewSurveyHandler.bind(this)),this.app.addListener(pS.EVENT_RESET_SURVEYS,this.resetSurveysHandler.bind(this))}},{key:"beforeNewHandler",value:function(e){$("#".concat(yS.NEW_SURVEY_MODAL_ID)).modal(),this.app.router.pause(),window.history.back(),this.app.router.resume(),e(!1)}},{key:"beforeResetHandler",value:function(e){$("#".concat(yS.RESET_MODAL_ID)).modal(),this.app.router.pause(),window.history.back(),this.app.router.resume(),e(!1)}},{key:"beforeSaveAllHandler",value:function(e){this.app.syncAll().then((function(e){console.log("In save all handler, success result: ".concat(e)),Array.isArray(e)?$("#".concat(yS.SAVE_ALL_SUCCESS_MODAL_ID)).modal():$("#".concat(yS.SAVE_ALL_FAILURE_MODAL_ID)).modal()}),(function(e){console.log("In save all handler, failure result: ".concat(e)),$("#".concat(yS.SAVE_ALL_FAILURE_MODAL_ID)).modal()})).finally((function(){})),this.app.router.pause(),window.history.back(),this.app.router.resume(),e(!1)}},{key:"newSurveyHandler",value:function(e,t,n,r){}},{key:"addNewSurveyHandler",value:function(){console.log("reached addNewSurveyHandler"),this.app.currentControllerHandle=this.handle,this.app.clearCurrentSurvey(),this.app.setNewSurvey(),this.app.router.pause(),this.app.router.navigate("/list/survey/welcome").resume(),this.app.router.resolve()}},{key:"resetSurveysHandler",value:function(){var e=this;this.app.clearLocalForage().then((function(){e.app.reset(),e.addNewSurveyHandler()}))}},{key:"addSurveyHandler",value:function(e,t,n,r){var o=this;console.log("reached addSurveyHandler"),console.log({context:e,params:t,query:r}),this.app.currentControllerHandle=this.handle;var i=r.surveyId;if(!i||!i.match(Ap))throw new _s("Failed to match survey id '".concat(i,"', the id format appears to be incorrect"));i=i.toLowerCase(),this.app.restoreOccurrences(i).then((function(){o.app.markAllNotPristine(),o.app.router.pause(),o.app.router.navigate("/list").resume(),o.app.router.resolve()}),(function(e){console.log({"failed survey restoration":e})}))}},{key:"mainRouteHandler",value:function(e,t,n,r){console.log("reached special route handler for SurveyPickerController.js"),console.log({context:e,params:t,query:r})}}]),i}();r(SS,"EVENT_BACK","back");var mS=nr,gS=$o,NS=I,bS=pn,TS=Ai,ES=tt,wS=Dy,_S=Qs,OS=ie,IS=lt.exports,RS=h,CS=Nu,xS=cf,LS=Sf,MS=Ut,kS=Le("matchAll"),AS=MS.set,HS=MS.getterFor("RegExp String Iterator"),PS=RegExp.prototype,DS="".matchAll,jS=!!DS&&!RS((function(){"a".matchAll(/./)})),FS=gS((function(e,t,n,r){AS(this,{type:"RegExp String Iterator",regexp:e,string:t,global:n,unicode:r,done:!1})}),"RegExp String",(function(){var e=HS(this);if(e.done)return{value:void 0,done:!0};var t=e.regexp,n=e.string,r=LS(t,n);return null===r?{value:void 0,done:e.done=!0}:e.global?(""===TS(r[0])&&(t.lastIndex=xS(n,bS(t.lastIndex),e.unicode)),{value:r,done:!1}):(e.done=!0,{value:r,done:!1})}));mS({target:"String",proto:!0,forced:jS},{matchAll:function(e){var t,n,r=NS(this);if(null!=e){if(wS(e)&&!~TS(NS("flags"in PS?e.flags:_S.call(e))).indexOf("g"))throw TypeError("`.matchAll` does not allow non-global regexes");if(jS)return DS.apply(r,arguments);if(n=OS(e,kS))return n.call(e,r)}else if(jS)return DS.apply(r,arguments);return t=TS(r),new RegExp(e,"g")[kS](t)}}),kS in PS||IS(PS,kS,(function(e){var t,n,r,o,i,a,c=ES(this),s=TS(e);return t=CS(c,RegExp),void 0===(n=c.flags)&&c instanceof RegExp&&!("flags"in PS)&&(n=_S.call(c)),r=void 0===n?"":TS(n),o=new t(t===RegExp?c.source:c,r),i=!!~r.indexOf("g"),a=!!~r.indexOf("u"),o.lastIndex=bS(c.lastIndex),new FS(o,s,i,a)}));var US=Oc.map;function BS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}nr({target:"Array",proto:!0,forced:!As("map")},{map:function(e){return US(this,e,arguments.length>1?arguments[1]:void 0)}});var JS=function(){function t(){e(this,t)}return n(t,null,[{key:"fromPostedData",value:function(e){var n,r={saveState:"SAVED_LOCALLY"},o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return BS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?BS(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}(e.entries());try{for(o.s();!(n=o.n()).done;){var i=n.value;r[i[0]]=i[1]}}catch(e){o.e(e)}finally{o.f()}if(!r.type)throw new Error("Missing type in form data.");if(t.responses.hasOwnProperty(r.type))return new t.responses[r.type](r,{});throw new Error("Unrecognised post type '".concat(r.type,"'"))}},{key:"fromPostResponse",value:function(e){if(!e)throw new Error("Invalid empty post response.");if(!e.type)throw new Error("Missing type in returned response.");if(t.responses.hasOwnProperty(e.type))return console.log("in fromPostResponse returning a ".concat(e.type)),new t.responses[e.type]({},e);throw new Error("Unrecognised post type '".concat(e.type,"'"))}}]),t}();function YS(e){var t=new Headers;return t.set("Content-Type","application/json"),new Response(JSON.stringify(e),{status:e.error?500:200,headers:t})}r(JS,"responses",{});var GS=function(){function t(n,o){e(this,t),r(this,"toSaveLocally",void 0),r(this,"returnedToClient",void 0),r(this,"prebuiltResponse",void 0),r(this,"failureErrorMessage","Failed to save a local copy on your device."),r(this,"failureErrorHelp","Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. Perhaps there is insufficient space? Please try to re-establish a network connection and try again."),this.toSaveLocally=n,this.returnedToClient=o}return n(t,[{key:"setPrebuiltResponse",value:function(e){return this.prebuiltResponse=e,this}},{key:"storeLocally",value:function(){var e=this;return Mp.setItem(this.localKey(),this.toSaveLocally).then((function(){return console.log("Stored object ".concat(e.localKey()," locally")),e.prebuiltResponse?e.prebuiltResponse:YS(e.returnedToClient)}),(function(t){return console.log("Failed to store object ".concat(e.localKey()," locally")),console.log({reason:t}),e.returnedToClient.error=e.failureErrorMessage,e.returnedToClient.errorHelp=e.failureErrorHelp,YS(e.returnedToClient)}))}},{key:"localKey",value:function(){throw new Error("LocalKey must be implemented in a subclass for ".concat(this.toSaveLocally.type))}}]),t}();var KS=function(t){fo(i,GS);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(){var t;e(this,i);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return r(uo(t=o.call.apply(o,[this].concat(a))),"failureErrorMessage","Failed to store image."),r(uo(t),"failureErrorHelp","Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. Perhaps there is insufficient space? Please try to re-establish a network connection and try again."),t}return n(i,[{key:"populateClientResponse",value:function(){return this.returnedToClient.id=this.toSaveLocally.imageId?this.toSaveLocally.imageId:this.toSaveLocally.id,this.returnedToClient.imageId=this.toSaveLocally.imageId?this.toSaveLocally.imageId:this.toSaveLocally.id,this.returnedToClient.type="image",this.returnedToClient.surveyId=this.toSaveLocally.surveyId,this.returnedToClient.occurrenceId=this.toSaveLocally.occurrenceId,this.returnedToClient.created=parseInt(this.toSaveLocally.created,10),this.returnedToClient.modified=parseInt(this.toSaveLocally.modified,10),this.returnedToClient.saveState="SAVED_LOCALLY",this.returnedToClient.deleted=this.toSaveLocally.deleted,this.returnedToClient.projectId=parseInt(this.toSaveLocally.projectId,10),this}},{key:"populateLocalSave",value:function(){return this.toSaveLocally.surveyId=this.returnedToClient.surveyId,this.toSaveLocally.type="image",this.toSaveLocally.occurrenceId=this.returnedToClient.occurrenceId,this.toSaveLocally.imageId=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.imageId,this.toSaveLocally.id=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.imageId,this.toSaveLocally.created=parseInt(this.returnedToClient.created,10),this.toSaveLocally.modified=parseInt(this.returnedToClient.modified,10),this.toSaveLocally.saveState="SAVED_TO_SERVER",this.toSaveLocally.deleted=!0===this.returnedToClient.deleted||"true"===this.returnedToClient.deleted,this.toSaveLocally.projectId=parseInt(this.returnedToClient.projectId,10),this}},{key:"localKey",value:function(){return"image.".concat(this.toSaveLocally.imageId)}}],[{key:"register",value:function(){JS.responses.image=i}}]),i}();var VS=function(t){fo(i,GS);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(){var t;e(this,i);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return r(uo(t=o.call.apply(o,[this].concat(a))),"failureErrorMessage","Failed to store survey."),r(uo(t),"failureErrorHelp","Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. Perhaps there is insufficient space? Please try to re-establish a network connection and try again."),t}return n(i,[{key:"populateClientResponse",value:function(){return this.toSaveLocally.surveyId=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.surveyId,this.toSaveLocally.id=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.surveyId,this.returnedToClient.type="survey",this.returnedToClient.attributes=this.toSaveLocally.attributes,this.returnedToClient.created=this.toSaveLocally.created,this.returnedToClient.modified=this.toSaveLocally.modified,this.returnedToClient.saveState="SAVED_LOCALLY",this.returnedToClient.deleted=this.toSaveLocally.deleted,this.returnedToClient.projectId=this.toSaveLocally.projectId,this}},{key:"populateLocalSave",value:function(){return this.toSaveLocally.surveyId=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.surveyId,this.toSaveLocally.id=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.surveyId,this.toSaveLocally.type="survey",this.toSaveLocally.attributes=this.returnedToClient.attributes,this.toSaveLocally.created=parseInt(this.returnedToClient.created,10),this.toSaveLocally.modified=parseInt(this.returnedToClient.modified,10),this.toSaveLocally.saveState="SAVED_TO_SERVER",this.toSaveLocally.deleted=this.returnedToClient.deleted,this.toSaveLocally.projectId=parseInt(this.returnedToClient.projectId,10),this}},{key:"localKey",value:function(){return"survey.".concat(this.toSaveLocally.surveyId)}}],[{key:"register",value:function(){JS.responses.survey=i}}]),i}();var qS=function(t){fo(i,GS);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(){var t;e(this,i);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return r(uo(t=o.call.apply(o,[this].concat(a))),"failureErrorMessage","Failed to store occurrence."),r(uo(t),"failureErrorHelp","Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. Perhaps there is insufficient space? Please try to re-establish a network connection and try again."),t}return n(i,[{key:"populateClientResponse",value:function(){return this.returnedToClient.id=this.toSaveLocally.occurrenceId?this.toSaveLocally.occurrenceId:this.toSaveLocally.id,this.returnedToClient.occurrenceId=this.toSaveLocally.occurrenceId?this.toSaveLocally.occurrenceId:this.toSaveLocally.id,this.returnedToClient.type="occurrence",this.returnedToClient.surveyId=this.toSaveLocally.surveyId,this.returnedToClient.attributes=this.toSaveLocally.attributes,this.returnedToClient.created=parseInt(this.toSaveLocally.created,10),this.returnedToClient.modified=parseInt(this.toSaveLocally.modified,10),this.returnedToClient.saveState="SAVED_LOCALLY",this.returnedToClient.deleted=this.toSaveLocally.deleted,this.returnedToClient.projectId=parseInt(this.toSaveLocally.projectId,10),this}},{key:"populateLocalSave",value:function(){return this.toSaveLocally.occurrenceId=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.occurrenceId,this.toSaveLocally.id=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.occurrenceId,this.toSaveLocally.type="occurrence",this.toSaveLocally.surveyId=this.returnedToClient.surveyId,this.toSaveLocally.attributes=this.returnedToClient.attributes,this.toSaveLocally.created=parseInt(this.returnedToClient.created,10),this.toSaveLocally.modified=parseInt(this.returnedToClient.modified,10),this.toSaveLocally.saveState="SAVED_TO_SERVER",this.toSaveLocally.deleted=!0===this.returnedToClient.deleted||"true"===this.returnedToClient.deleted,this.toSaveLocally.projectId=parseInt(this.returnedToClient.projectId,10),this}},{key:"localKey",value:function(){return"occurrence.".concat(this.toSaveLocally.occurrenceId)}}],[{key:"register",value:function(){JS.responses.occurrence=i}}]),i}(),XS=function(){function t(){e(this,t),r(this,"URL_CACHE_SET",void 0)}return n(t,[{key:"initialise",value:function(e){var t=this;Promise.prototype.finally||(Promise.prototype.finally=function(e){return this.then(e).catch(e)}),KS.register(),VS.register(),qS.register(),this.CACHE_VERSION="version-1.0.2.1634121489-".concat(e.version);var n=e.postPassThroughWhitelist,r=e.postImageUrlMatch,o=e.getImageUrlMatch,i=e.interceptUrlMatches,a=e.ignoreUrlMatches,c=e.indexUrl;this.URL_CACHE_SET=e.urlCacheSet,Mp.config({name:e.forageName}),self.addEventListener("install",(function(e){console.log("BSBI app service worker is being installed."),self.skipWaiting(),e.waitUntil(t.precache().then((function(){return self.skipWaiting()})))})),self.addEventListener("activate",(function(e){e.waitUntil(self.clients.matchAll({includeUncontrolled:!0}).then((function(e){var t=e.map((function(e){return e.url}));console.log("[ServiceWorker] Matching clients:",t.join(", "))})).then((function(){return caches.keys()})).then((function(e){return Promise.all(e.map((function(e){if(e!==t.CACHE_VERSION)return console.log("[ServiceWorker] Deleting old cache:",e),caches.delete(e)})))})).then((function(){return console.log("[ServiceWorker] Claiming clients for version",t.CACHE_VERSION),self.clients.claim()})))})),self.addEventListener("fetch",(function(e){if(console.log("The service worker is serving: '".concat(e.request.url,"'")),e.preventDefault(),"POST"===e.request.method)console.log("Got a post request"),e.request.url.match(n)?(console.log("Passing through whitelisted post request for: ".concat(e.request.url)),e.respondWith(fetch(e.request))):e.request.url.match(r)?t.handle_image_post(e):t.handle_post(e);else if(i.test(e.request.url)&&!a.test(e.request.url)){console.log("redirecting to the root of the SPA");var s=new Request(c);e.respondWith(t.fromCache(s)),e.waitUntil(t.update(s))}else e.request.url.match(o)?(console.log("request is for an image '".concat(e.request.url,"'")),t.handleImageFetch(e)):(console.log("request is for non-image '".concat(e.request.url,"'")),e.respondWith(t.fromCache(e.request)),e.waitUntil(t.update(e.request)))}))}},{key:"handle_post",value:function(e){var t;try{t=e.request.clone()}catch(e){console.log("Failed to clone request."),console.log({"Cloning error":e})}e.respondWith(fetch(e.request).then((function(e){return e.ok?Promise.resolve(e).then((function(e){return e.clone().json()})).then((function(t){return console.log("Following successful remote post about to save locally."),JS.fromPostResponse(t).setPrebuiltResponse(e).populateLocalSave().storeLocally()})).catch((function(t){return console.log({error:t}),Promise.resolve(e)})):(console.log("Failed to save, moving on to attempt IndexedDb"),Promise.reject("Failed to save to server."))})).catch((function(e){return console.log("post fetch failed (probably no network), (reason: ".concat(e,")")),t.formData().then((function(e){return console.log("got to form data handler"),JS.fromPostedData(e).populateClientResponse().storeLocally()}),(function(e){return console.log("failed to read form data locally"),console.log({reason:e}),YS({error:"Failed to process posted response data. (internal error)",errorHelp:"Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. (an unexpected error occurred) Please try to re-establish a network connection and try again."})}))})))}},{key:"handle_image_post",value:function(e){var t;console.log("posting image");try{t=e.request.clone()}catch(e){console.log("Failed to clone request."),console.log({"Cloning error":e})}e.respondWith(t.formData().then((function(e){return console.log("got to form data handler"),JS.fromPostedData(e).populateClientResponse().storeLocally()}),(function(e){return console.log("failed to read form data locally"),console.log({reason:e}),YS({error:"Failed to process posted response data. (internal error)",errorHelp:"Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. (an unexpected error occurred) Please try to re-establish a network connection and try again."})}))),e.waitUntil(fetch(e.request).then((function(e){return console.log("posted image to server in waitUntil part of fetch cycle"),e.ok?(console.log("posted image to server in waitUntil part of fetch cycle: got OK response"),Promise.resolve(e).then((function(e){return e.clone().json()})).then((function(t){return JS.fromPostResponse(t).setPrebuiltResponse(e).populateLocalSave().storeLocally()})).catch((function(t){return console.log({error:t}),Promise.resolve(e)}))):YS({error:"Failed to save posted response data. (internal error)",errorHelp:"Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. (an unexpected error occurred) Please try to re-establish a network connection and try again."})})))}},{key:"precache",value:function(){var e=this;return caches.open(this.CACHE_VERSION).then((function(t){return t.addAll(e.URL_CACHE_SET)}))}},{key:"fromCache",value:function(e){var t=this;return console.log("attempting fromCache response"),caches.open(this.CACHE_VERSION).then((function(n){return console.log("cache is open"),n.match(e).then((function(n){return console.log(n?"cache matched ".concat(e.url):"no cache match for ".concat(e.url)),n||t.update(e)}))}))}},{key:"handleImageFetch",value:function(e){var t=this;e.respondWith(this.fromCache(e.request).then((function(n){if(console.log("In handleImageFetch promise"),n&&n.ok)return console.log("Responding with image from cache (or remotely if no cache)."),n;var r=e.request.url;console.log("Attempting image match for '".concat(r,"'"));var o=r.match(/imageid=([a-fA-F0-9]{8}-(?:[a-fA-F0-9]{4}-){3}[a-fA-F0-9]{12})/);if(o){var i=o[1];return console.log("Returning image match for '".concat(r,"' from local database")),t.imageFromLocalDatabase(i)}console.log("Failed to match image id in url '".concat(r,"'"))})).catch((function(n){var r=e.request.url;console.log(n),console.log("caught ".concat(n)),console.log("In catch following failed network fetch, attempting image match for '".concat(r,"'"));var o=r.match(/imageid=([a-fA-F0-9]{8}-(?:[a-fA-F0-9]{4}-){3}[a-fA-F0-9]{12})/);if(o){var i=o[1];return console.log("(via catch) Returning image match for '".concat(r,"' from local database")),t.imageFromLocalDatabase(i)}console.log("(via catch) Failed to match image id in url '".concat(r,"'"))})))}},{key:"imageFromLocalDatabase",value:function(e){var t=new sS;return console.log("attempting retrieval of image data from local database"),Hp.retrieveFromLocal(e,t).then((function(t){if(console.log("Retrieved image '".concat(e,"' from indexeddb.")),t.file)return(new Headers).append("Content-Type",t.file.type),new Response(t.file,{status:200,statusText:"OK image response from IndexedDb"});console.log("No local file object associated with retrieved image '".concat(e,"' from indexeddb."))}))}},{key:"update",value:function(e){return e=new Request(e,{mode:"cors",credentials:"omit"}),console.log("Attempting fetch and cache update of ".concat(e.url)),caches.open(this.CACHE_VERSION).then((function(t){return fetch(e,{cache:"no-cache"}).then((function(n){return n.ok?(console.log("(re-)caching ".concat(e.url)),t.put(e,n).then((function(){return t.match(e)}))):(console.log("Request during cache update failed for ".concat(e.url)),console.log({"failed cache response":n}),Promise.reject("Request during cache update failed, not caching."))})).catch((function(t){console.log("Cache attempt failed for ".concat(e.url,": error was ").concat(t))}))}))}}]),t}(),WS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function QS(){return!("undefined"==typeof window||!window.history||!window.history.pushState)}function ZS(e,t,n){this.root=null,this._routes=[],this._useHash=t,this._hash=void 0===n?"#":n,this._paused=!1,this._destroyed=!1,this._lastRouteResolved=null,this._notFoundHandler=null,this._defaultHandler=null,this._usePushState=!t&&QS(),this._onLocationChange=this._onLocationChange.bind(this),this._genericHooks=null,this._historyAPIUpdateMethod="pushState",e?this.root=t?e.replace(/\/$/,"/"+this._hash):e.replace(/\/$/,""):t&&(this.root=this._cLoc().split(this._hash)[0].replace(/\/$/,"/"+this._hash)),this._listen(),this.updatePageLinks()}function zS(e){return e instanceof RegExp?e:e.replace(/\/+$/,"").replace(/^\/+/,"^/")}function $S(e,t){return 0===t.length?null:e?e.slice(1,e.length).reduce((function(e,n,r){return null===e&&(e={}),e[t[r]]=decodeURIComponent(n),e}),null):null}function em(e){var t=[];return{regexp:e instanceof RegExp?e:new RegExp(e.replace(ZS.PARAMETER_REGEXP,(function(e,n,r){return t.push(r),ZS.REPLACE_VARIABLE_REGEXP})).replace(ZS.WILDCARD_REGEXP,ZS.REPLACE_WILDCARD)+ZS.FOLLOWED_BY_SLASH_REGEXP,ZS.MATCH_REGEXP_FLAGS),paramNames:t}}function tm(e){return e.replace(/\/$/,"").split("/").length}function nm(e,t){return tm(t)-tm(e)}function rm(e,t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.map((function(t){var n=em(zS(t.route)),r=n.regexp,o=n.paramNames,i=e.replace(/^\/+/,"/").match(r),a=$S(i,o);return!!i&&{match:i,route:t,params:a}})).filter((function(e){return e}))}(e,t)[0]||!1}function om(e,t){var n=t.map((function(t){return""===t.route||"*"===t.route?e:e.split(new RegExp(t.route+"($|/)"))[0]})),r=zS(e);return n.length>1?n.reduce((function(e,t){return e.length>t.length&&(e=t),e}),n[0]):1===n.length?n[0]:r}function im(e,t,n){var r,o=function(e){return e.split(/\?(.*)?$/)[0]};return void 0===n&&(n="#"),QS()&&!t?o(e).split(n)[0]:(r=e.split(n)).length>1?o(r[1]):o(r[0])}function am(e,t,n){if(t&&"object"===(void 0===t?"undefined":WS(t))){if(t.before)return void t.before((function(){var r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];r&&(e(),t.after&&t.after(n))}),n);if(t.after)return e(),void(t.after&&t.after(n))}e()}ZS.prototype={helpers:{match:rm,root:om,clean:zS,getOnlyURL:im},navigate:function(e,t){var n;return e=e||"",this._usePushState?(n=(n=(t?"":this._getRoot()+"/")+e.replace(/^\/+/,"/")).replace(/([^:])(\/{2,})/g,"$1/"),history[this._historyAPIUpdateMethod]({},"",n),this.resolve()):"undefined"!=typeof window&&(e=e.replace(new RegExp("^"+this._hash),""),window.location.href=window.location.href.replace(/#$/,"").replace(new RegExp(this._hash+".*$"),"")+this._hash+e),this},on:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];if("function"==typeof n[0])this._defaultHandler={handler:n[0],hooks:n[1]};else if(n.length>=2)if("/"===n[0]){var o=n[1];"object"===WS(n[1])&&(o=n[1].uses),this._defaultHandler={handler:o,hooks:n[2]}}else this._add(n[0],n[1],n[2]);else if("object"===WS(n[0])){var i=Object.keys(n[0]).sort(nm);i.forEach((function(t){e.on(t,n[0][t])}))}return this},off:function(e){return null!==this._defaultHandler&&e===this._defaultHandler.handler?this._defaultHandler=null:null!==this._notFoundHandler&&e===this._notFoundHandler.handler&&(this._notFoundHandler=null),this._routes=this._routes.reduce((function(t,n){return n.handler!==e&&t.push(n),t}),[]),this},notFound:function(e,t){return this._notFoundHandler={handler:e,hooks:t},this},resolve:function(e){var t,n,r=this,o=(e||this._cLoc()).replace(this._getRoot(),"");this._useHash&&(o=o.replace(new RegExp("^/"+this._hash),"/"));var i=function(e){return e.split(/\?(.*)?$/).slice(1).join("")}(e||this._cLoc()),a=im(o,this._useHash,this._hash);return!this._paused&&(this._lastRouteResolved&&a===this._lastRouteResolved.url&&i===this._lastRouteResolved.query?(this._lastRouteResolved.hooks&&this._lastRouteResolved.hooks.already&&this._lastRouteResolved.hooks.already(this._lastRouteResolved.params),!1):(n=rm(a,this._routes))?(this._callLeave(),this._lastRouteResolved={url:a,query:i,hooks:n.route.hooks,params:n.params,name:n.route.name},t=n.route.handler,am((function(){am((function(){n.route.route instanceof RegExp?t.apply(void 0,n.match.slice(1,n.match.length)):t(n.params,i)}),n.route.hooks,n.params,r._genericHooks)}),this._genericHooks,n.params),n):this._defaultHandler&&(""===a||"/"===a||a===this._hash||function(e,t,n){if(QS()&&!t)return!1;if(!e.match(n))return!1;var r=e.split(n);return r.length<2||""===r[1]}(a,this._useHash,this._hash))?(am((function(){am((function(){r._callLeave(),r._lastRouteResolved={url:a,query:i,hooks:r._defaultHandler.hooks},r._defaultHandler.handler(i)}),r._defaultHandler.hooks)}),this._genericHooks),!0):(this._notFoundHandler&&am((function(){am((function(){r._callLeave(),r._lastRouteResolved={url:a,query:i,hooks:r._notFoundHandler.hooks},r._notFoundHandler.handler(i)}),r._notFoundHandler.hooks)}),this._genericHooks),!1))},destroy:function(){this._routes=[],this._destroyed=!0,this._lastRouteResolved=null,this._genericHooks=null,clearTimeout(this._listeningInterval),"undefined"!=typeof window&&(window.removeEventListener("popstate",this._onLocationChange),window.removeEventListener("hashchange",this._onLocationChange))},updatePageLinks:function(){var e=this;"undefined"!=typeof document&&this._findLinks().forEach((function(t){t.hasListenerAttached||(t.addEventListener("click",(function(n){if((n.ctrlKey||n.metaKey)&&"a"==n.target.tagName.toLowerCase())return!1;var r=e.getLinkPath(t);e._destroyed||(n.preventDefault(),e.navigate(r.replace(/\/+$/,"").replace(/^\/+/,"/")))})),t.hasListenerAttached=!0)}))},generate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._routes.reduce((function(n,r){var o;if(r.name===e)for(o in n=r.route,t)n=n.toString().replace(":"+o,t[o]);return n}),"");return this._useHash?this._hash+n:n},link:function(e){return this._getRoot()+e},pause:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._paused=e,this._historyAPIUpdateMethod=e?"replaceState":"pushState"},resume:function(){this.pause(!1)},historyAPIUpdateMethod:function(e){return void 0===e?this._historyAPIUpdateMethod:(this._historyAPIUpdateMethod=e,e)},disableIfAPINotAvailable:function(){QS()||this.destroy()},lastRouteResolved:function(){return this._lastRouteResolved},getLinkPath:function(e){return e.getAttribute("href")},hooks:function(e){this._genericHooks=e},_add:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"string"==typeof e&&(e=encodeURI(e)),this._routes.push("object"===(void 0===t?"undefined":WS(t))?{route:e,handler:t.uses,name:t.as,hooks:n||t.hooks}:{route:e,handler:t,hooks:n}),this._add},_getRoot:function(){return null!==this.root||(this.root=om(this._cLoc().split("?")[0],this._routes)),this.root},_listen:function(){var e=this;if(this._usePushState)window.addEventListener("popstate",this._onLocationChange);else if("undefined"!=typeof window&&"onhashchange"in window)window.addEventListener("hashchange",this._onLocationChange);else{var t=this._cLoc(),n=void 0,r=void 0;(r=function(){n=e._cLoc(),t!==n&&(t=n,e.resolve()),e._listeningInterval=setTimeout(r,200)})()}},_cLoc:function(){return"undefined"!=typeof window?void 0!==window.__NAVIGO_WINDOW_LOCATION_MOCK__?window.__NAVIGO_WINDOW_LOCATION_MOCK__:zS(window.location.href):""},_findLinks:function(){return[].slice.call(document.querySelectorAll("[data-navigo]"))},_onLocationChange:function(){this.resolve()},_callLeave:function(){var e=this._lastRouteResolved;e&&e.hooks&&e.hooks.leave&&e.hooks.leave(e.params)}},ZS.PARAMETER_REGEXP=/([:*])(\w+)/g,ZS.WILDCARD_REGEXP=/\*/g,ZS.REPLACE_VARIABLE_REGEXP="([^/]+)",ZS.REPLACE_WILDCARD="(?:.*)",ZS.FOLLOWED_BY_SLASH_REGEXP="(?:/$|$)",ZS.MATCH_REGEXP_FLAGS="",function(t){fo(o,ZS);var r=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(o);function o(){return e(this,o),r.apply(this,arguments)}n(o,[{key:"updatePageLinks",value:function(){var e=this;if("undefined"!=typeof document){var t=document.createElement("a");t.href=this.root;var n=t.pathname;this._findLinks().forEach((function(t){t.hasListenerAttached||(t.addEventListener("click",(function(r){if((r.ctrlKey||r.metaKey)&&"a"==r.target.tagName.toLowerCase())return!1;if(!e._destroyed){var o=t.pathname.replace(n,"");r.preventDefault(),e.navigate(o)}})),t.hasListenerAttached=!0)}))}}}])}();var cm=p,sm=d,um=Xn,lm=Za,dm=ut,fm=$e.f,hm=rn.f,pm=Dy,vm=Ai,ym=Qs,Sm=Id,mm=lt.exports,gm=h,Nm=me,bm=Ut.enforce,Tm=yu,Em=Md,wm=Hd,_m=Le("match"),Om=sm.RegExp,Im=Om.prototype,Rm=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,Cm=/a/g,xm=/a/g,Lm=new Om(Cm)!==Cm,Mm=Sm.UNSUPPORTED_Y;if(um("RegExp",cm&&(!Lm||Mm||Em||wm||gm((function(){return xm[_m]=!1,Om(Cm)!=Cm||Om(xm)==xm||"/a/i"!=Om(Cm,"i")}))))){for(var km=function(e,t){var n,r,o,i,a,c,s=this instanceof km,u=pm(e),l=void 0===t,d=[],f=e;if(!s&&u&&l&&e.constructor===km)return e;if((u||e instanceof km)&&(e=e.source,l&&(t="flags"in f?f.flags:ym.call(f))),e=void 0===e?"":vm(e),t=void 0===t?"":vm(t),f=e,Em&&"dotAll"in Cm&&(r=!!t&&t.indexOf("s")>-1)&&(t=t.replace(/s/g,"")),n=t,Mm&&"sticky"in Cm&&(o=!!t&&t.indexOf("y")>-1)&&(t=t.replace(/y/g,"")),wm&&(e=(i=function(e){for(var t,n=e.length,r=0,o="",i=[],a={},c=!1,s=!1,u=0,l="";r<=n;r++){if("\\"===(t=e.charAt(r)))t+=e.charAt(++r);else if("]"===t)c=!1;else if(!c)switch(!0){case"["===t:c=!0;break;case"("===t:Rm.test(e.slice(r+1))&&(r+=2,s=!0),o+=t,u++;continue;case">"===t&&s:if(""===l||Nm(a,l))throw new SyntaxError("Invalid capture group name");a[l]=!0,i.push([l,u]),s=!1,l="";continue}s?l+=t:o+=t}return[o,i]}(e))[0],d=i[1]),a=lm(Om(e,t),s?this:Im,km),(r||o||d.length)&&(c=bm(a),r&&(c.dotAll=!0,c.raw=km(function(e){for(var t,n=e.length,r=0,o="",i=!1;r<=n;r++)"\\"!==(t=e.charAt(r))?i||"."!==t?("["===t?i=!0:"]"===t&&(i=!1),o+=t):o+="[\\s\\S]":o+=t+e.charAt(++r);return o}(e),n)),o&&(c.sticky=!0),d.length&&(c.groups=d)),e!==f)try{dm(a,"source",""===f?"(?:)":f)}catch(e){}return a},Am=function(e){e in km||fm(km,e,{configurable:!0,get:function(){return Om[e]},set:function(t){Om[e]=t}})},Hm=hm(Om),Pm=0;Hm.length>Pm;)Am(Hm[Pm++]);Im.constructor=km,km.prototype=Im,mm(sm,"RegExp",km)}Tm("RegExp");var Dm=Math.floor,jm=function(e,t){var n=e.length,r=Dm(n/2);return n<8?Fm(e,t):Um(jm(e.slice(0,r),t),jm(e.slice(r),t),t)},Fm=function(e,t){for(var n,r,o=e.length,i=1;i<o;){for(r=i,n=e[i];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==i++&&(e[r]=n)}return e},Um=function(e,t,n){for(var r=e.length,o=t.length,i=0,a=0,c=[];i<r||a<o;)i<r&&a<o?c.push(n(e[i],t[a])<=0?e[i++]:t[a++]):c.push(i<r?e[i++]:t[a++]);return c},Bm=jm,Jm=j.match(/firefox\/(\d+)/i),Ym=!!Jm&&+Jm[1],Gm=/MSIE|Trident/.test(j),Km=j.match(/AppleWebKit\/(\d+)\./),Vm=!!Km&&+Km[1],qm=nr,Xm=re,Wm=ve,Qm=yn,Zm=Ai,zm=h,$m=Bm,eg=vp,tg=Ym,ng=Gm,rg=K,og=Vm,ig=[],ag=ig.sort,cg=zm((function(){ig.sort(void 0)})),sg=zm((function(){ig.sort(null)})),ug=eg("sort"),lg=!zm((function(){if(rg)return rg<70;if(!(tg&&tg>3)){if(ng)return!0;if(og)return og<603;var e,t,n,r,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)ig.push({k:t+r,v:n})}for(ig.sort((function(e,t){return t.v-e.v})),r=0;r<ig.length;r++)t=ig[r].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return"DGBEFHACIJK"!==o}}));qm({target:"Array",proto:!0,forced:cg||!sg||!ug||!lg},{sort:function(e){void 0!==e&&Xm(e);var t=Wm(this);if(lg)return void 0===e?ag.call(t):ag.call(t,e);var n,r,o=[],i=Qm(t);for(r=0;r<i;r++)r in t&&o.push(t[r]);for(n=(o=$m(o,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Zm(t)>Zm(n)?1:-1}}(e))).length,r=0;r<n;)t[r]=o[r++];for(;r<i;)delete t[r++];return t}});var dg=nr,fg=dn,hg=cn,pg=yn,vg=ve,yg=mc,Sg=xs,mg=As("splice"),gg=Math.max,Ng=Math.min;dg({target:"Array",proto:!0,forced:!mg},{splice:function(e,t){var n,r,o,i,a,c,s=vg(this),u=pg(s),l=fg(e,u),d=arguments.length;if(0===d?n=r=0:1===d?(n=0,r=u-l):(n=d-2,r=Ng(gg(hg(t),0),u-l)),u+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(o=yg(s,r),i=0;i<r;i++)(a=l+i)in s&&Sg(o,i,s[a]);if(o.length=r,n<r){for(i=l;i<u-r;i++)c=i+n,(a=i+r)in s?s[c]=s[a]:delete s[c];for(i=u;i>u-r+n;i--)delete s[i-1]}else if(n>r)for(i=u-r;i>l;i--)c=i+n-1,(a=i+r-1)in s?s[c]=s[a]:delete s[c];for(i=0;i<n;i++)s[i+l]=arguments[i+2];return s.length=u-r+n,o}});var bg=function(){function t(){if(e(this,t),r(this,"minimumRankSort",null),r(this,"requireExtantDDbRecords",!1),r(this,"skipJunk",!0),!jp.rawTaxa&&(jp.rawTaxa=BsbiDb.TaxonNames,!jp.rawTaxa))throw new Error("Taxon list has failed to load in TaxonSearch")}return n(t,[{key:"lookup",value:function(e){var n,r,o,i,a={};if(r=t.normaliseTaxonName(decodeURIComponent(e).trim()).replace(/\s+x$/i,""),i=/ x\b/.test(r),""!==r){var c=r.match(t.abbreviatedGenusRegex);if(c){var s,u;for(var l in"X"===c[2]||"x"===c[2]?u=s=new RegExp("^(X\\s|X[a-z]+\\s+)(x )?\\b".concat(t.generate_hybrid_combinations_regex(c[3]),".*"),"i"):(s=new RegExp("^(X )?".concat(t.escapeRegExp(c[2]),"[a-z]+ (x )?.*\\b").concat(t.generate_hybrid_combinations_regex(c[3]),".*"),"i"),u=new RegExp("^(X )?".concat(t.escapeRegExp(c[2]),"[a-z]+ (x )?\\b").concat(t.generate_hybrid_combinations_regex(c[3]),".*"),"i")),jp.rawTaxa){var d=jp.rawTaxa[l];o=0===d[t.canonicalColumn]?d[t.nameStringColumn]:d[t.canonicalColumn],(s.test(o)||""!==d[t.hybridCanonicalColumn]&&s.test(d[t.hybridCanonicalColumn]))&&(a[l]={exact:d[t.nameStringColumn]===r,near:u.test(d[t.nameStringColumn])})}n=this.compile_results(a,i)}else{var f,h,p=t.escapeRegExp(r);-1!==r.indexOf(" ")?(f="".concat(t.escapeRegExp(r.substr(0,r.indexOf(" ")))," (x )?.*\\b").concat(t.generate_hybrid_combinations_regex(r.substr(r.indexOf(" ")+1)),".*"),h=new RegExp("^(?:Xs+)?".concat(t.escapeRegExp(r.substr(0,r.indexOf(" ")))," (x )?\\b").concat(t.generate_hybrid_combinations_regex(r.substr(r.indexOf(" ")+1)),".*"),"i")):(f="".concat(p,".*"),h=new RegExp("^".concat(p,".*")));var v="^".concat(p,".*"),y=new RegExp("^(?:Xs+)?".concat(f),"i");if(t.showVernacular){var S=new RegExp(v,"i");for(var m in jp.rawTaxa){var g=jp.rawTaxa[m];o=0===g[t.canonicalColumn]?g[t.nameStringColumn]:g[t.canonicalColumn],y.test(g[t.nameStringColumn])||o!==g[t.nameStringColumn]&&y.test(o)?a[m]={exact:g[t.nameStringColumn]===r,near:h.test(g[t.nameStringColumn])||h.test(o)}:(S.test(g[t.vernacularColumn])||S.test(g[t.vernacularRootColumn]))&&(a[m]={exact:g[t.vernacularColumn]===r,vernacular:!0})}if((n=this.compile_results(a,i)).length<5){var N=new RegExp("\\b".concat(p,".*"),"i");for(var b in jp.rawTaxa)if(!a.hasOwnProperty(b)){var T=jp.rawTaxa[b];N.test(T[t.nameStringColumn])?a[b]={exact:T[t.nameStringColumn]===r}:(0!==T[t.canonicalColumn]&&N.test(T[t.canonicalColumn])||N.test(T[t.vernacularColumn]))&&(a[b]={exact:T[t.nameStringColumn]===r,vernacular:!0})}n=this.compile_results(a,i)}}else{for(var E in jp.rawTaxa){var w=jp.rawTaxa[E];o=0===w[t.canonicalColumn]?w[t.nameStringColumn]:w[t.canonicalColumn],(y.test(w[t.nameStringColumn])||o!==w[t.nameStringColumn]&&y.test(o))&&(a[E]={exact:w[t.nameStringColumn]===r})}n=this.compile_results(a,i)}}}else n=[];return n}},{key:"compile_results",value:function(e,n){var r=[];for(var o in e)if(e.hasOwnProperty(o)){var i=jp.rawTaxa[o];if((!this.requireExtantDDbRecords||this.requireExtantDDbRecords&&1===i[t.usedColumn])&&(!this.minimumRankSort||this.minimumRankSort>0&&i[t.minRankColumn]>=this.minimumRankSort)){var a=i[t.nameStringColumn]+(i[t.qualifierColumn]?" ".concat(i[t.qualifierColumn]):""),c={entityId:o,vernacular:i[t.vernacularColumn],qname:a,name:a,qualifier:i[t.qualifierColumn],authority:i[t.authorityColumn],uname:i[t.nameStringColumn],vernacularMatched:e[o].hasOwnProperty("vernacular"),exact:e[o].hasOwnProperty("exact")&&e[o].exact,near:e[o].hasOwnProperty("near")&&e[o].near};if(c.formatted=t.formatter(c),i[t.acceptedEntityIdColumn]){var s=jp.rawTaxa[i[t.acceptedEntityIdColumn]];if(!s)throw jp.rawTaxa?new Error("Failed to find taxon for accepted entity id ".concat(i[t.acceptedEntityIdColumn])):new Error("Taxon.rawTaxa set is undefined, when trying to find taxon for accepted entity id ".concat(i[t.acceptedEntityIdColumn]));c.acceptedEntityId=i[t.acceptedEntityIdColumn],c.acceptedNameString=s[t.nameStringColumn],c.acceptedQualifier=s[t.qualifierColumn],c.acceptedAuthority=s[t.authorityColumn]}r.push(c)}}return r.length&&(r.sort((function(e,t){if(e.exact)return t.exact?e.acceptedEntityId?1:0:-1;if(t.exact)return 1;if(e.near){if(!t.near)return-1}else if(t.near)return 1;var r=null!==e.uname.match(/\bx\b/i),o=null!==t.uname.match(/\bx\b/i);if(r)return o?e.uname===t.uname?e.acceptedEntityId?1:0:e.qname<t.qname?-1:1:n?-1:1;if(o)return n?1:-1;if(e.uname===t.uname){if(!e.acceptedEntityId&&!t.acceptedEntityId||e.acceptedEntityId&&t.acceptedEntityId){var i=["s.s.","",null,"s.l.","agg."].indexOf(e.qualifier),a=["s.s.","",null,"s.l.","agg."].indexOf(t.qualifier);return i===a?0:i<a?1:-1}return e.acceptedEntityId?1:-1}return e.uname<t.uname?-1:1})),r.length>t.MAXIMUM_RESULTS&&(r.length=t.MAXIMUM_RESULTS)),r}}],[{key:"formatter",value:function(e){return t.showVernacular?e.vernacularMatched?e.acceptedEntityId?"<q><b>".concat(e.vernacular,'</b></q> <span class="italictaxon">').concat(e.uname).concat(e.qualifier?" <b>".concat(e.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(e.authority,"</span>")+' = <span class="italictaxon">'.concat(e.acceptedNameString).concat(e.acceptedQualifier?" <b>".concat(e.acceptedQualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(e.acceptedAuthority,"</span>"):"<q><b>".concat(e.vernacular,'</b></q> <span class="italictaxon">').concat(e.uname).concat(e.qualifier?" <b>".concat(e.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(e.authority,"</span>"):e.acceptedEntityId?'<span class="italictaxon">'.concat(e.uname).concat(e.qualifier?" <b>".concat(e.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(e.authority,"</span>").concat(e.vernacular?" <q><b>".concat(e.vernacular,"</b></q>"):"",' = <span class="italictaxon">').concat(e.acceptedNameString).concat(e.acceptedQualifier?" <b>".concat(e.acceptedQualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(e.acceptedAuthority,"</span>"):'<span class="italictaxon">'.concat(e.uname).concat(e.qualifier?" <b>".concat(e.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(e.authority,"</span>").concat(e.vernacular?" <q><b>".concat(e.vernacular,"</b></q>"):""):e.acceptedEntityId?'<span class="italictaxon">'.concat(e.uname).concat(e.qualifier?" <b>".concat(e.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(e.authority,"</span>")+' = <span class="italictaxon">'.concat(e.acceptedNameString).concat(e.acceptedQualifier?" <b>".concat(e.acceptedQualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(e.acceptedAuthority,"</span>"):'<span class="italictaxon">'.concat(e.uname).concat(e.qualifier?" <b>".concat(e.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(e.authority,"</span>")}},{key:"normaliseTaxonName",value:function(e){for(var n=0,r=t.taxonRankNameSearchRegex.length;n<r;n++)e=e.replace(t.taxonRankNameSearchRegex[n],t.taxonRankNameReplacement[n]);for(var o=0,i=t.taxonQualifierSearchRegex.length;o<i;o++)e=e.replace(t.taxonQualifierSearchRegex[o],t.taxonQualifierReplacement[o]);return e}},{key:"escapeRegExp",value:function(e){return e.replace(t.cleanRegex,"\\$&")}},{key:"generate_hybrid_combinations_regex",value:function(e){var n=t.escapeRegExp(e).split(/\s+x\s+/i);if(n.length<2)return n[0];var r=[];return function e(t,n){if(0===t.length)r[r.length]=n.join("[a-zA-Z]* x ");else for(var o=t.length-1;o>=0;--o){var i=t.slice(0),a=n.slice(0);a.unshift(i.splice(o,1)[0]),e(i,a)}}(n,[]),"(?:".concat(r.join("|"),")")}}]),t}();function Tg(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}r(bg,"showVernacular",!0),r(bg,"MIN_SEARCH_LENGTH",2),r(bg,"MAXIMUM_RESULTS",25),r(bg,"abbreviatedGenusRegex",/^(X\s+)?([a-z])[.\s]+(.*?)$/i),r(bg,"nameStringColumn",0),r(bg,"canonicalColumn",1),r(bg,"hybridCanonicalColumn",2),r(bg,"acceptedEntityIdColumn",3),r(bg,"qualifierColumn",4),r(bg,"authorityColumn",5),r(bg,"vernacularColumn",6),r(bg,"vernacularRootColumn",7),r(bg,"usedColumn",8),r(bg,"minRankColumn",9),r(bg,"taxonRankNameSearchRegex",[/\s+sub-?g(?:en(?:us)?)?[.\s]+/i,/\s+sect(?:ion)?[.\s]+/i,/\s+subsect(?:ion)?[.\s]+/i,/\s+ser(?:ies)?[.\s]+/i,/\s+gp[.\s]+/i,/\s+s(?:ub)?-?sp(?:ecies)?[.\s]+/i,/\s+morphotype\s+/i,/\s+var[.\s]+/i,/\s+cv[.\s]+/i,/\s+n(?:otho)?v(?:ar)?[.\s]+/i,/\s+f[.\s]+|\s+forma?\s+/i,/\s+n(?:otho)?ssp[.\s]+/i]),r(bg,"taxonRankNameReplacement",[" subg. "," sect. "," subsect. "," ser. "," group "," subsp. "," morph. "," var. "," cv. "," nothovar. "," f. "," nothosubsp. "]),r(bg,"cleanRankNamesRegex",/\s(subfam\.|subg\.|sect\.|subsect\.|ser\.|subser\.|subsp\.|nothosubsp\.|microsp\.|praesp\.|agsp\.|race|convar\.|nm\.|microgene|f\.|subvar\.|var\.|nothovar\.|cv\.|sublusus|taxon|morph\.|group|sp\.)\s/),r(bg,"taxonQualifierSearchRegex",[/\s*\(?\bf\s*x\s*m or m\s*x\s*f\)?\s*$/i,/\s*\(?\bm\s*x\s*f or f\s*x\s*m\)?\s*$/i,/\s*\(?\bf\s*x\s*m\)?\s*$/i,/\s*\(?\bm\s*x\s*f\)?\s*$/i,/\s*\(?\bfemale\s*x\s*male\)?\s*$/i,/\s*\(?\bmale\s*x\s*female\)?\s*$/i,/\s*'male'\s*$/i,/\s*'female'\s*$/i,/\b\s*sens\.?\s*lat[.\s]+/i,/\b\s*s\.\s*lat\.?\s*\b/i,/\b\s*s\.?\s*l\.?\s+\b/i,/\b\s*sensu\s*lato\s+\b|\(\s*sensu\s*lato\s*\)/i,/\b\s*sensu\s*stricto\s+\b|\(\s*sensu\s*stricto\s*\)/i,/\b\s*sens\.?\s*strict[.\s]+/i,/\b\s*sens\.?\s*str\.?\s*(?=\))|\b\s*sens\.?\s*str[.\s]+/i,/\b\s*s\.\s*str[.\s]+/i,/\b\s*s\.?\s*s\.?\s+\b/i,/\b\s*sens\.?\s*lat\.?\s*$/i,/\b\s*s\.\s*lat\.?\s*$/i,/\b\s*s\.?\s*l\.?\s*$/i,/\b\s*sensu\s*lato\s*$/i,/\b\s*sensu\s*stricto\s*$/i,/\b\s*sens\.?\s*strict\.?\s*$/i,/\b\s*sens\.?\s*str\.?\s*$/i,/\b\s*s\.\s*str\.?\s*$/i,/\b\s*s\.?\s*s\.?\s*$/i,/\b\s*agg\.?\s*$/i,/\b\s*aggregate\s*$/i,/\b\s*sp\.?\s*cultivar\s*$/i,/\b\s*sp\.?\s*cv\.?\s*$/i,/\b\s*cultivars?\s*$/i,/\b\s*cv\s+$/i,/\b\s*cv$/i,/\b\s*cf\s*$/i,/\b\s*aff\s*$/i,/\b\s*s\.?n\.?\s*$/i,/\b\s*sp\.?\s*nov\.?\s*$/i,/\b\s*auct[.\s]*$/i,/\b\s*ined[.\s]*$/i,/\b\s*nom\.?\snud[.\s]*$/i,/\b\s*p\.p[.\s?]*$/i,/\b\s*spp?\.?[\s?]*$/i,/\b\s*species\s*$/i,/\b\s*spp?\.?\s*\(/i,/\b\s*species\s*\(/i]),r(bg,"taxonQualifierReplacement",[" "," "," (f x m)"," (m x f)"," (f x m)"," (m x f)"," male"," female"," s.l. "," s.l. "," s.l. "," s.l. "," s.s. "," s.s. "," s.s. "," s.s. "," s.s. "," s.l."," s.l."," s.l."," s.l."," s.s."," s.s."," s.s."," s.s."," s.s."," agg."," agg."," cv. "," cv. "," cv. "," cv. "," cv. "," cf."," aff."," sp.nov."," sp.nov."," auct."," ined."," nom. nud."," pro parte","",""," ("," ("]),r(bg,"cleanRegex",/[.*+?^${}()|[\]\\]/g),r(function(){function t(){e(this,t)}return n(t,null,[{key:"taxaLoadedEntryPoint",value:function(){for(jp.rawTaxa=BsbiDb.TaxonNames;t.callbackStack.length;){var e=t.callbackStack.shift();try{e()}catch(e){console.log({"Exception after taxon load":e})}}}},{key:"onceTaxaLoaded",value:function(){return BsbiDb.hasOwnProperty("TaxonNames")?Promise.resolve():(BsbiDb.taxonNamesLoadedEntryPoint||(BsbiDb.taxonNamesLoadedEntryPoint=t.taxaLoadedEntryPoint),new Promise((function(e){t.callbackStack.push(e)})))}}]),t}(),"callbackStack",[]),nr({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var Eg=new WeakMap,wg=new WeakMap;function _g(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Og(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Og(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function Og(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ig(e,t){Cg(e,t),t.add(e)}function Rg(e,t,n){Cg(e,t),t.set(e,n)}function Cg(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function xg(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}!function(t){fo(i,$p);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(t){var n;return e(this,i),Tg(uo(n=o.call(this,t)),Eg,{writable:!0,value:void 0}),Tg(uo(n),wg,{writable:!0,value:void 0}),r(uo(n),"_value",""),r(uo(n),"_inputType","date"),r(uo(n),"_autocomplete",""),n._value=(new Date).toJSON().slice(0,10),t&&(t.placeholder&&(n.placeholder=t.placeholder),t.autocomplete&&(n._autocomplete=t.autocomplete)),n}n(i,[{key:"value",get:function(){return this._value},set:function(e){this._value=void 0===e||null==e?(new Date).toJSON().slice(0,10):e.trim(),this.updateView()}},{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(mo(this,Eg)).value=$p.cleanRawString(this._value))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",So(this,wg,e.id=$p.nextId),So(this,Eg,$p.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=mo(this,Eg),t.textContent=this.label;var n=e.appendChild(document.createElement("input"));n.className="form-control",n.id=mo(this,Eg);try{n.type=this._inputType}catch(e){console.log("Failed to set type '".concat(this._inputType,"'"))}if(this.placeholder&&(n.placeholder=this.placeholder),this._autocomplete&&(n.autocomplete=this._autocomplete,"off"===this._autocomplete&&(n.name=kp())),this.completion===$p.COMPLETION_COMPULSORY&&(n.required=!0),this.validationMessage){var r=e.appendChild(document.createElement("div"));r.className="invalid-feedback",r.innerHTML=this.validationMessage}this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText),n.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"markValidity",value:function(e){var t=document.getElementById(mo(this,Eg));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"inputChangeHandler",value:function(e){e.stopPropagation(),console.log("got date field change event"),this.value=$p.cleanRawString(document.getElementById(mo(this,Eg)).value),this.fireEvent($p.EVENT_CHANGE)}}],[{key:"summariseImpl",value:function(e,t,n){return""!==n[e]&&null!==n[e]&&void 0!==n[e]?Dp(n[e].trim()):""}}])}(),dc("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Yc);var Lg=new WeakMap,Mg=new WeakMap,kg=new WeakMap,Ag=new WeakSet,Hg=new WeakSet,Pg=function(t){fo(i,$p);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(t){var n;return e(this,i),Ig(uo(n=o.call(this,t)),Hg),Ig(uo(n),Ag),Rg(uo(n),Lg,{writable:!0,value:void 0}),Rg(uo(n),Mg,{writable:!0,value:void 0}),Rg(uo(n),kg,{writable:!0,value:void 0}),r(uo(n),"parentForm",void 0),r(uo(n),"_value",{images:[]}),r(uo(n),"includeCamera",!0),r(uo(n),"placeholder",""),t&&(t.hasOwnProperty("includeCamera")&&(n.includeCamera=t.includeCamera),t.placeholder&&(n.placeholder=t.placeholder)),n}return n(i,[{key:"value",get:function(){var e=[];if(this._value&&this._value.images){var t,n=_g(this._value.images);try{for(n.s();!(t=n.n()).done;){var r=t.value;e[e.length]=r.id}}catch(e){n.e(e)}finally{n.f()}}return e},set:function(e){if(this._value={images:[]},e){var t,n=_g(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;sS.imageCache.has(r)?this._value.images.push(sS.imageCache.get(r)):(console.log("Creating placeholder image object '".concat(r,"'")),this._value.images.push(sS.placeholder(r)))}}catch(e){n.e(e)}finally{n.f()}}this.updateView()}},{key:"updateView",value:function(){if(this._fieldEl){var e,t=[],n=_g(this._value.images);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push('<picture style="cursor: pointer;" data-imageid="'.concat(r.id,'"><source srcset="/image.php?imageid=').concat(r.id,'&amp;height=128&amp;format=webp" type="image/webp"><img data-imageid="').concat(r.id,'" src="/image.php?imageid=').concat(r.id,'&amp;height=128&amp;format=jpeg" height="128" alt="photo"></picture>'))}}catch(e){n.e(e)}finally{n.f()}document.getElementById(mo(this,kg)).innerHTML=t.join("\n")}}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",So(this,Mg,e.id=$p.nextId),So(this,Lg,$p.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=mo(this,Lg),t.textContent=this.label;var n=e.appendChild(document.createElement("div"));n.className="input-group";var r=document.createElement("div");r.className="custom-file",n.appendChild(r);var o=r.appendChild(document.createElement("input"));if(o.type="file",o.className="custom-file-input",o.id=mo(this,Lg),o.accept=".jpeg, .jpg, image/png, image/jpeg",o.multiple=!0,this.placeholder){var i=r.appendChild(document.createElement("label"));i.className="custom-file-label",i.htmlFor=mo(this,Lg),i.textContent=this.placeholder}if(this.includeCamera){var a=document.createElement("div");a.className="input-group-append";var c=a.appendChild(document.createElement("span"));c.className="input-group-text";var s=c.appendChild(document.createElement("label"));s.className="pl-0 pr-0 ml-0 mr-0 mt-0 mb-0 pt-0 pb-0 material-icons";var u=s.appendChild(document.createElement("i"));u.className="material-icons pl-0 pr-0 ml-0 mr-0 mt-0 mb-0 pt-0 pb-0",u.textContent="add_a_photo";var l=s.appendChild(document.createElement("input"));l.type="file",l.capture="environment",l.accept="image/*",l.style.display="none",l.id=$p.nextId,n.appendChild(a),l.addEventListener("change",this.inputChangeHandler.bind(this,l.id))}this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);var d=e.appendChild(document.createElement("p"));if(So(this,kg,d.id=$p.nextId),d.addEventListener("click",this.imageClickHandler.bind(this)),this.validationMessage){var f=e.appendChild(document.createElement("div"));f.className="invalid-feedback",f.innerHTML=this.validationMessage}o.addEventListener("change",this.inputChangeHandler.bind(this,o.id)),this._fieldEl=e,this.parentForm.addListener("deleteimage",this.deleteImageHandler.bind(this))}},{key:"deleteImageHandler",value:function(e){var t;for(var n in console.log("delete image ".concat(e.imageId)),this._value.images)if(this._value.images.hasOwnProperty(n)&&this._value.images[n].id===e.imageId){t=this._value.images.splice(n,1)[0];break}t?(this.updateView(),this.fireEvent($p.EVENT_CHANGE)):console.log("Failed to find image id ".concat(e.imageId))}},{key:"imageClickHandler",value:function(e){var t=e.target.closest("picture");t||(t=e.target.closest("img")),console.log({"clicked image":t});var n=t.getAttribute("data-imageid");n&&(document.getElementById("imagemodal").getElementsByTagName("picture")[0].innerHTML='<source srcset="/image.php?imageid='.concat(n,"&amp;width=").concat(window.innerWidth,'&amp;format=webp" type="image/webp">\n                <img src="/image.php?imageid=').concat(n,"&amp;width=").concat(window.innerWidth,'&amp;format=jpeg" width="auto" style="max-height: 48vh; max-width: 100%;" alt="photo">'),document.getElementById("imagemodaldelete").setAttribute("data-imageid",n),$("#".concat("imagemodal")).modal({}))}},{key:"inputChangeHandler",value:function(e,t){var n=this;t.stopPropagation(),console.log("got image field input change event");var r=document.getElementById(e);r.files.length?xg(this,Ag,Dg).call(this,r.files).then((function(){n.fireEvent($p.EVENT_CHANGE)})):this.fireEvent($p.EVENT_CHANGE)}}],[{key:"isEmpty",value:function(e){return!e||0===e.length}},{key:"licenseModal",value:function(){var e=document.createElement("div");return e.innerHTML='<div class="modal fade" id="'.concat(i.LICENSE_MODAL,'" tabindex="-1" role="dialog" aria-labelledby="').concat(i.LICENSE_MODAL,'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title" id="').concat(i.LICENSE_MODAL,'Title">Image licensing</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <p>By choosing to submit images with your Garden Wildflower Hunt records you agree to license the image under the terms of the Creative Common Attribution 4.0 International license (CC BY 4.0).</p>\n        <p>The following is a summary of (and not a substitute for) the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">license</a>.</p>\n        <p>Licensees are free to:</p>\n        <ul class="license-properties">\n<li>\n<strong>Share</strong> â copy and redistribute the material in any medium or format\n</li>\n<li>\n<strong>Adapt</strong> â remix, transform, and build upon the material for any purpose, even commercially.\n</li>\n</ul>\n<p>Licensees are most follow these term:</p>\n<ul>\n<li>\n<p>\n<strong>Attribution</strong> â licensees must give appropriate credit, provide a link to the license, and indicate if changes were made.\n</p>\n</li>\n</ul>\n<p>Full details of the license are here: <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0 license</a></p>\n\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n      </div>\n    </div>\n  </div>\n</div>'),e.firstChild}}]),i}();function Dg(e){this.parentForm.pingOccurrence();var t,n=[],r=_g(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;n.push(sS.fromFile(o))}}catch(e){r.e(e)}finally{r.f()}return xg(this,Hg,jg).call(this,n)}function jg(e){var t=this;if(e.length){var n=e.shift();return n.save(this.parentForm.surveyId,this.parentForm.occurrenceId,this.parentForm.projectId).then((function(e){console.log("Added image '".concat(n.id,"'")),console.log({jsonDescription:e}),t._value.images.push(n),t.updateView()}),(function(e){console.log("Failed to add image ".concat(n.id)),console.log({"Failure reason":e})})).finally((function(){return xg(t,Hg,jg).call(t,e)}))}return Promise.resolve()}function Fg(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}r(Pg,"LICENSE_MODAL","imagelicensemodal");var Ug=new WeakMap,Bg=new WeakMap;function Jg(e,t,n){if(n.length>2){var r=n.pop();return"".concat(n.join(e+" ")," ").concat(t," ").concat(r)}return n.join(" ".concat(t," "))}function Yg(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Gg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Gg(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function Gg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Kg(e,t,n){Vg(e,t),t.set(e,n)}function Vg(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function qg(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function Xg(e,t,n){return function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(e,t),function(e,t){if(void 0===e)throw new TypeError("attempted to get private static field before its declaration")}(n),function(e,t){return t.get?t.get.call(e):t.value}(e,n)}!function(t){fo(i,$p);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(t){var n;return e(this,i),Fg(uo(n=o.call(this,t)),Ug,{writable:!0,value:void 0}),Fg(uo(n),Bg,{writable:!0,value:void 0}),r(uo(n),"_value",""),r(uo(n),"_inputType","text"),r(uo(n),"_autocomplete",""),t&&(t.type&&(n._inputType=t.type),t.placeholder&&(n.placeholder=t.placeholder),t.autocomplete&&(n._autocomplete=t.autocomplete)),n}n(i,[{key:"value",get:function(){return this._value},set:function(e){this._value=void 0===e||null==e?"":e.trim(),this.updateView()}},{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(mo(this,Ug)).value=$p.cleanRawString(this._value))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",So(this,Bg,e.id=$p.nextId),So(this,Ug,$p.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=mo(this,Ug),t.textContent=this.label;var n=e.appendChild(document.createElement("input"));n.className="form-control",n.id=mo(this,Ug);try{n.type=this._inputType}catch(e){console.log("Failed to set type '".concat(this._inputType,"'"))}if(this.placeholder&&(n.placeholder=this.placeholder),this._autocomplete&&(n.autocomplete=this._autocomplete,"off"===this._autocomplete&&(n.name=kp())),this.completion===$p.COMPLETION_COMPULSORY&&(n.required=!0),this.validationMessage){var r=e.appendChild(document.createElement("div"));r.className="invalid-feedback",r.innerHTML=this.validationMessage}this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText),n.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"markValidity",value:function(e){var t=document.getElementById(mo(this,Ug));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"inputChangeHandler",value:function(e){e.stopPropagation(),console.log("got input field change event"),this.value=$p.cleanRawString(document.getElementById(mo(this,Ug)).value),this.fireEvent($p.EVENT_CHANGE)}}],[{key:"summariseImpl",value:function(e,t,n){return""!==n[e]&&null!==n[e]&&void 0!==n[e]?Dp(n[e].trim()):""}}])}();var Wg=new WeakMap,Qg=new WeakMap,Zg=new WeakSet,zg=function(t){fo(i,$p);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(t){var n,a,c;return e(this,i),Vg(a=uo(n=o.call(this,t)),c=Zg),c.add(a),Kg(uo(n),Wg,{writable:!0,value:void 0}),Kg(uo(n),Qg,{writable:!0,value:void 0}),r(uo(n),"options",{}),r(uo(n),"includeOtherFreeText",!0),r(uo(n),"_value",{selection:[],other:null}),t&&(t.options&&(n.options=t.options),t.hasOwnProperty("includeOtherFreeText")&&(n.includeOtherFreeText=t.includeOtherFreeText)),n}return n(i,[{key:"value",get:function(){return this._value},set:function(e){this._value=e||{selection:[],other:null},this.updateView()}},{key:"updateView",value:function(){if(this._fieldEl){var e,t=Yg(document.querySelectorAll("".concat(Xg(i,i,eN),"#").concat(mo(this,Wg),' input[type="checkbox"]')));try{for(t.s();!(e=t.n()).done;){var n=e.value,r=n.checked=this._value.selection.includes(n.name);if(n.name===i.KEY_OTHER&&mo(this,Qg)){var o=document.getElementById(mo(this,Qg));o.style.display=r?"block":"none",o.value=null===this._value.other?"":this._value.other.trim()}}}catch(e){t.e(e)}finally{t.f()}}}},{key:"buildField",value:function(){if(!this.options)throw new Error("Options have not been set before call to buildField()");var e=document.createElement(Xg(i,i,eN));e.className="form-group",So(this,Wg,e.id=$p.nextId);var t=e.appendChild(document.createElement("label"));for(var n in t.style.display="block",t.textContent=this.label,this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText),this.options)this.options.hasOwnProperty(n)&&qg(this,Zg,$g).call(this,e,n,this.options[n]);if(this.validationMessage){var r=e.appendChild(document.createElement("div"));r.className="invalid-feedback",r.innerHTML=this.validationMessage}e.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"inputChangeHandler",value:function(e){e.stopPropagation();var t,n={selection:[],other:null};mo(this,Qg)&&(t=document.getElementById(mo(this,Qg)));var r,o=Yg(document.querySelectorAll("".concat(Xg(i,i,eN),"#").concat(mo(this,Wg),' input[type="checkbox"]:checked')));try{for(o.s();!(r=o.n()).done;){var a=r.value;n.selection[n.selection.length]=a.name,a.name===i.KEY_OTHER&&mo(this,Qg)&&(n.other=$p.cleanRawInput(t))}}catch(e){o.e(e)}finally{o.f()}this.value=n,this.fireEvent($p.EVENT_CHANGE)}}],[{key:"summariseImpl",value:function(e,t,n){var r=t.summary,o=[];if(n[e].selection.length){var i,a=Yg(n[e].selection);try{for(a.s();!(i=a.n()).done;){var c=i.value;"other"===c&&n[e].other?o[o.length]="".concat(t.attributes.options[c].summary||t.attributes.options[c].label," (").concat(n[e].other,")"):o[o.length]=t.attributes.options[c].summary||t.attributes.options[c].label}}catch(e){a.e(e)}finally{a.f()}return Dp("".concat(r.summaryPrefix," ").concat(Jg(",","or",o)))}return""}}]),i}();function $g(e,t,n){var r=e.appendChild(document.createElement("div"));r.className="form-check";var o=r.appendChild(document.createElement("input"));o.type="checkbox",o.className="form-check-input",o.id=$p.nextId,o.name=t;var i=r.appendChild(document.createElement("label"));if(i.htmlFor=o.id,i.className="form-check-label",i.textContent=n.label,zg.KEY_OTHER===t&&this.includeOtherFreeText){var a=r.appendChild(document.createElement("input"));a.id=So(this,Qg,$p.nextId),a.className="form-control",a.style.display="none"}}r(zg,"KEY_OTHER","other");var eN={writable:!0,value:"fieldset"};function tN(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return nN(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nN(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function nN(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rN(e,t,n){oN(e,t),t.set(e,n)}function oN(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function iN(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var aN=new WeakMap,cN=new WeakMap,sN=new WeakMap,uN=new WeakSet;function lN(e,t,n,r){var o=t.appendChild(document.createElement("option"));if(o.value=n,o.innerText=r.label,zg.KEY_OTHER===n&&this.includeOtherFreeText){var i=e.appendChild(document.createElement("input"));i.id=So(this,sN,$p.nextId),i.className="form-control"}}!function(t){fo(i,$p);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(t){var n,a,c;return e(this,i),oN(a=uo(n=o.call(this,t)),c=uN),c.add(a),rN(uo(n),aN,{writable:!0,value:void 0}),rN(uo(n),cN,{writable:!0,value:void 0}),rN(uo(n),sN,{writable:!0,value:void 0}),r(uo(n),"options",{}),r(uo(n),"placeholder",""),r(uo(n),"includeOtherFreeText",!0),r(uo(n),"_value",{selection:[],other:null}),t&&(t.options&&(n.options=t.options),t.hasOwnProperty("includeOtherFreeText")&&(n.includeOtherFreeText=t.includeOtherFreeText),t.placeholder&&(n.placeholder=t.placeholder)),n}n(i,[{key:"value",get:function(){return this._value},set:function(e){this._value=e||{selection:[],other:null},this.updateView()}},{key:"markValidity",value:function(e){var t=document.getElementById(mo(this,cN));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"updateView",value:function(){if(this._fieldEl){var e,t=tN(document.querySelectorAll("select#".concat(mo(this,cN)," option")));try{for(t.s();!(e=t.n()).done;){var n=e.value;if(""!==n.value){var r=n.selected=this._value.selection.includes(n.value);if(n.value===zg.KEY_OTHER&&mo(this,sN)){var o=document.getElementById(mo(this,sN));o.style.display=r?"block":"none",o.value=null===this._value.other?"":this._value.other.trim()}}else n.selected=0===this._value.selection.length}}catch(e){t.e(e)}finally{t.f()}}}},{key:"buildField",value:function(){if(!this.options)throw new Error("Options have not been set before call to buildField()");var e=document.createElement(function(e,t,n){return function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(e,t),function(e,t){if(void 0===e)throw new TypeError("attempted to get private static field before its declaration")}(n),function(e,t){return t.get?t.get.call(e):t.value}(e,n)}(i,i,dN));e.className="form-group",So(this,aN,e.id=$p.nextId),So(this,cN,$p.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=mo(this,cN),t.style.display="block",t.innerHTML=this.label;var n=document.createElement("select");for(var r in n.id=mo(this,cN),n.className="custom-select",this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText),this.placeholder&&iN(this,uN,lN).call(this,e,n,"",{label:this.placeholder}),this.options)this.options.hasOwnProperty(r)&&iN(this,uN,lN).call(this,e,n,r,this.options[r]);if(e.appendChild(n),this.validationMessage){var o=e.appendChild(document.createElement("div"));o.className="invalid-feedback",o.innerHTML=this.validationMessage}e.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"inputChangeHandler",value:function(e){e.stopPropagation();var t,n={selection:[],other:null};mo(this,sN)&&(t=document.getElementById(mo(this,sN)));var r,o=tN(document.querySelectorAll("select#".concat(mo(this,cN)," option:checked")));try{for(o.s();!(r=o.n()).done;){var i=r.value;""!==i.value&&(n.selection[n.selection.length]=i.value,i.name===zg.KEY_OTHER&&mo(this,sN)&&(n.other=$p.cleanRawInput(t)))}}catch(e){o.e(e)}finally{o.f()}this.value=n,this.fireEvent($p.EVENT_CHANGE)}}],[{key:"isEmpty",value:function(e){return 0===e.selection.length||""===e.selection[0]}},{key:"summariseImpl",value:function(e,t,n){var r=t.summary,o=[];if(n[e].selection.length){var i,a=tN(n[e].selection);try{for(a.s();!(i=a.n()).done;){var c=i.value;"other"===c&&n[e].other?o[o.length]="".concat(t.attributes.options[c].summary||t.attributes.options[c].label," (").concat(n[e].other,")"):o[o.length]=t.attributes.options[c].summary||t.attributes.options[c].label}}catch(e){a.e(e)}finally{a.f()}return Dp("".concat(r.summaryPrefix," ").concat(Jg(",","or",o)))}return""}}])}();var dN={writable:!0,value:"fieldset"},fN=nr,hN=Kp.start,pN=Wp("trimStart"),vN=pN?function(){return hN(this)}:"".trimStart;fN({target:"String",proto:!0,name:"trimStart",forced:pN},{trimStart:vN,trimLeft:vN});var yN=nr,SN=Oc.find,mN=Oo,gN=!0;function NN(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bN(e,t,n){TN(e,t),t.set(e,n)}function TN(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function EN(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}"find"in[]&&Array(1).find((function(){gN=!1})),yN({target:"Array",proto:!0,forced:gN},{find:function(e){return SN(this,e,arguments.length>1?arguments[1]:void 0)}}),mN("find");var wN=new WeakMap,_N=new WeakMap,ON=new WeakMap,IN=new WeakMap,RN=new WeakMap,CN=new WeakMap,xN=new WeakMap,LN=new WeakMap,MN=new WeakSet,kN=function(t){fo(i,$p);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(t){var n,a,c;return e(this,i),TN(a=uo(n=o.call(this,t)),c=MN),c.add(a),r(uo(n),"taxonSearch",void 0),bN(uo(n),wN,{writable:!0,value:void 0}),bN(uo(n),_N,{writable:!0,value:void 0}),bN(uo(n),ON,{writable:!0,value:void 0}),bN(uo(n),IN,{writable:!0,value:void 0}),bN(uo(n),RN,{writable:!0,value:null}),bN(uo(n),CN,{writable:!0,value:null}),bN(uo(n),xN,{writable:!0,value:null}),r(uo(n),"_lastInputValue",""),bN(uo(n),LN,{writable:!0,value:[]}),r(uo(n),"_value",{taxonId:"",taxonName:"",vernacularMatch:!1}),n.taxonSearch=new bg,n}return n(i,[{key:"value",get:function(){return this._value},set:function(e){var t;e&&e.taxonId?(t=jp.fromId(e.taxonId),this._value={taxonId:t.id,taxonName:e.vernacularMatch?t.vernacular:t.nameString,vernacularMatch:e.vernacularMatch}):this._value={taxonId:"",taxonName:e&&e.taxonName?e.taxonName:"",vernacularMatch:null},this.updateView()}},{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(mo(this,wN)).value=this._value.taxonName,this._lastInputValue=this._value.taxonName)}},{key:"markValidity",value:function(e){var t=document.getElementById(mo(this,wN));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",So(this,IN,e.id=$p.nextId),So(this,wN,$p.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=mo(this,wN),t.textContent=this.label;var n=e.appendChild(document.createElement("div"));n.className="dropdown-wrapper";var r=n.appendChild(document.createElement("input"));if(r.className="form-control dropdown-input",r.id=mo(this,wN),r.autocomplete="off",r.spellcheck=!1,this.validationMessage){var o=n.appendChild(document.createElement("div"));o.className="invalid-feedback",o.innerHTML=this.validationMessage}var i=n.appendChild(document.createElement("div"));i.className="dropdown-list",So(this,_N,i.id=$p.nextId),So(this,ON,$p.nextId),this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText),r.addEventListener("keydown",this.keydownHandler.bind(this)),r.addEventListener("input",this.inputHandler.bind(this)),r.addEventListener("change",this.inputChangeHandler.bind(this)),e.addEventListener("focusin",this.focusHandler.bind(this)),e.addEventListener("focusout",this.blurHandler.bind(this)),i.addEventListener("click",this.dropboxClickHandler.bind(this)),this._fieldEl=e}},{key:"keydownHandler",value:function(e){switch(this._lastInputValue=e.target.value.trimLeft(),e.key){case"Enter":case"ArrowUp":case"ArrowDown":e.preventDefault()}}},{key:"inputHandler",value:function(e){e.target.value.trimLeft()!==this._lastInputValue&&EN(this,MN,AN).call(this,e.target)}},{key:"keyupHandler",value:function(e){!e.key||1!==e.key.length&&"Backspace"!==e.key&&"Delete"!==e.key||EN(this,MN,AN).call(this,e.target)}},{key:"focusHandler",value:function(e){console.log("focused");var t=document.getElementById(mo(this,_N));if(!t.classList.contains("dropdown-focused")){var n=document.getElementById(mo(this,wN));EN(this,MN,AN).call(this,n),t.classList.add("dropdown-focused")}}},{key:"blurHandler",value:function(e){var t=this;mo(this,RN)&&(clearTimeout(mo(this,RN)),So(this,RN,null)),setTimeout((function(){document.getElementById(mo(t,_N)).classList.remove("dropdown-focused")}),500)}},{key:"refreshSearchResultsList",value:function(){var e=document.getElementById(mo(this,_N));if(mo(this,LN).length){var t,n=[],r=0,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return NN(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?NN(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}(mo(this,LN));try{for(o.s();!(t=o.n()).done;){var i=t.value;n[n.length]='<a class="list-group-item list-group-item-action" href="#" data-occurrenceId="'.concat(i.entityId,'" data-resultnumber="').concat(r,'">').concat(bg.formatter(i),"</a>"),++r}}catch(e){o.e(e)}finally{o.f()}e.innerHTML='<div class="list-group" id="'.concat(mo(this,ON),'">').concat(n.join(""),"</div>")}else e.innerHTML="";So(this,xN,null)}},{key:"dropboxClickHandler",value:function(e){console.log("click handler"),console.log(e);var t=e.target.closest("a");if(console.log(t),mo(this,CN)&&(clearTimeout(mo(this,CN)),So(this,CN,null),console.log("cleared a pending change event")),t&&t.dataset.occurrenceid){e.preventDefault(),console.log("got target ".concat(t.dataset.occurrenceid));var n=mo(this,LN)[t.dataset.resultnumber];this.value={taxonId:n.entityId,taxonName:n.vernacularMatched?n.vernacular:n.qname,vernacularMatch:n.vernacularMatched},this.fireEvent($p.EVENT_CHANGE)}}},{key:"inputChangeHandler",value:function(e){var t=this;e.stopPropagation(),console.log("got taxon field input change event"),mo(this,CN)&&clearTimeout(mo(this,CN)),So(this,CN,setTimeout((function(){console.log("processing taxon field input change event");var e=mo(t,LN).find((function(e){return e.exact}));e?(console.log("exact match"),t.value={taxonId:e.entityId,taxonName:e.vernacularMatched?e.vernacular:e.qname,vernacularMatch:e.vernacularMatched}):(console.log("no match"),t.value={taxonId:"",taxonName:document.getElementById(mo(t,wN)).value.trim(),vernacularMatch:null}),console.log(t._value),t.fireEvent($p.EVENT_CHANGE)}),500))}}],[{key:"isEmpty",value:function(e){return!e||e&&!e.taxonName}},{key:"cleanRawInput",value:function(e){return e.value.trim().replace(/\s\s+/g," ")}}]),i}();function AN(e){var t=this,n=$p.cleanRawInput(e);mo(this,RN)&&clearTimeout(mo(this,RN)),n.length>=bg.MIN_SEARCH_LENGTH?So(this,RN,setTimeout((function(){So(t,LN,t.taxonSearch.lookup($p.cleanRawInput(document.getElementById(mo(t,wN))))),console.log(mo(t,LN)),t.refreshSearchResultsList(),So(t,RN,null)}),kN.timeoutDelay)):(So(this,LN,[]),this.refreshSearchResultsList())}function HN(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}r(kN,"timeoutDelay",50);var PN=new WeakMap,DN=new WeakMap;!function(t){fo(i,$p);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(t){var n;return e(this,i),HN(uo(n=o.call(this,t)),PN,{writable:!0,value:void 0}),HN(uo(n),DN,{writable:!0,value:void 0}),r(uo(n),"_value",""),r(uo(n),"_autocomplete",""),t&&(t.options&&(n.options=t.options),t.placeholder&&(n.placeholder=t.placeholder),t.autocomplete&&(n._autocomplete=t.autocomplete)),n}n(i,[{key:"value",get:function(){return this._value},set:function(e){this._value=void 0===e||null==e?"":e.trim(),this.updateView()}},{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(mo(this,PN)).value=$p.cleanRawString(this._value))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",So(this,DN,e.id=$p.nextId),So(this,PN,$p.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=mo(this,PN),t.textContent=this.label;var n=e.appendChild(document.createElement("textarea"));if(n.className="form-control",n.id=mo(this,PN),this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText),this._autocomplete&&(n.autocomplete=this._autocomplete,"off"===this._autocomplete&&(n.name=kp())),this.validationMessage){var r=e.appendChild(document.createElement("div"));r.className="invalid-feedback",r.innerHTML=this.validationMessage}n.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"inputChangeHandler",value:function(e){e.stopPropagation(),console.log("got text area field input change event"),this.value=$p.cleanRawString(document.getElementById(mo(this,PN)).value),this.fireEvent($p.EVENT_CHANGE)}}],[{key:"summariseImpl",value:function(e,t,n){return""!==n[e]&&null!==n[e]&&void 0!==n[e]?Dp(n[e].trim()):""}}])}();var jN=function(){var e=function(){};return e.tetradOffsets={E:[0,8e3],J:[2e3,8e3],P:[4e3,8e3],U:[6e3,8e3],Z:[8e3,8e3],D:[0,6e3],I:[2e3,6e3],N:[4e3,6e3],T:[6e3,6e3],Y:[8e3,6e3],C:[0,4e3],H:[2e3,4e3],M:[4e3,4e3],S:[6e3,4e3],X:[8e3,4e3],B:[0,2e3],G:[2e3,2e3],L:[4e3,2e3],R:[6e3,2e3],W:[8e3,2e3],A:[0,0],F:[2e3,0],K:[4e3,0],Q:[6e3,0],V:[8e3,0]},e.quadrantOffsets={NW:[0,5e3],NE:[5e3,5e3],SW:[0,0],SE:[5e3,0]},e.letterMapping={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,J:8,K:9,L:10,M:11,N:12,O:13,P:14,Q:15,R:16,S:17,T:18,U:19,V:20,W:21,X:22,Y:23,Z:24},e.tetradLetters="ABCDEFGHIJKLMNPQRSTUVWXYZ",e.prototype.preciseGridRef="",e.prototype.length=0,e.prototype.hectad="",e.prototype.tetrad="",e.prototype.tetradLetter="",e.prototype.quadrant="",e.prototype.quadrantCode="",e.prototype.set_tetrad=function(){if(this.tetradLetter=e.tetradLetters.substr(5*(Math.floor(this.gridCoords.x%1e4/1e3)>>1)+(Math.floor(this.gridCoords.y%1e4/1e3)>>1),1),!this.tetradLetter)throw new Error("Failed to get tetrad letter when processing '"+this.preciseGridRef+"', easting="+this.gridCoords.x+" northing="+this.gridCoords.y);this.tetrad=this.hectad+this.tetradLetter},e.get_normalized_precision=function(e,t){return e>2e3?1e4:e>1e3?2e3:e>100?1e3:e>10?100:e>1?10:t||1},e}(),FN=function(e,t){this.lat=e,this.lng=t},UN=Math.PI/180,BN=180/Math.PI,JN=function(e,t){this.lat=e,this.lng=t};JN.prototype.to_WGS84=function(){var e=6377563.396,t=.00667054007,n=this.lat*UN,r=Math.sin(n),o=this.lng*UN,i=e/Math.sqrt(1-t*(r*r)),a=i*Math.cos(n)*Math.cos(o),c=i*Math.cos(n)*Math.sin(o),s=(1-t)*i*r,u=-204894e-10,l=7.28190110241429e-7,d=119748977294801e-20,f=446.448+a*(1+u)+-l*c+d*s,h=408261589226812e-20*a-124.157+c*(1+u)+-l*s,p=542.06+-d*a+l*c+s*(1+u);e=6378137,t=.00669438003;for(var v=Math.sqrt(f*f+h*h),y=Math.atan(p/(v*(1-t))),S=1;S<10;++S){var m=Math.sin(y);y=Math.atan((p+t*(e/Math.sqrt(1-t*(m*m)))*m)/v)}return new FN(BN*y,BN*Math.atan(h/f))},JN.from_wgs84=function(e){var t=e.lat*UN,n=e.lng*UN,r=.00669438037928458,o=.0066705397616,i=20.4894*1e-6,a=6378137/Math.sqrt(1-r*Math.sin(t)*Math.sin(t)),c=(a+0)*Math.cos(t)*Math.cos(n),s=(a+0)*Math.cos(t)*Math.sin(n),u=((1-r)*a+0)*Math.sin(t),l=-.1502/3600*UN,d=-.247/3600*UN,f=-.8421/3600*UN,h=c+c*i-s*f+u*d-446.448,p=c*f+s+s*i-u*l+125.157,v=-1*c*d+s*l+u+u*i+-542.06,y=Math.atan(p/h),S=Math.sqrt(h*h+p*p),m=Math.atan(v/(S*(1-o)));a=6377563.396/Math.sqrt(1-o*(Math.sin(m)*Math.sin(m)));for(var g=1,N=0;g>.001;)N=Math.atan((v+o*a*Math.sin(m))/S),g=Math.abs(N-m),m=N;return new JN(m*BN,y*BN)};var YN=function(){var e=function(e,t){this.lat=e,this.lng=t};return e._transform=function(t,n,r,o,i,a,c,s,u,l,d,f,h,p){var v=1e-6*p,y=r/Math.sqrt(1-o*(Math.sin(t)*Math.sin(t))),S=(y+i)*Math.cos(t)*Math.cos(n),m=(y+i)*Math.cos(t)*Math.sin(n),g=((1-o)*y+i)*Math.sin(t),N=d/3600*UN,b=f/3600*UN,T=h/3600*UN,E=S+S*v-m*T+g*b+s,w=S*T+m+m*v-g*N+u,_=-1*S*b+m*N+g+g*v+l;n=Math.atan(w/E);var O=Math.sqrt(E*E+w*w);t=Math.atan(_/(O*(1-c))),y=a/Math.sqrt(1-c*(Math.sin(t)*Math.sin(t)));for(var I=1,R=0;I>.001;)R=Math.atan((_+c*y*Math.sin(t))/O),I=Math.abs(R-t),t=R;return new e(t,n)},e._Marc=function(e,t,n,r){return e*((1+t+5/4*(t*t)+5/4*(t*t*t))*(r-n)-(3*t+t*t*3+21/8*(t*t*t))*Math.sin(r-n)*Math.cos(r+n)+(15/8*(t*t)+15/8*(t*t*t))*Math.sin(2*(r-n))*Math.cos(2*(r+n))-35/24*(t*t*t)*Math.sin(3*(r-n))*Math.cos(3*(r+n)))},e}(),GN=function(){var e=function(e,t){this.lat=e,this.lng=t};return e.from_wgs84=function(t){var n=t.lat*UN,r=t.lng*UN,o=YN._transform(n,r,6378137,.00669438037928458,0,6378388,.0067226700223333,83.901,98.127,118.635,0,0,0,0);return new e(o.lat*BN,o.lng*BN)},e}(),KN=function(e,t){this.lat=e,this.lng=t};KN.prototype.to_WGS84=function(){var e=YN._transform(this.lat*UN,this.lng*UN,6377340.189,.00667054015,0,6378137,.00669438037928458,482.53,-130.596,564.557,-1.042,-.214,-.631,-8.15);return new FN(e.lat*BN,e.lng*BN)},KN.from_wgs84=function(e){var t=e.lat*UN,n=e.lng*UN,r=YN._transform(t,n,6378137,.00669438037928458,0,6377340.189,.00667054015,-482.53,130.596,-564.557,1.042,.214,.631,8.15);return new KN(r.lat*BN,r.lng*BN)};var VN=function(){};VN.tetradLetters="ABCDEFGHIJKLMNPQRSTUVWXYZ",VN.tetradLettersRowFirst="AFKQVBGLRWCHMSXDINTYEJPUZ",VN.from_latlng=function(e,t){if(t>=-8.74&&e>49.88){var n=new JN.from_wgs84(new FN(e,t)).to_os_coords();if(n.x>=0&&n.is_gb_hectad())return n}if(t<-5.3&&e>51.34&&t>-11&&e<55.73){var r=new KN.from_wgs84(new FN(e,t)).to_os_coords();return r.x<0||r.y<0?null:r}var o=new GN.from_wgs84(new FN(e,t)).to_os_coords();return o.x>=5e5&&o.x<6e5&&o.y>=54e5&&o.y<56e5?o:null},VN.calculate_tetrad=function(e,t){return e>=0&&t>=0?VN.tetradLetters.charAt(5*Math.floor(e%1e4/2e3)+Math.floor(t%1e4/2e3)):""},VN.prototype.toString=function(){return this.x+","+this.y};var qN=function(e,t,n,r){var o="00000"+Math.floor(t),i="00000"+Math.floor(n);if(2e3===r)return e+o.charAt(o.length-5)+i.charAt(i.length-5)+VN.calculate_tetrad(t,n);if(1e5===r)return e;5e3===r&&(r=1e4);var a=Math.round(Math.log10(r));return e+(a?o.slice(-5,-a)+i.slice(-5,-a):o.slice(-5)+i.slice(-5))},XN=function(e,t){this.x=e,this.y=t};(XN.prototype=new VN).constructor=XN,XN.prototype.country="CI",XN.prototype.to_latLng=function(){var e=.0067226700223333,t=6375836.6448,n=this.x-5e5,r=WN(this.y,0,t,0,.0016863406508729017,6354369.181221601),o=t/Math.sqrt(1-e*(Math.sin(r)*Math.sin(r))),i=o*(1-e)/(1-e*Math.sin(r)*Math.sin(r)),a=o/i-1,c=Math.tan(r)*Math.tan(r),s=Math.pow(Math.tan(r),4),u=Math.pow(Math.tan(r),6),l=Math.pow(Math.cos(r),-1),d=Math.tan(r)/(2*i*o),f=Math.tan(r)/(24*i*(o*o*o))*(5+3*c+a-9*a*c),h=Math.tan(r)/(720*i*Math.pow(o,5))*(61+90*c+45*s),p=r-n*n*d+Math.pow(n,4)*f-Math.pow(n,6)*h,v=Math.pow(Math.cos(r),-1)/o,y=l/(o*o*o*6)*(o/i+2*c),S=l/(120*Math.pow(o,5))*(5+28*c+24*s),m=l/(5040*Math.pow(o,7))*(61+662*c+1320*s+720*u),g=n*v-.0523598775598-n*n*n*y+Math.pow(n,5)*S-Math.pow(n,7)*m,N=XN.convert_to_wgs(p,g);return new FN(N.lat*BN,N.lng*BN)};var WN=function(e,t,n,r,o,i){for(var a=(e-t)/n+r,c=XN.marc(i,o,r,a),s=(e-t-c)/n+a,u=0;Math.abs(e-t-c)>1e-5&&u<20;)u+=1,s=(e-t-c)/n+a,c=YN._Marc(i,o,r,s),a=s;return s};XN.prototype.to_gridref=function(e){return this.y>=55e5?qN("WA",this.x-5e5,this.y-55e5,e||1):this.y<55e5?qN("WV",this.x-5e5,this.y-54e5,e||1):null},XN.prototype.to_hectad=function(){return this.y>55e5?"WA"+this.x.toString().substring(1,2)+this.y.toString().substring(2,3):this.y<55e5?"WV"+this.x.toString().substring(1,2)+this.y.toString().substring(2,3):null};var QN=function(){var e=function(){};return(e.prototype=new jN).constructor=e,e.prototype.country="CI",e.prototype.GridCoords=XN,e.prototype.from_string=function(t){var n,r=t.replace(/[\[\]\s\t\.\/-]+/g,"").toUpperCase(),o="";/[ABCDEFGHIJKLMNPQRSTUVWXYZ]$/.test(r)&&(jN.quadrantOffsets.hasOwnProperty(r.substr(r.length-2))?(this.quadrantCode=r.substr(r.length-2),r=r.substr(0,r.length-2)):(o=r.substr(r.length-1),r=r.substr(0,r.length-1))),/^(W[AV](?:\d\d){1,5})$/.test(r)?(n=e.gridref_string_to_e_n_l(r))?(this.length=n.length,this.gridCoords=new XN(n.e,n.n),this.hectad=this.gridCoords.to_gridref(1e4),1e4===this.length&&(o||this.quadrantCode)?o?(this.preciseGridRef=r+o,this.tetrad=this.hectad+o,this.tetradLetter=o,this.length=2e3,this.gridCoords.x+=jN.tetradOffsets[o][0],this.gridCoords.y+=jN.tetradOffsets[o][1]):(this.preciseGridRef=r+this.quadrantCode,this.tetradLetter="",this.tetrad="",this.quadrant=this.preciseGridRef,this.length=5e3,this.gridCoords.x+=jN.quadrantOffsets[this.quadrantCode][0],this.gridCoords.y+=jN.quadrantOffsets[this.quadrantCode][1]):(this.preciseGridRef=r,this.length<=1e3&&this.set_tetrad())):(this.error=!0,this.errorMessage="Grid reference format not understood (odd length)."):(this.error=!0,this.errorMessage="Channel Island grid reference format not understood. ('"+t+"')")},e.prototype.parse_well_formed=e.prototype.from_string,e.gridref_string_to_e_n_l=function(e){var t,n,r,o,i=e.substr(0,2);if("WA"===i)t=55e5;else{if("WV"!==i)return Logger("Bad Channel Island grid letters: '"+i+"'"),!1;t=54e5}var a=e.substr(2);switch(a.length){case 2:n=1e4*a.charAt(0),r=1e4*a.charAt(1),o=1e4;break;case 4:n=1e3*a.substr(0,2),r=1e3*a.substr(2),o=1e3;break;case 6:n=100*a.substr(0,3),r=100*a.substr(3),o=100;break;case 8:n=10*a.substr(0,4),r=10*a.substr(4),o=10;break;case 10:n=parseInt(a.substr(0,5),10),r=parseInt(a.substr(5),10),o=1;break;default:return Logger("Bad length for Channel Island grid ref '"+e+"'"),!1}return{e:n+5e5,n:r+t,length:o}},e}(),ZN=function(e,t){this.x=e,this.y=t};(ZN.prototype=new VN).constructor=ZN,ZN.prototype.country="GB",ZN.gbHectads="SV80SV81SV90SV91SW32SW33SW42SW43SW44SW52SW53SW54SW61SW62SW63SW64SW65SW71SW72SW73SW74SW75SW76SW81SW82SW83SW84SW85SW86SW87SW95SW96SW97SS10SS11SS20SS21SS30SW83SW84SW85SW93SW94SW95SW96SW97SW98SX03SX04SX05SX06SX07SX08SX09SX14SX15SX16SX17SX18SX19SX25SX26SX27SX28SX29SX35SX36SX37SX38SX39SX44SX45SX46SX47SS70SS80SS81SS90SS91ST00ST01ST10ST11ST20ST21ST30SX37SX44SX45SX46SX47SX48SX54SX55SX56SX57SX58SX63SX64SX65SX66SX67SX68SX69SX73SX74SX75SX76SX77SX78SX79SX83SX84SX85SX86SX87SX88SX89SX94SX95SX96SX97SX98SX99SY07SY08SY09SY18SY19SY28SY29SY38SY39SS14SS20SS21SS22SS30SS31SS32SS40SS41SS42SS43SS44SS50SS51SS52SS53SS54SS60SS61SS62SS63SS64SS70SS71SS72SS73SS74SS75SS80SS81SS82SS83SS91SS92ST01ST02SX28SX29SX37SX38SX39SX48SX49SX58SX59SX68SX69SX79SS73SS74SS82SS83SS84SS92SS93SS94ST01ST02ST03ST04ST11ST12ST13ST14ST20ST21ST22ST23ST24ST25ST30ST31ST32ST33ST34ST40ST41ST42ST50ST51ST52ST61ST62ST71ST72ST24ST25ST26ST32ST33ST34ST35ST36ST37ST42ST43ST44ST45ST46ST47ST52ST53ST54ST55ST56ST57ST62ST63ST64ST65ST66ST67ST72ST73ST74ST75ST76ST77ST83ST84ST85ST86SP00SP10ST76ST77ST85ST86ST87ST88ST89ST96ST97ST98ST99SU06SU07SU08SU09SU16SU17SU18SU19SU26SU27SU28SU29SU36SU37ST73ST74ST75ST76ST82ST83ST84ST85ST86ST91ST92ST93ST94ST95ST96SU01SU02SU03SU04SU05SU06SU11SU12SU13SU14SU15SU16SU21SU22SU23SU24SU25SU26SU31SU32SU34SU35SU36ST20ST30ST40ST50ST51ST60ST61ST70ST71ST72ST73ST80ST81ST82ST83ST90ST91ST92SU00SU01SU02SU10SU11SY39SY48SY49SY58SY59SY66SY67SY68SY69SY77SY78SY79SY87SY88SY89SY97SY98SY99SZ07SZ08SZ09SZ28SZ38SZ39SZ47SZ48SZ49SZ57SZ58SZ59SZ68SZ69SU00SU01SU02SU10SU11SU12SU20SU21SU22SU23SU30SU31SU32SU33SU40SU41SU42SU43SU50SU51SU52SU60SU61SU62SU70SU71SU72SZ08SZ09SZ19SZ29SZ38SZ39SZ49SZ59SZ69SZ79SU23SU24SU25SU33SU34SU35SU36SU42SU43SU44SU45SU46SU52SU53SU54SU55SU56SU62SU63SU64SU65SU66SU72SU73SU74SU75SU76SU82SU83SU84SU85SU86SU70SU71SU72SU80SU81SU82SU83SU90SU91SU92SU93SZ79SZ89SZ99TQ00TQ01TQ02TQ03TQ10TQ11TQ12TQ13TQ20TQ21TQ22TQ23TQ30TQ31TQ32TQ20TQ21TQ22TQ23TQ30TQ31TQ32TQ33TQ40TQ41TQ42TQ43TQ44TQ50TQ51TQ52TQ53TQ54TQ60TQ61TQ62TQ63TQ70TQ71TQ72TQ80TQ81TQ82TQ91TQ92TV49TV59TV69TQ65TQ72TQ73TQ74TQ75TQ76TQ77TQ82TQ83TQ84TQ85TQ86TQ87TQ91TQ92TQ93TQ94TQ95TQ96TQ97TR01TR02TR03TR04TR05TR06TR07TR12TR13TR14TR15TR16TR23TR24TR25TR26TR27TR33TR34TR35TR36TR37TR46TR47TQ35TQ36TQ37TQ38TQ43TQ44TQ45TQ46TQ47TQ48TQ53TQ54TQ55TQ56TQ57TQ58TQ63TQ64TQ65TQ66TQ67TQ72TQ73TQ74TQ75TQ76TQ77TQ78TQ87TQ88TQ97SU83SU84SU85SU86SU93SU94SU95SU96SU97TQ03TQ04TQ05TQ06TQ07TQ13TQ14TQ15TQ16TQ17TQ23TQ24TQ25TQ26TQ27TQ33TQ34TQ35TQ36TQ37TQ38TQ43TQ44TQ45TL30TL40TL50TL60TL70TL80TL90TM00TQ38TQ39TQ47TQ48TQ49TQ57TQ58TQ59TQ67TQ68TQ69TQ77TQ78TQ79TQ88TQ89TQ98TQ99TR08TR09TR19TL30TL31TL34TL40TL41TL42TL43TL44TL50TL51TL52TL53TL54TL60TL61TL62TL63TL64TL70TL71TL72TL73TL74TL80TL81TL82TL83TL84TL90TL91TL92TL93TM01TM02TM03TM11TM12TM13TM21TM22TM23TQ49SP81SP90SP91TL00TL01TL02TL10TL11TL12TL13TL20TL21TL22TL23TL24TL30TL31TL32TL33TL34TL41TL42TL43TL44TL51TL52TQ09TQ19TQ29TQ39TL20TL30TQ06TQ07TQ08TQ09TQ16TQ17TQ18TQ19TQ27TQ28TQ29TQ37TQ38TQ39SP20SP30SP40SP41SP50SU19SU26SU27SU28SU29SU36SU37SU38SU39SU46SU47SU48SU49SU56SU57SU58SU59SU66SU67SU68SU69SU76SU77SU78SU86SU87SU88SU96SU97SU98SP10SP20SP21SP22SP23SP30SP31SP32SP33SP34SP40SP41SP42SP43SP44SP45SP50SP51SP52SP53SP54SP60SP61SP62SP63SP70SU29SU39SU49SU57SU58SU59SU67SU68SU69SU77SU78SU79SP51SP53SP60SP61SP62SP63SP64SP70SP71SP72SP73SP74SP80SP81SP82SP83SP84SP85SP90SP91SP92SP93SP94SP95SU78SU79SU88SU89SU97SU98SU99TL00TL01TQ07TQ08TQ09TG40TG50TM03TM04TM05TM06TM07TM13TM14TM15TM16TM17TM23TM24TM25TM26TM27TM28TM33TM34TM35TM36TM37TM38TM39TM44TM45TM46TM47TM48TM49TM57TM58TM59TL64TL65TL66TL67TL68TL74TL75TL76TL77TL78TL83TL84TL85TL86TL87TL88TL93TL94TL95TL96TL97TL98TM03TM04TM05TM06TM07TM08TG00TG01TG02TG03TG04TG10TG11TG12TG13TG14TG20TG21TG22TG23TG24TG30TG31TG32TG33TG40TG41TG42TG50TG51TM07TM08TM09TM17TM18TM19TM27TM28TM29TM38TM39TM49TM59TF40TF41TF42TF50TF51TF52TF53TF60TF61TF62TF63TF64TF70TF71TF72TF73TF74TF80TF81TF82TF83TF84TF90TF91TF92TF93TF94TG00TG01TG02TG03TG04TL49TL59TL68TL69TL78TL79TL87TL88TL89TL98TL99TM07TM08TM09TF20TF30TF31TF40TF41TF50TL15TL19TL23TL24TL25TL26TL28TL29TL33TL34TL35TL36TL37TL38TL39TL44TL45TL46TL47TL48TL49TL54TL55TL56TL57TL58TL59TL63TL64TL65TL66TL67TL68TL69TL75TL76SP91SP92SP93SP94SP95SP96TL01TL02TL03TL04TL05TL06TL07TL11TL12TL13TL14TL15TL16TL23TL24TL25TL06TL07TL08TL09TL15TL16TL17TL18TL19TL25TL26TL27TL28TL29TL36TL37TL38TL39SK90SP43SP44SP45SP46SP53SP54SP55SP56SP57SP58SP63SP64SP65SP66SP67SP68SP73SP74SP75SP76SP77SP78SP79SP84SP85SP86SP87SP88SP89SP95SP96SP97SP98SP99TF00TF10TF20TL06TL07TL08TL09TL18TL19TL29SO70SO71SO80SO81SO82SO83SO90SO91SO92SO93SO94SP00SP01SP02SP03SP04SP10SP11SP12SP13SP14SP15SP20SP21SP22SP23SP24SP25ST99SU09SU19SU29SO50SO51SO60SO61SO62SO63SO70SO71SO72SO73SO80SO81SO82SO83SO90ST57ST58ST59ST66ST67ST68ST69ST76ST77ST78ST79ST87ST88ST89ST98ST99SO10SO11SO20SO21SO22SO23SO30SO31SO32SO40SO41SO42SO50SO51ST18ST19ST27ST28ST29ST37ST38ST39ST47ST48ST49ST58ST59SO22SO23SO24SO25SO26SO32SO33SO34SO35SO36SO37SO41SO42SO43SO44SO45SO46SO47SO51SO52SO53SO54SO55SO56SO57SO61SO62SO63SO64SO65SO66SO73SO74SO75SO76SO56SO64SO65SO66SO67SO72SO73SO74SO75SO76SO77SO78SO82SO83SO84SO85SO86SO87SO88SO93SO94SO95SO96SO97SO98SO99SP03SP04SP05SP06SP07SP08SP13SP14SP16SP17SP18SK10SK20SK30SP04SP05SP06SP07SP08SP09SP14SP15SP16SP17SP18SP19SP22SP23SP24SP25SP26SP27SP28SP29SP33SP34SP35SP36SP37SP38SP39SP44SP45SP46SP47SP48SP49SP55SP56SP57SP58SJ63SJ70SJ71SJ72SJ73SJ74SJ75SJ80SJ81SJ82SJ83SJ84SJ85SJ86SJ90SJ91SJ92SJ93SJ94SJ95SJ96SK00SK01SK02SK03SK04SK05SK06SK10SK11SK12SK13SK14SK15SK16SK20SK21SK22SO77SO78SO79SO88SO89SO98SO99SP08SP09SP19SP29SJ20SJ21SJ22SJ23SJ30SJ31SJ32SJ33SJ34SJ40SJ41SJ42SJ43SJ50SJ51SJ52SJ53SJ54SJ60SJ61SJ62SJ63SJ64SJ70SJ71SJ72SJ73SJ74SJ80SO17SO18SO27SO28SO29SO37SO38SO39SO46SO47SO48SO49SO56SO57SO58SO59SO66SO67SO68SO69SO77SO78SO79SO88SO89SN50SN60SN61SN70SN71SN80SN81SN90SO00SO01SO10SO11SS38SS39SS48SS49SS58SS59SS68SS69SS77SS78SS79SS87SS88SS89SS96SS97SS98SS99ST06ST07ST08ST09ST16ST17ST18ST19ST26ST27ST28SN70SN71SN74SN80SN81SN82SN83SN84SN85SN86SN90SN91SN92SN93SN94SN95SN96SO00SO01SO02SO03SO04SO05SO06SO10SO11SO12SO13SO14SO21SO22SO23SO24SN86SN87SN96SN97SO04SO05SO06SO07SO08SO13SO14SO15SO16SO17SO18SO24SO25SO26SO27SO36SO37SN01SN02SN10SN11SN12SN20SN21SN22SN23SN24SN30SN31SN32SN33SN34SN40SN41SN42SN43SN44SN50SN51SN52SN53SN54SN60SN61SN62SN63SN64SN65SN71SN72SN73SN74SN75SN81SN82SN83SN84SS39SS49SS59SM50SM62SM70SM71SM72SM73SM80SM81SM82SM83SM84SM90SM91SM92SM93SM94SN00SN01SN02SN03SN04SN10SN11SN12SN13SN14SN22SN23SN24SR89SR99SS09SS19SN14SN15SN24SN25SN33SN34SN35SN36SN44SN45SN46SN54SN55SN56SN57SN58SN64SN65SN66SN67SN68SN69SN74SN75SN76SN77SN78SN79SN84SN85SN86SN87SN88SN89SH70SH71SH80SH81SH90SH91SH92SJ00SJ01SJ02SJ03SJ10SJ11SJ12SJ20SJ21SJ22SJ31SN69SN78SN79SN87SN88SN89SN97SN98SN99SO07SO08SO09SO18SO19SO28SO29SO39SH50SH51SH52SH53SH54SH60SH61SH62SH63SH64SH70SH71SH72SH73SH74SH80SH81SH82SH83SH84SH91SH92SH93SH94SH95SJ03SJ04SJ05SJ13SJ14SN59SN69SN79SH12SH13SH22SH23SH24SH32SH33SH34SH43SH44SH45SH46SH53SH54SH55SH56SH57SH64SH65SH66SH67SH74SH75SH76SH77SH78SH84SH85SH86SH87SH88SH74SH75SH76SH77SH84SH85SH86SH87SH88SH94SH95SH96SH97SH98SJ02SJ03SJ04SJ05SJ06SJ07SJ08SJ12SJ13SJ14SJ15SJ16SJ17SJ22SJ23SJ24SJ25SJ26SJ33SJ34SJ35SJ43SJ44SJ45SJ53SJ54SH97SH98SJ06SJ07SJ08SJ15SJ16SJ17SJ18SJ25SJ26SJ27SJ35SJ36SJ37SH27SH28SH29SH36SH37SH38SH39SH46SH47SH48SH49SH56SH57SH58SH59SH67SH68SK81SK82SK83SK84SK85SK86SK87SK90SK91SK92SK93SK94SK95SK96SK97TF00TF01TF02TF03TF04TF05TF06TF07TF10TF11TF12TF13TF14TF15TF16TF17TF20TF21TF22TF23TF24TF25TF30TF31TF32TF33TF34TF41TF42TF43TF44TF52SE60SE70SE71SE80SE81SE82SE90SE91SE92SK78SK79SK87SK88SK89SK97SK98SK99TA00TA01TA02TA10TA11TA12TA20TA21TA30TA31TA40TF07TF08TF09TF15TF16TF17TF18TF19TF24TF25TF26TF27TF28TF29TF33TF34TF35TF36TF37TF38TF39TF43TF44TF45TF46TF47TF48TF49TF54TF55TF56TF57TF58SK20SK21SK30SK31SK32SK40SK41SK42SK43SK50SK51SK52SK60SK61SK62SK70SK71SK72SK73SK74SK80SK81SK82SK83SK84SK90SK91SP39SP48SP49SP57SP58SP59SP68SP69SP78SP79SP89SP99TF00TF01SE60SE70SK42SK43SK44SK45SK46SK52SK53SK54SK55SK56SK57SK58SK59SK62SK63SK64SK65SK66SK67SK68SK69SK72SK73SK74SK75SK76SK77SK78SK79SK84SK85SK86SK87SK88SK89SK97SJ98SJ99SK03SK06SK07SK08SK09SK11SK12SK13SK14SK15SK16SK17SK18SK19SK21SK22SK23SK24SK25SK26SK27SK28SK31SK32SK33SK34SK35SK36SK37SK38SK42SK43SK44SK45SK46SK47SK48SK53SK56SK57SD90SE00SE10SJ18SJ19SJ27SJ28SJ29SJ35SJ36SJ37SJ38SJ39SJ44SJ45SJ46SJ47SJ48SJ54SJ55SJ56SJ57SJ58SJ63SJ64SJ65SJ66SJ67SJ68SJ69SJ74SJ75SJ76SJ77SJ78SJ79SJ85SJ86SJ87SJ88SJ89SJ96SJ97SJ98SJ99SK06SK07SK08SK09SK19SD20SD21SD22SD30SD31SD32SD40SD41SD42SD50SD51SD52SD53SD60SD61SD62SD63SD70SD71SD72SD73SD74SD80SD81SD82SD83SD84SD90SD91SD92SD93SD94SJ29SJ38SJ39SJ48SJ49SJ58SJ59SJ68SJ69SJ79SJ88SJ89SJ99SD22SD23SD32SD33SD34SD35SD36SD42SD43SD44SD45SD46SD47SD52SD53SD54SD55SD56SD57SD63SD64SD65SD66SD67SD68SD73SD78SE53SE54SE62SE63SE64SE65SE72SE73SE74SE75SE76SE82SE83SE84SE85SE86SE87SE92SE93SE94SE95SE96SE97SE98TA02TA03TA04TA05TA06TA07TA08TA12TA13TA14TA15TA16TA17TA18TA21TA22TA23TA24TA26TA27TA31TA32TA33TA41TA42NZ30NZ31NZ40NZ41NZ42NZ50NZ51NZ52NZ60NZ61NZ62NZ70NZ71NZ72NZ80NZ81NZ90NZ91SE37SE38SE39SE46SE47SE48SE49SE55SE56SE57SE58SE59SE64SE65SE66SE67SE68SE69SE75SE76SE77SE78SE79SE86SE87SE88SE89SE97SE98SE99TA08TA09TA18SD84SD90SD91SD92SD93SD94SD95SE00SE01SE02SE03SE04SE10SE11SE12SE13SE14SE20SE21SE22SE23SE30SE31SE32SE33SE40SE41SE42SE50SE51SE52SE60SE61SE62SE70SE71SE72SE81SE82SK18SK19SK28SK29SK38SK39SK47SK48SK49SK57SK58SK59SK69SD54SD55SD64SD65SD66SD67SD68SD73SD74SD75SD76SD77SD78SD84SD85SD86SD87SD88SD94SD95SD96SD97SD98SE04SE05SE06SE07SE13SE14SE15SE16SE17SE23SE24SE25SE26SE27SE32SE33SE34SE35SE36SE37SE42SE43SE44SE45SE46SE52SE53SE54SE55SE56SE62SE63SE64SE65SE72NY72NY80NY81NY82NY90NY91NY92NZ00NZ01NZ02NZ10NZ11NZ20NZ21NZ30NZ31SD68SD69SD78SD79SD88SD89SD97SD98SD99SE07SE08SE09SE17SE18SE19SE27SE28SE29SE36SE37SE38SE39SE46SE47NY73NY74NY82NY83NY84NY92NY93NY94NY95NZ01NZ02NZ03NZ04NZ05NZ11NZ12NZ13NZ14NZ15NZ16NZ20NZ21NZ22NZ23NZ24NZ25NZ26NZ30NZ31NZ32NZ33NZ34NZ35NZ36NZ41NZ42NZ43NZ44NZ45NZ46NZ52NZ53NT60NT70NT80NT90NU00NU10NU20NY58NY59NY64NY65NY66NY67NY68NY69NY74NY75NY76NY77NY78NY79NY84NY85NY86NY87NY88NY89NY94NY95NY96NY97NY98NY99NZ04NZ05NZ06NZ07NZ08NZ09NZ15NZ16NZ17NZ18NZ19NZ26NZ27NZ28NZ29NZ36NZ37NZ38NZ39NT70NT71NT73NT80NT81NT82NT83NT84NT90NT91NT92NT93NT94NT95NU00NU01NU02NU03NU04NU05NU10NU11NU12NU13NU14NU20NU21NU22NU23NZ09NZ19NY20NY21NY30NY31NY40NY41NY42NY50NY51NY52NY53NY60NY61NY62NY63NY70NY71NY72NY73NY80NY81NY82NY83SD16SD17SD18SD19SD26SD27SD28SD29SD36SD37SD38SD39SD46SD47SD48SD49SD57SD58SD59SD67SD68SD69SD78SD79SD89NX90NX91NX92NX93NY00NY01NY02NY03NY04NY05NY10NY11NY12NY13NY14NY15NY16NY20NY21NY22NY23NY24NY25NY26NY31NY32NY33NY34NY35NY36NY37NY41NY42NY43NY44NY45NY46NY47NY48NY52NY53NY54NY55NY56NY57NY58NY62NY63NY64NY65NY66NY67NY68NY73NY74NY75NY84SD08SD09SD17SD18SD19SD28SD29NX30NX40SC16SC17SC26SC27SC28SC36SC37SC38SC39SC47SC48SC49NS60NS61NS70NS71NS72NS80NS81NS90NT00NT01NT10NT11NT20NT21NT30NX69NX78NX79NX88NX89NX96NX97NX98NX99NY05NY06NY07NY08NY09NY16NY17NY18NY19NY26NY27NY28NY29NY36NY37NY38NY39NY47NY48NY49NS50NS60NX36NX37NX38NX45NX46NX47NX48NX49NX54NX55NX56NX57NX58NX59NX64NX65NX66NX67NX68NX69NX74NX75NX76NX77NX78NX79NX84NX85NX86NX87NX88NX95NX96NX97NX98NY05NY06NW95NW96NW97NX03NX04NX05NX06NX07NX13NX14NX15NX16NX17NX24NX25NX26NX27NX33NX34NX35NX36NX37NX43NX44NX45NX46NS00NS10NS14NS15NS16NS20NS21NS23NS24NS25NS26NS30NS31NS32NS33NS34NS35NS36NS40NS41NS42NS43NS44NS45NS50NS51NS52NS53NS54NS55NS60NS61NS62NS63NS64NS71NS72NS73NX07NX08NX09NX17NX18NX19NX27NX28NX29NX37NX38NX39NX48NX49NX59NS16NS17NS26NS27NS35NS36NS37NS44NS45NS46NS47NS54NS55NS56NS64NS65NS66NS53NS54NS55NS56NS57NS63NS64NS65NS66NS67NS71NS72NS73NS74NS75NS76NS77NS80NS81NS82NS83NS84NS85NS86NS87NS90NS91NS92NS93NS94NS95NS96NT00NT01NT02NT03NT04NT05NT14NT01NT02NT03NT04NT05NT11NT12NT13NT14NT15NT21NT22NT23NT24NT25NT32NT33NT34NT10NT11NT20NT21NT22NT23NT30NT31NT32NT33NT34NT41NT42NT43NT44NT53NT20NT30NT31NT40NT41NT42NT43NT44NT50NT51NT52NT53NT54NT60NT61NT62NT63NT64NT70NT71NT72NT73NT74NT81NT82NT83NY39NY47NY48NY49NY58NY59NY69NT44NT45NT46NT53NT54NT55NT56NT63NT64NT65NT66NT73NT74NT75NT76NT77NT83NT84NT85NT86NT87NT94NT95NT96NT36NT37NT45NT46NT47NT48NT55NT56NT57NT58NT65NT66NT67NT68NT76NT77NS95NS96NT05NT06NT15NT16NT17NT24NT25NT26NT27NT34NT35NT36NT37NT43NT44NT45NT46NS86NS87NS95NS96NS97NS98NT06NT07NT08NT16NT17NO00NO01NO10NO11NO20NO21NO22NO30NO31NO32NO40NO41NO42NO50NO51NO52NO60NO61NS99NT08NT09NT18NT19NT28NT29NT39NT49NT59NT69NN30NN31NN40NN41NS38NS39NS47NS48NS49NS57NS58NS59NS67NS68NS69NS77NS78NS79NS86NS87NS88NS89NS97NS98NN21NN22NN30NN31NN32NN40NN41NN42NN50NN51NN52NN60NN61NN70NN71NN80NN81NN90NN91NO00NS49NS59NS69NS79NS88NS89NS98NS99NT08NT09NN22NN23NN32NN33NN34NN35NN42NN43NN44NN45NN46NN47NN51NN52NN53NN54NN55NN56NN57NN61NN62NN63NN64NN65NN66NN67NN71NN72NN73NN74NN75NN76NN77NN81NN82NN83NN84NN85NN86NN90NN91NN92NN93NN94NN95NN96NO00NO01NO02NO03NO04NO11NO12NO13NO21NN56NN57NN66NN67NN68NN76NN77NN78NN86NN87NN88NN94NN95NN96NN97NN98NO02NO03NO04NO05NO06NO07NO08NO11NO12NO13NO14NO15NO16NO17NO21NO22NO23NO24NO25NO32NO33NO34NO15NO16NO17NO23NO24NO25NO26NO27NO28NO32NO33NO34NO35NO36NO37NO38NO42NO43NO44NO45NO46NO47NO48NO53NO54NO55NO56NO57NO58NO63NO64NO65NO66NO67NO74NO75NO76NJ60NJ70NJ80NJ90NO57NO58NO66NO67NO68NO69NO76NO77NO78NO79NO86NO87NO88NO89NO99NH90NJ00NJ10NJ11NJ20NJ21NJ30NJ31NJ32NJ40NJ41NJ42NJ50NJ51NJ52NJ60NJ61NJ62NJ70NJ71NJ72NJ80NJ81NJ82NJ90NJ91NJ92NK02NN98NN99NO07NO08NO09NO17NO18NO19NO27NO28NO29NO37NO38NO39NO48NO49NO58NO59NO68NO69NO79NO89NJ31NJ32NJ33NJ34NJ42NJ43NJ44NJ52NJ53NJ54NJ55NJ62NJ63NJ64NJ65NJ72NJ73NJ74NJ75NJ76NJ82NJ83NJ84NJ85NJ86NJ92NJ93NJ94NJ95NJ96NK02NK03NK04NK05NK06NK13NK14NK15NH90NJ00NJ01NJ10NJ11NJ12NJ13NJ14NJ21NJ22NJ23NJ24NJ25NJ32NJ33NJ34NJ35NJ36NJ42NJ43NJ44NJ45NJ46NJ54NJ55NJ56NJ64NJ65NJ66NJ74NJ75NJ76NJ86NN99NH72NH81NH82NH91NH92NH93NH94NH95NH96NJ00NJ01NJ02NJ03NJ04NJ05NJ06NJ11NJ12NJ13NJ14NJ15NJ16NJ17NJ23NJ24NJ25NJ26NJ27NJ34NJ35NJ36NJ45NH01NH02NH10NH11NH12NH13NH14NH20NH21NH22NH23NH24NH30NH31NH32NH33NH34NH40NH41NH42NH43NH44NH50NH51NH52NH53NH54NH60NH61NH62NH63NH64NH70NH71NH72NH73NH74NH75NH80NH81NH82NH83NH84NH85NH90NH91NH92NH93NH94NH95NH96NJ00NJ01NN39NN46NN47NN48NN49NN56NN57NN58NN59NN67NN68NN69NN77NN78NN79NN88NN89NN98NN99NG60NG70NG71NG72NG80NG81NG82NG90NG91NH00NH01NH10NH20NH30NM46NM47NM54NM55NM56NM57NM64NM65NM66NM67NM68NM69NM74NM75NM76NM77NM78NM79NM84NM85NM86NM87NM88NM89NM95NM96NM97NM98NM99NN05NN06NN07NN08NN09NN16NN17NN18NN19NN26NN27NN28NN29NN35NN36NN37NN38NN39NN46NN47NN48NN49NN57NN58NN59NM70NM71NM72NM73NM80NM81NM82NM83NM84NM90NM91NM92NM93NM94NM95NN00NN01NN02NN03NN04NN05NN10NN11NN12NN13NN14NN15NN16NN20NN21NN22NN23NN24NN25NN26NN30NN33NN34NN35NN36NN44NN45NN46NR79NR88NR89NR96NR97NR98NR99NS06NS07NS08NS09NS16NS17NS18NS19NS28NS29NN20NN21NN30NN31NS28NS29NS37NS38NS39NS46NS47NS48NS56NS57NR82NR83NR84NR92NR93NR94NR95NR96NR97NS01NS02NS03NS04NS05NS06NS07NS15NS16NR50NR51NR60NR61NR62NR63NR64NR65NR67NR68NR70NR71NR72NR73NR74NR75NR76NR77NR78NR79NR83NR84NR85NR86NR87NR88NR89NR95NR96NM40NM60NM61NM70NM71NR15NR16NR24NR25NR26NR27NR34NR35NR36NR37NR38NR39NR44NR45NR46NR47NR48NR49NR56NR57NR58NR59NR67NR68NR69NR79NL93NL94NM04NM05NM15NM16NM21NM22NM23NM24NM25NM26NM31NM32NM33NM34NM35NM41NM42NM43NM44NM45NM51NM52NM53NM54NM55NM61NM62NM63NM64NM72NM73NG13NG14NG15NG20NG23NG24NG25NG26NG30NG31NG32NG33NG34NG35NG36NG37NG38NG40NG41NG42NG43NG44NG45NG46NG47NG50NG51NG52NG53NG54NG55NG56NG60NG61NG62NG63NG64NG65NG66NG71NG72NG82NM19NM29NM37NM38NM39NM47NM48NM49NM59NB90NB91NC00NC01NC10NC11NC20NC21NG63NG64NG65NG72NG73NG74NG75NG76NG77NG78NG79NG82NG83NG84NG85NG86NG87NG88NG89NG91NG92NG93NG94NG95NG96NG97NG98NG99NH00NH01NH02NH03NH04NH05NH06NH07NH08NH09NH10NH11NH15NH16NH17NH18NH19NH27NH28NH29NC10NC20NC21NC30NC31NC40NH02NH03NH04NH05NH06NH07NH12NH13NH14NH15NH16NH17NH19NH23NH24NH25NH26NH27NH28NH29NH34NH35NH36NH37NH38NH39NH44NH45NH46NH47NH48NH49NH54NH55NH56NH57NH58NH59NH64NH65NH66NH67NH68NH69NH75NH76NH77NH78NH86NH87NH88NH97NH98NC22NC30NC31NC32NC33NC40NC41NC42NC43NC50NC51NC52NC60NC61NC62NC63NC70NC71NC72NC73NC74NC80NC81NC82NC83NC84NC90NC91NC92NC93ND01ND02NH49NH59NH68NH69NH78NH79NH88NH89NC01NC02NC03NC10NC11NC12NC13NC14NC15NC16NC20NC21NC22NC23NC24NC25NC26NC27NC31NC32NC33NC34NC35NC36NC37NC42NC43NC44NC45NC46NC52NC53NC54NC55NC56NC62NC63NC64NC65NC66NC73NC74NC75NC76NC83NC84NC85NC86NC93NC94NC95NC96NC92NC93NC94NC95NC96ND01ND02ND03ND04ND05ND06ND07ND12ND13ND14ND15ND16ND17ND23ND24ND25ND26ND27ND33ND34ND35ND36ND37ND47HW63HW83HX62NA00NA10NA64NA74NA81NA90NA91NA92NA93NB00NB01NB02NB03NB10NB11NB12NB13NB14NB20NB21NB22NB23NB24NB30NB31NB32NB33NB34NB35NB40NB41NB42NB43NB44NB45NB46NB52NB53NB54NB55NB56NF09NF19NF56NF58NF60NF61NF66NF67NF68NF70NF71NF72NF73NF74NF75NF76NF77NF80NF81NF82NF83NF84NF85NF86NF87NF88NF89NF95NF96NF97NF98NF99NG07NG08NG09NG18NG19NG29NG49NL57NL58NL68NL69NL79HY10HY20HY21HY22HY23HY30HY31HY32HY33HY34HY35HY40HY41HY42HY43HY44HY45HY50HY51HY52HY53HY54HY55HY60HY61HY62HY63HY64HY73HY74HY75ND19ND28ND29ND38ND39ND47ND48ND49ND59HP40HP50HP51HP60HP61HT93HT94HU14HU15HU16HU24HU25HU26HU27HU28HU30HU31HU32HU33HU34HU35HU36HU37HU38HU39HU40HU41HU42HU43HU44HU45HU46HU47HU48HU49HU53HU54HU55HU56HU57HU58HU59HU66HU67HU68HU69HZ16HZ17HZ26HZ27",ZN.prototype.to_gridref=function(e){var t,n=this.x/1e5|0,r=this.y/1e5|0;t=r<5?n<5?"S":"T":r<10?n<5?"N":"O":n<5?"H":"J";var o=65+5*(4-r%5)+n%5;o>=73&&o++;var i=String.fromCharCode(o);return qN(t+i,this.x-1e5*n,this.y-1e5*r,e||1)},ZN.prototype.to_hectad=function(){var e=this.x/1e5|0,t=this.y/1e5|0,n=65+5*(4-t%5)+e%5;return n>=73&&n++,(t<5?e<5?"S":"T":t<10?e<5?"N":"O":e<5?"H":"J")+String.fromCharCode(n)+((this.x-1e5*e)/1e4|0)+((this.y-1e5*t)/1e4|0)},ZN.prototype.is_gb_hectad=function(){return-1!==ZN.gbHectads.indexOf(this.to_hectad())},ZN.prototype.to_latLng=function(){var e,t=4e5,n=.85521133347722,r=6377563.396,o=this.x,i=this.y,a=.0016732203289875,c=(i+1e5)/(.9996012717*r)+n;do{c+=(e=i+1e5-6353722.489*(1.0016767257674*(c-n)-.00502807228247412*Math.sin(c-n)*Math.cos(c+n)+5258157614724887e-21*Math.sin(2*(c-n))*Math.cos(2*(c+n))-35/24*a*a*a*Math.sin(3*(c-n))*Math.cos(3*(c+n))))/6375020.48098897}while(e>=.001);var s=Math.sin(c)*Math.sin(c),u=Math.tan(c)*Math.tan(c),l=1/Math.cos(c),d=.9996012717*r*Math.pow(1-.00667054007*s,-.5),f=6332495.651423464*Math.pow(1-.00667054007*s,-1.5),h=d/f-1,p=Math.tan(c)/(2*f*d),v=Math.tan(c)/(24*f*Math.pow(d,3))*(5+3*u+h-9*u*h),y=Math.tan(c)/(720*f*Math.pow(d,5))*(61+90*u+45*u*u),S=l/d,m=l/(6*d*d*d)*(d/f+2*u),g=l/(120*Math.pow(d,5))*(5+28*u+24*u*u),N=l/(5040*Math.pow(d,7))*(61+662*u+1320*u*u+720*u*u*u),b=c-p*Math.pow(o-t,2)+v*Math.pow(o-t,4)-y*Math.pow(o-t,6),T=S*(o-t)-.034906585039887-m*Math.pow(o-t,3)+g*Math.pow(o-t,5)-N*Math.pow(o-t,7);return new JN(BN*b,BN*T).to_WGS84()};var zN=function(){var e=function(){};return(e.prototype=new jN).constructor=e,e.prototype.country="GB",e.prototype.GridCoords=ZN,e.prototype.parse_well_formed=function(e){e.length>=5&&/^[A-Z]/.test(e.charAt(4))&&(jN.quadrantOffsets.hasOwnProperty(e.substr(e.length-2))?this.quadrantCode=e.substr(e.length-2):this.tetradLetter=e.charAt(4),e=e.substr(0,4)),this.parse_wellformed_gb_gr_string_no_tetrads(e),this.tetradLetter||this.quadrantCode?this.tetradLetter?(this.preciseGridRef=this.tetrad=this.hectad+this.tetradLetter,this.length=2e3,this.gridCoords.x+=jN.tetradOffsets[this.tetradLetter][0],this.gridCoords.y+=jN.tetradOffsets[this.tetradLetter][1]):(this.preciseGridRef=this.quadrant=e+this.quadrantCode,this.length=5e3,this.gridCoords.x+=jN.quadrantOffsets[this.quadrantCode][0],this.gridCoords.y+=jN.quadrantOffsets[this.quadrantCode][1]):(this.preciseGridRef=e,this.length<=1e3&&this.set_tetrad())},e.prototype.from_string=function(e){var t,n=e.replace(/[\[\]\s\t\.-]+/g,"").toUpperCase(),r="";if(/[ABCDEFGHIJKLMNPQRSTUVWXYZ]$/.test(n)&&(jN.quadrantOffsets.hasOwnProperty(n.substr(n.length-2))?(this.quadrantCode=n.substr(n.length-2),n=n.substr(0,n.length-2)):(r=n.substr(n.length-1),n=n.substr(0,n.length-1))),n===parseInt(n,10).toString()?n=n.substr(0,2)+"/"+n.substr(2):n.length>3&&"/"===n.charAt(2)&&/^[A-Z]{2}$/.test(n.substr(0,2))&&(n=n.replace("/","")),"VC"===n.substr(0,2))this.error=!0,this.errorMessage="Misplaced vice-county code in grid-reference field. ('"+n+"')",this.gridCoords=null,this.length=0;else if(null!==(t=n.match(/^([A-Z]{2}(?:\d\d){1,5})$/)))n=t[0],this.parse_wellformed_gb_gr_string_no_tetrads(n),this.length>0?1e4===this.length&&(r||this.quadrantCode)?r?(this.preciseGridRef=n+r,this.tetradLetter=r,this.tetrad=this.hectad+r,this.length=2e3,this.gridCoords.x+=jN.tetradOffsets[r][0],this.gridCoords.y+=jN.tetradOffsets[r][1]):(this.preciseGridRef=n+this.quadrantCode,this.tetradLetter="",this.tetrad="",this.quadrant=this.preciseGridRef,this.length=5e3,this.gridCoords.x+=jN.quadrantOffsets[this.quadrantCode][0],this.gridCoords.y+=jN.quadrantOffsets[this.quadrantCode][1]):(this.preciseGridRef=n,this.length<=1e3&&this.set_tetrad()):(this.error=!0,this.errorMessage="GB grid reference format not understood (strange length).");else if(/^([\d]{2})\/((?:\d\d){1,5})$/.test(n)){switch(this.parse_gr_string_without_tetrads(n),this.length){case 1e4:n=this.gridCoords.to_gridref(1e4),this.hectad=n,r?(n+=r,this.tetradLetter=r,this.tetrad=this.hectad+r,this.length=2e3,this.gridCoords.x+=jN.tetradOffsets[r][0],this.gridCoords.y+=jN.tetradOffsets[r][1]):this.quadrantCode&&(n+=this.quadrantCode,this.quadrant=n,this.length=5e3,this.gridCoords.x+=jN.quadrantOffsets[this.quadrantCode][0],this.gridCoords.y+=jN.quadrantOffsets[this.quadrantCode][1]);break;case 1e3:case 100:case 10:case 1:n=this.gridCoords.to_gridref(this.length),this.hectad=this.gridCoords.to_gridref(1e4),this.set_tetrad();break;default:this.error=!0,this.errorMessage="Bad grid square dimension ("+this.length+" m).",this.gridCoords=null,this.length=0}this.preciseGridRef=n}else this.gridCoords=null,this.length=0,this.error=!0,this.errorMessage="Grid reference format not understood. ('"+e+"')"},e.prototype.parse_gr_string_without_tetrads=function(e){var t,n,r,o;if(null!==(t=e.match(/^(\d{2})\/((?:\d\d){1,5})$/))){switch(t[1]){case"57":n=3e5,r=1e6;break;case"67":n=4e5,r=1e6;break;case"58":n=3e5,r=11e5;break;case"68":n=4e5,r=11e5;break;case"69":n=4e5,r=12e5;break;default:n=1e5*e.charAt(0),r=1e5*e.charAt(1)}o=t[2]}else{if(!jN.letterMapping.hasOwnProperty(e.charAt(0))||!jN.letterMapping.hasOwnProperty(e.charAt(1)))return this.length=0,void(this.gridCoords=null);var i=jN.letterMapping[e.charAt(0)],a=jN.letterMapping[e.charAt(1)];o=e.substr(2),n=i%5*5e5+a%5*1e5-1e6,r=5e5*-Math.floor(i/5)-1e5*Math.floor(a/5)+19e5}switch(o.length){case 2:this.gridCoords=new ZN(n+1e4*o.charAt(0),r+1e4*o.charAt(1)),this.length=1e4;break;case 4:this.gridCoords=new ZN(n+1e3*Math.floor(o/100),r+o%100*1e3),this.length=1e3;break;case 6:this.gridCoords=new ZN(n+100*Math.floor(o/1e3),r+o%1e3*100),this.length=100;break;case 8:this.gridCoords=new ZN(n+10*Math.floor(o/1e4),r+o%1e4*10),this.length=10;break;case 10:this.gridCoords=new ZN(n+Math.floor(o/1e5),r+o%1e5),this.length=1;break;default:Logger("Bad grid ref length, ref="+e),this.gridCoords=null,this.length=0}},e.prototype.parse_wellformed_gb_gr_string_no_tetrads=function(e){var t,n,r,o,i;switch(t=jN.letterMapping[e.charAt(0)],n=jN.letterMapping[e.charAt(1)],r=e.substr(2),o=t%5*5e5+n%5*1e5-1e6,i=5e5*-Math.floor(t/5)-1e5*Math.floor(n/5)+19e5,r.length){case 2:this.gridCoords=new ZN(o+1e4*r.charAt(0),i+1e4*r.charAt(1)),this.length=1e4,this.hectad=e;break;case 4:this.gridCoords=new ZN(o+1e3*Math.floor(r/100),i+r%100*1e3),this.length=1e3,this.hectad=e.substr(0,3)+e.substr(4,1);break;case 6:this.gridCoords=new ZN(o+100*Math.floor(r/1e3),i+r%1e3*100),this.length=100,this.hectad=e.substr(0,3)+e.substr(5,1);break;case 8:this.gridCoords=new ZN(o+10*Math.floor(r/1e4),i+r%1e4*10),this.length=10,this.hectad=e.substr(0,3)+e.substr(6,1);break;case 10:this.gridCoords=new ZN(o+Math.floor(r/1e5),i+r%1e5),this.length=1,this.hectad=e.substr(0,3)+e.substr(7,1);break;default:throw this.gridCoords=null,new Error("Bad grid ref length when parsing supposedly well-formed ref, ref='"+e+"'")}},e}(),$N=function(){var e=function(e,t){this.x=e,this.y=t};return(e.prototype=new VN).constructor=e,e.prototype.country="IE",e.irishGrid={0:["V","Q","L","F","A"],1:["W","R","M","G","B"],2:["X","S","N","H","C"],3:["Y","T","O","J","D"]},e.prototype.to_latLng=function(){var e=6377340.189,t=.0066705402933363,n=.0016732203841521,r=this.x-2e5,o=(5929615.3530033+(this.y-25e4)/1.000035)/6366691.7742864415,i=o+.002509826623715886*Math.sin(2*o)+36745487490091978e-22*Math.sin(4*o)+151*n*n*n/96*Math.sin(6*o),a=e/Math.sqrt(1-t*Math.sin(i)*Math.sin(i)),c=Math.tan(i)*Math.tan(i),s=.0067153352074207*Math.cos(i)*Math.cos(i),u=e*(1-t)/Math.pow(1-t*Math.sin(i)*Math.sin(i),1.5),l=r/(1.000035*a),d=i-a*Math.tan(i)/u*(l*l/2-(5+3*c+10*s-4*s*s-.0604380168667863)*l*l*l*l/24+(61+90*c+298*s+45*c*c-1.6922644722700164-3*s*s)*l*l*l*l*l*l/720);d*=BN;var f=(l-(1+2*c+s)*l*l*l/6+(5-2*s+28*c-3*s*s+.0537226816593656+24*c*c)*l*l*l*l*l/120)/Math.cos(i);return new KN(d,f=f*BN-8).to_WGS84()},e.prototype.to_gridref=function(t){var n=Math.floor(this.x/1e5),r=Math.floor(this.y/1e5);return e.irishGrid[n]&&e.irishGrid[n][r]?qN(e.irishGrid[n][r],this.x-1e5*n,this.y-1e5*r,t||1):null},e.prototype.to_hectad=function(){var t=Math.floor(this.x/1e5),n=Math.floor(this.y/1e5);return e.irishGrid[t]&&e.irishGrid[t][n]?e.irishGrid[t][n]+Math.floor(this.x%1e5/1e4)+Math.floor(this.y%1e5/1e4):""},e}(),eb=function(){var e=function(){};return(e.prototype=new jN).constructor=e,e.prototype.country="IE",e.prototype.GridCoords=$N,e.gridLetter={A:[0,4],B:[1,4],C:[2,4],D:[3,4],F:[0,3],G:[1,3],H:[2,3],J:[3,3],L:[0,2],M:[1,2],N:[2,2],O:[3,2],Q:[0,1],R:[1,1],S:[2,1],T:[3,1],V:[0,0],W:[1,0],X:[2,0],Y:[3,0]},e.prototype.from_string=function(t){var n=t.replace(/[\[\]\s\t\.-]+/g,"").toUpperCase();/[ABCDEFGHIJKLMNPQRSTUVWXYZ]$/.test(n)&&(e.quadrantOffsets.hasOwnProperty(n.substr(n.length-2))?(this.quadrantCode=n.substr(n.length-2),n=n.substr(0,n.length-2)):(this.tetradLetter=n.substr(n.length-1),n=n.substr(0,n.length-1))),this.parse_gr_string_without_tetrads(n),this.length>0?this.tetradLetter||this.quadrantCode?this.tetradLetter?(this.preciseGridRef=this.hectad+this.tetradLetter,this.tetrad=this.preciseGridRef,this.length=2e3,this.gridCoords.x+=e.tetradOffsets[this.tetradLetter][0],this.gridCoords.y+=e.tetradOffsets[this.tetradLetter][1]):(this.preciseGridRef=this.hectad+this.quadrantCode,this.quadrant=this.preciseGridRef,this.length=5e3,this.gridCoords.x+=e.quadrantOffsets[this.quadrantCode][0],this.gridCoords.y+=e.quadrantOffsets[this.quadrantCode][1]):(this.preciseGridRef=n,this.length<=1e3&&this.set_tetrad()):(this.error=!0,this.errorMessage="Irish grid reference format not understood. ('"+t+"')")},e.prototype.parse_well_formed=e.prototype.from_string,e._IE_GRID_LETTERS="VQLFAWRMGBXSNHCYTOJD",e.prototype.parse_gr_string_without_tetrads=function(t){var n,r,o,i;if(/^\d{2}\/(?:\d\d){1,5}$/.test(t)){if(n=parseInt(t.charAt(0),10),r=parseInt(t.charAt(1),10),n>3||r>4)return Logger("bad grid square, ref='"+t+"' (Ireland)"),this.length=0,!1;o=t.substr(3),i=e._IE_GRID_LETTERS.charAt(5*n+r),n*=1e5,r*=1e5}else{if(t=t.replace("/",""),!/^[ABCDFGHJLMNOQRSTVWXY](?:\d\d){1,5}$/.test(t))return this.length=0,this.gridCoords=null,!1;if(!t)return Logger("Bad (empty) Irish grid ref"),this.length=0,this.gridCoords=null,!1;i=t.charAt(0);var a=e._IE_GRID_LETTERS.indexOf(i);if(-1===a)return Logger("Bad grid ref grid-letter, ref='"+t+"' (Ireland)"),this.length=0,this.gridCoords=null,!1;n=1e5*Math.floor(a/5),r=a%5*1e5,o=t.substr(1)}switch(o.length){case 2:this.gridCoords=new $N(n+1e4*o.charAt(0),r+1e4*o.charAt(1)),this.length=1e4,this.hectad=i+o;break;case 4:this.gridCoords=new $N(n+1e3*Math.floor(o/100),r+o%100*1e3),this.length=1e3,this.hectad=i+o.charAt(0)+o.charAt(2);break;case 6:this.gridCoords=new $N(n+100*Math.floor(o/1e3),r+o%1e3*100),this.length=100,this.hectad=i+o.charAt(0)+o.charAt(3);break;case 8:this.gridCoords=new $N(n+10*Math.floor(o/1e4),r+o%1e4*10),this.length=10,this.hectad=i+o.charAt(0)+o.charAt(4);break;case 10:this.gridCoords=new $N(n+Math.floor(o/1e5),r+o%1e5),this.length=1,this.hectad=i+o.charAt(0)+o.charAt(5);break;default:return Logger("Bad grid ref length, ref='"+t+"' (Ireland)"),this.length=0,this.gridCoords=null,!1}return!0},e}();jN.from_string=function(e){var t,n=e.replace(/\s+/g,"").toUpperCase();if(!n)return!1;if(/^[A-Z]{1,2}\d{2}(?:[A-Z]|[NS][EW]|(?:\d{2}){0,4})?$/.test(n))return(t=/^.\d/.test(n)?new jN.GridRefIE:"W"===n.charAt(0)?new QN:new zN).parse_well_formed(n),!(!t.length||t.error)&&t;if((t=new zN).from_string(n),t.length&&!t.error)return t;if("W"===n.charAt(0)){if((t=new QN).from_string(n),t.length&&!t.error)return t}else if((t=new eb).from_string(n),t.length&&!t.error)return t;return!1};var tb=ZN;JN.prototype.to_os_coords=function(){var e=this.lat*UN,t=this.lng*UN,n=.0066705397616,r=Math.sin(e)*Math.sin(e),o=6375020.480988971/Math.sqrt(1-n*r),i=o*(1-n)/(1-n*r),a=o/i-1,c=t- -.03490658503988659,s=o*Math.cos(e),u=Math.pow(Math.cos(e),3),l=Math.tan(e)*Math.tan(e),d=o/6*u*(o/i-l),f=Math.pow(Math.cos(e),5),h=Math.pow(Math.tan(e),4),p=o/120*f*(5-18*l+h+14*a-58*l*a),v=4e5+c*s+Math.pow(c,3)*d+Math.pow(c,5)*p,y=YN._Marc(6353722.490487913,.0016732202503250907,.8552113334772214,e)+-1e5,S=o/2*Math.sin(e)*Math.cos(e),m=o/24*Math.sin(e)*Math.pow(Math.cos(e),3)*(5-Math.pow(Math.tan(e),2)+9*a),g=o/720*Math.sin(e)*f*(61-58*l+h),N=y+c*c*S+Math.pow(c,4)*m+Math.pow(c,6)*g;return new tb(Math.round(v),Math.round(N))};var nb=$N;KN.prototype.to_os_coords=function(){var e=this.lat*UN,t=this.lng*UN,n=.00667054015,r=Math.sin(e)*Math.sin(e),o=6377563.395906615/Math.sqrt(1-n*r),i=o*(1-n)/(1-n*r),a=o/i-1,c=t- -.13962634015954636,s=o*Math.cos(e),u=Math.pow(Math.cos(e),3),l=Math.tan(e)*Math.tan(e),d=o/6*u*(o/i-l),f=Math.pow(Math.cos(e),5),h=Math.pow(Math.tan(e),4),p=o/120*f*(5-18*l+h+14*a-58*l*a),v=2e5+c*s+Math.pow(c,3)*d+Math.pow(c,5)*p,y=YN._Marc(6356256.908205645,.0016732203841520518,.9337511498169663,e)+25e4,S=o/2*Math.sin(e)*Math.cos(e),m=o/24*Math.sin(e)*Math.pow(Math.cos(e),3)*(5-Math.pow(Math.tan(e),2)+9*a),g=o/720*Math.sin(e)*f*(61-58*l+h),N=y+c*c*S+Math.pow(c,4)*m+Math.pow(c,6)*g;return new nb(Math.round(v),Math.round(N))};var rb=XN;function ob(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}GN.prototype.to_os_coords=function(){var e=this.lat*UN,t=this.lng*UN,n=.0067226700223333,r=Math.sin(e)*Math.sin(e),o=6375836.6448/Math.sqrt(1-n*r),i=o*(1-n)/(1-n*r),a=o/i-1,c=t- -.0523598775598,s=o*Math.cos(e),u=Math.pow(Math.cos(e),3),l=Math.tan(e)*Math.tan(e),d=o/6*u*(o/i-l),f=Math.pow(Math.cos(e),5),h=Math.pow(Math.tan(e),4),p=o/120*f*(5-18*l+h+14*a-58*l*a),v=5e5+c*s+Math.pow(c,3)*d+Math.pow(c,5)*p,y=YN._Marc(6354369.181221601,.0016863406508729017,0,e)+0,S=o/2*Math.sin(e)*Math.cos(e),m=o/24*Math.sin(e)*Math.pow(Math.cos(e),3)*(5-Math.pow(Math.tan(e),2)+9*a),g=o/720*Math.sin(e)*f*(61-58*l+h),N=y+c*c*S+Math.pow(c,4)*m+Math.pow(c,6)*g;return new rb(Math.round(v),Math.round(N))};var ib=new WeakMap,ab=new WeakMap;!function(t){fo(i,$p);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(t){var n;return e(this,i),ob(uo(n=o.call(this,t)),ib,{writable:!0,value:void 0}),ob(uo(n),ab,{writable:!0,value:void 0}),r(uo(n),"_value",""),r(uo(n),"_inputType","text"),r(uo(n),"_autocomplete",""),t&&(t.type&&(n._inputType=t.type),t.placeholder&&(n.placeholder=t.placeholder),t.autocomplete&&(n._autocomplete=t.autocomplete)),n}n(i,[{key:"value",get:function(){return this._value},set:function(e){this._value=void 0===e||null==e?"":e.trim(),this.updateView()}},{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(mo(this,ib)).value=$p.cleanRawString(this._value))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",So(this,ab,e.id=$p.nextId),So(this,ib,$p.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=mo(this,ib),t.textContent=this.label;var n=e.appendChild(document.createElement("div"));n.className="input-group";var r=n.appendChild(document.createElement("input"));r.className="form-control",r.id=mo(this,ib),r.type="text",this.placeholder&&(r.placeholder=this.placeholder),this._autocomplete&&(r.autocomplete=this._autocomplete,"off"===this._autocomplete&&(r.name=kp()));var o=n.appendChild(document.createElement("span"));if(o.className="input-group-btn",navigator.geolocation){var i=o.appendChild(document.createElement("button"));i.id=$p.nextId,i.type="button",i.className="btn btn-outline-secondary btn-sm",i.title="use GPS";var a=i.appendChild(document.createElement("span"));a.className="material-icons",a.innerText="gps_not_fixed",i.addEventListener("click",this.gpsButtonClickHandler.bind(this))}if(this.completion===$p.COMPLETION_COMPULSORY&&(r.required=!0),this.validationMessage){var c=e.appendChild(document.createElement("div"));c.className="invalid-feedback",c.innerHTML=this.validationMessage}this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText),r.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"markValidity",value:function(e){var t=document.getElementById(mo(this,ib));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"inputChangeHandler",value:function(e){e.stopPropagation(),console.log("got input field change event"),this.value=$p.cleanRawString(document.getElementById(mo(this,ib)).value),this.fireEvent($p.EVENT_CHANGE)}},{key:"gpsButtonClickHandler",value:function(e){var t=this;console.log("got gps button click event"),navigator.geolocation.getCurrentPosition((function(e){var n=e.coords.latitude,r=e.coords.longitude;console.log("Got GPS fix ".concat(n," , ").concat(r));var o=VN.from_latlng(n,r).to_gridref(1e3);console.log("Got grid-ref: ".concat(o)),t.value=o,t.fireEvent($p.EVENT_CHANGE)}),(function(e){console.log("gps look-up failed"),console.log(e)}))}}],[{key:"summariseImpl",value:function(e,t,n){return""!==n[e]&&null!==n[e]&&void 0!==n[e]?Dp(n[e].trim()):""}}])}();var cb=function(t){fo(i,cv);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(t){var n;if(e(this,i),r(uo(n=o.call(this)),"_occurrence",void 0),r(uo(n),"surveyId",""),(this instanceof i?this.constructor:void 0)===i)throw new TypeError("Cannot construct OccurrenceForm instances directly, class should be overridden.");return t&&(n.model=t),n}return n(i,[{key:"formElement",get:function(){var e=arguments,t=Os(vo(i.prototype),"formElement",this);return this._formFieldsBuilt||(this.buildFormFields(),t.addEventListener("change",(function(){console.log("occurrence form change event"),console.log(e)}),{capture:!1})),t}},{key:"buildContentContainer",value:function(e){var t=e.appendChild(document.createElement("div"));t.className="card mt-3 ml-0 mr-0 mb-3";var n=t.appendChild(document.createElement("div"));return n.className="card-header",n.textContent=i.sectionTitle,this._formContentContainer=t.appendChild(document.createElement("div")),this._formContentContainer.className="card-body",this._formContentContainer}},{key:"occurrenceId",get:function(){return this._occurrence?this._occurrence.id:null}},{key:"projectId",get:function(){return this._occurrence?this._occurrence.projectId:null}},{key:"initialiseFormFields",value:function(){var e=i.properties;for(var t in this.fields={},e)e.hasOwnProperty(t)&&(this.fields[t]=new e[t].field(e[t].attributes))}},{key:"updateModelFromContent",value:function(){for(var e in console.log("updating occurrence from OccurrenceForm content"),this.fields)if(this.fields.hasOwnProperty(e)){var t=this.fields[e];this._occurrence.attributes[e]=t.value}console.log({occurrence:this._occurrence})}},{key:"model",get:function(){return this._occurrence},set:function(e){this._occurrence=e,this.populateFormContent()}},{key:"changeHandler",value:function(e){console.log("occurrence form change event"),console.log({event:e}),this.fireEvent(cv.CHANGE_EVENT,{form:this})}},{key:"pingOccurrence",value:function(){this._occurrence.unsaved()&&this.fireEvent(cv.CHANGE_EVENT,{form:this})}},{key:"destructor",value:function(){this._occurrence=null,Os(vo(i.prototype),"destructor",this).call(this)}},{key:"getFormSectionProperties",value:function(){return i.properties}}]),i}();r(cb,"properties",void 0),r(cb,"sectionTitle","Occurrence form"),r(cb,"help","Records help text, should normally be initialised with an imported html template");var sb=function t(){e(this,t)};function ub(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return lb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lb(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function lb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function db(e,t){hb(e,t),t.add(e)}function fb(e,t,n){hb(e,t),t.set(e,n)}function hb(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function pb(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}r(sb,"sectionTitle",void 0),r(sb,"sectionSortOrder",void 0),r(sb,"sectionNavigationKey",void 0),r(sb,"help",""),r(sb,"properties",void 0);var vb=new WeakMap,yb=new WeakMap,Sb=new WeakMap,mb=new WeakSet,gb=new WeakSet,Nb=new WeakSet,bb=new WeakSet,Tb=new WeakSet,Eb=new WeakSet,wb=new WeakSet,_b=new WeakSet,Ob=new WeakSet,Ib=new WeakSet,Rb=new WeakSet,Cb=new WeakSet,xb=function(t){fo(i,oS);var o=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var o=vo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return po(this,n)}}(i);function i(){var t;e(this,i);for(var n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return db(uo(t=o.call.apply(o,[this].concat(a))),Cb),db(uo(t),Rb),db(uo(t),Ib),db(uo(t),Ob),db(uo(t),_b),db(uo(t),wb),db(uo(t),Eb),db(uo(t),Tb),db(uo(t),bb),db(uo(t),Nb),db(uo(t),gb),db(uo(t),mb),r(uo(t),"controller",void 0),fb(uo(t),vb,{writable:!0,value:{}}),fb(uo(t),yb,{writable:!0,value:void 0}),fb(uo(t),Sb,{writable:!0,value:{}}),r(uo(t),"panelKey",""),r(uo(t),"OCCURRENCES_ARE_LAST_SECTION",!0),r(uo(t),"occurrenceSummaryText","Placeholder occurrence summary text in MainView.js"),r(uo(t),"welcomeContent","Placeholder welcome text in MainView.js"),r(uo(t),"defaultRightHandSideHelp","Default right-hand side help text in MainView.js"),t}return n(i,[{key:"initialise",value:function(){this.controller.app.addListener(pS.EVENT_OCCURRENCE_ADDED,this.occurrenceAddedHandler.bind(this))}},{key:"setLayout",value:function(){var e=this;document.getElementById("body").innerHTML='\r\n<div class="container-fluid">\r\n    <div class="row" style="height: 90vh;">\r\n        <div class="col d-md-block pr-md-0 pt-3" id="col1panel" style="overflow-y: auto; max-height: calc(100vh - 5rem);">\r\n        </div>\r\n        <div class="col d-md-none pl-0 pr-0" id="ctrlpanel" style="background-color: aliceblue; width: 28px; max-width: 28px; overflow-y: hidden; ">\r\n            <button class="navbar-light navbar-toggler pl-0 pr-0" type="button" aria-label="Back" id="right-panel-back">\r\n                <i class="material-icons-round" style="color: gray;">view_list</i>\r\n            </button>\r\n        </div>\r\n        <div class="col d-md-block pr-md-0" id="col2panel" style="overflow-y: auto; height: 100%;">\r\n        </div>\r\n    </div>\r\n</div>\r\n',document.getElementById("right-panel-back").addEventListener("click",(function(t){t.stopPropagation(),t.preventDefault(),e.fireEvent(hv.EVENT_BACK)}))}},{key:"refreshLeftPanelAccordionState",value:function(){var e,t=document.querySelectorAll("div#".concat(this.leftPanelAccordionId,' div[data-parent="#').concat(this.leftPanelAccordionId,'"].collapse'));e=this.controller.viewSubcontext?"record"===this.controller.viewSubcontext?"record":this.controller.surveySection:"";var n,r=ub(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;o.getAttribute("data-sectionkey")===e?o.classList.add("show"):o.classList.remove("show")}}catch(e){r.e(e)}finally{r.f()}this._refreshOccurrenceAccordionState()}},{key:"_refreshOccurrenceAccordionState",value:function(){var e,t=document.querySelectorAll("div#".concat("occurrencelistcontainer",' div[data-parent="#').concat("occurrencelistcontainer",'"].collapse')),n=this.controller.currentOccurrenceId,r=ub(t);try{for(r.s();!(e=r.n()).done;){var o=e.value;o.getAttribute("data-occurrenceid")===n?o.classList.add("show"):o.classList.remove("show")}}catch(e){r.e(e)}finally{r.f()}}},{key:"display",value:function(){if(this.controller.needsFullRefresh?(console.log("Full refresh triggered."),this.setLayout(),pb(this,Tb,Hb).call(this)):this.refreshLeftPanelAccordionState(),this.controller.needRightPanelRefresh)switch(this.controller.viewSubcontext){case"record":pb(this,gb,Mb).call(this);break;case"survey":pb(this,mb,Lb).call(this);break;default:pb(this,Nb,kb).call(this)}this.setResponsivePanel(""===this.panelKey?"left":"right")}},{key:"refreshOccurrenceFooterControls",value:function(e){var t=this,n=e.appendChild(document.createElement("div")),r=n.appendChild(document.createElement("button"));if(r.className="btn btn-secondary btn-md-lg mt-2 mb-3 mr-2",r.type="button",r.textContent="back to list",r.setAttribute("data-buttonaction","back"),this.occurrenceIsMostRecent(this.controller.currentOccurrence)){var o=n.appendChild(document.createElement("button"));o.className="btn btn-primary btn-md-lg mt-2 mb-3 mr-2",o.type="button",o.textContent="add another",o.setAttribute("data-buttonaction","new")}if(this.OCCURRENCES_ARE_LAST_SECTION){var i=n.appendChild(document.createElement("button"));i.className="btn btn-primary btn-md-lg mt-2 mb-3",i.type="button",i.textContent="finish",i.setAttribute("data-buttonaction","finish")}else{var a=aS.sections[1],c=n.appendChild(document.createElement("button"));c.className="btn btn-primary btn-md-lg mt-2 mb-3",c.type="button",c.textContent="next Â»",c.setAttribute("data-buttonaction","next"),c.title=a.sectionTitle}n.addEventListener("click",(function(e){var n=e.target.closest("button");if(n&&n.hasAttribute("data-buttonaction"))switch(n.getAttribute("data-buttonaction")){case"new":t.fireEvent(hv.EVENT_NEW_RECORD);break;case"back":t.controller.app.router.navigate("/list/record/");break;case"finish":t.controller.app.router.navigate("/list/record/"),$("#".concat("finishmodal")).modal();break;case"next":t.controller.app.router.navigate("/list/survey/".concat(nextSection.sectionNavigationKey));break;default:throw new Error("Unrecognised button action ".concat(n.getAttribute("data-buttonaction")))}}))}},{key:"occurrenceIsMostRecent",value:function(e){var t,n=ub(this.controller.occurrences.entries());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r[1].createdStamp>e.createdStamp&&!r[1].deleted)return!1}}catch(e){n.e(e)}finally{n.f()}return!0}},{key:"newButtonClickHandler",value:function(e){e.preventDefault(),e.stopPropagation(),this.fireEvent(hv.EVENT_NEW_RECORD)}},{key:"occurrenceAddedHandler",value:function(e){var t=document.getElementById("occurrencelistcontainer");if(t){var n=this.controller.occurrences.get(e.occurrenceId),r=document.createElement("div");r.className="card",r.id="card_".concat(n.id),r.innerHTML=pb(this,Cb,Jb).call(this,n),mo(this,Sb)[n.id]=n.addListener(lv.EVENT_MODIFIED,this.occurrenceChangeHandler.bind(this),{occurrenceId:n.id}),t.insertBefore(r,t.firstChild)}}},{key:"refreshOccurrenceValiditySummary",value:function(e){var t=document.getElementById("card_".concat(e.id));t&&(e.evaluateCompletionStatus(cb.properties).requiredFieldsPresent?t.classList.remove("is-invalid"):t.classList.add("is-invalid"))}},{key:"occurrenceChangeHandler",value:function(e){var t=this.controller.occurrences.get(e.occurrenceId),n=document.getElementById("card_".concat(e.occurrenceId));n&&(t.deleted?(n.parentElement.removeChild(n),mo(this,Sb)[e.occurrenceId]&&(t.removeListener(lv.EVENT_MODIFIED,mo(this,Sb)[e.occurrenceId]),mo(this,Sb)[e.occurrenceId]=null)):(n.innerHTML=pb(this,Cb,Jb).call(this,t),this.refreshOccurrenceValiditySummary(t)))}},{key:"occurrenceSummaryBodyHTML",value:function(e){var t="";for(var n in e.attributes)if(e.attributes.hasOwnProperty(n)&&cb.properties.hasOwnProperty(n)&&!cb.properties[n].field.isEmpty(e.attributes[n])){var r=cb.properties[n].field.summarise(n,cb.properties[n],e.attributes);r&&(t+='<p class="ellipsed-line mb-0">'.concat(r,"</p>"))}return pS.devMode&&(t+='<p class="mb-0">(<i>id '.concat(e.id,"</i>)</p>")),t}},{key:"occurrenceSummaryHeadingHTML",value:function(e){var t="";if(e.attributes.hasOwnProperty("images")&&e.attributes.images.length){var n=e.attributes.images[0];t+=sS.imageLink(n,48,48,{className:"mr-1"})}return e.attributes.taxon&&e.attributes.taxon.taxonId?t+=e.taxon.formattedHTML(e.attributes.taxon.vernacularMatch):e.attributes.taxon&&e.attributes.taxon.taxonName?t+=Dp(e.attributes.taxon.taxonName):t+="<span>(unnamed plant)</span>",t}},{key:"setResponsivePanel",value:function(e){var t=document.getElementById("col2panel"),n=document.getElementById("col1panel"),r=document.getElementById("ctrlpanel");switch(e){case"left":n.classList.remove("d-none"),n.classList.add("d-block"),t.classList.remove("d-block"),t.classList.add("d-none"),r.classList.remove("d-md-none"),r.classList.add("d-none");break;case"right":n.classList.remove("d-block"),n.classList.add("d-none"),t.classList.remove("d-none"),t.classList.add("d-block"),r.classList.remove("d-none"),r.classList.add("d-md-none");break;default:throw new Error("Unrecognised panel value '".concat(e))}}}]),i}();function Lb(){var e=document.getElementById("col2panel"),t=this.controller.surveySection,n=aS.sectionsByKey[t]?aS.sectionsByKey[t].help:"";e.innerHTML=n||("welcome"===t?this.defaultRightHandSideHelp:"<p>placeholder survey help content for '".concat(t,"'</p>"))}function Mb(){try{var e=this.controller.currentOccurrence,t=document.getElementById("col2panel");if(e){mo(this,yb)&&mo(this,yb).occurrenceId===e.id||(mo(this,yb)&&mo(this,yb).destructor(),So(this,yb,e.setForm(new cb(e))),mo(this,yb).surveyId=this.controller.app.currentSurvey.id,t.scrollTop=0),t.innerHTML="";var n=mo(this,yb).formElement;t.appendChild(n),mo(this,yb).populateFormContent(),this.refreshOccurrenceFooterControls(t),$("#description_".concat(e.id)).collapse("show")}else pb(this,Nb,kb).call(this,cb.help)}catch(e){console.log({error:e});var r=document.getElementById("col2panel");r?r.innerHTML="<p>".concat(e.message,"</p>"):document.body.innerHTML="<h2>Internal error</h2><p>Please report this problem:</p><p>".concat(e.message,"</p>")}}function kb(e){document.getElementById("col2panel").innerHTML=e||this.defaultRightHandSideHelp}function Ab(){for(var e in mo(this,Sb)){var t=this.controller.occurrences.get[e];t&&t.removeListener(lv.EVENT_MODIFIED,mo(this,Sb)[e])}So(this,Sb,{})}function Hb(){var e=this,t=document.getElementById("col1panel").appendChild(document.createElement("div"));t.className="accordion",this.leftPanelAccordionId=t.id=cv.nextId,pb(this,_b,jb).call(this),pb(this,Ob,Fb).call(this,0,t,xb.NEXT_RECORDS),pb(this,Ib,Ub).call(this),pb(this,Rb,Bb).call(this),t.addEventListener("click",(function(t){var n=t.target.closest("a");n&&n.hasAttribute("data-help-link")&&(t.preventDefault(),t.stopPropagation(),e.controller.app.router.navigate(n.getAttribute("data-help-link")))})),pb(this,wb,Db).call(this),pb(this,Eb,Pb).call(this)}function Pb(){var e=this,t=document.body,n='<div class="modal fade" id="'.concat("deleteoccurrencemodal",'" tabindex="-1" role="dialog" aria-labelledby="').concat("deleteoccurrencemodal",'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title" id="').concat("deleteoccurrencemodal",'Title">Delete record?</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        Please confirm that you wish to delete the record.\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Back</button>\n        <button type="button" class="btn btn-danger" data-dismiss="modal" id="').concat("deleteoccurrencemodal",'confirmed">Delete record</button>\n      </div>\n    </div>\n  </div>\n</div>'),r=document.createElement("div");r.innerHTML=n,t.appendChild(r.firstChild),$("#".concat("deleteoccurrencemodal")).on("show.bs.modal",(function(e){var t=$(e.relatedTarget);if(t&&t.data("occurrenceid")){var n=t.data("occurrenceid");document.getElementById("".concat("deleteoccurrencemodal","confirmed")).setAttribute("data-occurrenceid",n)}})),document.getElementById("".concat("deleteoccurrencemodal","confirmed")).addEventListener("click",(function(t){var n=t.target.closest("button");if(n&&n.hasAttribute("data-occurrenceid")){var r=n.getAttribute("data-occurrenceid");console.log("Deleting occurrence ".concat(r,".")),e.fireEvent(hv.EVENT_DELETE_OCCURRENCE,{occurrenceId:r})}}));var o=document.createElement("div");o.innerHTML='<div class="modal fade" id="'.concat("finishmodal",'" tabindex="-1" role="dialog" aria-labelledby="').concat("finishmodal",'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title" id="').concat("finishmodal",'Title">Thank you</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <p>Thank you! Your form responses have been sent. If you wish, you can continue to make changes and edit or add further records.</p>\n        <p>If you provided an email address, then we will send you a message with a link to this form, so that you can return to it later if needed.</p>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n      </div>\n    </div>\n  </div>\n</div>'),t.appendChild(o.firstChild),t.appendChild(Pg.licenseModal());var i=document.createElement("div");i.innerHTML='<div class="modal fade" id="'.concat("imagemodal",'" tabindex="-1" role="dialog" aria-labelledby="').concat("imagemodal",'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header d-none d-md-flex">\n        <h5 class="modal-title" id="').concat("imagemodal",'Title">Photo</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body" style="position: relative;">\n        <picture>\n        </picture>\n      </div>\n      <div class="modal-footer">\n        <button type="button" id="').concat("imagemodaldelete",'" class="btn btn-outline-danger delete-occurrence-button mr-3" data-toggle="modal" data-target="#').concat("deleteimagemodal",'" data-imageid=""><i class="material-icons">delete</i></button>\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n      </div>\n    </div>\n  </div>\n</div>'),t.appendChild(i.firstChild),document.getElementById("imagemodaldelete").addEventListener("click",(function(t){var n=t.target.closest("button");if(n&&n.hasAttribute("data-imageid")){var r=n.getAttribute("data-imageid");mo(e,yb).fireEvent("deleteimage",{imageId:r}),$("#".concat("imagemodal")).modal("hide")}}))}function Db(){var e=this;$("#".concat("col1panel")).on("show.bs.collapse",(function(t){t.target.dataset.occurrenceid?(console.log({"left panel accordion show event (with occ id)":t}),e.fireEvent(hv.EVENT_SELECT_OCCURRENCE,{occurrenceId:t.target.dataset.occurrenceid})):t.target.dataset.sectionkey?(console.log({"left panel accordion show event (with section key)":t}),e.fireEvent(hv.EVENT_SELECT_SURVEY_SECTION,{sectionKey:t.target.dataset.sectionkey})):console.log({"left panel accordion show event (other)":t})})).on("hidden.bs.collapse",(function(t){if(console.log({"left panel accordion hide event":t}),t.target.dataset.occurrenceid){var n=e.controller.occurrences.get(t.target.dataset.occurrenceid);n.isNew&&!n.isPristine&&(n.isNew=!1,e.refreshOccurrenceValiditySummary(n)),e.controller.currentOccurrenceId===t.target.dataset.occurrenceid&&e.fireEvent(hv.EVENT_SELECT_OCCURRENCE,{occurrenceId:""})}else if(t.target.dataset.sectionkey)if("record"===t.target.dataset.sectionkey)"record"===e.controller.viewSubcontext&&e.fireEvent(hv.EVENT_SELECT_SURVEY_SECTION,{sectionKey:""});else if(mo(e,vb)[t.target.dataset.sectionkey]){var r=mo(e,vb)[t.target.dataset.sectionkey].validateForm();console.log({"survey section validity":r}),e.controller.surveySection===t.target.dataset.sectionkey&&e.fireEvent(hv.EVENT_SELECT_SURVEY_SECTION,{sectionKey:""})}}))}function jb(){var e=document.getElementById(this.leftPanelAccordionId),t=document.createElement("button");t.className="btn btn-primary",t.type="button",t.textContent="get started Â»",t.setAttribute("data-toggle","collapse"),t.setAttribute("data-target","#survey-0-about");var n=cv.nextId,r=document.createElement("div");r.innerHTML=this.welcomeContent,r.appendChild(t);var o=document.createElement("span");o.className="d-md-none pl-2",o.innerHTML='(<a href="/app/list/survey/welcome/help" data-navigo="list/survey/welcome/help">more info</a>)',r.appendChild(o),e.appendChild(this.card({cardId:n,cardHeadingId:cv.nextId,collapsed:"welcome"!==this.controller.surveySection,headingButtonId:cv.nextId,headingHTML:'<img src="/img/BSBIlong.png" alt="" style="float:right; max-width: 40%; max-height: 48px;"><div style="float: left;">Welcome</div>',buttonStyleString:"width: 100%",headingNonbuttonHTML:"",headingValidationWarningHTML:"",cardDescriptionId:"survey-welcome",parentContainerId:e.id,bodyContentElement:r,dataAttributes:{sectionkey:"welcome"}}))}function Fb(e,t,n){var r=this,o=aS.sections[e],i=new aS(o);mo(this,vb)[o.sectionNavigationKey]=i;var a=i.formElement,c=document.createElement("button");switch(c.className="btn btn-primary",c.type="button",c.textContent="next Â»",n){case xb.NEXT_RECORDS:c.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),r.fireEvent(hv.EVENT_NEXT_TO_RECORDS)}));break;case xb.NEXT_SURVEY_SECTION:var s=aS.sections[e+1];c.setAttribute("data-toggle","collapse"),c.setAttribute("data-target","#survey-".concat(e+1,"-").concat(s.sectionNavigationKey)),c.title=s.sectionTitle;break;case xb.NEXT_IS_FINAL:c.textContent="finish",c.className="btn btn-primary btn-md-lg mt-2 mb-3",c.type="button",c.addEventListener("click",(function(){r.controller.app.router.navigate("/list/"),$("#".concat("finishmodal")).modal()}));break;default:throw new Error("Unrecognized next section keyword '".concat(n,"'"))}a.appendChild(c);var u=cv.nextId;t.appendChild(this.card({cardId:u,cardHeadingId:cv.nextId,collapsed:this.controller.surveySection!==o.sectionNavigationKey,headingButtonId:cv.nextId,headingHTML:o.sectionTitle,headingNonbuttonHTML:'<small class="btn d-md-none" style="margin: 0; padding: 0;">(<a href="/app/list/survey/'.concat(o.sectionNavigationKey,'/help" data-help-link="/list/survey/').concat(o.sectionNavigationKey,'/help">help</a>)</small>'),headingValidationWarningHTML:"Please check the form for some missing responses.",cardDescriptionId:"survey-".concat(e,"-").concat(o.sectionNavigationKey),parentContainerId:t.id,bodyContentElement:a,dataAttributes:{sectionkey:o.sectionNavigationKey}})),this.controller.survey.registerForm(i),i.addListener(aS.EVENT_VALIDATION_STATE_CHANGE,(function(e){var t=document.getElementById(u);e.isValid?t.classList.remove("is-invalid"):t.classList.add("is-invalid")}))}function Ub(){var e=document.getElementById(this.leftPanelAccordionId),t=document.createDocumentFragment();t.appendChild(document.createElement("p")).innerHTML="".concat(this.occurrenceSummaryText,'<small class="d-block d-md-none"><a href="/app/list/record/help">(help)</a></small>');var n=t.appendChild(document.createElement("button"));n.type="button",n.className="btn btn-primary btn-lg mb-2",n.innerText="Add a plant record.",n.addEventListener("click",this.newButtonClickHandler.bind(this)),t.appendChild(document.createElement("div")).id="occurrencelistcontainer",e.appendChild(this.card({cardId:cv.nextId,cardHeadingId:cv.nextId,collapsed:"record"!==this.controller.viewSubcontext,headingButtonId:cv.nextId,headingHTML:"Your plant records",cardDescriptionId:cv.nextId,parentContainerId:e.id,bodyContentElement:t,dataAttributes:{sectionkey:"record"}}))}function Bb(){var e=document.getElementById("occurrencelistcontainer");if(!e)throw new dv("Failed to find list container.");pb(this,bb,Ab).call(this);var t,n=[],r=ub(function(e){return function(e){if(Array.isArray(e))return Sy(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||my(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.controller.occurrences.entries()).sort((function(e,t){return t[1].createdStamp-e[1].createdStamp})));try{for(r.s();!(t=r.n()).done;){var o=t.value[1];if(console.log("displaying '".concat(o.id,"'")),!o.deleted){var i=o.isNew||o.evaluateCompletionStatus(cb.properties).requiredFieldsPresent;n.push('<div class="card'.concat(i?"":" is-invalid",'" id="card_').concat(o.id,'">\n    ').concat(pb(this,Cb,Jb).call(this,o),"\n</div>")),mo(this,Sb)[o.id]=o.addListener(lv.EVENT_MODIFIED,this.occurrenceChangeHandler.bind(this),{occurrenceId:o.id})}}}catch(e){r.e(e)}finally{r.f()}e.className="accordion",e.innerHTML=n.join(""),e.addEventListener("click",(function(e){var t=e.target.closest("button");t&&t.hasAttribute("data-toggle")&&"modal"===t.getAttribute("data-toggle")&&(document.getElementById("".concat("deleteoccurrencemodal","confirmed")).setAttribute("data-occurrenceid",t.getAttribute("data-occurrenceid")),$(t.getAttribute("data-target")).modal(),e.preventDefault(),e.stopPropagation())}))}function Jb(e){return'<div class="card-header pointer pl-2 pr-2 pt-2 pb-2" id="heading_'.concat(e.id,'" data-toggle="collapse" data-target="#description_').concat(e.id,'">\n    <div class="float-right">\n        <button type="button" class="btn btn-outline-danger delete-occurrence-button" data-toggle="modal" data-target="#').concat("deleteoccurrencemodal",'" data-occurrenceid="').concat(e.id,'"><i class="material-icons">delete</i></button>\n    </div>\n    <h2 class="mb-0 pb-0 mt-0 pt-0 pl-0 ml-0">\n        <button class="btn btn-link').concat(this.controller.currentOccurrenceId===e.id?"":" collapsed",' pt-0 pb-0 pl-0" id="headingbutton_').concat(e.id,'" type="button" data-toggle="collapse" data-target="#description_').concat(e.id,'" aria-expanded="').concat(this.controller.currentOccurrenceId===e.id?"true":"false",'" aria-controls="description_').concat(e.id,'">\n          ').concat(this.occurrenceSummaryHeadingHTML(e),'\n        </button>\n    </h2>\n    <div class="card-invalid-feedback">\n        <small>Please check for errors or missing details.</small>\n    </div>\n</div>\n<div id="description_').concat(e.id,'" class="collapse').concat(this.controller.currentOccurrenceId===e.id?" show":"",'" aria-labelledby="heading_').concat(e.id,'" data-parent="#').concat("occurrencelistcontainer",'" data-occurrenceid="').concat(e.id,'">\n  <div class="card-body">\n    ').concat(this.occurrenceSummaryBodyHTML(e),"\n  </div>\n</div>")}function Yb(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Gb(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Kb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Vb(e){return(Vb=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qb(e,t){return(qb=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xb(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wb(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Xb(e)}function Qb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Vb(e);if(t){var o=Vb(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Wb(this,n)}}function Zb(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){c=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}(e,t)||zb(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zb(e,t){if(e){if("string"==typeof e)return $b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$b(e,t):void 0}}function $b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function eT(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=zb(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}r(xb,"NEXT_RECORDS","records"),r(xb,"NEXT_SURVEY_SECTION","survey"),r(xb,"NEXT_IS_FINAL","last");var tT="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function nT(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var rT=function(e){return e&&e.Math==Math&&e},oT=rT("object"==typeof globalThis&&globalThis)||rT("object"==typeof window&&window)||rT("object"==typeof self&&self)||rT("object"==typeof tT&&tT)||function(){return this}()||Function("return this")(),iT={},aT=function(e){try{return!!e()}catch(e){return!0}},cT=!aT((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),sT={},uT={}.propertyIsEnumerable,lT=Object.getOwnPropertyDescriptor,dT=lT&&!uT.call({1:2},1);sT.f=dT?function(e){var t=lT(this,e);return!!t&&t.enumerable}:uT;var fT,hT,pT=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},vT={}.toString,yT=function(e){return vT.call(e).slice(8,-1)},ST=yT,mT="".split,gT=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},NT=aT((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==ST(e)?mT.call(e,""):Object(e)}:Object,bT=gT,TT=function(e){return NT(bT(e))},ET=function(e){return"function"==typeof e},wT=ET,_T=function(e){return"object"==typeof e?null!==e:wT(e)},OT=oT,IT=ET,RT=function(e){return IT(e)?e:void 0},CT=function(e,t){return arguments.length<2?RT(OT[e]):OT[e]&&OT[e][t]},xT=CT("navigator","userAgent")||"",LT=oT,MT=xT,kT=LT.process,AT=LT.Deno,HT=kT&&kT.versions||AT&&AT.version,PT=HT&&HT.v8;PT?hT=(fT=PT.split("."))[0]<4?1:fT[0]+fT[1]:MT&&(!(fT=MT.match(/Edge\/(\d+)/))||fT[1]>=74)&&(fT=MT.match(/Chrome\/(\d+)/))&&(hT=fT[1]);var DT=hT&&+hT,jT=DT,FT=aT,UT=!!Object.getOwnPropertySymbols&&!FT((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&jT&&jT<41})),BT=UT&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,JT=ET,YT=CT,GT=BT?function(e){return"symbol"==typeof e}:function(e){var t=YT("Symbol");return JT(t)&&Object(e)instanceof t},KT=function(e){try{return String(e)}catch(e){return"Object"}},VT=ET,qT=KT,XT=function(e){if(VT(e))return e;throw TypeError(qT(e)+" is not a function")},WT=XT,QT=function(e,t){var n=e[t];return null==n?void 0:WT(n)},ZT=ET,zT=_T,$T={exports:{}},eE=oT,tE=function(e,t){try{Object.defineProperty(eE,e,{value:t,configurable:!0,writable:!0})}catch(n){eE[e]=t}return t},nE=tE,rE=oT["__core-js_shared__"]||nE("__core-js_shared__",{}),oE=rE;($T.exports=function(e,t){return oE[e]||(oE[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.18.3",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var iE=gT,aE=function(e){return Object(iE(e))},cE=aE,sE={}.hasOwnProperty,uE=Object.hasOwn||function(e,t){return sE.call(cE(e),t)},lE=0,dE=Math.random(),fE=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++lE+dE).toString(36)},hE=oT,pE=$T.exports,vE=uE,yE=fE,SE=UT,mE=BT,gE=pE("wks"),NE=hE.Symbol,bE=mE?NE:NE&&NE.withoutSetter||yE,TE=function(e){return vE(gE,e)&&(SE||"string"==typeof gE[e])||(SE&&vE(NE,e)?gE[e]=NE[e]:gE[e]=bE("Symbol."+e)),gE[e]},EE=_T,wE=GT,_E=QT,OE=function(e,t){var n,r;if("string"===t&&ZT(n=e.toString)&&!zT(r=n.call(e)))return r;if(ZT(n=e.valueOf)&&!zT(r=n.call(e)))return r;if("string"!==t&&ZT(n=e.toString)&&!zT(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},IE=TE("toPrimitive"),RE=function(e,t){if(!EE(e)||wE(e))return e;var n,r=_E(e,IE);if(r){if(void 0===t&&(t="default"),n=r.call(e,t),!EE(n)||wE(n))return n;throw TypeError("Can't convert object to primitive value")}return void 0===t&&(t="number"),OE(e,t)},CE=GT,xE=function(e){var t=RE(e,"string");return CE(t)?t:String(t)},LE=_T,ME=oT.document,kE=LE(ME)&&LE(ME.createElement),AE=function(e){return kE?ME.createElement(e):{}},HE=AE,PE=!cT&&!aT((function(){return 7!=Object.defineProperty(HE("div"),"a",{get:function(){return 7}}).a})),DE=cT,jE=sT,FE=pT,UE=TT,BE=xE,JE=uE,YE=PE,GE=Object.getOwnPropertyDescriptor;iT.f=DE?GE:function(e,t){if(e=UE(e),t=BE(t),YE)try{return GE(e,t)}catch(e){}if(JE(e,t))return FE(!jE.f.call(e,t),e[t])};var KE={},VE=_T,qE=function(e){if(VE(e))return e;throw TypeError(String(e)+" is not an object")},XE=cT,WE=PE,QE=qE,ZE=xE,zE=Object.defineProperty;KE.f=XE?zE:function(e,t,n){if(QE(e),t=ZE(t),QE(n),WE)try{return zE(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var $E=KE,ew=pT,tw=cT?function(e,t,n){return $E.f(e,t,ew(1,n))}:function(e,t,n){return e[t]=n,e},nw={exports:{}},rw=ET,ow=rE,iw=Function.toString;rw(ow.inspectSource)||(ow.inspectSource=function(e){return iw.call(e)});var aw,cw,sw,uw=ow.inspectSource,lw=ET,dw=uw,fw=oT.WeakMap,hw=lw(fw)&&/native code/.test(dw(fw)),pw=$T.exports,vw=fE,yw=pw("keys"),Sw=function(e){return yw[e]||(yw[e]=vw(e))},mw={},gw=hw,Nw=_T,bw=tw,Tw=uE,Ew=rE,ww=Sw,_w=mw,Ow=oT.WeakMap;if(gw||Ew.state){var Iw=Ew.state||(Ew.state=new Ow),Rw=Iw.get,Cw=Iw.has,xw=Iw.set;aw=function(e,t){if(Cw.call(Iw,e))throw new TypeError("Object already initialized");return t.facade=e,xw.call(Iw,e,t),t},cw=function(e){return Rw.call(Iw,e)||{}},sw=function(e){return Cw.call(Iw,e)}}else{var Lw=ww("state");_w[Lw]=!0,aw=function(e,t){if(Tw(e,Lw))throw new TypeError("Object already initialized");return t.facade=e,bw(e,Lw,t),t},cw=function(e){return Tw(e,Lw)?e[Lw]:{}},sw=function(e){return Tw(e,Lw)}}var Mw={set:aw,get:cw,has:sw,enforce:function(e){return sw(e)?cw(e):aw(e,{})},getterFor:function(e){return function(t){var n;if(!Nw(t)||(n=cw(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},kw=cT,Aw=uE,Hw=Function.prototype,Pw=kw&&Object.getOwnPropertyDescriptor,Dw=Aw(Hw,"name"),jw={EXISTS:Dw,PROPER:Dw&&"something"===function(){}.name,CONFIGURABLE:Dw&&(!kw||kw&&Pw(Hw,"name").configurable)},Fw=oT,Uw=ET,Bw=uE,Jw=tw,Yw=tE,Gw=uw,Kw=jw.CONFIGURABLE,Vw=Mw.get,qw=Mw.enforce,Xw=String(String).split("String");(nw.exports=function(e,t,n,r){var o,i=!!r&&!!r.unsafe,a=!!r&&!!r.enumerable,c=!!r&&!!r.noTargetGet,s=r&&void 0!==r.name?r.name:t;Uw(n)&&("Symbol("===String(s).slice(0,7)&&(s="["+String(s).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!Bw(n,"name")||Kw&&n.name!==s)&&Jw(n,"name",s),(o=qw(n)).source||(o.source=Xw.join("string"==typeof s?s:""))),e!==Fw?(i?!c&&e[t]&&(a=!0):delete e[t],a?e[t]=n:Jw(e,t,n)):a?e[t]=n:Yw(t,n)})(Function.prototype,"toString",(function(){return Uw(this)&&Vw(this).source||Gw(this)}));var Ww={},Qw=Math.ceil,Zw=Math.floor,zw=function(e){var t=+e;return t!=t||0===t?0:(t>0?Zw:Qw)(t)},$w=zw,e_=Math.max,t_=Math.min,n_=zw,r_=Math.min,o_=function(e){return e>0?r_(n_(e),9007199254740991):0},i_=o_,a_=function(e){return i_(e.length)},c_=TT,s_=function(e,t){var n=$w(e);return n<0?e_(n+t,0):t_(n,t)},u_=a_,l_=function(e){return function(t,n,r){var o,i=c_(t),a=u_(i),c=s_(r,a);if(e&&n!=n){for(;a>c;)if((o=i[c++])!=o)return!0}else for(;a>c;c++)if((e||c in i)&&i[c]===n)return e||c||0;return!e&&-1}},d_={includes:l_(!0),indexOf:l_(!1)},f_=uE,h_=TT,p_=d_.indexOf,v_=mw,y_=function(e,t){var n,r=h_(e),o=0,i=[];for(n in r)!f_(v_,n)&&f_(r,n)&&i.push(n);for(;t.length>o;)f_(r,n=t[o++])&&(~p_(i,n)||i.push(n));return i},S_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],m_=y_,g_=S_.concat("length","prototype");Ww.f=Object.getOwnPropertyNames||function(e){return m_(e,g_)};var N_={};N_.f=Object.getOwnPropertySymbols;var b_=Ww,T_=N_,E_=qE,w_=CT("Reflect","ownKeys")||function(e){var t=b_.f(E_(e)),n=T_.f;return n?t.concat(n(e)):t},__=uE,O_=w_,I_=iT,R_=KE,C_=aT,x_=ET,L_=/#|\.prototype\./,M_=function(e,t){var n=A_[k_(e)];return n==P_||n!=H_&&(x_(t)?C_(t):!!t)},k_=M_.normalize=function(e){return String(e).replace(L_,".").toLowerCase()},A_=M_.data={},H_=M_.NATIVE="N",P_=M_.POLYFILL="P",D_=M_,j_=oT,F_=iT.f,U_=tw,B_=nw.exports,J_=tE,Y_=function(e,t){for(var n=O_(t),r=R_.f,o=I_.f,i=0;i<n.length;i++){var a=n[i];__(e,a)||r(e,a,o(t,a))}},G_=D_,K_=function(e,t){var n,r,o,i,a,c=e.target,s=e.global,u=e.stat;if(n=s?j_:u?j_[c]||J_(c,{}):(j_[c]||{}).prototype)for(r in t){if(i=t[r],o=e.noTargetGet?(a=F_(n,r))&&a.value:n[r],!G_(s?r:c+(u?".":"#")+r,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;Y_(i,o)}(e.sham||o&&o.sham)&&U_(i,"sham",!0),B_(n,r,i,e)}},V_=yT,q_=Array.isArray||function(e){return"Array"==V_(e)},X_=xE,W_=KE,Q_=pT,Z_={};Z_[TE("toStringTag")]="z";var z_="[object z]"===String(Z_),$_=z_,eO=ET,tO=yT,nO=TE("toStringTag"),rO="Arguments"==tO(function(){return arguments}()),oO=$_?tO:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),nO))?n:rO?tO(t):"Object"==(r=tO(t))&&eO(t.callee)?"Arguments":r},iO=aT,aO=ET,cO=oO,sO=uw,uO=[],lO=CT("Reflect","construct"),dO=/^\s*(?:class|function)\b/,fO=dO.exec,hO=!dO.exec((function(){})),pO=function(e){if(!aO(e))return!1;try{return lO(Object,uO,e),!0}catch(e){return!1}},vO=!lO||iO((function(){var e;return pO(pO.call)||!pO(Object)||!pO((function(){e=!0}))||e}))?function(e){if(!aO(e))return!1;switch(cO(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return hO||!!fO.call(dO,sO(e))}:pO,yO=q_,SO=vO,mO=_T,gO=TE("species"),NO=function(e){var t;return yO(e)&&(t=e.constructor,(SO(t)&&(t===Array||yO(t.prototype))||mO(t)&&null===(t=t[gO]))&&(t=void 0)),void 0===t?Array:t},bO=aT,TO=DT,EO=TE("species"),wO=K_,_O=aT,OO=q_,IO=_T,RO=aE,CO=a_,xO=function(e,t,n){var r=X_(t);r in e?W_.f(e,r,Q_(0,n)):e[r]=n},LO=function(e,t){return new(NO(e))(0===t?0:t)},MO=function(e){return TO>=51||!bO((function(){var t=[];return(t.constructor={})[EO]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},kO=DT,AO=TE("isConcatSpreadable"),HO=kO>=51||!_O((function(){var e=[];return e[AO]=!1,e.concat()[0]!==e})),PO=MO("concat"),DO=function(e){if(!IO(e))return!1;var t=e[AO];return void 0!==t?!!t:OO(e)};wO({target:"Array",proto:!0,forced:!HO||!PO},{concat:function(e){var t,n,r,o,i,a=RO(this),c=LO(a,0),s=0;for(t=-1,r=arguments.length;t<r;t++)if(DO(i=-1===t?a:arguments[t])){if(s+(o=CO(i))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<o;n++,s++)n in i&&xO(c,s,i[n])}else{if(s>=9007199254740991)throw TypeError("Maximum allowed index exceeded");xO(c,s++,i)}return c.length=s,c}});var jO=oO,FO=z_?{}.toString:function(){return"[object "+jO(this)+"]"},UO=z_,BO=nw.exports,JO=FO;UO||BO(Object.prototype,"toString",JO,{unsafe:!0});var YO=oT.Promise,GO=nw.exports,KO=ET,VO=qE,qO=function(e){if("object"==typeof e||KO(e))return e;throw TypeError("Can't set "+String(e)+" as a prototype")},XO=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return VO(n),qO(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),WO=KE.f,QO=uE,ZO=TE("toStringTag"),zO=function(e,t,n){e&&!QO(e=n?e:e.prototype,ZO)&&WO(e,ZO,{configurable:!0,value:t})},$O=CT,eI=KE,tI=cT,nI=TE("species"),rI={},oI=rI,iI=TE("iterator"),aI=Array.prototype,cI=XT,sI=function(e,t,n){if(cI(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}},uI=oO,lI=QT,dI=rI,fI=TE("iterator"),hI=function(e){if(null!=e)return lI(e,fI)||lI(e,"@@iterator")||dI[uI(e)]},pI=XT,vI=qE,yI=hI,SI=qE,mI=QT,gI=qE,NI=function(e){return void 0!==e&&(oI.Array===e||aI[iI]===e)},bI=a_,TI=sI,EI=function(e,t){var n=arguments.length<2?yI(e):t;if(pI(n))return vI(n.call(e));throw TypeError(String(e)+" is not iterable")},wI=hI,_I=function(e,t,n){var r,o;SI(e);try{if(!(r=mI(e,"return"))){if("throw"===t)throw n;return n}r=r.call(e)}catch(e){o=!0,r=e}if("throw"===t)throw n;if(o)throw r;return SI(r),n},OI=function(e,t){this.stopped=e,this.result=t},II=TE("iterator"),RI=!1;try{var CI=0,xI={next:function(){return{done:!!CI++}},return:function(){RI=!0}};xI[II]=function(){return this},Array.from(xI,(function(){throw 2}))}catch(e){}var LI,MI,kI,AI,HI=vO,PI=KT,DI=qE,jI=function(e){if(HI(e))return e;throw TypeError(PI(e)+" is not a constructor")},FI=TE("species"),UI=function(e,t){var n,r=DI(e).constructor;return void 0===r||null==(n=DI(r)[FI])?t:jI(n)},BI=CT("document","documentElement"),JI=/(?:ipad|iphone|ipod).*applewebkit/i.test(xT),YI="process"==yT(oT.process),GI=oT,KI=ET,VI=aT,qI=sI,XI=BI,WI=AE,QI=JI,ZI=YI,zI=GI.setImmediate,$I=GI.clearImmediate,eR=GI.process,tR=GI.MessageChannel,nR=GI.Dispatch,rR=0,oR={};try{LI=GI.location}catch(e){}var iR=function(e){if(oR.hasOwnProperty(e)){var t=oR[e];delete oR[e],t()}},aR=function(e){return function(){iR(e)}},cR=function(e){iR(e.data)},sR=function(e){GI.postMessage(String(e),LI.protocol+"//"+LI.host)};zI&&$I||(zI=function(e){for(var t=[],n=arguments.length,r=1;n>r;)t.push(arguments[r++]);return oR[++rR]=function(){(KI(e)?e:Function(e)).apply(void 0,t)},MI(rR),rR},$I=function(e){delete oR[e]},ZI?MI=function(e){eR.nextTick(aR(e))}:nR&&nR.now?MI=function(e){nR.now(aR(e))}:tR&&!QI?(AI=(kI=new tR).port2,kI.port1.onmessage=cR,MI=qI(AI.postMessage,AI,1)):GI.addEventListener&&KI(GI.postMessage)&&!GI.importScripts&&LI&&"file:"!==LI.protocol&&!VI(sR)?(MI=sR,GI.addEventListener("message",cR,!1)):MI="onreadystatechange"in WI("script")?function(e){XI.appendChild(WI("script")).onreadystatechange=function(){XI.removeChild(this),iR(e)}}:function(e){setTimeout(aR(e),0)});var uR,lR,dR,fR,hR,pR,vR,yR,SR={set:zI,clear:$I},mR=oT,gR=/ipad|iphone|ipod/i.test(xT)&&void 0!==mR.Pebble,NR=/web0s(?!.*chrome)/i.test(xT),bR=oT,TR=iT.f,ER=SR.set,wR=JI,_R=gR,OR=NR,IR=YI,RR=bR.MutationObserver||bR.WebKitMutationObserver,CR=bR.document,xR=bR.process,LR=bR.Promise,MR=TR(bR,"queueMicrotask"),kR=MR&&MR.value;kR||(uR=function(){var e,t;for(IR&&(e=xR.domain)&&e.exit();lR;){t=lR.fn,lR=lR.next;try{t()}catch(e){throw lR?fR():dR=void 0,e}}dR=void 0,e&&e.enter()},wR||IR||OR||!RR||!CR?!_R&&LR&&LR.resolve?((vR=LR.resolve(void 0)).constructor=LR,yR=vR.then,fR=function(){yR.call(vR,uR)}):fR=IR?function(){xR.nextTick(uR)}:function(){ER.call(bR,uR)}:(hR=!0,pR=CR.createTextNode(""),new RR(uR).observe(pR,{characterData:!0}),fR=function(){pR.data=hR=!hR}));var AR=kR||function(e){var t={fn:e,next:void 0};dR&&(dR.next=t),lR||(lR=t,fR()),dR=t},HR={},PR=XT,DR=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=PR(t),this.reject=PR(n)};HR.f=function(e){return new DR(e)};var jR,FR,UR,BR,JR=qE,YR=_T,GR=HR,KR=function(e,t){if(JR(e),YR(t)&&t.constructor===e)return t;var n=GR.f(e);return(0,n.resolve)(t),n.promise},VR=oT,qR="object"==typeof window,XR=K_,WR=oT,QR=CT,ZR=YO,zR=nw.exports,$R=function(e,t,n){for(var r in t)GO(e,r,t[r],n);return e},eC=XO,tC=zO,nC=function(e){var t=$O(e),n=eI.f;tI&&t&&!t[nI]&&n(t,nI,{configurable:!0,get:function(){return this}})},rC=XT,oC=ET,iC=_T,aC=function(e,t,n){if(e instanceof t)return e;throw TypeError("Incorrect "+(n?n+" ":"")+"invocation")},cC=uw,sC=function(e,t,n){var r,o,i,a,c,s,u,l=n&&n.that,d=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_ITERATOR),h=!(!n||!n.INTERRUPTED),p=TI(t,l,1+d+h),v=function(e){return r&&_I(r,"normal",e),new OI(!0,e)},y=function(e){return d?(gI(e),h?p(e[0],e[1],v):p(e[0],e[1])):h?p(e,v):p(e)};if(f)r=e;else{if(!(o=wI(e)))throw TypeError(String(e)+" is not iterable");if(NI(o)){for(i=0,a=bI(e);a>i;i++)if((c=y(e[i]))&&c instanceof OI)return c;return new OI(!1)}r=EI(e,o)}for(s=r.next;!(u=s.call(r)).done;){try{c=y(u.value)}catch(e){_I(r,"throw",e)}if("object"==typeof c&&c&&c instanceof OI)return c}return new OI(!1)},uC=function(e,t){if(!t&&!RI)return!1;var n=!1;try{var r={};r[II]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},lC=UI,dC=SR.set,fC=AR,hC=KR,pC=function(e,t){var n=VR.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},vC=HR,yC=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},SC=Mw,mC=D_,gC=qR,NC=YI,bC=DT,TC=TE("species"),EC="Promise",wC=SC.get,_C=SC.set,OC=SC.getterFor(EC),IC=ZR&&ZR.prototype,RC=ZR,CC=IC,xC=WR.TypeError,LC=WR.document,MC=WR.process,kC=vC.f,AC=kC,HC=!!(LC&&LC.createEvent&&WR.dispatchEvent),PC=oC(WR.PromiseRejectionEvent),DC=!1,jC=mC(EC,(function(){var e=cC(RC),t=e!==String(RC);if(!t&&66===bC)return!0;if(bC>=51&&/native code/.test(e))return!1;var n=new RC((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[TC]=r,!(DC=n.then((function(){}))instanceof r)||!t&&gC&&!PC})),FC=jC||!uC((function(e){RC.all(e).catch((function(){}))})),UC=function(e){var t;return!(!iC(e)||!oC(t=e.then))&&t},BC=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;fC((function(){for(var r=e.value,o=1==e.state,i=0;n.length>i;){var a,c,s,u=n[i++],l=o?u.ok:u.fail,d=u.resolve,f=u.reject,h=u.domain;try{l?(o||(2===e.rejection&&KC(e),e.rejection=1),!0===l?a=r:(h&&h.enter(),a=l(r),h&&(h.exit(),s=!0)),a===u.promise?f(xC("Promise-chain cycle")):(c=UC(a))?c.call(a,d,f):d(a)):f(r)}catch(e){h&&!s&&h.exit(),f(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&YC(e)}))}},JC=function(e,t,n){var r,o;HC?((r=LC.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),WR.dispatchEvent(r)):r={promise:t,reason:n},!PC&&(o=WR["on"+e])?o(r):"unhandledrejection"===e&&pC("Unhandled promise rejection",n)},YC=function(e){dC.call(WR,(function(){var t,n=e.facade,r=e.value;if(GC(e)&&(t=yC((function(){NC?MC.emit("unhandledRejection",r,n):JC("unhandledrejection",n,r)})),e.rejection=NC||GC(e)?2:1,t.error))throw t.value}))},GC=function(e){return 1!==e.rejection&&!e.parent},KC=function(e){dC.call(WR,(function(){var t=e.facade;NC?MC.emit("rejectionHandled",t):JC("rejectionhandled",t,e.value)}))},VC=function(e,t,n){return function(r){e(t,r,n)}},qC=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,BC(e,!0))},XC=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw xC("Promise can't be resolved itself");var r=UC(t);r?fC((function(){var n={done:!1};try{r.call(t,VC(XC,n,e),VC(qC,n,e))}catch(t){qC(n,t,e)}})):(e.value=t,e.state=1,BC(e,!1))}catch(t){qC({done:!1},t,e)}}};if(jC&&(CC=(RC=function(e){aC(this,RC,EC),rC(e),jR.call(this);var t=wC(this);try{e(VC(XC,t),VC(qC,t))}catch(e){qC(t,e)}}).prototype,(jR=function(e){_C(this,{type:EC,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=$R(CC,{then:function(e,t){var n=OC(this),r=kC(lC(this,RC));return r.ok=!oC(e)||e,r.fail=oC(t)&&t,r.domain=NC?MC.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&BC(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),FR=function(){var e=new jR,t=wC(e);this.promise=e,this.resolve=VC(XC,t),this.reject=VC(qC,t)},vC.f=kC=function(e){return e===RC||e===UR?new FR(e):AC(e)},oC(ZR)&&IC!==Object.prototype)){BR=IC.then,DC||(zR(IC,"then",(function(e,t){var n=this;return new RC((function(e,t){BR.call(n,e,t)})).then(e,t)}),{unsafe:!0}),zR(IC,"catch",CC.catch,{unsafe:!0}));try{delete IC.constructor}catch(e){}eC&&eC(IC,CC)}XR({global:!0,wrap:!0,forced:jC},{Promise:RC}),tC(RC,EC,!1),nC(EC),UR=QR(EC),XR({target:EC,stat:!0,forced:jC},{reject:function(e){var t=kC(this);return t.reject.call(void 0,e),t.promise}}),XR({target:EC,stat:!0,forced:jC},{resolve:function(e){return hC(this,e)}}),XR({target:EC,stat:!0,forced:FC},{all:function(e){var t=this,n=kC(t),r=n.resolve,o=n.reject,i=yC((function(){var n=rC(t.resolve),i=[],a=0,c=1;sC(e,(function(e){var s=a++,u=!1;i.push(void 0),c++,n.call(t,e).then((function(e){u||(u=!0,i[s]=e,--c||r(i))}),o)})),--c||r(i)}));return i.error&&o(i.value),n.promise},race:function(e){var t=this,n=kC(t),r=n.reject,o=yC((function(){var o=rC(t.resolve);sC(e,(function(e){o.call(t,e).then(n.resolve,r)}))}));return o.error&&r(o.value),n.promise}});var WC,QC=y_,ZC=S_,zC=Object.keys||function(e){return QC(e,ZC)},$C=KE,ex=qE,tx=zC,nx=cT?Object.defineProperties:function(e,t){ex(e);for(var n,r=tx(t),o=r.length,i=0;o>i;)$C.f(e,n=r[i++],t[n]);return e},rx=qE,ox=nx,ix=S_,ax=mw,cx=BI,sx=AE,ux=Sw("IE_PROTO"),lx=function(){},dx=function(e){return"<script>"+e+"<\/script>"},fx=function(e){e.write(dx("")),e.close();var t=e.parentWindow.Object;return e=null,t},hx=function(){try{WC=new ActiveXObject("htmlfile")}catch(e){}var e,t;hx="undefined"!=typeof document?document.domain&&WC?fx(WC):((t=sx("iframe")).style.display="none",cx.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(dx("document.F=Object")),e.close(),e.F):fx(WC);for(var n=ix.length;n--;)delete hx.prototype[ix[n]];return hx()};ax[ux]=!0;var px=Object.create||function(e,t){var n;return null!==e?(lx.prototype=rx(e),n=new lx,lx.prototype=null,n[ux]=e):n=hx(),void 0===t?n:ox(n,t)},vx=px,yx=KE,Sx=TE("unscopables"),mx=Array.prototype;null==mx[Sx]&&yx.f(mx,Sx,{configurable:!0,value:vx(null)});var gx,Nx,bx,Tx=function(e){mx[Sx][e]=!0},Ex=!aT((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),wx=uE,_x=ET,Ox=aE,Ix=Ex,Rx=Sw("IE_PROTO"),Cx=Object.prototype,xx=Ix?Object.getPrototypeOf:function(e){var t=Ox(e);if(wx(t,Rx))return t[Rx];var n=t.constructor;return _x(n)&&t instanceof n?n.prototype:t instanceof Object?Cx:null},Lx=aT,Mx=ET,kx=xx,Ax=nw.exports,Hx=TE("iterator"),Px=!1;[].keys&&("next"in(bx=[].keys())?(Nx=kx(kx(bx)))!==Object.prototype&&(gx=Nx):Px=!0),(null==gx||Lx((function(){var e={};return gx[Hx].call(e)!==e})))&&(gx={}),Mx(gx[Hx])||Ax(gx,Hx,(function(){return this}));var Dx={IteratorPrototype:gx,BUGGY_SAFARI_ITERATORS:Px},jx=Dx.IteratorPrototype,Fx=px,Ux=pT,Bx=zO,Jx=rI,Yx=function(){return this},Gx=K_,Kx=jw,Vx=ET,qx=function(e,t,n){var r=t+" Iterator";return e.prototype=Fx(jx,{next:Ux(1,n)}),Bx(e,r,!1),Jx[r]=Yx,e},Xx=xx,Wx=XO,Qx=zO,Zx=tw,zx=nw.exports,$x=rI,eL=Kx.PROPER,tL=Kx.CONFIGURABLE,nL=Dx.IteratorPrototype,rL=Dx.BUGGY_SAFARI_ITERATORS,oL=TE("iterator"),iL=function(){return this},aL=function(e,t,n,r,o,i,a){qx(n,t,r);var c,s,u,l=function(e){if(e===o&&v)return v;if(!rL&&e in h)return h[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",f=!1,h=e.prototype,p=h[oL]||h["@@iterator"]||o&&h[o],v=!rL&&p||l(o),y="Array"==t&&h.entries||p;if(y&&(c=Xx(y.call(new e)))!==Object.prototype&&c.next&&(Xx(c)!==nL&&(Wx?Wx(c,nL):Vx(c[oL])||zx(c,oL,iL)),Qx(c,d,!0)),eL&&"values"==o&&p&&"values"!==p.name&&(tL?Zx(h,"name","values"):(f=!0,v=function(){return p.call(this)})),o)if(s={values:l("values"),keys:i?v:l("keys"),entries:l("entries")},a)for(u in s)(rL||f||!(u in h))&&zx(h,u,s[u]);else Gx({target:t,proto:!0,forced:rL||f},s);return h[oL]!==v&&zx(h,oL,v,{name:o}),$x[t]=v,s},cL=TT,sL=Tx,uL=rI,lL=Mw,dL=aL,fL=lL.set,hL=lL.getterFor("Array Iterator"),pL=dL(Array,"Array",(function(e,t){fL(this,{type:"Array Iterator",target:cL(e),index:0,kind:t})}),(function(){var e=hL(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");uL.Arguments=uL.Array,sL("keys"),sL("values"),sL("entries");var vL=oO,yL=function(e){if("Symbol"===vL(e))throw TypeError("Cannot convert a Symbol value to a string");return String(e)},SL=zw,mL=yL,gL=gT,NL=function(e){return function(t,n){var r,o,i=mL(gL(t)),a=SL(n),c=i.length;return a<0||a>=c?e?"":void 0:(r=i.charCodeAt(a))<55296||r>56319||a+1===c||(o=i.charCodeAt(a+1))<56320||o>57343?e?i.charAt(a):r:e?i.slice(a,a+2):o-56320+(r-55296<<10)+65536}},bL={codeAt:NL(!1),charAt:NL(!0)},TL=bL.charAt,EL=yL,wL=Mw,_L=aL,OL=wL.set,IL=wL.getterFor("String Iterator");_L(String,"String",(function(e){OL(this,{type:"String Iterator",string:EL(e),index:0})}),(function(){var e,t=IL(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=TL(n,r),t.index+=e.length,{value:e,done:!1})}));var RL=AE("span").classList,CL=RL&&RL.constructor&&RL.constructor.prototype,xL=CL===Object.prototype?void 0:CL,LL=oT,ML={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},kL=xL,AL=pL,HL=tw,PL=TE,DL=PL("iterator"),jL=PL("toStringTag"),FL=AL.values,UL=function(e,t){if(e){if(e[DL]!==FL)try{HL(e,DL,FL)}catch(t){e[DL]=FL}if(e[jL]||HL(e,jL,t),ML[t])for(var n in AL)if(e[n]!==AL[n])try{HL(e,n,AL[n])}catch(t){e[n]=AL[n]}}};for(var BL in ML)UL(LL[BL]&&LL[BL].prototype,BL);UL(kL,"DOMTokenList");var JL=d_.includes,YL=Tx;K_({target:"Array",proto:!0},{includes:function(e){return JL(this,e,arguments.length>1?arguments[1]:void 0)}}),YL("includes");var GL=_T,KL=yT,VL=TE("match"),qL=function(e){var t;return GL(e)&&(void 0!==(t=e[VL])?!!t:"RegExp"==KL(e))},XL=qL,WL=TE("match"),QL=function(e){if(XL(e))throw TypeError("The method doesn't accept regular expressions");return e},ZL=gT,zL=yL;K_({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[WL]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~zL(ZL(this)).indexOf(zL(QL(e)),arguments.length>1?arguments[1]:void 0)}});var $L=qE,eM={},tM=aT,nM=oT.RegExp;eM.UNSUPPORTED_Y=tM((function(){var e=nM("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),eM.BROKEN_CARET=tM((function(){var e=nM("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));var rM,oM,iM=aT,aM=oT.RegExp,cM=iM((function(){var e=aM(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),sM=aT,uM=oT.RegExp,lM=sM((function(){var e=uM("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),dM=yL,fM=function(){var e=$L(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},hM=eM,pM=$T.exports,vM=px,yM=Mw.get,SM=cM,mM=lM,gM=RegExp.prototype.exec,NM=pM("native-string-replace",String.prototype.replace),bM=gM,TM=(rM=/a/,oM=/b*/g,gM.call(rM,"a"),gM.call(oM,"a"),0!==rM.lastIndex||0!==oM.lastIndex),EM=hM.UNSUPPORTED_Y||hM.BROKEN_CARET,wM=void 0!==/()??/.exec("")[1];(TM||wM||EM||SM||mM)&&(bM=function(e){var t,n,r,o,i,a,c,s=this,u=yM(s),l=dM(e),d=u.raw;if(d)return d.lastIndex=s.lastIndex,t=bM.call(d,l),s.lastIndex=d.lastIndex,t;var f=u.groups,h=EM&&s.sticky,p=fM.call(s),v=s.source,y=0,S=l;if(h&&(-1===(p=p.replace("y","")).indexOf("g")&&(p+="g"),S=l.slice(s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\n"!==l.charAt(s.lastIndex-1))&&(v="(?: "+v+")",S=" "+S,y++),n=new RegExp("^(?:"+v+")",p)),wM&&(n=new RegExp("^"+v+"$(?!\\s)",p)),TM&&(r=s.lastIndex),o=gM.call(h?n:s,S),h?o?(o.input=o.input.slice(y),o[0]=o[0].slice(y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:TM&&o&&(s.lastIndex=s.global?o.index+o[0].length:r),wM&&o&&o.length>1&&NM.call(o[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&f)for(o.groups=a=vM(null),i=0;i<f.length;i++)a[(c=f[i])[0]]=o[c[1]];return o});var _M=bM;K_({target:"RegExp",proto:!0,forced:/./.exec!==_M},{exec:_M});var OM=nw.exports,IM=_M,RM=aT,CM=TE,xM=tw,LM=CM("species"),MM=RegExp.prototype,kM=bL.charAt,AM=qE,HM=ET,PM=yT,DM=_M,jM=function(e,t,n,r){var o=CM(e),i=!RM((function(){var t={};return t[o]=function(){return 7},7!=""[e](t)})),a=i&&!RM((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[LM]=function(){return n},n.flags="",n[o]=/./[o]),n.exec=function(){return t=!0,null},n[o](""),!t}));if(!i||!a||n){var c=/./[o],s=t(o,""[e],(function(e,t,n,r,o){var a=t.exec;return a===IM||a===MM.exec?i&&!o?{done:!0,value:c.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}));OM(String.prototype,e,s[0]),OM(MM,o,s[1])}r&&xM(MM[o],"sham",!0)},FM=qL,UM=qE,BM=gT,JM=UI,YM=function(e,t,n){return t+(n?kM(e,t).length:1)},GM=o_,KM=yL,VM=QT,qM=function(e,t){var n=e.exec;if(HM(n)){var r=n.call(e,t);return null!==r&&AM(r),r}if("RegExp"===PM(e))return DM.call(e,t);throw TypeError("RegExp#exec called on incompatible receiver")},XM=_M,WM=aT,QM=eM.UNSUPPORTED_Y,ZM=[].push,zM=Math.min;jM("split",(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=KM(BM(this)),o=void 0===n?4294967295:n>>>0;if(0===o)return[];if(void 0===e)return[r];if(!FM(e))return t.call(r,e,o);for(var i,a,c,s=[],u=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,d=new RegExp(e.source,u+"g");(i=XM.call(d,r))&&!((a=d.lastIndex)>l&&(s.push(r.slice(l,i.index)),i.length>1&&i.index<r.length&&ZM.apply(s,i.slice(1)),c=i[0].length,l=a,s.length>=o));)d.lastIndex===i.index&&d.lastIndex++;return l===r.length?!c&&d.test("")||s.push(""):s.push(r.slice(l)),s.length>o?s.slice(0,o):s}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var o=BM(this),i=null==t?void 0:VM(t,e);return i?i.call(t,o,n):r.call(KM(o),t,n)},function(e,o){var i=UM(this),a=KM(e),c=n(r,i,a,o,r!==t);if(c.done)return c.value;var s=JM(i,RegExp),u=i.unicode,l=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(QM?"g":"y"),d=new s(QM?"^(?:"+i.source+")":i,l),f=void 0===o?4294967295:o>>>0;if(0===f)return[];if(0===a.length)return null===qM(d,a)?[a]:[];for(var h=0,p=0,v=[];p<a.length;){d.lastIndex=QM?0:p;var y,S=qM(d,QM?a.slice(p):a);if(null===S||(y=zM(GM(d.lastIndex+(QM?p:0)),a.length))===h)p=YM(a,p,u);else{if(v.push(a.slice(h,p)),v.length===f)return v;for(var m=1;m<=S.length-1;m++)if(v.push(S[m]),v.length===f)return v;p=h=y}}return v.push(a.slice(h)),v}]}),!!WM((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),QM);var $M=K_,ek=YO,tk=aT,nk=CT,rk=ET,ok=UI,ik=KR,ak=nw.exports;if($M({target:"Promise",proto:!0,real:!0,forced:!!ek&&tk((function(){ek.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=ok(this,nk("Promise")),n=rk(e);return this.then(n?function(n){return ik(t,e()).then((function(){return n}))}:e,n?function(n){return ik(t,e()).then((function(){throw n}))}:e)}}),rk(ek)){var ck=nk("Promise").prototype.finally;ek.prototype.finally!==ck&&ak(ek.prototype,"finally",ck,{unsafe:!0})}var sk={exports:{}};
/*!
        localForage -- Offline Storage, Improved
        Version 1.10.0
        https://localforage.github.io/localForage
        (c) 2013-2017 Mozilla, Apache License 2.0
    */sk.exports=function e(t,n,r){function o(a,c){if(!n[a]){if(!t[a]){if(!c&&nT)return nT(a);if(i)return i(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var u=n[a]={exports:{}};t[a][0].call(u.exports,(function(e){var n=t[a][1][e];return o(n||e)}),u,u.exports,e,t,n,r)}return n[a].exports}for(var i=nT,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){(function(e){var n,r,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var i=0,a=new o(l),c=e.document.createTextNode("");a.observe(c,{characterData:!0}),n=function(){c.data=i=++i%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)};else{var s=new e.MessageChannel;s.port1.onmessage=l,n=function(){s.port2.postMessage(0)}}var u=[];function l(){var e,t;r=!0;for(var n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}r=!1}t.exports=function(e){1!==u.push(e)||r||n()}}).call(this,void 0!==tT?tT:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var r=e(1);function o(){}var i={},a=["REJECTED"],c=["FULFILLED"],s=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,e!==o&&h(this,e)}function l(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return i.reject(e,t)}r===e?i.reject(e,new TypeError("Cannot resolve promise with itself")):i.resolve(e,r)}))}function f(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function h(e,t){var n=!1;function r(t){n||(n=!0,i.reject(e,t))}function o(t){n||(n=!0,i.resolve(e,t))}var a=p((function(){t(o,r)}));"error"===a.status&&r(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=u,u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===c||"function"!=typeof t&&this.state===a)return this;var n=new this.constructor(o);return this.state!==s?d(n,this.state===c?e:t,this.outcome):this.queue.push(new l(n,e,t)),n},l.prototype.callFulfilled=function(e){i.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){i.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},i.resolve=function(e,t){var n=p(f,t);if("error"===n.status)return i.reject(e,n.value);var r=n.value;if(r)h(e,r);else{e.state=c,e.outcome=t;for(var o=-1,a=e.queue.length;++o<a;)e.queue[o].callFulfilled(t)}return e},i.reject=function(e,t){e.state=a,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},u.resolve=function(e){return e instanceof this?e:i.resolve(new this(o),e)},u.reject=function(e){var t=new this(o);return i.reject(t,e)},u.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a=new Array(n),c=0,s=-1,u=new this(o);++s<n;)l(e[s],s);return u;function l(e,o){t.resolve(e).then((function(e){a[o]=e,++c!==n||r||(r=!0,i.resolve(u,a))}),(function(e){r||(r=!0,i.reject(u,e))}))}},u.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a,c=-1,s=new this(o);++c<n;)a=e[c],t.resolve(a).then((function(e){r||(r=!0,i.resolve(s,e))}),(function(e){r||(r=!0,i.reject(s,e))}));return s}},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==tT?tT:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function i(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var a=Promise;function c(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function s(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function u(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function l(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var d=void 0,f={},h=Object.prototype.toString;function p(e){return"boolean"==typeof d?a.resolve(d):function(e){return new a((function(t){var n=e.transaction("local-forage-detect-blob-support","readwrite"),r=i([""]);n.objectStore("local-forage-detect-blob-support").put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return d=e}))}function v(e){var t=f[e.name],n={};n.promise=new a((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function y(e){var t=f[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function S(e,t){var n=f[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function m(e,t){return new a((function(n,r){if(f[e.name]=f[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);v(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var a=o.open.apply(o,i);t&&(a.onupgradeneeded=function(t){var n=a.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore("local-forage-detect-blob-support")}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),r(a.error)},a.onsuccess=function(){var t=a.result;t.onversionchange=function(e){e.target.close()},n(t),y(e)}}))}function g(e){return m(e,!1)}function N(e){return m(e,!0)}function b(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,o=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||n){if(n){var i=e.db.version+1;i>e.version&&(e.version=i)}return!0}return!1}function T(e){return i([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),o=0;o<t;o++)r[o]=e.charCodeAt(o);return n}(atob(e.data))],{type:e.type})}function E(e){return e&&e.__local_forage_encoded_blob}function w(e){var t=this,n=t._initReady().then((function(){var e=f[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return s(n,e,e),n}function _(e,t,n,r){void 0===r&&(r=1);try{var o=e.db.transaction(e.storeName,t);n(null,o)}catch(o){if(r>0&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return a.resolve().then((function(){if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),N(e)})).then((function(){return function(e){v(e);for(var t=f[e.name],n=t.forages,r=0;r<n.length;r++){var o=n[r];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,g(e).then((function(t){return e.db=t,b(e)?N(e):t})).then((function(r){e.db=t.db=r;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=r})).catch((function(t){throw S(e,t),t}))}(e).then((function(){_(e,t,n,r-1)}))})).catch(n);n(o)}}var O={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var o=f[n.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},f[n.name]=o),o.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=w);var i=[];function c(){return a.resolve()}for(var s=0;s<o.forages.length;s++){var u=o.forages[s];u!==t&&i.push(u._initReady().catch(c))}var l=o.forages.slice(0);return a.all(i).then((function(){return n.db=o.db,g(n)})).then((function(e){return n.db=e,b(n,t._defaultConfig.version)?N(n):e})).then((function(e){n.db=o.db=e,t._dbInfo=n;for(var r=0;r<l.length;r++){var i=l[r];i!==t&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}}))},_support:function(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){_(n._dbInfo,"readonly",(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).openCursor(),c=1;a.onsuccess=function(){var n=a.result;if(n){var r=n.value;E(r)&&(r=T(r));var o=e(r,n.key,c++);void 0!==o?t(o):n.continue()}else t()},a.onerror=function(){r(a.error)}}catch(e){r(e)}}))})).catch(r)}));return c(r,t),r},getItem:function(e,t){var n=this;e=u(e);var r=new a((function(t,r){n.ready().then((function(){_(n._dbInfo,"readonly",(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),E(e)&&(e=T(e)),t(e)},a.onerror=function(){r(a.error)}}catch(e){r(e)}}))})).catch(r)}));return c(r,t),r},setItem:function(e,t,n){var r=this;e=u(e);var o=new a((function(n,o){var i;r.ready().then((function(){return i=r._dbInfo,"[object Blob]"===h.call(t)?p(i.db).then((function(e){return e?t:(n=t,new a((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){_(r._dbInfo,"readwrite",(function(i,a){if(i)return o(i);try{var c=a.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var s=c.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),n(t)},a.onabort=a.onerror=function(){var e=s.error?s.error:s.transaction.error;o(e)}}catch(e){o(e)}}))})).catch(o)}));return c(o,n),o},removeItem:function(e,t){var n=this;e=u(e);var r=new a((function(t,r){n.ready().then((function(){_(n._dbInfo,"readwrite",(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).delete(e);i.oncomplete=function(){t()},i.onerror=function(){r(a.error)},i.onabort=function(){var e=a.error?a.error:a.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return c(r,t),r},clear:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){_(t._dbInfo,"readwrite",(function(r,o){if(r)return n(r);try{var i=o.objectStore(t._dbInfo.storeName).clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){var e=i.error?i.error:i.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return c(n,e),n},length:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){_(t._dbInfo,"readonly",(function(r,o){if(r)return n(r);try{var i=o.objectStore(t._dbInfo.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){n(i.error)}}catch(e){n(e)}}))})).catch(n)}));return c(n,e),n},key:function(e,t){var n=this,r=new a((function(t,r){e<0?t(null):n.ready().then((function(){_(n._dbInfo,"readonly",(function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName),c=!1,s=a.openKeyCursor();s.onsuccess=function(){var n=s.result;n?0===e||c?t(n.key):(c=!0,n.advance(e)):t(null)},s.onerror=function(){r(s.error)}}catch(e){r(e)}}))})).catch(r)}));return c(r,t),r},keys:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){_(t._dbInfo,"readonly",(function(r,o){if(r)return n(r);try{var i=o.objectStore(t._dbInfo.storeName).openKeyCursor(),a=[];i.onsuccess=function(){var t=i.result;t?(a.push(t.key),t.continue()):e(a)},i.onerror=function(){n(i.error)}}catch(e){n(e)}}))})).catch(n)}));return c(n,e),n},dropInstance:function(e,t){t=l.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;if(e.name){var s=e.name===n.name&&i._dbInfo.db,u=s?a.resolve(i._dbInfo.db):g(e).then((function(t){var n=f[e.name],r=n.forages;n.db=t;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=t;return t}));r=e.storeName?u.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;v(e);var r=f[e.name],i=r.forages;t.close();for(var c=0;c<i.length;c++){var s=i[c];s._dbInfo.db=null,s._dbInfo.version=n}return new a((function(t,r){var i=o.open(e.name,n);i.onerror=function(e){i.result.close(),r(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,y(n._dbInfo)}})).catch((function(t){throw(S(e,t)||a.resolve()).catch((function(){})),t}))}})):u.then((function(t){v(e);var n=f[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;return new a((function(t,n){var r=o.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)y(r[t]._dbInfo)})).catch((function(t){throw(S(e,t)||a.resolve()).catch((function(){})),t}))}))}else r=a.reject("Invalid arguments");return c(r,t),r}},I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",R=/^~~local_forage_type~([^~]+)~/,C="__lfsc__:".length,x=C+"arbf".length,L=Object.prototype.toString;function M(e){var t,n,r,o,i,a=.75*e.length,c=e.length,s=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),l=new Uint8Array(u);for(t=0;t<c;t+=4)n=I.indexOf(e[t]),r=I.indexOf(e[t+1]),o=I.indexOf(e[t+2]),i=I.indexOf(e[t+3]),l[s++]=n<<2|r>>4,l[s++]=(15&r)<<4|o>>2,l[s++]=(3&o)<<6|63&i;return u}function k(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=I[n[t]>>2],r+=I[(3&n[t])<<4|n[t+1]>>4],r+=I[(15&n[t+1])<<2|n[t+2]>>6],r+=I[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var A={serialize:function(e,t){var n="";if(e&&(n=L.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===L.call(e.buffer))){var r,o="__lfsc__:";e instanceof ArrayBuffer?(r=e,o+="arbf"):(r=e.buffer,"[object Int8Array]"===n?o+="si08":"[object Uint8Array]"===n?o+="ui08":"[object Uint8ClampedArray]"===n?o+="uic8":"[object Int16Array]"===n?o+="si16":"[object Uint16Array]"===n?o+="ur16":"[object Int32Array]"===n?o+="si32":"[object Uint32Array]"===n?o+="ui32":"[object Float32Array]"===n?o+="fl32":"[object Float64Array]"===n?o+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(o+k(r))}else if("[object Blob]"===n){var i=new FileReader;i.onload=function(){var n="~~local_forage_type~"+e.type+"~"+k(this.result);t("__lfsc__:blob"+n)},i.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if("__lfsc__:"!==e.substring(0,C))return JSON.parse(e);var t,n=e.substring(x),r=e.substring(C,x);if("blob"===r&&R.test(n)){var o=n.match(R);t=o[1],n=n.substring(o[0].length)}var a=M(n);switch(r){case"arbf":return a;case"blob":return i([a],{type:t});case"si08":return new Int8Array(a);case"ui08":return new Uint8Array(a);case"uic8":return new Uint8ClampedArray(a);case"si16":return new Int16Array(a);case"ur16":return new Uint16Array(a);case"si32":return new Int32Array(a);case"ui32":return new Uint32Array(a);case"fl32":return new Float32Array(a);case"fl64":return new Float64Array(a);default:throw new Error("Unkown type: "+r)}},stringToBuffer:M,bufferToString:k};function H(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function P(e,t,n,r,o,i){e.executeSql(n,r,o,(function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,c){c.rows.length?i(e,a):H(e,t,(function(){e.executeSql(n,r,o,i)}),i)}),i):i(e,a)}),i)}function D(e,t,n,r){var o=this;e=u(e);var i=new a((function(i,a){o.ready().then((function(){void 0===t&&(t=null);var c=t,s=o._dbInfo;s.serializer.serialize(t,(function(t,u){u?a(u):s.db.transaction((function(n){P(n,s,"INSERT OR REPLACE INTO "+s.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){i(c)}),(function(e,t){a(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void i(D.apply(o,[e,c,n,r-1]));a(t)}}))}))})).catch(a)}));return c(i,n),i}function j(e){return new a((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var o=[],i=0;i<r.rows.length;i++)o.push(r.rows.item(i).name);t({db:e,storeNames:o})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}var F={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var o=new a((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(o){H(o,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=A,o},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){P(n,o,"SELECT * FROM "+o.storeName,[],(function(n,r){for(var i=r.rows,a=i.length,c=0;c<a;c++){var s=i.item(c),u=s.value;if(u&&(u=o.serializer.deserialize(u)),void 0!==(u=e(u,s.key,c+1)))return void t(u)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return c(r,t),r},getItem:function(e,t){var n=this;e=u(e);var r=new a((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){P(n,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=o.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return c(r,t),r},setItem:function(e,t,n){return D.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=u(e);var r=new a((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){P(n,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return c(r,t),r},clear:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){P(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return c(n,e),n},length:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){P(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return c(n,e),n},key:function(e,t){var n=this,r=new a((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){P(n,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return c(r,t),r},keys:function(e){var t=this,n=new a((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){P(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return c(n,e),n},dropInstance:function(e,t){t=l.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,o=this;return c(r=e.name?new a((function(t){var r;r=e.name===n.name?o._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(j(r))})).then((function(e){return new a((function(t,n){e.db.transaction((function(r){function o(e){return new a((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var i=[],c=0,s=e.storeNames.length;c<s;c++)i.push(o(e.storeNames[c]));a.all(i).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):a.reject("Invalid arguments"),t),r}};function U(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function B(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0}var J={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=U(e,this._defaultConfig),B()?(this._dbInfo=t,t.serializer=A,a.resolve()):a.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,o=r.length,i=localStorage.length,a=1,c=0;c<i;c++){var s=localStorage.key(c);if(0===s.indexOf(r)){var u=localStorage.getItem(s);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,s.substring(o),a++)))return u}}}));return c(r,t),r},getItem:function(e,t){var n=this;e=u(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return c(r,t),r},setItem:function(e,t,n){var r=this;e=u(e);var o=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new a((function(o,i){var a=r._dbInfo;a.serializer.serialize(t,(function(t,r){if(r)i(r);else try{localStorage.setItem(a.keyPrefix+e,t),o(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||i(e),i(e)}}))}))}));return c(o,n),o},removeItem:function(e,t){var n=this;e=u(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return c(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return c(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return c(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return c(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],o=0;o<n;o++){var i=localStorage.key(o);0===i.indexOf(e.keyPrefix)&&r.push(i.substring(e.keyPrefix.length))}return r}));return c(n,e),n},dropInstance:function(e,t){if(t=l.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,o=this;return c(r=e.name?new a((function(t){e.storeName?t(U(e,o._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):a.reject("Invalid arguments"),t),r}},Y=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},G=function(e,t){for(var n=e.length,r=0;r<n;){if(Y(e[r],t))return!0;r++}return!1},K=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},V={},q={},X={INDEXEDDB:O,WEBSQL:F,LOCALSTORAGE:J},W=[X.INDEXEDDB._driver,X.WEBSQL._driver,X.LOCALSTORAGE._driver],Q=["dropInstance"],Z=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Q),z={description:"",driver:W.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function $(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function ee(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(K(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var te=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),X)if(X.hasOwnProperty(n)){var r=X[n],o=r._driver;this[n]=o,V[o]||this.defineDriver(r)}this._defaultConfig=ee({},z),this._config=ee({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new a((function(t,n){try{var r=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(o);for(var i=Z.concat("_initStorage"),s=0,u=i.length;s<u;s++){var l=i[s];if((!G(Q,l)||e[l])&&"function"!=typeof e[l])return void n(o)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=a.reject(t);return c(n,arguments[arguments.length-1]),n}},n=0,r=Q.length;n<r;n++){var o=Q[n];e[o]||(e[o]=t(o))}}();var d=function(n){V[r]&&console.info("Redefining LocalForage driver: "+r),V[r]=e,q[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(d,n):d(!!e._support):d(!0)}catch(e){n(e)}}));return s(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=V[e]?a.resolve(V[e]):a.reject(new Error("Driver not found."));return s(r,t,n),r},e.prototype.getSerializer=function(e){var t=a.resolve(A);return s(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return s(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;K(e)||(e=[e]);var o=this._getSupportedDrivers(e);function i(){r._config.driver=r.driver()}function c(e){return r._extend(e),i(),r._ready=r._initStorage(r._config),r._ready}var u=null!==this._driverSet?this._driverSet.catch((function(){return a.resolve()})):a.resolve();return this._driverSet=u.then((function(){var e=o[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,i(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var o=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(o).then(c).catch(n)}i();var s=new Error("No available storage method found.");return r._driverSet=a.reject(s),r._driverSet}()}}(o)}))})).catch((function(){i();var e=new Error("No available storage method found.");return r._driverSet=a.reject(e),r._driverSet})),s(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!q[e]},e.prototype._extend=function(e){ee(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n];this.supports(o)&&t.push(o)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=Z.length;e<t;e++)$(this,Z[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=te},{3:3}]},{},[4])(4);var uk=sk.exports,lk=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qb(e,t)}(i,e);var t,n,r,o=Qb(i);function i(){var e;Yb(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Kb(Xb(e=o.call.apply(o,[this].concat(n))),"projectId",2),e}return t=i,(n=[{key:"addSurvey",value:function(e){var t=this;if(e.projectId!==this.projectId)throw new Error("Survey project id '".concat(e.projectId," does not match with current project ('").concat(this.projectId,"')"));this.surveys.has(e.id)||(console.log("setting survey's modified/save handler"),e.addListener(cS.EVENT_MODIFIED,this,(function(e){return t.fireEvent(pS.EVENT_SURVEYS_CHANGED),e.save()}))),this.surveys.set(e.id,e),this.fireEvent(pS.EVENT_SURVEYS_CHANGED)}},{key:"haveExtantOccurrences",value:function(){var e,t=eT(this.occurrences);try{for(t.s();!(e=t.n()).done;)if(!e.value.deleted)return!0}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"addOccurrence",value:function(e){var t=this;if(!e.surveyId)throw new dv("Survey id must set prior to registering occurrence.");0===this.occurrences.size&&(this.surveys.get(e.surveyId).createdStamp=e.createdStamp),this.occurrences.set(e.id,e),e.addListener(lv.EVENT_MODIFIED,this,(function(e){var n=t.surveys.get(e.surveyId);if(!n)throw new Error("Failed to look up survey id ".concat(e.surveyId));n.unsaved()&&n.save(),e.save(n.id)}))}},{key:"refreshFromServer",value:function(e){var t,n=this,r=new FormData,o=0,a=eT(e);try{for(a.s();!(t=a.n()).done;){var c=t.value;r.append("surveyId[".concat(o++,"]"),c)}}catch(e){a.e(e)}finally{a.f()}return fetch(i.LOAD_SURVEYS_ENDPOINT,{method:"POST",body:r}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response from server when refreshing survey ids")})).then((function(e){console.log({"refresh from server json response":e});var t=[];for(var r in e)if(e.hasOwnProperty(r)){var o,i=eT(e[r]);try{for(i.s();!(o=i.n()).done;){var a=o.value;t.push(n._conditionallyReplaceObject(a))}}catch(e){i.e(e)}finally{i.f()}}return Promise.all(t)}))}},{key:"_conditionallyReplaceObject",value:function(e){var t=e.type,n=e.id,r="".concat(t,".").concat(n);return uk.getItem(r).then((function(t){return t&&!e.deleted&&t.modified>=e.modified?(console.log("Local copy of ".concat(r," is the same or newer than the server copy. (").concat(t.modified," >= ").concat(e.modified,") ")),Promise.resolve()):(console.log("Adding or replacing local copy of ".concat(r)),uk.setItem(r,e))}))}},{key:"seekKeys",value:function(e){return uk.keys().then((function(t){var n,r=eT(t);try{for(r.s();!(n=r.n()).done;){var o,i,a=n.value,c=Zb(a.split(".",2),2);o=c[0],i=c[1],e.hasOwnProperty(o)?e[o].includes(i)||e[o].push(i):console.log("Unrecognised stored key type '".concat(o,"."))}}catch(e){r.e(e)}finally{r.f()}return e}))}},{key:"syncAll",value:function(){var e=this;return this.seekKeys({survey:[],occurrence:[],image:[]}).then((function(t){return e._syncLocalUnsaved(t)}),(function(e){console.log("Failed to sync all: ".concat(e))}))}},{key:"_syncLocalUnsaved",value:function(e){var t,n=[],r=eT(e.survey);try{for(r.s();!(t=r.n()).done;){var o=t.value;n.push(cS.retrieveFromLocal(o,new cS).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){r.e(e)}finally{r.f()}var i,a=eT(e.occurrence);try{for(a.s();!(i=a.n()).done;){var c=i.value;n.push(lv.retrieveFromLocal(c,new lv).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){a.e(e)}finally{a.f()}var s,u=eT(e.image);try{for(u.s();!(s=u.n()).done;){var l=s.value;n.push(sS.retrieveFromLocal(l,new sS).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){u.e(e)}finally{u.f()}return Promise.all(n).catch((function(e){console.log("Save failure: ".concat(e))}))}},{key:"restoreOccurrences",value:function(e){var t=this;if(this.surveys.has(e)){var n=this.surveys.get(e);if(n.isPristine)return this.currentSurvey=n,this.fireEvent(pS.EVENT_SURVEYS_CHANGED),Promise.resolve()}var r={survey:[],occurrence:[],image:[]};return e&&(r.survey[0]=e),this.seekKeys(r).then((function(e){return e.survey.length?t.refreshFromServer(e.survey).finally((function(){return t.seekKeys(e)})):null})).finally((function(){return r.survey.length?t._restoreSurveyFromLocal(r.survey[0],r).finally((function(){return t.currentSurvey=t.surveys.get(r.survey[0]),t.currentSurvey?(t.currentSurvey.deleted?t.setNewSurvey():t.fireEvent(pS.EVENT_SURVEYS_CHANGED),Promise.resolve()):(console.log("Failed to retrieve survey id '".concat(e,"'")),Promise.reject(new Error("Failed to retrieve survey id '".concat(e,"'"))))})):(t.setNewSurvey(),Promise.resolve())}))}},{key:"setNewSurvey",value:function(){this.currentSurvey=new cS,this.currentSurvey.projectId=this.projectId,this.currentSurvey.isPristine=!0,this.addSurvey(this.currentSurvey)}},{key:"addNewOccurrence",value:function(){var e=new lv;return e.surveyId=this.currentSurvey.id,e.projectId=this.projectId,e.isNew=!0,e.isPristine=!0,this.addOccurrence(e),this.fireEvent(i.EVENT_OCCURRENCE_ADDED,{occurrenceId:e.id,surveyId:e.surveyId}),e}},{key:"_restoreSurveyFromLocal",value:function(e,t){var n=this;return cS.retrieveFromLocal(e,new cS).then((function(r){n.clearCurrentSurvey(),n.addSurvey(r);var o,i=[],a=eT(t.occurrence);try{for(a.s();!(o=a.n()).done;){var c=o.value;i.push(lv.retrieveFromLocal(c,new lv).then((function(t){t.surveyId===e&&n.addOccurrence(t)})))}}catch(e){a.e(e)}finally{a.f()}return Promise.all(i)})).finally((function(){var n,r=[],o=eT(t.image);try{var i=function(){var t=n.value;r.push(sS.retrieveFromLocal(t,new sS).then((function(n){n.surveyId===e&&sS.imageCache.set(t,n)}),(function(e){console.log("Failed to retrieve an image: ".concat(e))})))};for(o.s();!(n=o.n()).done;)i()}catch(e){o.e(e)}finally{o.f()}return Promise.all(r)}))}},{key:"clearLocalForage",value:function(){return uk.clear()}}])&&Gb(t.prototype,n),r&&Gb(t,r),i}(pS);Kb(lk,"forageName","Nyph App"),Kb(lk,"LOAD_SURVEYS_ENDPOINT","/loadsurveys.php"),Kb(lk,"EVENT_OCCURRENCE_ADDED","occurrenceadded"),Kb(lk,"EVENT_SURVEYS_CHANGED","surveyschanged"),Kb(lk,"devMode",!1),(new XS).initialise({forageName:lk.forageName,postPassThroughWhitelist:/^https:\/\/nyphtest\.bsbi\.org\/loadsurveys.php/,postImageUrlMatch:/^https:\/\/nyphtest\.bsbi\.org\/saveimage.php/,getImageUrlMatch:/^https:\/\/nyphtest\.bsbi\.org\/image\.php/,interceptUrlMatches:/(?:^https:\/\/nyphtest\.bsbi\.org\/app\/|^https:\/\/nyphtest\.bsbi\.org\/app$)/,ignoreUrlMatches:/(?:^https:\/\/nyphtest\.bsbi\.org\/app\/app\.js|^https:\/\/nyphtest\.bsbi\.org\/app\/serviceworker\.js|^https:\/\/nyphtest\.bsbi\.org\/app\/manifest\.webmanifest|^https:\/\/nyphtest\.bsbi\.org\/app\/index\.html)/,indexUrl:"https://nyphtest.bsbi.org/app/index.html",urlCacheSet:["./index.html","./manifest.webmanifest","/appcss/app.css","/appcss/theme.css","/img/BSBIlong.png","https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Round","https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css","https://database.bsbi.org/js/taxonnames.js.php","https://code.jquery.com/jquery-3.3.1.slim.min.js","https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js","https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js","https://fonts.googleapis.com/css2?family=Gentium+Basic&display=swap"],version:"1.0.1.1634307110"})}();
//# sourceMappingURL=serviceworker.js.map
